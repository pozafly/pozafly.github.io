<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.5.0"/><meta data-react-helmet="true" name="description" content="API Routes를 사용하면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적."/><meta data-react-helmet="true" property="og:site_name" content="Pozafly Blog"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Next.js의 API Routes 코드 모듈화에 대해서"/><meta data-react-helmet="true" property="og:description" content="API Routes를 사용하면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적."/><meta data-react-helmet="true" property="og:url" content="https://pozafly.github.io/nextjs/about-modularizing-api-routes-code-in-nextjs/"/><meta data-react-helmet="true" property="og:image" content="https://pozafly.github.io/static/6763177ee50addd67c4dc57952797f69/231da/main.webp"/><meta data-react-helmet="true" property="article:published_time" content="2023-07-26"/><meta data-react-helmet="true" property="article:tag" content="Next.js"/><meta data-react-helmet="true" property="article:publisher" content="https://www.instagram.com/pozafly_/"/><meta data-react-helmet="true" property="article:author" content="https://www.instagram.com/pozafly_/"/><meta data-react-helmet="true" name="github:card" content="summary_large_image"/><meta data-react-helmet="true" name="github:title" content="Next.js의 API Routes 코드 모듈화에 대해서"/><meta data-react-helmet="true" name="github:description" content="API Routes를 사용하면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적."/><meta data-react-helmet="true" name="github:url" content="https://pozafly.github.io/nextjs/about-modularizing-api-routes-code-in-nextjs/"/><meta data-react-helmet="true" name="github:image" content="https://pozafly.github.io/static/6763177ee50addd67c4dc57952797f69/231da/main.webp"/><meta data-react-helmet="true" name="github:label1" content="Written by"/><meta data-react-helmet="true" name="github:data1" content="Pozafly"/><meta data-react-helmet="true" name="github:label2" content="Filed under"/><meta data-react-helmet="true" name="github:data2" content="Next.js"/><meta data-react-helmet="true" name="github:site" content="@pozafly"/><meta data-react-helmet="true" name="github:creator" content="@pozafly"/><meta data-react-helmet="true" property="og:image:width" content="1"/><meta data-react-helmet="true" property="og:image:height" content="0.5234375"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .auto-link.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .auto-link.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .auto-link svg,
    h2 .auto-link svg,
    h3 .auto-link svg,
    h4 .auto-link svg,
    h5 .auto-link svg,
    h6 .auto-link svg {
      visibility: hidden;
    }
    h1:hover .auto-link svg,
    h2:hover .auto-link svg,
    h3:hover .auto-link svg,
    h4:hover .auto-link svg,
    h5:hover .auto-link svg,
    h6:hover .auto-link svg,
    h1 .auto-link:focus svg,
    h2 .auto-link:focus svg,
    h3 .auto-link:focus svg,
    h4 .auto-link:focus svg,
    h5 .auto-link:focus svg,
    h6 .auto-link:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://pozafly.github.io/nextjs/about-modularizing-api-routes-code-in-nextjs/" data-baseprotocol="https:" data-basehost="pozafly.github.io"/><title data-react-helmet="true">Next.js의 API Routes 코드 모듈화에 대해서</title><link data-react-helmet="true" rel="icon" href="/static/alien-652bde6f766dc3e52bdf32391ba54a09.png" type="image/x-icon"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SLQNH3ND3J"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-SLQNH3ND3J',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SLQNH3ND3J', {"anonymize_ip":true,"cookie_expires":0,"send_page_view":false});
      }
      </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="post-template"><style data-emotion="css-global n84pzt">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,dl,dt,dd,ol,fieldset,form,label,legend,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;font-size:93%;vertical-align:baseline;}html .copyright,body .copyright,div .copyright,span .copyright,applet .copyright,object .copyright,iframe .copyright,h1 .copyright,h2 .copyright,h3 .copyright,h4 .copyright,h5 .copyright,h6 .copyright,p .copyright,blockquote .copyright,pre .copyright,a .copyright,abbr .copyright,acronym .copyright,address .copyright,big .copyright,cite .copyright,code .copyright,del .copyright,dfn .copyright,em .copyright,img .copyright,ins .copyright,kbd .copyright,q .copyright,s .copyright,samp .copyright,small .copyright,strike .copyright,strong .copyright,sub .copyright,sup .copyright,tt .copyright,var .copyright,dl .copyright,dt .copyright,dd .copyright,ol .copyright,fieldset .copyright,form .copyright,label .copyright,legend .copyright,article .copyright,aside .copyright,canvas .copyright,details .copyright,embed .copyright,figure .copyright,figcaption .copyright,footer .copyright,header .copyright,hgroup .copyright,menu .copyright,nav .copyright,output .copyright,ruby .copyright,section .copyright,summary .copyright,time .copyright,mark .copyright,audio .copyright,video .copyright{font-size:1.4rem;}html .error-front-page,body .error-front-page,div .error-front-page,span .error-front-page,applet .error-front-page,object .error-front-page,iframe .error-front-page,h1 .error-front-page,h2 .error-front-page,h3 .error-front-page,h4 .error-front-page,h5 .error-front-page,h6 .error-front-page,p .error-front-page,blockquote .error-front-page,pre .error-front-page,a .error-front-page,abbr .error-front-page,acronym .error-front-page,address .error-front-page,big .error-front-page,cite .error-front-page,code .error-front-page,del .error-front-page,dfn .error-front-page,em .error-front-page,img .error-front-page,ins .error-front-page,kbd .error-front-page,q .error-front-page,s .error-front-page,samp .error-front-page,small .error-front-page,strike .error-front-page,strong .error-front-page,sub .error-front-page,sup .error-front-page,tt .error-front-page,var .error-front-page,dl .error-front-page,dt .error-front-page,dd .error-front-page,ol .error-front-page,fieldset .error-front-page,form .error-front-page,label .error-front-page,legend .error-front-page,article .error-front-page,aside .error-front-page,canvas .error-front-page,details .error-front-page,embed .error-front-page,figure .error-front-page,figcaption .error-front-page,footer .error-front-page,header .error-front-page,hgroup .error-front-page,menu .error-front-page,nav .error-front-page,output .error-front-page,ruby .error-front-page,section .error-front-page,summary .error-front-page,time .error-front-page,mark .error-front-page,audio .error-front-page,video .error-front-page{font-size:1.6rem;}body{line-height:1;word-break:keep-all;}ol,ul{list-style:none;}blockquote,q{quotes:none;}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none;}table{border-spacing:0;border-collapse:collapse;}img{max-width:100%;}html{box-sizing:border-box;font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;}*,*:before,*:after{box-sizing:inherit;}a{background-color:transparent;}a:active,a:hover{outline:0;}b,strong{font-weight:bold;}i,em,dfn{font-style:italic;}h1{margin:0.67em 0;font-size:2em;}small{font-size:80%;}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline;}sup{top:-0.5em;}sub{bottom:-0.25em;}img{border:0;}svg:not(:root){overflow:hidden;}mark{background-color:#fdffb6;}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em;}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit;}button{overflow:visible;border:none;}button,select{text-transform:none;}button,html input[type='button'],input[type='reset'],input[type='submit']{cursor:pointer;-webkit-appearance:button;}button[disabled],html input[disabled]{cursor:default;}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0;}input{line-height:normal;}input:focus{outline:none;}input[type='checkbox'],input[type='radio']{box-sizing:border-box;padding:0;}input[type='number']::-webkit-inner-spin-button,input[type='number']::-webkit-outer-spin-button{height:auto;}input[type='search']{box-sizing:content-box;-webkit-appearance:textfield;}input[type='search']::-webkit-search-cancel-button,input[type='search']::-webkit-search-decoration{-webkit-appearance:none;}legend{padding:0;border:0;}textarea{overflow:auto;}table{border-spacing:0;border-collapse:collapse;}td,th{padding:0;}html{overflow-x:hidden;overflow-y:scroll;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);}body{overflow-x:hidden;color:#303a3e;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:1.6rem;line-height:1.6em;font-weight:400;font-style:normal;letter-spacing:0;text-rendering:optimizeLegibility;background:#fff;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-moz-font-feature-settings:'liga' on;}body::-webkit-scrollbar{background-color:transparent;width:6px;}body::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}::selection{text-shadow:none;background:#3498db;}hr{position:relative;display:block;width:100%;margin:2.5em 0 3.5em;padding:0;height:1px;border:0;border-top:1px solid #e4eaed;}audio,canvas,iframe,img,svg,video{vertical-align:middle;}fieldset{margin:0;padding:0;border:0;}textarea{resize:vertical;}p,ul,ol,dl,blockquote{margin:0 0 1.5em 0;}ol,ul{padding-left:1.3em;}ol ol,ul ul,ul ol,ol ul{margin:0.5em 0 1em;}ul{list-style:disc;}ol{list-style:decimal;}ul,ol{max-width:100%;}li{margin:0.5em 0;padding-left:0.3em;line-height:1.6em;}dt{float:left;margin:0 20px 0 0;width:120px;color:#15171A;font-weight:500;text-align:right;}dd{margin:0 0 5px 0;text-align:left;}blockquote{margin:1.5em 0;padding:0 1.6em 0 1.6em;border-left:#e5eff5 0.5em solid;}blockquote p{margin:0.8em 0;font-size:1.2em;font-weight:400;}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;font-size:0.9em;opacity:0.8;}blockquote cite{font-weight:bold;}blockquote cite a{font-weight:normal;}a{color:#768086;-webkit-text-decoration:none;text-decoration:none;}@media (prefers-color-scheme: dark){a{color:#90a2aa;}}a:hover{-webkit-text-decoration:underline;text-decoration:underline;}h1,h2,h3,h4,h5,h6{margin-top:0;line-height:1.15;font-weight:600;text-rendering:optimizeLegibility;}h1{margin:0 0 0.5em 0;font-size:5.5rem;font-weight:600;}@media (max-width: 500px){h1{font-size:2.2rem;}}h2{margin:1.5em 0 0.5em 0;font-size:2.2rem;}@media (max-width: 500px){h2{font-size:1.8rem;}}h3{margin:1.5em 0 0.5em 0;font-size:1.8rem;font-weight:500;}@media (max-width: 500px){h3{font-size:1.7rem;}}h4{margin:1.5em 0 0.5em 0;font-size:1.6rem;font-weight:500;}h5{margin:1.5em 0 0.5em 0;font-size:1.4rem;font-weight:500;}h6{margin:1.5em 0 0.5em 0;font-size:1.4rem;font-weight:500;}body{background:#fff;}h1 a.auto-link svg,h2 a.auto-link svg,h3 a.auto-link svg,h4 a.auto-link svg,h5 a.auto-link svg,h6 a.auto-link svg{opacity:0;-webkit-transition:0.25s ease;transition:0.25s ease;}h1:hover a.auto-link svg,h2:hover a.auto-link svg,h3:hover a.auto-link svg,h4:hover a.auto-link svg,h5:hover a.auto-link svg,h6:hover a.auto-link svg{opacity:1;}a.auto-link{box-shadow:none!important;}a.auto-link svg{fill:#0a0b0c!important;}a.auto-link:hover{box-shadow:none!important;}@media (prefers-color-scheme: dark){body{color:rgba(255, 255, 255, 0.75);background:#191b1f;}img{opacity:0.9;}a.auto-link svg{fill:rgba(255, 255, 255, 0.9)!important;}}.medium-zoom-overlay{-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);}.gatsby-resp-image-background-image{border-radius:6px;}.gatsby-resp-image-wrapper{width:80%;}@media (max-width: 800px){.gatsby-resp-image-wrapper{width:100%;}}.medium-zoom-image{box-shadow:none!important;}</style><style data-emotion="css wv5on3">.css-wv5on3 .site-main{margin-top:64px;background:#fff;padding-bottom:4vw;}@media (prefers-color-scheme: dark){.css-wv5on3 .site-main{background:#191b1f;}}</style><style data-emotion="css 1qvd43r">.css-1qvd43r{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}.css-1qvd43r .site-main{margin-top:64px;background:#fff;padding-bottom:4vw;}@media (prefers-color-scheme: dark){.css-1qvd43r .site-main{background:#191b1f;}}</style><div class="css-1qvd43r esvym2d0"><header class="site-header"><style data-emotion="css wuurd5">.css-wuurd5{position:relative;padding:0 5vw;position:fixed;top:0;right:0;left:0;z-index:1000;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);background:transparent;}</style><div class="css-wuurd5"><style data-emotion="css y521qa">.css-y521qa{margin:0 auto;max-width:1040px;width:100%;}</style><div class="css-y521qa"><style data-emotion="css lcmrfl">.css-lcmrfl{position:relative;z-index:100;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;overflow-y:hidden;height:64px;font-size:1.3rem;}</style><nav class="css-lcmrfl"><style data-emotion="css axoi21">.css-axoi21{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;margin-right:10px;padding:10px 0 80px;font-weight:500;letter-spacing:0.2px;text-transform:uppercase;white-space:nowrap;-ms-overflow-scrolling:touch;}@media (max-width: 700px){.css-axoi21{margin-right:0;}}</style><div class="site-nav-left  css-axoi21 e1sju8vj5"><style data-emotion="css vdmvgr">.css-vdmvgr{position:relative;z-index:100;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;display:inline-block;margin-right:32px;padding:12px 0;color:#fff;font-size:1.7rem;line-height:1.8rem;font-weight:bold;letter-spacing:-0.5px;text-transform:none;}@media (max-width: 700px){.css-vdmvgr{margin-right:18px;}}.css-vdmvgr:hover{-webkit-text-decoration:none;text-decoration:none;}.css-vdmvgr img{display:block;width:auto;height:21px;}</style><a class="site-nav-logo css-vdmvgr" href="/"><img src="/static/a62d45ddbe29cf42da820a576d9375e1/aef42/alien.png" alt="Pozafly Blog"/></a><style data-emotion="css 1xdepn">.css-1xdepn{position:relative;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}</style><div class="css-1xdepn e1sju8vj4"><style data-emotion="css 17u0f19">.css-17u0f19{position:absolute;z-index:1000;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0 0 0 -12px;padding:0;list-style:none;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-17u0f19 li{display:block;margin:0;padding:0;}.css-17u0f19 li a{font-size:1.2rem;position:relative;display:block;padding:14px 12px;color:#000;opacity:0.8;-webkit-transition:opacity 0.35s ease-in-out;transition:opacity 0.35s ease-in-out;}@media (prefers-color-scheme: dark){.css-17u0f19 li a{color:#fff;}}@media (max-width: 700px){.css-17u0f19 li a{padding:14px 8px;}}.css-17u0f19 li a:hover{-webkit-text-decoration:none;text-decoration:none;opacity:1;}.css-17u0f19 li a:before{content:'';position:absolute;right:100%;bottom:8px;left:12px;height:1px;background:#000;opacity:0.25;-webkit-transition:all 0.35s ease-in-out;transition:all 0.35s ease-in-out;}@media (prefers-color-scheme: dark){.css-17u0f19 li a:before{background:#fff;}}.css-17u0f19 li a:hover:before{right:12px;opacity:0.5;}.css-17u0f19 li a.is-home{color:#fff;}.css-17u0f19 li a.is-home:before{background:#fff;}.css-17u0f19 .nav-current{opacity:1;}</style><ul role="menu" class="css-17u0f19"><li role="menuitem"><a class="" href="/">Home</a></li><li role="menuitem"><a class="" href="/about/">About</a></li><li role="menuitem"><a class="" href="/tags/">Tags</a></li><li role="menuitem"><a class="" href="/tags/diary/">Diary</a></li></ul><style data-emotion="css pfwux1">.css-pfwux1{visibility:hidden;position:absolute;top:9px;color:#000;font-size:1.7rem;font-weight:400;text-transform:none;opacity:0;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);-webkit-transform:translateY(175%);-moz-transform:translateY(175%);-ms-transform:translateY(175%);transform:translateY(175%);}@media (prefers-color-scheme: dark){.css-pfwux1{color:#fff;}}@media (max-width: 700px){.css-pfwux1{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100vw - 172px);}}.css-pfwux1 .dash{left:-25px;}.css-pfwux1 .dash:before{content:'– ';opacity:0.5;}</style><span class="nav-post-title css-pfwux1 e1sju8vj0">Next.js의 API Routes 코드 모듈화에 대해서</span></div></div><style data-emotion="css 3i3mo1">.css-3i3mo1{-webkit-flex:0 1 auto;-ms-flex:0 1 auto;flex:0 1 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;padding:10px 0;height:64px;}</style><div class="css-3i3mo1 e1sju8vj3"><style data-emotion="css 1z0rm8f">.css-1z0rm8f{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-1z0rm8f e1sju8vj2"><style data-emotion="css yvx7r3">.css-yvx7r3{display:inline-block;margin:0;padding:10px;opacity:0.8;}.css-yvx7r3:hover{opacity:1;}.css-yvx7r3 svg{height:1.8rem;fill:#000;}@media (prefers-color-scheme: dark){.css-yvx7r3 svg{fill:#fff;}}.css-yvx7r3.is-home svg{fill:#fff;}.css-yvx7r3 svg{height:1.6rem;}</style><a class=" css-yvx7r3" href="https://www.instagram.com/pozafly_/" target="_blank" title="Instagram" rel="noopener noreferrer"><svg height="511pt" viewBox="0 0 511 511.9" width="13pt" xmlns="http://www.w3.org/2000/svg"><path d="m510.949219 150.5c-1.199219-27.199219-5.597657-45.898438-11.898438-62.101562-6.5-17.199219-16.5-32.597657-29.601562-45.398438-12.800781-13-28.300781-23.101562-45.300781-29.5-16.296876-6.300781-34.898438-10.699219-62.097657-11.898438-27.402343-1.300781-36.101562-1.601562-105.601562-1.601562s-78.199219.300781-105.5 1.5c-27.199219 1.199219-45.898438 5.601562-62.097657 11.898438-17.203124 6.5-32.601562 16.5-45.402343 29.601562-13 12.800781-23.097657 28.300781-29.5 45.300781-6.300781 16.300781-10.699219 34.898438-11.898438 62.097657-1.300781 27.402343-1.601562 36.101562-1.601562 105.601562s.300781 78.199219 1.5 105.5c1.199219 27.199219 5.601562 45.898438 11.902343 62.101562 6.5 17.199219 16.597657 32.597657 29.597657 45.398438 12.800781 13 28.300781 23.101562 45.300781 29.5 16.300781 6.300781 34.898438 10.699219 62.101562 11.898438 27.296876 1.203124 36 1.5 105.5 1.5s78.199219-.296876 105.5-1.5c27.199219-1.199219 45.898438-5.597657 62.097657-11.898438 34.402343-13.300781 61.601562-40.5 74.902343-74.898438 6.296876-16.300781 10.699219-34.902343 11.898438-62.101562 1.199219-27.300781 1.5-36 1.5-105.5s-.101562-78.199219-1.300781-105.5zm-46.097657 209c-1.101562 25-5.300781 38.5-8.800781 47.5-8.601562 22.300781-26.300781 40-48.601562 48.601562-9 3.5-22.597657 7.699219-47.5 8.796876-27 1.203124-35.097657 1.5-103.398438 1.5s-76.5-.296876-103.402343-1.5c-25-1.097657-38.5-5.296876-47.5-8.796876-11.097657-4.101562-21.199219-10.601562-29.398438-19.101562-8.5-8.300781-15-18.300781-19.101562-29.398438-3.5-9-7.699219-22.601562-8.796876-47.5-1.203124-27-1.5-35.101562-1.5-103.402343s.296876-76.5 1.5-103.398438c1.097657-25 5.296876-38.5 8.796876-47.5 4.101562-11.101562 10.601562-21.199219 19.203124-29.402343 8.296876-8.5 18.296876-15 29.398438-19.097657 9-3.5 22.601562-7.699219 47.5-8.800781 27-1.199219 35.101562-1.5 103.398438-1.5 68.402343 0 76.5.300781 103.402343 1.5 25 1.101562 38.5 5.300781 47.5 8.800781 11.097657 4.097657 21.199219 10.597657 29.398438 19.097657 8.5 8.300781 15 18.300781 19.101562 29.402343 3.5 9 7.699219 22.597657 8.800781 47.5 1.199219 27 1.5 35.097657 1.5 103.398438s-.300781 76.300781-1.5 103.300781zm0 0"></path><path d="m256.449219 124.5c-72.597657 0-131.5 58.898438-131.5 131.5s58.902343 131.5 131.5 131.5c72.601562 0 131.5-58.898438 131.5-131.5s-58.898438-131.5-131.5-131.5zm0 216.800781c-47.097657 0-85.300781-38.199219-85.300781-85.300781s38.203124-85.300781 85.300781-85.300781c47.101562 0 85.300781 38.199219 85.300781 85.300781s-38.199219 85.300781-85.300781 85.300781zm0 0"></path><path d="m423.851562 119.300781c0 16.953125-13.746093 30.699219-30.703124 30.699219-16.953126 0-30.699219-13.746094-30.699219-30.699219 0-16.957031 13.746093-30.699219 30.699219-30.699219 16.957031 0 30.703124 13.742188 30.703124 30.699219zm0 0"></path></svg></a><style data-emotion="css 1rnjd3v">.css-1rnjd3v{display:inline-block;margin:0;padding:10px;opacity:0.8;}.css-1rnjd3v:hover{opacity:1;}.css-1rnjd3v svg{height:1.8rem;fill:#000;}@media (prefers-color-scheme: dark){.css-1rnjd3v svg{fill:#fff;}}.css-1rnjd3v.is-home svg{fill:#fff;}</style><a class=" css-1rnjd3v" href="https://github.com/pozafly" title="Github" target="_blank" rel="noopener noreferrer"><svg width="21px" height="21px" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"></path></svg></a></div></div></nav></div></div></header><style data-emotion="css 12lzzeq">.css-12lzzeq{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;position:relative;padding:0 5vw;}@media (prefers-color-scheme: dark){.css-12lzzeq{background:#191b1f;}}</style><main id="site-main" class="site-main css-12lzzeq"><div class="css-y521qa"><style data-emotion="css 150a24d">.css-150a24d{position:relative;}</style><article class="css-150a24d"><style data-emotion="css 7tju5o">.css-7tju5o{position:relative;margin:0 auto;padding:70px 100px 50px;border-top-left-radius:3px;border-top-right-radius:3px;}@media (max-width: 1170px){.css-7tju5o{padding:60px 11vw 50px;}}@media (max-width: 800px){.css-7tju5o{padding-right:5vw;padding-left:5vw;}}@media (max-width: 500px){.css-7tju5o{padding:20px 0 35px;}}</style><header class="post-full-header css-7tju5o ewnyor56"><style data-emotion="css 1dark36">.css-1dark36{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#738a94;font-size:1.3rem;line-height:1.4em;font-weight:600;}</style><section class="post-full-tags css-1dark36 ewnyor55"><a href="/tags/next-js/">Next.js</a></section><style data-emotion="css qia1z6">.css-qia1z6{margin:0 0 0.2em;color:#0b0c0e;}@media (max-width: 500px){.css-qia1z6{margin-top:0.2em;font-size:3.3rem;}}@media (prefers-color-scheme: dark){.css-qia1z6{color:rgba(255, 255, 255, 0.9);}}</style><h1 class="post-full-title css-qia1z6 ewnyor51">Next.js의 API Routes 코드 모듈화에 대해서</h1><style data-emotion="css ai4oyg">.css-ai4oyg{margin:20px 0 0;color:var(--midgrey);font-size:2rem;line-height:1.4em;font-weight:360;}@media (max-width: 500px){.css-ai4oyg{font-size:1.9rem;line-height:1.5em;}}@media (prefers-color-scheme: dark){.css-ai4oyg{color:#768086;}}</style><p class="post-full-custom-excerpt css-ai4oyg ewnyor53">API Routes를 사용하면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적.</p><style data-emotion="css 7rkhl5">.css-7rkhl5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:35px 0 0;padding-top:15px;border-top:1px solid #e4eaed;}.css-7rkhl5 .post-full-byline-content{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}.css-7rkhl5 .post-full-byline-content .author-list{-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;padding:0 12px 0 0;}.css-7rkhl5 .post-full-byline-meta{margin:2px 0 0;color:#768086;font-size:1.4rem;line-height:1.2em;letter-spacing:0.2px;}.css-7rkhl5 .post-full-byline-meta h4{margin:0 0 3px;font-size:1.4rem;line-height:1.3em;font-weight:500;}.css-7rkhl5 .post-full-byline-meta h4 a{color:#2c3036;}.css-7rkhl5 .post-full-byline-meta h4 a:hover{color:#15171A;}.css-7rkhl5 .post-full-byline-meta .bull{display:inline-block;margin:0 4px;opacity:0.6;}@media (prefers-color-scheme: dark){.css-7rkhl5{border-top-color:#3b4049;}.css-7rkhl5 .post-full-byline-meta h4 a{color:rgba(255, 255, 255, 0.75);}.css-7rkhl5 .post-full-byline-meta h4 a:hover{color:#fff;}}</style><div class="post-full-byline css-7rkhl5 ewnyor52"><section class="post-full-byline-content"><style data-emotion="css 12fmpzj">.css-12fmpzj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 0 0 4px;padding:0;list-style:none;}</style><ul class="author-list css-12fmpzj ewnyor54"><style data-emotion="css 1g82peq">.css-1g82peq{position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin:0;padding:0;}.css-1g82peq:hover .author-name-tooltip{opacity:1;-webkit-transform:translate(-10px, -2px);-moz-transform:translate(-10px, -2px);-ms-transform:translate(-10px, -2px);transform:translate(-10px, -2px);}</style><li class="author-list-item css-1g82peq e1tg0lak0"><style data-emotion="css 1smzq71">.css-1smzq71{display:block;overflow:hidden;margin:0 -4px;width:40px;height:40px;border:#fff 2px solid;border-radius:100%;-webkit-transition:all 0.5s cubic-bezier(0.4, 0.01, 0.165, 0.99) 700ms;transition:all 0.5s cubic-bezier(0.4, 0.01, 0.165, 0.99) 700ms;}@media (max-width: 500px){.css-1smzq71{width:36px;height:36px;}}@media (prefers-color-scheme: dark){.css-1smzq71{border-color:#1a1c20;}}</style><a class="author-avatar css-1smzq71" href="/about/"><style data-emotion="css 12febhg">.css-12febhg{display:block;width:100%;height:100%;background:#e4eaed;border-radius:100%;object-fit:cover;}@media (prefers-color-scheme: dark){.css-12febhg{background:#191b1f;}}.css-12febhg img{border-radius:100%;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper author-profile-image css-12febhg"><div aria-hidden="true" style="padding-top:100%"></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#6808f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/e73fe/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/61ca6/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/507b0/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/2f28c/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/499f6/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg 120w" alt="Pozafly"/></picture><noscript><picture><source type="image/webp" srcSet="/static/8c061761f263c344f2c0416607c8adf1/e73fe/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/61ca6/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/507b0/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg" srcSet="/static/8c061761f263c344f2c0416607c8adf1/2f28c/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/499f6/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg 120w" alt="Pozafly"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a></li></ul><section class="post-full-byline-meta"><h4 class="author-name"><a href="/about/">Pozafly</a></h4><div class="byline-meta-content"><time class="byline-meta-date" dateTime="2023-07-26">2023 07 26</time><span class="byline-reading-time"><span class="bull">•</span>11 min read</span></div></section></section></div></header><style data-emotion="css 2f6woi">.css-2f6woi{margin:25px auto 50px;max-height:800px;-webkit-background-size:cover;background-size:cover;width:80%;border-radius:8px;border:1px solid hsl(230deg 25% 94%);}.css-2f6woi img{border-radius:8px;}@media (max-width: 1170px){.css-2f6woi img{max-width:1170px;}}@media (max-width: 800px){.css-2f6woi{width:100%;}}@media (max-width: 500px){.css-2f6woi{margin-bottom:4vw;}}@media (prefers-color-scheme: dark){.css-2f6woi{border:1px solid hsl(230deg 6% 23%);}}</style><figure class="css-2f6woi ewnyor50"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:52.34375%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/webp;base64,UklGRlABAABXRUJQVlA4IEQBAAAQBgCdASoUAAoAAAAAJQBOmUI4G2AKEr3kT9TfSAd8bMV4y7BHP9V/MDjAP1APvhp9S1P4WAaWWwAA/v//FO+/uU2wVgdvo3t7+/esHdVnt/ADvJNu//kKsryq7K4/kH6dQSpGZH/Wmy5Hn/aiP/iWMNYE/L04/fxOh6w6LNfMVCO2e4bk1w+gWtpgjXx8dPwxbP/af/3X+0eo//xh3vW8bP8x/59L+P+uAb/nTz0WLfd1P3vPtBSZEyy/3T0wbRrtQDgzQWJR+Ionuv+3z/+oMGf/VUBr79zfpXfp+qM/6uI1nkf8xYssVf+Jam3g3/89o/+0Ec/+2AL9tBfn9QixAvY/zPVrT+ICoP+ly+1C7/DtZUF9PQRI4d13mrIY7dR2bGTX2cQVs9OgNCzOMwQy1nvlPj56aTR9Kl6iaLrR7askCAA=" alt=""/><picture><source type="image/avif" data-srcset="/static/6763177ee50addd67c4dc57952797f69/7f171/main.avif 750w,/static/6763177ee50addd67c4dc57952797f69/4f36a/main.avif 1080w,/static/6763177ee50addd67c4dc57952797f69/dac68/main.avif 1366w,/static/6763177ee50addd67c4dc57952797f69/f7ebe/main.avif 1920w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/6763177ee50addd67c4dc57952797f69/231da/main.webp" data-srcset="/static/6763177ee50addd67c4dc57952797f69/7513b/main.webp 750w,/static/6763177ee50addd67c4dc57952797f69/317ed/main.webp 1080w,/static/6763177ee50addd67c4dc57952797f69/b5c49/main.webp 1366w,/static/6763177ee50addd67c4dc57952797f69/231da/main.webp 1920w" alt="Next.js의 API Routes 코드 모듈화에 대해서"/></picture><noscript><picture><source type="image/avif" srcSet="/static/6763177ee50addd67c4dc57952797f69/7f171/main.avif 750w,/static/6763177ee50addd67c4dc57952797f69/4f36a/main.avif 1080w,/static/6763177ee50addd67c4dc57952797f69/dac68/main.avif 1366w,/static/6763177ee50addd67c4dc57952797f69/f7ebe/main.avif 1920w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/6763177ee50addd67c4dc57952797f69/231da/main.webp" srcSet="/static/6763177ee50addd67c4dc57952797f69/7513b/main.webp 750w,/static/6763177ee50addd67c4dc57952797f69/317ed/main.webp 1080w,/static/6763177ee50addd67c4dc57952797f69/b5c49/main.webp 1366w,/static/6763177ee50addd67c4dc57952797f69/231da/main.webp 1920w" alt="Next.js의 API Routes 코드 모듈화에 대해서"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></figure><style data-emotion="css 144v97n">.css-144v97n code[class*='language-'],.css-144v97n pre[class*='language-']{color:white;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-144v97n code[class*='language-']::-webkit-scrollbar,.css-144v97n pre[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-144v97n code[class*='language-']::-webkit-scrollbar-thumb,.css-144v97n pre[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-144v97n code[class*='language-'],.css-144v97n pre[class*='language-']{display:inline-block;}}.css-144v97n pre[class*='language-']{overflow:auto;}.css-144v97n pre[class*='language-']::-moz-selection{background:hsl(207, 4%, 16%);}.css-144v97n pre[class*='language-']::selection{background:hsl(207, 4%, 16%);}.css-144v97n pre[class*='language-']::-moz-selection,.css-144v97n pre[class*='language-'] ::-moz-selection{text-shadow:none;background:hsla(0, 0%, 100%, 0.15);}.css-144v97n pre[class*='language-']::selection,.css-144v97n pre[class*='language-'] ::selection{text-shadow:none;background:hsla(0, 0%, 100%, 0.15);}.css-144v97n *:not(pre)>code[class*='language-']{border-radius:0.3em;background:rgb(235, 235, 235);border:1px solid rgb(236, 237, 244);color:#000;padding:0.15em 0.5em;white-space:normal;}@media (max-width: 800px){.css-144v97n *:not(pre)>code[class*='language-']{display:inline;}}@media (prefers-color-scheme: dark){.css-144v97n *:not(pre)>code[class*='language-']{background:#3c4148;color:white;border:none;font-weight:500!important;}}.css-144v97n .token{font-size:1.4rem;}.css-144v97n .token.attr-name{color:rgb(173, 219, 103);font-style:italic;}.css-144v97n .token.comment{color:rgb(128, 147, 147);}.css-144v97n .token.string,.css-144v97n .token.url{color:rgb(173, 219, 103);}.css-144v97n .token.variable{color:rgb(214, 222, 235);}.css-144v97n .token.number{color:rgb(247, 140, 108);}.css-144v97n .token.builtin,.css-144v97n .token.char,.css-144v97n .token.constant,.css-144v97n .token.function{color:rgb(130, 170, 255);}.css-144v97n .token.punctuation{color:rgb(199, 146, 234);}.css-144v97n .token.selector,.css-144v97n .token.doctype{color:rgb(199, 146, 234);font-style:'italic';}.css-144v97n .token.class-name{color:rgb(255, 203, 139);}.css-144v97n .token.tag,.css-144v97n .token.operator,.css-144v97n .token.keyword{color:#ffa7c4;}.css-144v97n .token.boolean{color:rgb(255, 88, 116);}.css-144v97n .token.property{color:rgb(128, 203, 196);}.css-144v97n .token.namespace{color:rgb(178, 204, 214);}.css-144v97n pre[data-line]{padding:1em 0 1em 3em;position:relative;}.css-144v97n .gatsby-highlight-code-line{background-color:hsla(207, 95%, 15%, 1);display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;border-left:0.25em solid #ffa7c4;}.css-144v97n .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:rgb(32 36 39);-webkit-overflow-scrolling:touch;overflow:auto;}.css-144v97n .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.5rem;}</style><style data-emotion="css 1hzpswx">.css-1hzpswx{position:relative;margin:0 auto;padding:0 100px 6vw;min-height:230px;font-size:2rem;line-height:1.6em;background:#fff;border-radius:6px;}@media (max-width: 1170px){.css-1hzpswx{padding:0 11vw;}}@media (max-width: 800px){.css-1hzpswx{padding:0 5vw;font-size:1.8rem;}}@media (max-width: 500px){.css-1hzpswx{padding:0;}}@media (max-width: 500px){.css-1hzpswx .post-full-custom-excerpt{font-size:1.9rem;line-height:1.5em;}}.css-1hzpswx .no-image{padding-top:0;}.css-1hzpswx h1,.css-1hzpswx h2,.css-1hzpswx h3,.css-1hzpswx h4,.css-1hzpswx h5,.css-1hzpswx h6,.css-1hzpswx p,.css-1hzpswx ul,.css-1hzpswx ol,.css-1hzpswx dl,.css-1hzpswx pre,.css-1hzpswx blockquote,.css-1hzpswx .post-full-comments,.css-1hzpswx .footnotes{margin:0 0 1.5em 0;min-width:100%;}@media (max-width: 500px){.css-1hzpswx p,.css-1hzpswx ul,.css-1hzpswx ol,.css-1hzpswx dl,.css-1hzpswx pre,.css-1hzpswx .post-full-comments,.css-1hzpswx .footnotes{margin-bottom:1.28em;}}.css-1hzpswx li{word-break:break-word;}.css-1hzpswx li p{margin:0;}.css-1hzpswx a{color:#3eb0ef;word-break:break-word;box-shadow:#3eb0ef 0 -1px 0 inset;-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-1hzpswx a:hover{color:#15171A;-webkit-text-decoration:none;text-decoration:none;box-shadow:#15171A 0 -1px 0 inset;}.css-1hzpswx a[class*='image'],.css-1hzpswx a[class*='image']:hover{box-shadow:none;}.css-1hzpswx a[class*='image'] span[class*='image'],.css-1hzpswx a[class*='image']:hover span[class*='image']{border-radius:6px;}.css-1hzpswx strong,.css-1hzpswx em{color:#0a0b0c;}.css-1hzpswx small{display:inline-block;line-height:1.6em;}.css-1hzpswx img,.css-1hzpswx video{display:block;margin:2em auto;max-width:840px;height:auto;border-radius:6px;border:1px solid hsl(230deg 25% 94%);}@media (prefers-color-scheme: dark){.css-1hzpswx img,.css-1hzpswx video{border:1px solid hsl(230, 6%, 23%);}}@media (max-width: 1040px){.css-1hzpswx img,.css-1hzpswx video{width:100%;}}.css-1hzpswx img[src$='#full']{max-width:none;width:100vw;}.css-1hzpswx img+br+small{display:block;margin-top:-3em;margin-bottom:1.5em;text-align:center;}.css-1hzpswx iframe{margin:10px auto 20px;}.css-1hzpswx blockquote{margin:0 0 1.5em;padding:0 1.5em;border-left:#3eb0ef 3px solid;}@media (max-width: 500px){.css-1hzpswx blockquote{padding:0 1.3em;}}.css-1hzpswx blockquote p{margin:0 0 1em 0;color:inherit;font-size:inherit;line-height:inherit;font-style:italic;}.css-1hzpswx blockquote p:last-child{margin-bottom:0;}.css-1hzpswx code{padding:0 5px 2px;font-size:0.8em;line-height:1em;font-weight:400!important;background:#e5eff5;border-radius:3px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;}.css-1hzpswx p code{word-break:keep-all;}.css-1hzpswx pre{overflow-x:auto;padding:20px;max-width:100%;color:#e5eff5;font-size:1.4rem;line-height:1.5em;border-radius:5px;}.css-1hzpswx pre ::selection{color:#3b474d;}.css-1hzpswx pre code{padding:0;font-size:inherit;line-height:inherit;background:transparent;}.css-1hzpswx pre code :not(span){color:inherit;}.css-1hzpswx .fluid-width-video-wrapper{margin:1.5em 0 3em;}.css-1hzpswx hr{margin:2em 0;}.css-1hzpswx hr:after{content:'';position:absolute;top:-15px;left:50%;display:block;margin-left:-10px;width:1px;height:30px;background:#e4eaed;box-shadow:#fff 0 0 0 5px;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);}.css-1hzpswx hr+p{margin-top:1.2em;}.css-1hzpswx h1,.css-1hzpswx h2,.css-1hzpswx h3,.css-1hzpswx h4,.css-1hzpswx h5,.css-1hzpswx h6{color:#0a0b0c;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;}.css-1hzpswx h1{margin:0.5em 0 0.4em;font-size:4.2rem;line-height:1.25em;font-weight:600;}.css-1hzpswx p+h1{margin-top:0.8em;}@media (max-width: 800px){.css-1hzpswx h1{font-size:3.2rem;line-height:1.25em;}}.css-1hzpswx h2{margin:0.5em 0 0.4em;font-size:3.2rem;line-height:1.25em;font-weight:600;}.css-1hzpswx p+h2{margin-top:0.8em;}@media (max-width: 800px){.css-1hzpswx h2{margin-bottom:0.3em;font-size:2.8rem;line-height:1.25em;}}.css-1hzpswx h3{margin:0.5em 0 0.2em;font-size:2.5rem;line-height:1.3em;font-weight:600;}.css-1hzpswx h2+h3{margin-top:0.7em;}@media (max-width: 800px){.css-1hzpswx h3{margin-bottom:0.3em;font-size:2.4rem;line-height:1.3em;}}.css-1hzpswx h4{margin:0.5em 0 0.2em;font-size:1.8rem;font-weight:600;}.css-1hzpswx h2+h4{margin-top:0.7em;}.css-1hzpswx h3+h4{margin-top:0;}@media (max-width: 800px){.css-1hzpswx h4{margin-bottom:0.3em;font-size:1.8rem;line-height:1.3em;}}.css-1hzpswx h5{display:block;margin:0.5em 0;padding:0.4em 1em 0.9em;border:0;color:#3eb0ef;font-size:3.2rem;line-height:1.35em;text-align:center;}@media (min-width: 1180px){.css-1hzpswx h5{max-width:1060px;}}@media (max-width: 800px){.css-1hzpswx h5{margin-bottom:1em;margin-left:1.3em;padding:0 0 0.5em;font-size:2.4rem;text-align:initial;}}.css-1hzpswx h6{margin:0.5em 0 0.2em 0;font-size:2rem;font-weight:700;}@media (max-width: 800px){.css-1hzpswx h6{font-size:1.8rem;line-height:1.4em;}}.css-1hzpswx table{display:inline-block;overflow-x:auto;margin:0.5em 0 2.5em;max-width:100%;width:auto;border-spacing:0;border-collapse:collapse;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:1.6rem;white-space:nowrap;vertical-align:top;}.css-1hzpswx table{-webkit-overflow-scrolling:touch;background:radial-gradient(
          ellipse at left,
          rgba(0, 0, 0, 0.2) 0%,
          rgba(0, 0, 0, 0) 75%
        ) 0 center,radial-gradient(
          ellipse at right,
          rgba(0, 0, 0, 0.2) 0%,
          rgba(0, 0, 0, 0) 75%
        ) 100% center;background-attachment:scroll,scroll;-webkit-background-size:10px 100%,10px 100%;background-size:10px 100%,10px 100%;background-repeat:no-repeat;}.css-1hzpswx table td:first-of-type{background-image:linear-gradient(
      to right,
      rgba(255, 255, 255, 1) 50%,
      rgba(255, 255, 255, 0) 100%
    );-webkit-background-size:20px 100%;background-size:20px 100%;background-repeat:no-repeat;}.css-1hzpswx table td:last-child{background-image:linear-gradient(
      to left,
      rgba(255, 255, 255, 1) 50%,
      rgba(255, 255, 255, 0) 100%
    );-webkit-background-position:100% 0;background-position:100% 0;-webkit-background-size:20px 100%;background-size:20px 100%;background-repeat:no-repeat;}.css-1hzpswx table th{color:#15171A;font-size:1.2rem;font-weight:700;letter-spacing:0.2px;text-align:left;text-transform:uppercase;background-color:#f4f8fb;}.css-1hzpswx table th,.css-1hzpswx table td{padding:6px 12px;border:#e1edf4 1px solid;}@media (prefers-color-scheme: dark){.css-1hzpswx{background:#191b1f;}.css-1hzpswx h1,.css-1hzpswx h2,.css-1hzpswx h3,.css-1hzpswx h4,.css-1hzpswx h6{color:rgba(255, 255, 255, 0.9);}.css-1hzpswx a{color:#26a6ed;box-shadow:inset 0 -1px 0 #26a6ed;}.css-1hzpswx a:hover{color:#fff;box-shadow:inset 0 -1px 0 #fff;}.css-1hzpswx a[class*='image'],.css-1hzpswx a[class*='image']:hover{box-shadow:none;}.css-1hzpswx strong{color:#fff;}.css-1hzpswx em{color:#fff;}.css-1hzpswx code{color:#fff;background:#000;}.css-1hzpswx hr{border-top-color:#2b2f36;}.css-1hzpswx hr:after{background:#17191c;box-shadow:#191b1f 0 0 0 5px;}.css-1hzpswx figcaption{color:rgba(255, 255, 255, 0.6);}.css-1hzpswx table td:first-of-type{background-image:linear-gradient(
        to right,
        #191b1f 50%,
        #191b1f 100%
      );}.css-1hzpswx table td:last-child{background-image:linear-gradient(
        270deg,
        #191b1f 50%,
        rgba(25, 27, 31, 0)
      );}.css-1hzpswx table th{color:rgba(255, 255, 255, 0.85);background-color:#2b2f36;}.css-1hzpswx table th,.css-1hzpswx table td{border:#2b2f36 1px solid;}.css-1hzpswx .kg-bookmark-container,.css-1hzpswx .kg-bookmark-container:hover{color:rgba(255, 255, 255, 0.75);box-shadow:0 0 1px rgba(255, 255, 255, 0.9);}}.css-1hzpswx code[class*='language-'],.css-1hzpswx pre[class*='language-']{color:white;background:none;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;font-feature-settings:normal;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;margin-bottom:0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1hzpswx code[class*='language-']::-webkit-scrollbar,.css-1hzpswx pre[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-1hzpswx code[class*='language-']::-webkit-scrollbar-thumb,.css-1hzpswx pre[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-1hzpswx code[class*='language-'],.css-1hzpswx pre[class*='language-']{display:inline-block;}}.css-1hzpswx pre[class*='language-']{overflow:auto;}.css-1hzpswx pre[class*='language-']::-moz-selection{background:hsl(207, 4%, 16%);}.css-1hzpswx pre[class*='language-']::selection{background:hsl(207, 4%, 16%);}.css-1hzpswx pre[class*='language-']::-moz-selection,.css-1hzpswx pre[class*='language-'] ::-moz-selection{text-shadow:none;background:hsla(0, 0%, 100%, 0.15);}.css-1hzpswx pre[class*='language-']::selection,.css-1hzpswx pre[class*='language-'] ::selection{text-shadow:none;background:hsla(0, 0%, 100%, 0.15);}.css-1hzpswx *:not(pre)>code[class*='language-']{border-radius:0.3em;background:rgb(235, 235, 235);border:1px solid rgb(236, 237, 244);color:#000;padding:0.15em 0.5em;white-space:normal;}@media (max-width: 800px){.css-1hzpswx *:not(pre)>code[class*='language-']{display:inline;}}@media (prefers-color-scheme: dark){.css-1hzpswx *:not(pre)>code[class*='language-']{background:#3c4148;color:white;border:none;font-weight:500!important;}}.css-1hzpswx .token{font-size:1.4rem;}.css-1hzpswx .token.attr-name{color:rgb(173, 219, 103);font-style:italic;}.css-1hzpswx .token.comment{color:rgb(128, 147, 147);}.css-1hzpswx .token.string,.css-1hzpswx .token.url{color:rgb(173, 219, 103);}.css-1hzpswx .token.variable{color:rgb(214, 222, 235);}.css-1hzpswx .token.number{color:rgb(247, 140, 108);}.css-1hzpswx .token.builtin,.css-1hzpswx .token.char,.css-1hzpswx .token.constant,.css-1hzpswx .token.function{color:rgb(130, 170, 255);}.css-1hzpswx .token.punctuation{color:rgb(199, 146, 234);}.css-1hzpswx .token.selector,.css-1hzpswx .token.doctype{color:rgb(199, 146, 234);font-style:'italic';}.css-1hzpswx .token.class-name{color:rgb(255, 203, 139);}.css-1hzpswx .token.tag,.css-1hzpswx .token.operator,.css-1hzpswx .token.keyword{color:#ffa7c4;}.css-1hzpswx .token.boolean{color:rgb(255, 88, 116);}.css-1hzpswx .token.property{color:rgb(128, 203, 196);}.css-1hzpswx .token.namespace{color:rgb(178, 204, 214);}.css-1hzpswx pre[data-line]{padding:1em 0 1em 3em;position:relative;}.css-1hzpswx .gatsby-highlight-code-line{background-color:hsla(207, 95%, 15%, 1);display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;border-left:0.25em solid #ffa7c4;}.css-1hzpswx .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:rgb(32 36 39);-webkit-overflow-scrolling:touch;overflow:auto;}.css-1hzpswx .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.5rem;}</style><section class="post-full-content css-1hzpswx e14ijd7g0"><div><h2 id="메타-프레임워크" style="position:relative">메타 프레임워크<a href="#%EB%A9%94%ED%83%80-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC" aria-label="메타 프레임워크 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>Next.js는 react의 메타 프레임워크다. 메타 프레임워크는 프레임워크의 프레임워크라고도 말할 수 있는데, 프레임워크를 사용하기 위해 기본적으로 세팅해야 하는 환경이나, 필요한 기능을 추상화 한 코드 모듈을 제공해줘서 프레임워크를 더 쉽게 사용할 수 있도록 도와준다.</p>
<p>특히 react의 경우, <a href="https://pozafly.github.io/react/declarative-meaning-of-react-rendering-process/" target="_blank" rel="nofollow">라이브러리의 정체성</a>을 어느정도 가지고 있기 때문에, 사용자에 따라 코드 스타일이나 환경 등이 제각각인 경우가 많았다. 메타 프레임워크는 Best Practice를 모아두어, 개발자가 시행착오를 거치지 않고 여러 통합 환경 및 기능을 사용할 수 있도록 한다. react의 메타 프레임워크로 <strong>Next.js</strong>, <strong>Remix</strong>, <strong>Gatsby</strong> 등의 프레임워크가 존재하며, Vue.js 같은 경우는 <strong>Nuxt.js</strong>라는 메타 프레임워크가 있다.</p>
<p>Next.js는 SSR 뿐 아니라 다양한 기능을 제공하고 있다. 번들링과 컴파일 같은 도구를 기본으로 제공한다. 또한, 리소스를 최적화 기능, 파일 시스템 기  반 라우팅, 레이아웃, 배포 등 기능을 내장하고 있다.</p>
<p>아래는 Next.js 공식 홈페이지에서 자신을 설명하고 있는 문장이다.</p>
<blockquote>
<p>Used by some of the world’s largest companies, Next.js enables you to create full-stack Web applications by extending the latest React features, and integrating powerful Rust-based JavaScript tooling for the fastest builds.</p>
</blockquote>
<p>위 문장 중 <strong>full-stack Web application</strong>이라는 문구를 사용했다. full-stack은, 프론트엔드 뿐 아니라 백엔드 코드도 작성할 수 있다는 의미이다. 수 많은 웹 어플리케이션이 Node.js 환경에서 빌드되어 브라우저로 서빙되고 있다. Next.js는 Node.js로 react 기반 프론트엔드 코드를 번들링과 컴파일을 해주고 있으며, 또한 Node.js 런타임 환경에서 백엔드 코드를 실행시킬 수 있다. (조금 더 엄밀하게 말하면 백엔드를 실행시킨다기 보다는 Node.js 런타임 환경에서 API response를 내려주는 함수를 실행시킬 수 있다. 이는 Next.js의 API Routes로 쉽게 구현이 가능하다. 따라서 Next.js는 API Routes 기능과, SSR 기능을 사용할 수 있기 때문에 full-stack Web application이라는 네이밍이 붙었다고 예상할 수 있다.)</p>
<p>이번에 Next.js로 프로젝트를 진행하면서 백엔드 코드를 작성할 일이 생겼다. Google OAuth를 통해 사용자 인증을 하고 싶었다. Google OAuth를 통해 인증을 하려면 2가지 방법이 있는데 첫 번째는 <strong>프론트엔드 단에서 연결</strong>하는 방법과, <strong>프론트엔드에서 백엔드 단을 통해 OAuth를 연결</strong>하는 방법이다. 프론트엔드 단에서만 인증을 요청하면 Google 인증 서버에서 Refresh Token을 넘겨주지 않았다. 하지만, 검증된 백엔드를 통해 Google 인증 서버에 인증을 요청하게 되면 Refresh Token도 함께 받을 수 있다. Refresh Token을 받지 못한다  면 Google의 인가된 서비스를 사용하기 위해, 사용자가 1시간에 한 번씩 로그인을 해주어야 하기 때문에 Next.js의 API Routes를 통해 인증을 받기로 했다.</p>
<p>하지만, API Routes를 사용하면 코드가 매우 지저분해진다. 그 이유는 아래의 API Routes에서 조금 더 알아볼 것이다. 아래 글은, API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적이 되겠다.</p>
<p>📌 <em>Next.js가 13 버전으로 올라가면서 서버 컴포넌트를 사용하기 위해 App Router가 도입 되었다. App Router가 도입 되면서 서버 코드를 작성할 수 있는 <code class="language-text">API Routes</code>는 <code class="language-text">Route Handlers</code> 라는 이름으로 변경 되었으며, 아래의 내용 없이도 도메인 별로 서버 코드를 쉽게 작성할 수 있도록 변경되었다. 따라서 아래의 코드는 Next.js 12 버전 이하 또는 Page Route를 사용하는 Next.js 서버 코드라고 보면 된다.</em></p>
<br/>
<h2 id="API-Routes" style="position:relative">API Routes<a href="#API-Routes" aria-label="API Routes permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>API Routes는 API를 호출할 수 있는 Endpoint를 생성해준다. Next.js의 파일 기반 routing과 마찬가지로 파일 기반으로 API Endpoint가 생성된다. <code class="language-text">pages/api</code> 폴더 내부에 파일을 생성하고, 함수를 작성하면 함수를 기반으로 API를 내려줄 수 있다.</p>
<p>API Routes의 <strong>포지션</strong>에 대해 생각해보자. Node.js로 백엔드를 구성한다면 Express를 사용할 수도 있고, NestJS도 사용할 수 있다. 반드시 서버 프레임워크 구성 환경이 Node.js가 아니라면 Spring과 같은 엔터프라이즈 급 프레임워크로 서버를 구성할 수도 있다. 하지만, API Routes는 서버 프레임워크로 구성 된 서버 코드보다 훨씬 가벼운 개념으로 탄생했다.</p>
<h3 id="Serverless-Function" style="position:relative">Serverless Function<a href="#Serverless-Function" aria-label="Serverless Function permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>API Routes는 <strong>Serverless Function</strong>으로 구성되어 있다. Serverless Function의 컨셉은 요청(이벤트)이 들어올 때마다 지정된 함수를 실행시켜 원하는 API를 클라이언트에게 전달하는 것이다. 그렇기 때문에 web socket과 같은 연결은 가질 수 없다. 애초에 지속적인 커넥션을 잡고 있을 수 없도록 설계된 모델이기 때문이다.</p>
<p>Serverless Function은 인프라를 관리하지 않아도 되며, 요청이 들어올 때마다 함수를 실행시키기 때문에 적은 비용으로 운영할 수 있고, 동일한 값을 반환한다면 캐싱에도 유용하다. 여전히 물리적인 서버로 운영되고 있지만, 직접 서버의 인프라를 운영하지 않아도 되는 컨셉과 동시에, 함수 하나만 실행하기 때문에 Serverless Function이라는 이름이 붙었다. 이벤트 기반이기 때문에 Serverless에서 동작하는 코드는  상태를 가지고 있지 않다. 즉, 데이터를 유지하지 않는다. 이를 FaaS 라고도 한다.</p>
<p><a href="https://github.com/vercel/next.js/discussions/17679" target="_blank" rel="nofollow">링크</a>를 살펴보면, Next.js의 메인테이너가 API Routes에 대해 설명하고 있는데, API Routes는 Serverless Function 컨셉을 가지고 있지만 아주 큰 커넥션을 가지지 않는다면 DB 와의 통신은 가능하다. 왜냐하면 web socket과 같은 지속적인 커넥션을 맺는 것이 아니라, DB 인스턴스와 단기적인 통신을 통해 데이터를 저장하거나 가공하기 때문이다. 이는 vercel의 공식문서에서 배포된 Serverless Function의 제약조건으로 커넥션 타임이 지정되어 있는 이유이기도 하다.</p>
<p>또한, SSR을 위해 사용하는 <code class="language-text">getStaticProps</code>, <code class="language-text">getServerSideProps</code> 등의 함수 코드도 Serverless Function 형태로 배포된다. 당연히 client-side 번들에는 추가되지 않는다.</p>
<p><em>📌 참고로 Edge API Routes와 API Routes는 다르다. Edge API Routes는 Edge Runtime을 사용하고, API Routes는 Node.js Runtime을 사용한다. 따라서, Edge Runtime에는 Node.js의 <code class="language-text">fs</code>와 같은 Node API 사용이 불가능하다. Edge API Routes는 AWS 람다와 비슷한 환경이다. 또한, Serverless Function으로 사용하고 싶지 않다면 <a href="https://nextjs.org/docs/pages/building-your-application/configuring/custom-server" target="_blank" rel="nofollow">custom server</a>로 변경해 사용할 수 있다.</em></p>
<h3 id="API-Routes-코드-예시" style="position:relative">API Routes 코드 예시<a href="#API-Routes-%EC%BD%94%EB%93%9C-%EC%98%88%EC%8B%9C" aria-label="API Routes 코드 예시 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>따라서, Serverless Function은, 이벤트가 일어나면 함수 하나를 호출해주는 역할이다. 이런 컨셉에 맞게 API Routes도 마찬가지로 Endpoint당 함수 하나만 사용할 수 있도록 만들어졌다. <a href="https://nextjs.org/docs/pages/building-your-application/routing/api-routes" target="_blank" rel="nofollow">공식문서 api-routes</a>의 예제를 보면, 아래 코드와 같이 <code class="language-text">handler</code> 함수 하나만 달랑 존재한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#x27;John Doe&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>이렇게 함수가 하나만 존재할 경우 하나의 Endpoint에 <strong>http method</strong>들을 <code class="language-text">if</code>문 혹은 <code class="language-text">switch</code>문으로 분기를 태울 수 밖에 없는 상황이 발생한다. 위에서 말했듯, API Routes는 Serverless Function 컨셉에 맞게 handler 함수 하나만 작성하는 컨셉으로 만들어졌기 때문이다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">&#x27;POST&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Process a POST request</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle any other HTTP method</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>위와 같은 상황에서 로직이 길어지면, 코드를 보는 것이 매우 불편해진다. Utility 파일을 새로 생성해서 가독성을 좋게 만들기 위해 여러 시도를 해봤고, 내 기준 Best Practice를 찾았다.</p>
<br/>
<h2 id="API-Routes-코드-위치" style="position:relative">API Routes 코드 위치<a href="#API-Routes-%EC%BD%94%EB%93%9C-%EC%9C%84%EC%B9%98" aria-label="API Routes 코드 위치 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>모듈화 되어 있지 않은 API관련 Utility 코드를 위치 시키는 방법은 2가지다.</p>
<ol>
<li><code class="language-text">pages/api</code> 경로에 파일을 위치시키고, 파일 명에 <code class="language-text">_</code> 또는 <code class="language-text">.</code> 접두사를 넣어주는 방법.</li>
<li><code class="language-text">pages</code> 폴더 외부에 위치시키는 방법.</li>
</ol>
<h3 id="1-pagesapi-경로에-파일을-위치시키고-파일-명에-code-classlanguage-text_code-또는-code-classlanguage-textcode-접두사를-넣어주는-방법" style="position:relative">1. pages/api 경로에 파일을 위치시키고, 파일 명에 <code class="language-text">_</code> 또는 <code class="language-text">.</code> 접두사를 넣어주는 방법<a href="#1-pagesapi-%EA%B2%BD%EB%A1%9C%EC%97%90-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EC%9C%84%EC%B9%98%EC%8B%9C%ED%82%A4%EA%B3%A0-%ED%8C%8C%EC%9D%BC-%EB%AA%85%EC%97%90-code-classlanguage-text_code-%EB%98%90%EB%8A%94-code-classlanguage-textcode-%EC%A0%91%EB%91%90%EC%82%AC%EB%A5%BC-%EB%84%A3%EC%96%B4%EC%A3%BC%EB%8A%94-%EB%B0%A9%EB%B2%95" aria-label="1 pagesapi 경로에 파일을 위치시키고 파일 명에 code classlanguage text_code 또는 code classlanguage textcode 접두사를 넣어주는 방법 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>Next.js에서 <code class="language-text">pages/api</code> 경로에 파일을 위치시키는 경우 자동으로 API Routes 코드임을 인식하고, 파일 명으로 API Endpoint를 만들게 된다. 하지만, <a href="https://github.com/vercel/vercel/discussions/4983" target="_blank" rel="nofollow">링크</a>에 따르면 Vercel에 배포할 경우, API Enpoint를 만들지 않도록 할 수 있다.</p>
<p>pages/api 폴더에 생성된 파일 명에 <code class="language-text">_</code> 또는 <code class="language-text">.</code> 접두사를 붙여 주면 API Endpoint를 만들지 않는다.</p>
<p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:610px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:33.4%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABA0lEQVQoz42Ry0rDQBhG8wiCIEg0k5mMuSfNpTWtqK1YAhYt1ZUbV8UHcOML+Aw+7ykZSnQhNosDA/Nz5vu/sS7zlO+3DfXyCvlU4r9MUPMRjgwQOhxENyvzxGBJHbK+m1E0Bc4kRU0z3DTG8X6Ev89/Crt7PzRYwi943SR8vZeczTN0W3FuX5hXDXvZf1JHBcgsNliODvG0j3jcYlcLZOzjVilynOKWCSIYmDCIEHGEJXSEkB5Hz5+cNivUOECvary2xLsvjPRQn11Ct0tYJnuh0py0W+zZEjWNkE2OrFPcPO5lh1YWUWS674XH6w/s6wf0bYxaFKibEbLJBv12n7BI2AEu7s5BF6YeOQAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="api-test-folder" title="api-test-folder" src="/static/6055ebb1d62cbc411bbc7ec990ab46b4/5d5ad/api-test-folder.png" srcSet="/static/6055ebb1d62cbc411bbc7ec990ab46b4/0eb09/api-test-folder.png 500w /static/6055ebb1d62cbc411bbc7ec990ab46b4/5d5ad/api-test-folder.png 610w" sizes="(max-width: 610px) 100vw, 610px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p>
<p>사진과 같이 <code class="language-text">pages/api/</code> 경로에 <code class="language-text">test1.ts</code> 파일과 <code class="language-text">_test2.ts</code> 파일을 생성했다. 예상대로라면, <code class="language-text">_test2</code>의 경로로 api를 요청했을 경우 오류가 발생해야 한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// test1.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#x27;api 요청 성공 예상&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// _test2.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#x27;api 요청 실패 예상&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>그리고 브라우저에서 <code class="language-text">http://localhost:3000/api/test1</code>, <code class="language-text">http://localhost:3000/api/_test2</code>로 요청을 보내보았다. 결과는 아래 사진과 같다.</p>
<p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1724px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:29.000000000000004%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVQY0z3NbWvTYBTG8XyUgShra82d5unOY6HTFfdCFBU3WtgmU9R3fuBNZixdp21XXNKkd3v/JVE8cHGuF4ffMRw/QMYpomPiOh4926P7xKLdNnn4qKX39h7UOwuCtPC8kCjq647Zw3IlYZg0t38j2G89xjj+eMbo62c+vX7H2xevGJ++5/z8gpPjUy4+fNFn4xNGo3E2iPuFfH5AMn6p3wyGPO0Kwv6A4fCIwcEhnpPy7PAIY7Va8WNyw+X3CdeTKVfXGT/nC25/zZkvlvo+L7i8+pYJIQrLsek6Pe0KC9Fqs9/u0OvZmKZACBshLAylFPVoDbudZrvVKLVjXSrKSumdhul0mkVRVAQyIE0S7fk+YRyTpglhGDZJkhjLsjCqqmK5XHJ3t6JSOXm5JC8X/F7fUm5yXT+bzW6yNE0Lx3EIgkDXgJSy7g1i2zau6yKDAGOz2VAUBev1GrWtaqSBy809SlX/wFkmpSyEEP9B0zSJ47hBa9D3/SZ/AHWUIFgTLeW6AAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="api-call-result" title="api-call-result" src="/static/7151bc9d84a6128edb20359dc4dd5eee/8aa99/api-call-result.png" srcSet="/static/7151bc9d84a6128edb20359dc4dd5eee/0eb09/api-call-result.png 500w /static/7151bc9d84a6128edb20359dc4dd5eee/1263b/api-call-result.png 1000w /static/7151bc9d84a6128edb20359dc4dd5eee/8aa99/api-call-result.png 1724w" sizes="(max-width: 1724px) 100vw, 1724px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p>
<p>첫 번째 사진은 정상적으로 JSON이 반환된 것을 볼 수 있고, 두 번째 사진은 오류가 발생했다. 따라서, <code class="language-text">_</code> 접두사를 붙인 파일은 Endpoint를 만들지 않은 것을 볼 수 있다.</p>
<p>하지만 접두사 <code class="language-text">_</code>를 포함한 하나의 Utility 파일이면 상관 없지만, 코드를 폴더 구조로 나누고 싶을 수 있다. 공통으로 사용하는 Utility 코드가 생길 수 있기 때문이다. 즉 확장성이 떨어진다. 그리고 여러 개의 파일을 만들게 되면 폴더 명을 포함해, 파일 명에 매번 <code class="language-text">_</code> 접두사를 붙여주어야 한다. 2번째 방법을 사용해보자.</p>
<h3 id="2-pages-폴더-외부에-위치시키는-방법" style="position:relative">2. pages 폴더 외부에 위치시키는 방법<a href="#2-pages-%ED%8F%B4%EB%8D%94-%EC%99%B8%EB%B6%80%EC%97%90-%EC%9C%84%EC%B9%98%EC%8B%9C%ED%82%A4%EB%8A%94-%EB%B0%A9%EB%B2%95" aria-label="2 pages 폴더 외부에 위치시키는 방법 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:590px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:170.20000000000002%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAiCAYAAABfqvm9AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEAklEQVRIx5WW2W/iVhTG81SpkarZmkyzYYwXbIgx9vUGNng3YEjInlat0r60UtenUaVWqmbU5/7PX3VvAmVmJOw+WEbYfPrOPb/zHXZERYOs9eB8N4IRDpHmcyiagZOWDE5U0BDa792rrp2mpIKTVJiFjZ6to2d64NsdJrgpWluQE9vgFQNF0MY/f13BGU8wX15hfnGDxeUtxkmBo6ZYS2wt2BAViKqKy5kD2yY4NRxYXoCuTiCq2kc/2uZ2hz4U2h0cS338etvFzw8RvGiKyXyJVruL/SMOh5ywvqrOdGf1kJdUCKoOJyzQNWy4fohhmGIwTuAGEezhGI4fVjtcvSC0u1B1grP7b0AcD6OkQDY7Y1cQ5xgnE8RFyVxXlsxE6dXg8Mqa4LPlGxBiI8xnsAYjJkjdUZxWDaosmQo2eQHHTo697FsYT4K01L7lsbJPDRvHvFTV5afOiSqaHI8D/xzPL3+H5w0R5iUGowSGM8Tr42YtLnfW5dIveAFHJMF+9BV0g4B4I5iuD810Ppqc7Q5ZySqaDQ6HXolnd2/hOC5m59dIpwuM0wn69qAW4GuHnCCjIXexlz6As2LohgWNuOj2LXR0AjaidcBeC7YknHQInl//gbYTYlqeoZhfMHzMpzOkDakEe/1AkMEpOj4vf4RARnA8nyFDcaF3WjJtTm2HDV7EgaJhd/EbWmaAYBzDGyeMwaSYww8zNjm1ZpmXOmh1uliQO5Qkh+E4GCWTR5FxCqnTwwHXYk2pVTI98IYkIzJLJMk9NGcA4gWsxOE4YYlDg4GiUy8cGIMSXisaPrl7C3mQI4pTRPkM6WSB5fU9+0zLr+RwNXarpuzHX0MmPpxBwBpx2rcY2BQdtWfWA/s/bEw8u38HyU2wvLhGMl0gmczZi1+c8KzsytHbdNhQdOxNfwCvD9AzLPSIB93ymENVM5jL2g4pNodyD7uXf0J0YmT5FGE2ZaNXzJfsDKNs+tjAKmzoSzRg+8MQlu0ydxToVVITN2Ad3pzlrSXzcoetgGE+x2R5A+L68EYx6ypdAavo/1+z3GhJOJQ0fHr7DoKbIk4yBHGBpCiZIA2JqnD9QFAGp/bw0ltCJT5GER21DH6YMsjbp/11JlZySP8pCLKO6YOHmy9H8P0E5fKalUbX6EGjVStpPkibNhRTR3tyBbHnQDMstkOoM7qc6DxXbbwPwBZxpJjYvfsbil9gNj/D7PyKIVOUS5balMdNuLeDTQdf6WFv+j34/gbYxF1nIW0MdbrtLN8fPdXAi4s3kJ0IYZwhnZ4xsNOnEaR3ulK37ZYNwcfRezn/BZIdIs4KBrUfZazLNBhWEVYvvpjDPl6VP6HVHyBKciYWRDkD3HT8Wl3+F7vKBAg8b3HTAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="backend-folder" title="backend-folder" src="/static/36c2850e6353eccbbc1476bc97d31973/6d370/backend-folder.png" srcSet="/static/36c2850e6353eccbbc1476bc97d31973/0eb09/backend-folder.png 500w /static/36c2850e6353eccbbc1476bc97d31973/6d370/backend-folder.png 590w" sizes="(max-width: 590px) 100vw, 590px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p>
<p>사진과 같이 <code class="language-text">backend</code> 폴더를 생성한다. 그리고 원하는 대로 코드를 파악하기 쉽도록 잘게 쪼개어 작성한다. Utils만 따로 작성해도 되지만, http method를 여러 개 사용하고 있었기 때문에 조금 더 세분화 했다.</p>
<p>Next.js 13 버전에서 App Router의 API Route 코드는 <code class="language-text">Route Handlers</code> 라는 이름으로 변경되었다고 했는데, 그 구조는 아래와 같다.</p>
<p><img src="/b5bcb81c5abffbdad9bcda0798a5253c/13v-route-handlers.avif" alt="13v-route-handlers"/></p>
<p><code class="language-text">app/api</code> 폴더에 routes.ts 파일로 작성할 수 있다. 하지만, 기존 API Routes와 같이 하나의 함수만 존재하는 것은 아니다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<p>위와 같이 함수를 여러 개 정의할 수 있으며 <code class="language-text">GET</code>, <code class="language-text">POST</code> 와 같이 http methods 이름을 함수 명으로 작성하면 된다. Route Handlers의 http method 명을 함수 명으로 사용한 것을 착안해 <code class="language-text">httpMethods</code> 폴더를 backend 폴더 하위에 두고 <code class="language-text">GET.ts</code>, <code class="language-text">POST.ts</code>, <code class="language-text">DELETE.ts</code> 파일을 생성하고 필요한 로직을 작성했다. 예시인 <code class="language-text">GET.ts</code> 파일의 코드다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">GOOGLE_INFO</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/constants/google.ts&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> oauth2Client <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/utils/authUtils.ts&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> authorizationUrl<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> oauth2Client<span class="token punctuation">.</span><span class="token function">generateAuthUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  access_type<span class="token operator">:</span> <span class="token string">&#x27;offline&#x27;</span><span class="token punctuation">,</span>
  scope<span class="token operator">:</span> <span class="token constant">GOOGLE_INFO</span><span class="token punctuation">.</span><span class="token constant">SCOPE</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span>
  req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span>
  res<span class="token operator">:</span> NextApiResponse<span class="token operator">&lt;</span>GoogleUrl <span class="token operator">|</span> AxiosError<span class="token operator">&gt;</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> location<span class="token operator">:</span> authorizationUrl <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>기존 API Routes 코드에서 분기분으로 GET 코드를 사용했던 것보다 훨씬 한 눈에 파악하기 쉬워졌다.</p>
<p>그리고, http methods 코드를 최종적으로 API Routes 코드에서 한 번에 불러오기  위해 <code class="language-text">도메인/index.ts</code> 파일에서 GET.ts, POST.ts, DELETE.ts 파일들을 <strong>re-export</strong> 해준다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// @/backend/auth/index.ts</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/auth/httpMethods/GET.ts&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/auth/httpMethods/POST.ts&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/auth/httpMethods/DELETE.ts&#x27;</span><span class="token punctuation">;</span></code></pre></div>
<p>이제 마지막으로 실제 API Routes 코드인 <code class="language-text">pages/api/auth.ts</code> 파일을 보자. 실제 API Routes를 실행시키고, API Endpoint를 생성해주던 파일이다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// pages/api/auth.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">AUTH</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/auth/index.ts&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">RouteMehtod</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">typeof</span> <span class="token constant">AUTH</span><span class="token punctuation">.</span><span class="token constant">GET</span> <span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">AUTH</span><span class="token punctuation">.</span><span class="token constant">POST</span> <span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">AUTH</span><span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>
  req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span>
  res<span class="token operator">:</span> NextApiResponse
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> HttpFunctions<span class="token operator">:</span> RouteMehtod <span class="token operator">=</span> <span class="token constant">AUTH</span><span class="token punctuation">;</span>
  HttpFunctions<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>index.ts에서 re-export한 파일을 가져와, <code class="language-text">req.method</code> (http 요청이 들어온 메서드 명)가 들어온 이름에 따라 함수를 실행해주도록 했다.</p>
<p>기존 auth.ts 파일의 코드는 아래 사진과 같이 167 라인이었고 그 길이 만큼 코드를 파악하기 어려웠었다. 이제는 auth.ts 파일은 단순히 통로가 되어, http 요청에 따라 실행 될 함수가 작성된 파일을 찾아 보면 되기 때문에 코드 파악이 훨씬 쉬워졌다.</p>
<p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1294px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:69.4%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACIUlEQVQ4y32TW4+bMBCFeWs3yQIh+IKNLxhMAgm5qFHV///HTuXJZtVW2T58GizZY59zhox3V4hwg/ALeLhDhgsO5584LHcw1f0F1+FL6sZjJx0yN17g9zeE6QeG5ReaboYfz3DxBOX3kDZCmgGNixBt/5LU0A1HDNMNme0ndOMJw7jgcr6jcxHGDjCmh7UDYfwMP5w/X7Fr3KNKh7pxqISFCROG6YqsZBoFa1FVEg1TGLsRYzejD0f4cET0BzRthFAR75XEZiuo/su65FgVDFklDBJvBcO3gkErD616bCpFF5WsxVte4ftmS4e+Il2UyJ4+pIUzAUYa2LCH7GYwd0DVdDDjFcLtUdTqr8OvIMmJtFFyjUYaKD+iDRN0mFAKAxUmMD8j3zUka10yrJ/1Q+qTD8mWJDdck2Q/npDCkm1E318RuhsFk9cK7zuFvNbIWYv3VGtFD9ryFgXTqaGl1FJDJw2W4xVxucPEE8bjDa4/wvsLQriiVh1ZsDMjajdhqwcwHdB2I0w4oLEDspI/jE8SSqbQHRbYYQaTA6QaIG1PslflQ9KapNVY5TXWqRYMb3lNkOTnPJGHOqI1E2yY4Wg+F5qAp+EP31Kq/wuFt6Q/3bDlBlwGiDaCmwihA0puUHBL/pTCYisMhfNV2lklLYWSNok2UEOuI3a6h5CBKvklHZiJ5ONzfF6RUTq1AlOe6uqPcfikYNjQN/t82au/JfEb/ZRo3phqKmQAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="167-line-code" title="167-line-code" src="/static/e4b9a075b6dbeddc0a7df5edeb7fcf63/80132/167-line-code.png" srcSet="/static/e4b9a075b6dbeddc0a7df5edeb7fcf63/0eb09/167-line-code.png 500w /static/e4b9a075b6dbeddc0a7df5edeb7fcf63/1263b/167-line-code.png 1000w /static/e4b9a075b6dbeddc0a7df5edeb7fcf63/80132/167-line-code.png 1294w" sizes="(max-width: 1294px) 100vw, 1294px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
    </span></p>
<p>하지만, 이렇게 리팩토링하면서 한 가지 아쉬운 부분이 존재했다. 공통 에러처리에 대한 부분이다. 백엔드의 코드에서 에러가 발생한다면 공통으로 잡아주고 싶었다. 또한, API Routes로 로깅을 해야하는 상황이 있을 수 있겠다는 생각이 들었다.</p>
<h4 id="Filter-적용" style="position:relative">Filter 적용<a href="#Filter-%EC%A0%81%EC%9A%A9" aria-label="Filter 적용 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<p>Spring에는 filter와 interceptor가 존재한다. http 요청이 들어오면 먼저 filter를 거치고, interceptor를 거쳐 controller로 요청 데이터가 넘어오게 된다. 이 과정을 착안해서, filter 혹은 interceptor를 만들면 좋겠다고 생각했다. spring에서 filter는 실제 http 요청이 컨테이너로 넘어오기 전에 데이터를 가공하거나 XSS 공격을 막아주는 역할을 한다고 한다. 또한 filter는 체이닝이라는 특성을 가지고 있어, 체이닝 개념으로 사용하면 좋을 것 같다고 생각했다. interceptor와 비교했을 경우 filter라는 명칭이 더 어울릴 것 같아 filter를 만들게 되었다.</p>
<p>filter는 간단하게 HoF으로 handler를 감싸주기만 하면 된다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// @/backend/common/filter.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Hanlder <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/common/interfaces.ts&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> errorFilter <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/common/errorFilter.ts&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span>handler<span class="token operator">:</span> Hanlder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">errorFilter</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>위와 같이 HoF를 만들어주면 <code class="language-text">return</code> 문에 <code class="language-text">logFilter(errorFilter(handler))</code> 같은 방식으로 추후에 logFilter도 만들어 적용할 수 있다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// pages/api/auth.ts</span>

<span class="token comment">// import 문 생략</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> HttpFunctions<span class="token operator">:</span> RouteMehtod <span class="token operator">=</span> <span class="token constant">AUTH</span><span class="token punctuation">;</span>
  HttpFunctions<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">filter</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>handler 코드에 filter를 감싸주었다. 그러면, 무조건 http 요청이 오면 filter를 거쳐 실제 함수가 실행된다. <code class="language-text">errorFilter.ts</code>를 보자.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// @/backend/common/errorFilter.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Hanlder <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@/backend/common/interfaces.ts&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">HTTP_METHODS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;next/dist/server/web/http&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">errorFilter</span><span class="token punctuation">(</span>handler<span class="token operator">:</span> Hanlder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token constant">HTTP_METHODS</span> <span class="token keyword">as</span> ReadonlyArray<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res
        <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&#x27;허용되지 않는 http method 입니다.&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// NOTE:  공통 에러 처리 추가 가능</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res
        <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">&#x27;알 수 없는 오류가 발생했습니다.&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>위 내용은 아래 커밋에서 볼 수 있다.</p>
<ul>
<li><a href="https://github.com/pozafly/jiary/commit/d496003516c56a6f056b6991f62a5f2caafd8219" target="_blank" rel="nofollow">HTTP Method 별 파일 분리 커밋</a></li>
<li><a href="https://github.com/pozafly/jiary/commit/d5b74a7331338e9a238f39ad09c650edd2cbe007" target="_blank" rel="nofollow">공통 에러처리 및 필터 추가 커밋</a></li>
</ul>
<br/>
<h2 id="마치며" style="position:relative">마치며<a href="#%EB%A7%88%EC%B9%98%EB%A9%B0" aria-label="마치며 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>이번 글은 Next.js의 API Routes의 컨셉을 간단히 알아보고, API Routes로 백엔드 코드를 작성해보면서 코드를 어떻게 분리시킬지 개선한 부분을 작성했다. Next.js의 API Routes는 사실 그렇게까지 많이 사용되고 있지는 않다고 한다. heath 체크 정도로만 사용하지, 백엔드의 역할을 백엔드가 한다고 한다. 그래서 그런지 API Routes 코드를 제대로 모듈화 한 자료를 많이 찾지 못했고, 컨셉을 들여다보며 원하는 방향대로 리팩토링 해봤다.</p>
<p>Next.js를 사용한  곳의 프로젝트 사이즈가 크고, MSA 구조로 되어 있어서 BFF가 필요하다고 하면, API Routes를 데이터 가공 레이어로 활용해보면 좋겠다고 생각했다.</p>
<p>리팩토링 전 코드가 매우 지저분해서 마음에 걸렸었는데, 코드 구조가 보기 좋게 되었다. 이렇게 코드가 딱 깔끔하게 떨어졌을 때의 쾌감은 이루 말할 수 없다.</p>
<blockquote>
<p>참고</p>
<ul>
<li><a href="https://nextjs.org/docs/app/building-your-application/routing/router-handlers" target="_blank" rel="nofollow">https://nextjs.org/docs/app/building-your-application/routing/router-handlers</a></li>
<li><a href="https://www.daleseo.com/meta-frameworks/" target="_blank" rel="nofollow">https://www.daleseo.com/meta-frameworks/</a></li>
<li><a href="https://json.media/blog/proper_understading_of_nextjs" target="_blank" rel="nofollow">https://json.media/blog/proper_understading_of_nextjs</a></li>
<li><a href="https://dev.to/wzulfikar/end-to-end-typing-for-nextjs-api-50kn" target="_blank" rel="nofollow">https://dev.to/wzulfikar/end-to-end-typing-for-nextjs-api-50kn</a></li>
<li><a href="https://github.com/vercel/next.js/discussions/17832" target="_blank" rel="nofollow">https://github.com/vercel/next.js/discussions/17832</a></li>
<li><a href="https://github.com/microsoft/TypeScript/pull/52217" target="_blank" rel="nofollow">https://github.com/microsoft/TypeScript/pull/52217</a></li>
<li><a href="https://dev.to/sneakysensei/nextjs-api-routes-global-error-handling-and-clean-code-practices-3g9p" target="_blank" rel="nofollow">https://dev.to/sneakysensei/nextjs-api-routes-global-error-handling-and-clean-code-practices-3g9p</a></li>
<li><a href="https://github.com/vercel/vercel/discussions/4983" target="_blank" rel="nofollow">https://github.com/vercel/vercel/discussions/4983</a></li>
</ul>
</blockquote></div></section></article><style data-emotion="css 17876f4">.css-17876f4{position:relative;box-sizing:border-box;width:100%;max-width:760px;margin-left:auto;margin-right:auto;}</style><div class="css-17876f4"><div></div></div></div></main><style data-emotion="css dcfhc9">.css-dcfhc9{position:relative;padding:0 5vw;}</style><style data-emotion="css 1aa7tg3">.css-1aa7tg3{border-bottom:1px solid rgba(255, 255, 255, 0.1);background:#0a0b0c;position:relative;padding:0 5vw;}.css-1aa7tg3 .post-card{padding-bottom:0;border-bottom:none;}.css-1aa7tg3 .post-card:after{display:none;}.css-1aa7tg3 .post-card-primary-tag{color:#fff;opacity:0.6;}.css-1aa7tg3 .post-card-title{color:#fff;opacity:0.8;-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-1aa7tg3 .post-card:hover .post-card-image{opacity:1;}.css-1aa7tg3 .post-card-excerpt{color:rgba(255, 255, 255, 0.6);}.css-1aa7tg3 .static-avatar{border-color:#000;}.css-1aa7tg3 .post-card-byline-content{color:rgba(255, 255, 255, 0.6);}.css-1aa7tg3 .post-card-byline-content a{color:rgba(255, 255, 255, 0.8);}.css-1aa7tg3 .author-avatar{border-color:#0a0b0c;}.css-1aa7tg3 .author-profile-image{background:#0a0b0c;}@media (max-width: 650px){.css-1aa7tg3 .post-card{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;margin:25px;padding:25px 0 0;border-bottom:1px solid rgba(255, 255, 255, 0.1);}}</style><aside class="read-next css-1aa7tg3 eu5ixib1"><div class="css-y521qa"><style data-emotion="css 1ehfk3g">.css-1ehfk3g{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 -25px;padding:60px 0 0 0;}</style><div class="read-next-feed css-1ehfk3g eu5ixib0"><style data-emotion="css vxrpic">.css-vxrpic{position:relative;-webkit-flex:1 1 301px;-ms-flex:1 1 301px;flex:1 1 301px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;overflow:hidden;margin:0 20px 60px;min-height:220px;-webkit-background-size:cover;background-size:cover;-webkit-transition:0.4s ease;transition:0.4s ease;}.css-vxrpic:hover{-webkit-transform:translateY(-2px);-moz-transform:translateY(-2px);-ms-transform:translateY(-2px);transform:translateY(-2px);}</style><article class="post-card   css-vxrpic"><style data-emotion="css 16xcmry">.css-16xcmry{position:relative;display:block;overflow:hidden;border-radius:12px;}</style><a class="post-card-image-link css-16xcmry" href="/diary/geultto-8-retrospect/"><style data-emotion="css 16etra8">.css-16etra8{width:auto;height:200px;background:#fff no-repeat center center;-webkit-background-size:cover;background-size:cover;border-radius:12px;border:1px solid hsl(230deg 25% 94%);}.css-16etra8 img{border-radius:12px;}@media (prefers-color-scheme: dark){.css-16etra8{background:#191b1f;border:1px solid hsl(230deg 6% 23%);}}.css-16etra8.is-next{border:1px solid hsl(230deg 6% 23%);}</style><div class="post-card-image is-next css-16etra8 e1qfhan16"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:56.97329376854599%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAACE3AAAhNwEzWJ96AAABSklEQVQoz6WTu6rCQBCGfSZ9A5/AImCTTiI2ghokJLhRMAYsxcYyTTrFp5BcwEvjWwhCCBKS2ZnDLgSC6DnKGVh2io+P3Z1/a1QpRCx3pD+qZJ7R2gtOEo/HIzufz3kcxxCGIQRBAFEUwel0ytM0zSpSfCsUAOdctsvlMqnX64WqqlzTNOj1etDpdHij0QDGWCIYwT7f5q3QNE2Yz+cUBAExxuh2u0lmsVjQYDCA8oAfCxljhW3bst/v93i9XhEA0HVd0nW9+Fo4mUyK6XQq+zAMqdls0m63w9VqJU74vXA2mxWGYdD9fsfD4YDdbhe32y06jkPj8fh7oWEYoCgKrddr8jyPfN+nzWZD7Xab+v3+528IALK1bTtptVqFZVl8OByCGIRpmlxRFBiNRnLKgv1VWM1hlmXZ5XLJj8cjVJfIpsjopzn890/5AT9vF1I4Ou42AAAAAElFTkSuQmCC" alt=""/><picture><source type="image/webp" data-srcset="/static/53fe681b532753855e5826673a894e9a/15c6e/main.webp 674w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/53fe681b532753855e5826673a894e9a/44f99/main.png" data-srcset="/static/53fe681b532753855e5826673a894e9a/44f99/main.png 674w" alt="글또 8기 회고 cover image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/53fe681b532753855e5826673a894e9a/15c6e/main.webp 674w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/53fe681b532753855e5826673a894e9a/44f99/main.png" srcSet="/static/53fe681b532753855e5826673a894e9a/44f99/main.png 674w" alt="글또 8기 회고 cover image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></a><style data-emotion="css 1lh7kdz">.css-1lh7kdz{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="post-card-content css-1lh7kdz e1qfhan15"><style data-emotion="css 18bk8u1">.css-18bk8u1{margin:15px 0 0.2em;color:#90a2aa;font-size:1.3rem;font-weight:500;letter-spacing:0.2px;}</style><div class="post-card-primary-tag css-18bk8u1 e1qfhan14"><a href="/tags/diary/">Diary</a></div><style data-emotion="css 1fjrpmt">.css-1fjrpmt{position:relative;display:block;color:#15171A;}.css-1fjrpmt:hover{-webkit-text-decoration:none;text-decoration:none;}</style><a class="post-card-content-link css-1fjrpmt" href="/diary/geultto-8-retrospect/"><header><style data-emotion="css 3lgx4i">.css-3lgx4i{margin:0 0 0.4em;line-height:1.15em;-webkit-transition:color 0.2s ease-in-out;transition:color 0.2s ease-in-out;}@media (prefers-color-scheme: dark){.css-3lgx4i{color:rgba(255, 255, 255, 0.85);}}</style><h2 class="post-card-title css-3lgx4i e1qfhan13">글또 8기 회고</h2></header><style data-emotion="css 1hvq4qv">.css-1hvq4qv{font-size:1.6rem;}@media (prefers-color-scheme: dark){.css-1hvq4qv{color:#768086;}}.css-1hvq4qv p{width:100%;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-bottom:0.8em;}</style><section class="post-card-excerpt css-1hvq4qv e1qfhan12"><p>6개월 간 참여한 글또 활동 회고. 글쓰기에 대해서.</p></section></a><style data-emotion="css 143c7df">.css-143c7df{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding:0;}</style><footer class="post-card-meta css-143c7df e1qfhan11"><style data-emotion="css 1ja96fr">.css-1ja96fr{-webkit-flex:1 1 50%;-ms-flex:1 1 50%;flex:1 1 50%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;color:#90a2aa;line-height:1.4em;font-weight:400;letter-spacing:0.2px;}.css-1ja96fr time{font-size:1.3rem;}.css-1ja96fr span{margin:0;font-size:1.3rem;}.css-1ja96fr a{color:#434952;font-weight:600;}@media (prefers-color-scheme: dark){.css-1ja96fr a{color:rgba(255, 255, 255, 0.75);}}</style><div class="post-card-byline-content css-1ja96fr e1qfhan10"><span class="post-card-byline-date"><time dateTime="2023-07-16">2023 07 16</time> <span class="bull">•</span> <span>8 min read</span></span></div></footer></div></article></div></div></aside><style data-emotion="css d4eprp">.css-d4eprp{position:relative;padding:0 5vw;position:relative;padding-top:20px;padding-bottom:22px;color:#fff;background:#000;}</style><footer class="css-d4eprp"><style data-emotion="css 1d3gyi8">.css-1d3gyi8{margin:0 auto;max-width:1040px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:rgba(255, 255, 255, 0.7);font-size:1.3rem;}.css-1d3gyi8 a{color:rgba(255, 255, 255, 0.7);}.css-1d3gyi8 a:hover{color:rgba(255, 255, 255, 1);-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 650px){.css-1d3gyi8{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="css-1d3gyi8"><section class="copyright">© <!-- -->2023<!-- --> <span>|  </span><a href="https://www.gatsbyjs.com/" target="_blank" rel="nofollow">Pozafly Blog<!-- --> <!-- -->is based on Gatsby Casper</a></section><style data-emotion="css 13qgqyf">.css-13qgqyf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-13qgqyf a{position:relative;margin-left:20px;font-size:1.3rem;}.css-13qgqyf a:before{content:'';position:absolute;top:11px;left:-11px;display:block;width:2px;height:2px;background:#fff;border-radius:100%;}.css-13qgqyf a:first-of-type:before{display:none;}@media (max-width: 650px){.css-13qgqyf a:first-of-type{margin-left:0;}}</style><nav class="css-13qgqyf e1me3zb40"><a href="/">Latest Posts</a><a href="https://www.instagram.com/pozafly_/" target="_blank" rel="noopener noreferrer">Instagram</a><a href="https://github.com/pozafly" target="_blank" rel="noopener noreferrer">Github</a><a href="/rss.xml">RSS</a></nav></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/nextjs/about-modularizing-api-routes-code-in-nextjs/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-4db1aad52ce7bd3994a2.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-7e56e5f698fc1b8ecad4.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-537864e8821dcd6ae890.js\"],\"component---src-pages-tags-tsx\":[\"/component---src-pages-tags-tsx-c5a6a097c880bb175278.js\"],\"component---src-templates-index-tsx\":[\"/component---src-templates-index-tsx-b5c37eca4d84495d41dd.js\"],\"component---src-templates-post-tsx\":[],\"component---src-templates-tags-tsx\":[\"/component---src-templates-tags-tsx-115dcf3868904aa97209.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="2c890f994b2541a27693";</script><script src="/webpack-runtime-e0084df1a0ff81aa6707.js" async></script><script src="/framework-5332a90d114fef29dbe7.js" async></script><script src="/app-4db1aad52ce7bd3994a2.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>