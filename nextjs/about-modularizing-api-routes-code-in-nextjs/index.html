<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.3"/><meta name="description" content="API Routes를 사용하면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적." data-gatsby-head="true"/><meta property="og:site_name" content="Pozafly&#x27;s Blog" data-gatsby-head="true"/><meta property="og:type" content="article" data-gatsby-head="true"/><meta property="og:title" content="Next.js의 API Routes 코드 모듈화에 대해서" data-gatsby-head="true"/><meta property="og:description" content="API Routes를 사용하면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적." data-gatsby-head="true"/><meta property="og:url" content="https://pozafly.github.io/nextjs/about-modularizing-api-routes-code-in-nextjs/" data-gatsby-head="true"/><meta property="og:image" content="https://pozafly.github.io/static/6763177ee50addd67c4dc57952797f69/231da/main.webp" data-gatsby-head="true"/><meta property="article:published_time" content="2023-07-26T00:00:00.000Z" data-gatsby-head="true"/><meta property="article:tag" content="Next.js" data-gatsby-head="true"/><meta name="github:card" content="summary_large_image" data-gatsby-head="true"/><meta name="github:title" content="Next.js의 API Routes 코드 모듈화에 대해서" data-gatsby-head="true"/><meta name="github:description" content="API Routes를 사용하면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적." data-gatsby-head="true"/><meta name="github:url" content="https://pozafly.github.io/nextjs/about-modularizing-api-routes-code-in-nextjs/" data-gatsby-head="true"/><meta name="github:image" content="https://pozafly.github.io/static/6763177ee50addd67c4dc57952797f69/231da/main.webp" data-gatsby-head="true"/><meta name="github:label1" content="Written by" data-gatsby-head="true"/><meta name="github:data1" content="Pozafly" data-gatsby-head="true"/><meta name="github:label2" content="Filed under" data-gatsby-head="true"/><meta name="github:data2" content="Next.js" data-gatsby-head="true"/><meta name="github:site" content="@pozafly" data-gatsby-head="true"/><meta name="github:creator" content="@pozafly" data-gatsby-head="true"/><meta property="og:image:width" content="1" data-gatsby-head="true"/><meta property="og:image:height" content="0.5234375" data-gatsby-head="true"/><link rel="icon" href="/favicon-32x32.png?v=a62d45ddbe29cf42da820a576d9375e1" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .auto-link.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .auto-link.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .auto-link svg,
    h2 .auto-link svg,
    h3 .auto-link svg,
    h4 .auto-link svg,
    h5 .auto-link svg,
    h6 .auto-link svg {
      visibility: hidden;
    }
    h1:hover .auto-link svg,
    h2:hover .auto-link svg,
    h3:hover .auto-link svg,
    h4:hover .auto-link svg,
    h5:hover .auto-link svg,
    h6:hover .auto-link svg,
    h1 .auto-link:focus svg,
    h2 .auto-link:focus svg,
    h3 .auto-link:focus svg,
    h4 .auto-link:focus svg,
    h5 .auto-link:focus svg,
    h6 .auto-link:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://pozafly.github.io/nextjs/about-modularizing-api-routes-code-in-nextjs/" data-baseprotocol="https:" data-basehost="pozafly.github.io"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SLQNH3ND3J"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-SLQNH3ND3J',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SLQNH3ND3J', {"anonymize_ip":true,"cookie_expires":0,"send_page_view":false});
      }
      </script><title data-gatsby-head="true">Next.js의 API Routes 코드 모듈화에 대해서</title></head><body><script>
  (function() {
    window.__onThemeChange = function() {}; // 컴포넌트에서 정의할 테마 변경 콜백

    let preferredTheme; // 초기화에 사용할 테마
    try {
      const saved = localStorage.getItem('theme') // 로컬 스토리지에 있는 것 사용
      if (saved) {
        preferredTheme = saved.toLowerCase()
      }
    } catch (err) { }

    // 테마 설정 함수
    window.__setPreferredTheme = function(newTheme) {
      window.__theme = newTheme; // 테마는 전역 변수에 저장
      preferredTheme = newTheme;
      document.body.className = newTheme; // 바디에 클래스 추가
      window.__onThemeChange(newTheme); // 콜백 실행

      try {
        localStorage.setItem('theme', newTheme);
      } catch (err) {}
    }

    // 컬러모드 미디어 쿼리 객체를 가져온다
    const darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

    // 컬러모드 변경 탐지 이벤트 리스터 추가
    darkQuery.addListener(function(e) {
      window.__setPreferredTheme(e.matches ? 'dark' : 'light')
    });

    // 테마 설정. 저장된 테마가 없으면 시스템 설정을 사용한다.
    window.__setPreferredTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
  })();
  </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="post-template"><style data-emotion="css-global 1tncpns">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,dl,dt,dd,ol,fieldset,form,label,legend,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;font:inherit;font-size:16px;vertical-align:baseline;border:0;}html .error-front-page,body .error-front-page,div .error-front-page,span .error-front-page,applet .error-front-page,object .error-front-page,iframe .error-front-page,h1 .error-front-page,h2 .error-front-page,h3 .error-front-page,h4 .error-front-page,h5 .error-front-page,h6 .error-front-page,p .error-front-page,blockquote .error-front-page,pre .error-front-page,a .error-front-page,abbr .error-front-page,acronym .error-front-page,address .error-front-page,big .error-front-page,cite .error-front-page,code .error-front-page,del .error-front-page,dfn .error-front-page,em .error-front-page,img .error-front-page,ins .error-front-page,kbd .error-front-page,q .error-front-page,s .error-front-page,samp .error-front-page,small .error-front-page,strike .error-front-page,strong .error-front-page,sub .error-front-page,sup .error-front-page,tt .error-front-page,var .error-front-page,dl .error-front-page,dt .error-front-page,dd .error-front-page,ol .error-front-page,fieldset .error-front-page,form .error-front-page,label .error-front-page,legend .error-front-page,article .error-front-page,aside .error-front-page,canvas .error-front-page,details .error-front-page,embed .error-front-page,figure .error-front-page,figcaption .error-front-page,footer .error-front-page,header .error-front-page,hgroup .error-front-page,menu .error-front-page,nav .error-front-page,output .error-front-page,ruby .error-front-page,section .error-front-page,summary .error-front-page,time .error-front-page,mark .error-front-page,audio .error-front-page,video .error-front-page{font-size:1.6rem;}body{overflow-x:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:1.6rem;-moz-font-feature-settings:'liga' on;font-weight:400;font-style:normal;line-height:1.6em;color:var(--body-color);letter-spacing:0;background:var(--background-color);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;word-break:keep-all;}body::-webkit-scrollbar{width:6px;background-color:transparent;}body::-webkit-scrollbar-thumb{background-color:hsl(230 5% 35%);border-radius:8px;}body.light{--body-color:#303a3e;--background-color:#fff;--main-color:#000;--link-color:#0a0b0c;--border-top-color:#e4eaed;--nav-background:rgb(255 255 255 / 0.4);--nav-border-color:rgb(0 0 0 / 0.05);--header-color:var(--background-color);--header-after:var(--background-color);--header-before:rgb(255 255 255 / 0.18);--author-border:#fff;--home-header-color:#15171A;--home-header-border-bottom:#eaeff1;--header-author-link:#15171A;--no-image-border:#eaeff1;--strong-font-weight:600;--anchor-color:#768086;--loader-color:hsla(230 40% 10% / 0.8);--loader-color2:hsla(230 40% 10% / 0.2);--image-border-color:hsl(230 25% 94%);--post-card-title:rgb(21 23 26);--post-card-description:rgb(48 58 62);--post-card-by-line:#434952;--strong-color:#0a0b0c;--figcaption-color:#000;--table-first-of-type:linear-gradient(
        to right,
        rgb(255 255 255) 50%,
        rgb(255 255 255 / 0) 100%
      );--table-last-of-type:linear-gradient(
        to left,
        rgb(255 255 255) 50%,
        rgb(255 255 255 / 0) 100%
      );--table-th-background:#f4f8fb;--table-th-border:#e1edf4;--tag-boxshadow:hsl(218 53% 10% / 0.12);--tag-background:#f5f5f5;--post-full-border:#e4eaed;--post-full-meta-link:#2c3036;--post-full-meta-link-hover:#15171A;--post-full-title:#0b0c0e;--highlight-background:#fafafa;--highlight-border:#d1d1d1;--pre-code-color:#000;--little-code-background:var(--highlight-background);--little-code-border:#d1d1d1;--prism-background:hsl(0 0% 90.66%);--prism-border-left:hsl(0 0% 82.88%);--about-box-shadow:10px 10px 30px #bebebe,-10px -10px 30px #fff;--post-card-opacity:0;--post-card-background:rgb(0 0 0 / 0.1);--post-card-after-opacity:1;}body.dark{--body-color:rgba(255 255 255 / 0.75);--background-color:#191b1f;--main-color:#fff;--link-color:rgba(255 255 255 / 0.9);--border-top-color:#2b2f36;--nav-background:rgba(25 27 31 / 0.4);--nav-border-color:rgba(255 255 255 / 0.05);--header-color:#0a0b0c;--header-after:#191b1f;--header-before:rgba(0 0 0 / 0.6);--author-border:#1a1c20;--home-header-color:rgba(255 255 255 / 0.9);--home-header-border-bottom:#272a30;--header-author-link:rgba(255 255 255 / 0.75);--no-image-border:#3b4049;--strong-font-weight:500;--anchor-color:#90a2aa;--loader-color:hsl(230 40% 90% / 0.8);--loader-color2:hsl(230 40% 90% / 0.2);--image-border-color:hsl(230 6% 23%);--post-card-title:rgba(255 255 255 / 0.85);--post-card-description:#768086;--post-card-by-line:rgba(255 255 255 / 0.75);--strong-color:#f2f2f2;--figcaption-color:rgba(255 255 255 / 0.6);--table-first-of-type:linear-gradient(
        to right,
        #191b1f 50%,
        #191b1f 100%
      );--table-last-of-type:linear-gradient(270deg, #191b1f 50%, rgb(25 27 31));--table-th-background:#2b2f36;--table-th-border:var(--table-th-background);--tag-boxshadow:#090f1a;--tag-background:#282b31;--post-full-border:#3b4049;--post-full-meta-link:rgb(255 255 255 / 0.75);--post-full-meta-link-hover:#fff;--post-full-title:rgb(255 255 255 / 0.9);--highlight-background:rgb(32 36 39);--highlight-border:none;--pre-code-color:#c9d1d9;--little-code-background:rgb(96 98 100 / 0.4);--little-code-border:none;--prism-background:rgb(0 0 0 / 0.4);--prism-border-left:#818181;--about-box-shadow:10px 20px 20px hsl(230 4% 8% / 0.3);--post-card-opacity:0.6;--post-card-background:rgb(0 0 0 / 0.3);--post-card-after-opacity:0.1;}a{color:var(--anchor-color);-webkit-text-decoration:none;text-decoration:none;background-color:transparent;}a:hover{-webkit-text-decoration:underline;text-decoration:underline;}a:active,a:hover{outline:0;}ol,ul{max-width:100%;padding-left:1.3em;list-style:none;}blockquote,q{quotes:none;}blockquote:before,blockquote:after,q:before,q:after{content:none;}table{border-spacing:0;border-collapse:collapse;}img{max-width:100%;border:0;}html{overflow:hidden scroll;box-sizing:border-box;font-family:sans-serif;font-size:62.5%;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgb(0 0 0 / 0);}*,*:before,*:after{box-sizing:inherit;}b,strong{font-weight:var(--strong-font-weight);}i,em,dfn{font-style:italic;}small{font-size:80%;}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline;}sup{top:-0.5em;}sub{bottom:-0.25em;}mark{background-color:#fdffb6;}code,kbd,pre,samp{font-family:monospace;font-size:1em;}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit;}button{overflow:visible;border:none;}button,select{text-transform:none;}button,html input[type='button'],input[type='reset'],input[type='submit']{cursor:pointer;-webkit-appearance:button;}button[disabled],html input[disabled]{cursor:default;}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0;}input{line-height:normal;}input:focus{outline:none;}input[type='checkbox'],input[type='radio']{box-sizing:border-box;padding:0;}input[type='number']::-webkit-inner-spin-button,input[type='number']::-webkit-outer-spin-button{height:auto;}input[type='search']{box-sizing:content-box;-webkit-appearance:textfield;}input[type='search']::-webkit-search-cancel-button,input[type='search']::-webkit-search-decoration{-webkit-appearance:none;}legend{padding:0;border:0;}textarea{resize:vertical;overflow:auto;}td,th{padding:0;}hr{position:relative;display:block;width:100%;height:1px;margin:2.5em 0 3.5em;padding:0;border:0;border-top:1px solid var(--border-top-color);}audio,canvas,iframe,img,svg,video{vertical-align:middle;}svg:not(:root){overflow:hidden;}fieldset{margin:0;padding:0;border:0;}p,ul,ol,dl,blockquote{margin:0 0 1.5em;}ul{list-style:disc;}ol{list-style:decimal;}ol ol,ul ul,ul ol,ol ul{margin:0.5em 0 1em;}li{margin:0.4em 0;padding-left:0.3em;line-height:1.6em;}dt{float:left;width:120px;margin:0 20px 0 0;font-weight:500;color:#15171A;text-align:right;}dd{margin:0 0 5px;text-align:left;}blockquote{margin:1.5em 0;padding:0 1.6em;border-left:#e5eff5 0.5em solid;}blockquote p{margin:0.8em 0;font-size:1.2em;font-weight:400;}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;font-size:0.9em;opacity:0.8;}blockquote cite{font-weight:700;}blockquote cite a{font-weight:400;}h1,h2,h3,h4,h5,h6{margin-top:0;font-weight:600;line-height:1.15;text-rendering:optimizeLegibility;}h1 a.auto-link,h2 a.auto-link,h3 a.auto-link,h4 a.auto-link,h5 a.auto-link,h6 a.auto-link{box-shadow:none!important;}h1 a.auto-link:hover,h2 a.auto-link:hover,h3 a.auto-link:hover,h4 a.auto-link:hover,h5 a.auto-link:hover,h6 a.auto-link:hover{box-shadow:none!important;}h1 a.auto-link svg,h2 a.auto-link svg,h3 a.auto-link svg,h4 a.auto-link svg,h5 a.auto-link svg,h6 a.auto-link svg{opacity:0;fill:var(--link-color)!important;-webkit-transition:0.25s ease;transition:0.25s ease;}h1:hover a.auto-link svg,h2:hover a.auto-link svg,h3:hover a.auto-link svg,h4:hover a.auto-link svg,h5:hover a.auto-link svg,h6:hover a.auto-link svg{opacity:1;}h1{margin:0 0 0.5em;font-size:5.5rem;font-weight:600;}@media (max-width: 500px){h1{font-size:2.2rem;}}h2{margin:1.5em 0 0.5em;font-size:2.2rem;}@media (max-width: 500px){h2{font-size:1.8rem;}}h3{margin:1.5em 0 0.5em;font-size:1.8rem;font-weight:500;}@media (max-width: 500px){h3{font-size:1.7rem;}}h4{margin:1.5em 0 0.5em;font-size:1.6rem;font-weight:500;}h5{margin:1.5em 0 0.5em;font-size:1.4rem;font-weight:500;}h6{margin:1.5em 0 0.5em;font-size:1.4rem;font-weight:500;}.medium-zoom-overlay{-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);}.gatsby-resp-image-background-image{border-radius:6px;}.gatsby-resp-image-wrapper{margin:40px 0;}@media (max-width: 800px){.gatsby-resp-image-wrapper{width:100%;margin:initial;}}.medium-zoom-image{box-shadow:none!important;}.copyright{font-size:1.4rem;}.copyright a{font-size:inherit;}</style><style data-emotion="css vva9px">.css-vva9px .site-main{margin-top:64px;padding-bottom:4vw;background:var(--background-color);}</style><style data-emotion="css 163jdes">.css-163jdes{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}.css-163jdes .site-main{margin-top:64px;padding-bottom:4vw;background:var(--background-color);}</style><div class="css-163jdes e1xu36er0"><header class="site-header"><style data-emotion="css 1kbvt30">.css-1kbvt30{position:relative;padding:0 5vw;position:fixed;z-index:1000;top:0;right:0;left:0;background:var(--nav-background);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);border-bottom:1px solid var(--nav-border-color);}</style><div class="css-1kbvt30"><style data-emotion="css 8aaawc">.css-8aaawc{width:100%;max-width:1040px;margin:0 auto;}</style><div class="css-8aaawc"><style data-emotion="css tetqay">.css-tetqay{position:relative;z-index:100;overflow-y:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;height:52px;font-size:1.3rem;}</style><nav class="css-tetqay"><style data-emotion="css 14y32a">.css-14y32a{overflow:auto hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:10px;font-weight:500;text-transform:uppercase;letter-spacing:0.2px;white-space:nowrap;-webkit-overflow-scrolling:touch;-ms-overflow-scrolling:touch;}@media (max-width: 700px){.css-14y32a{margin-right:0;}}</style><div class="site-nav-left css-14y32a esgr0m44"><style data-emotion="css yn94hc">.css-yn94hc{position:relative;z-index:100;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:32px;padding:12px 0;font-size:1.7rem;font-weight:700;line-height:1.8rem;color:#fff;text-transform:none;letter-spacing:-0.5px;}.css-yn94hc:hover{-webkit-text-decoration:none;text-decoration:none;}.css-yn94hc img{display:block;width:auto;height:21px;}@media (max-width: 700px){.css-yn94hc{margin-right:18px;}}</style><a class="site-nav-logo css-yn94hc" href="/"><img src="/static/a62d45ddbe29cf42da820a576d9375e1/aef42/alien.png" alt="Pozafly&#x27;s Blog" width="21" height="21"/></a><style data-emotion="css 1xdepn">.css-1xdepn{position:relative;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}</style><div class="css-1xdepn esgr0m43"><style data-emotion="css f30i1v">.css-f30i1v{position:absolute;z-index:1000;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0 0 0 -12px;padding:0;list-style:none;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-f30i1v li{display:block;margin:0;padding:0;}.css-f30i1v li a{position:relative;display:block;padding:10px 12px;font-size:1.2rem;color:var(--main-color);opacity:0.7;-webkit-transition:opacity 0.2s ease-in-out;transition:opacity 0.2s ease-in-out;}@media (max-width: 700px){.css-f30i1v li a{padding:10px 8px;}}.css-f30i1v li a:hover{-webkit-text-decoration:none;text-decoration:none;opacity:1;}.css-f30i1v .nav-current{opacity:1;}</style><ul role="menu" class="css-f30i1v"><li role="menuitem"><a href="/">Home</a></li><li role="menuitem"><a href="/about/">About</a></li><li role="menuitem"><a href="/tags/">Tags</a></li><li role="menuitem"><a href="/tags/diary/">Diary</a></li></ul><style data-emotion="css qrnywa">.css-qrnywa{position:absolute;top:9px;-webkit-transform:translateY(175%);-moz-transform:translateY(175%);-ms-transform:translateY(175%);transform:translateY(175%);font-size:1.7rem;font-weight:400;color:var(--main-color);text-transform:none;visibility:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-qrnywa .dash{left:-25px;}.css-qrnywa .dash:before{content:'- ';opacity:0.5;}@media (max-width: 700px){.css-qrnywa{overflow:hidden;max-width:calc(100vw - 126px);text-overflow:ellipsis;white-space:nowrap;}}</style><span class="nav-post-title css-qrnywa esgr0m40">Next.js의 API Routes 코드 모듈화에 대해서</span></div></div><style data-emotion="css 1wxq7hc">.css-1wxq7hc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:0 1 auto;-ms-flex:0 1 auto;flex:0 1 auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}</style><div class="css-1wxq7hc esgr0m42"><style data-emotion="css 150gfpr">.css-150gfpr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (max-width: 700px){.css-150gfpr .not-mobile{display:none;}}</style><div class="css-150gfpr esgr0m41"><style data-emotion="css u4kwjs">.css-u4kwjs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;margin:0;padding:10px;opacity:0.8;-webkit-transition:opacity 0.35s ease;transition:opacity 0.35s ease;}.css-u4kwjs:hover{opacity:1;}.css-u4kwjs svg{height:1.8rem;fill:var(--main-color);-webkit-transition:fill 0.45s ease;transition:fill 0.45s ease;}.css-u4kwjs.is-white svg{fill:#fff;}</style><a class="not-mobile css-u4kwjs" href="https://github.com/pozafly" title="Github" target="_blank" rel="noopener noreferrer"><svg width="21px" height="21px" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"></path></svg></a><style data-emotion="css-global 8o55qm">body .theme-toggler{overflow:hidden;margin:6px;padding:2px;background:transparent;border-radius:50%;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;}body .theme-toggler #switch{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;width:21px;height:21px;padding:0;background:transparent;border:0;}body .theme-toggler .mode{position:relative;width:18px;height:18px;opacity:0.8;background:#000;-webkit-clip-path:path(
          'M17.5306 13.5882C16.6384 13.8558 15.689 14 14.7044 14C9.5004 14 5.28174 9.97061 5.28174 5.00005C5.28174 3.32422 5.76127 1.75538 6.59643 0.411865C2.77326 1.55853 0 4.96994 0 9.00001C0 13.9706 4.21866 18 9.42265 18C12.8721 18 15.8887 16.2296 17.5306 13.5882Z'
        );clip-path:path(
          'M17.5306 13.5882C16.6384 13.8558 15.689 14 14.7044 14C9.5004 14 5.28174 9.97061 5.28174 5.00005C5.28174 3.32422 5.76127 1.75538 6.59643 0.411865C2.77326 1.55853 0 4.96994 0 9.00001C0 13.9706 4.21866 18 9.42265 18C12.8721 18 15.8887 16.2296 17.5306 13.5882Z'
        );border-radius:50%;-webkit-transition:all 0.45s ease;transition:all 0.45s ease;}body .theme-toggler .mode:before{content:'';position:absolute;z-index:-1;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-moz-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:5px;height:5px;opacity:0;background:inherit;border-radius:50%;-webkit-transition:box-shadow 0.4s 0s ease;transition:box-shadow 0.4s 0s ease;}body .theme-toggler .mode:after{content:'';position:absolute;top:-20%;left:30%;width:90%;height:90%;background:rgb(255 255 255 / 1);border-radius:50%;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;}body .theme-toggler .mode:hover{opacity:1;}body .theme-toggler:hover{background:rgb(215 215 215 / 0.9);}body .theme-toggler.is-white .mode{background:#fff;}body .theme-toggler.is-white:hover{background:rgb(215 215 215 / 0.2);}body.dark .theme-toggler{background:transparent;}body.dark .theme-toggler:hover{background:rgb(255 255 255 / 0.1);}body.dark .theme-toggler .mode{-webkit-transform:scale(0.5);-moz-transform:scale(0.5);-ms-transform:scale(0.5);transform:scale(0.5);overflow:initial;opacity:0.8;background:white;-webkit-clip-path:none;clip-path:none;}body.dark .theme-toggler .mode:before{opacity:1;box-shadow:0 -16px 0 0 white,0 16px 0 0 white,-16px 0 0 0 white,16px 0 0 0 white,12px 12px 0 0 white,12px -12px 0 0 white,-12px 12px 0 0 white,-12px -12px 0 0 white;}body.dark .theme-toggler .mode:after{-webkit-transform:translateX(50%) translateY(-50%);-moz-transform:translateX(50%) translateY(-50%);-ms-transform:translateX(50%) translateY(-50%);transform:translateX(50%) translateY(-50%);opacity:0;-webkit-transition:background 0.45s ease;transition:background 0.45s ease;}body.dark .theme-toggler.is-white .mode:before{box-shadow:0 -16px 0 0 white,0 16px 0 0 white,-16px 0 0 0 white,16px 0 0 0 white,12px 12px 0 0 white,12px -12px 0 0 white,-12px 12px 0 0 white,-12px -12px 0 0 white;}</style><button class="theme-toggler " aria-label="theme toggle button" type="button"><div id="switch"><div class="mode"></div></div></button></div></div></nav></div></div></header><style data-emotion="css 1h9yqcb">.css-1h9yqcb{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;position:relative;padding:0 5vw;}</style><main id="site-main" class="site-main css-1h9yqcb"><div class="css-8aaawc"><style data-emotion="css 150a24d">.css-150a24d{position:relative;}</style><article class="css-150a24d"><style data-emotion="css 7tju5o">.css-7tju5o{position:relative;margin:0 auto;padding:70px 100px 50px;border-top-left-radius:3px;border-top-right-radius:3px;}@media (max-width: 1170px){.css-7tju5o{padding:60px 11vw 50px;}}@media (max-width: 800px){.css-7tju5o{padding-right:5vw;padding-left:5vw;}}@media (max-width: 500px){.css-7tju5o{padding:20px 0 35px;}}</style><header class="post-full-header css-7tju5o exbbyko6"><style data-emotion="css ueomv1">.css-ueomv1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;font-size:1.2rem;font-weight:600;line-height:1.4em;color:#738a94;}.css-ueomv1 a{font-size:1.2rem;}</style><section class="post-full-tags css-ueomv1 exbbyko5"><a href="/tags/next-js/">Next.js</a></section><style data-emotion="css yk3ogg">.css-yk3ogg{margin:0 0 0.2em;color:var(--post-full-title);}@media (max-width: 500px){.css-yk3ogg{margin-top:0.2em;font-size:3.3rem;}}</style><h1 class="post-full-title css-yk3ogg exbbyko1">Next.js의 API Routes 코드 모듈화에 대해서</h1><style data-emotion="css 1gjy1ma">.css-1gjy1ma{margin:20px 0 0;font-size:2rem;font-weight:360;line-height:1.4em;color:var(--post-card-description);}@media (max-width: 500px){.css-1gjy1ma{font-size:1.9rem;line-height:1.5em;}}</style><p class="post-full-custom-excerpt css-1gjy1ma exbbyko3">API Routes를 사용하  면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적.</p><style data-emotion="css r2irbu">.css-r2irbu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:35px 0 0;padding-top:15px;border-top:1px solid var(--post-full-border);}.css-r2irbu .post-full-byline-content{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}.css-r2irbu .post-full-byline-content .author-list{-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;padding:0 12px 0 0;}.css-r2irbu .post-full-byline-meta{margin:2px 0 0;font-size:1.4rem;line-height:1.2em;color:#768086;letter-spacing:0.2px;}.css-r2irbu .post-full-byline-meta .author-name{margin:0 0 3px;font-size:1.4rem;font-weight:500;line-height:1.3em;}.css-r2irbu .post-full-byline-meta .author-name a{font-size:13px;color:var(--post-full-meta-link);}.css-r2irbu .post-full-byline-meta .author-name a:hover{color:var(--post-full-meta-link-hover);}.css-r2irbu .post-full-byline-meta .byline-reading-time,.css-r2irbu .post-full-byline-meta .byline-meta-date{font-size:13px;}.css-r2irbu .post-full-byline-meta .bull{display:inline-block;margin:0 4px;opacity:0.6;}</style><div class="post-full-byline css-r2irbu exbbyko2"><section class="post-full-byline-content"><style data-emotion="css 12fmpzj">.css-12fmpzj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 0 0 4px;padding:0;list-style:none;}</style><ul class="author-list css-12fmpzj exbbyko4"><style data-emotion="css 4q5div">.css-4q5div{position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin:0;padding:0;}.css-4q5div:hover .author-name-tooltip{-webkit-transform:translate(-10px, -2px);-moz-transform:translate(-10px, -2px);-ms-transform:translate(-10px, -2px);transform:translate(-10px, -2px);opacity:1;}</style><li class="author-list-item css-4q5div e13xkhp00"><style data-emotion="css aezf96">.css-aezf96{overflow:hidden;display:block;width:40px;height:40px;margin:0 -4px;border:2px solid var(--author-border);border-radius:100%;}@media (max-width: 500px){.css-aezf96{width:36px;height:36px;}}</style><a class="author-avatar css-aezf96" href="/about/"><style data-emotion="css 1ip6e3z">.css-1ip6e3z{display:block;width:100%;height:100%;object-fit:cover;background:var(--background-color);border-radius:100%;}.css-1ip6e3z img{border-radius:100%;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper author-profile-image css-1ip6e3z"><div aria-hidden="true" style="padding-top:100%"></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#6808f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/e73fe/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/61ca6/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/507b0/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/2f28c/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/499f6/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg 120w" alt="Pozafly"/></picture><noscript><picture><source type="image/webp" srcSet="/static/8c061761f263c344f2c0416607c8adf1/e73fe/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/61ca6/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/507b0/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg" srcSet="/static/8c061761f263c344f2c0416607c8adf1/2f28c/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/499f6/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg 120w" alt="Pozafly"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a></li></ul><section class="post-full-byline-meta"><div class="author-name"><a href="/about/">Pozafly</a></div><div class="byline-meta-content"><time class="byline-meta-date" dateTime="2023-07-26">2023-07-26</time><span class="byline-reading-time"><span class="bull">•</span>11 min read</span></div></section></section></div></header><style data-emotion="css 1ymj7z2">.css-1ymj7z2{width:80%;max-height:800px;margin:25px auto 50px;-webkit-background-size:cover;background-size:cover;border:1px solid var(--image-border-color);border-radius:8px;}.css-1ymj7z2 img{border-radius:8px;}@media (max-width: 1170px){.css-1ymj7z2 img{max-width:1170px;}}@media (max-width: 800px){.css-1ymj7z2{width:100%;}}@media (max-width: 500px){.css-1ymj7z2{margin-bottom:4vw;}}</style><figure class="css-1ymj7z2 exbbyko0"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:52.34375%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/webp;base64,UklGRlABAABXRUJQVlA4IEQBAAAQBgCdASoUAAoAAAAAJQBOmUI4G2AKEr3kT9TfSAd8bMV4y7BHP9V/MDjAP1APvhp9S1P4WAaWWwAA/v//FO+/uU2wVgdvo3t7+/esHdVnt/ADvJNu//kKsryq7K4/kH6dQSpGZH/Wmy5Hn/aiP/iWMNYE/L04/fxOh6w6LNfMVCO2e4bk1w+gWtpgjXx8dPwxbP/af/3X+0eo//xh3vW8bP8x/59L+P+uAb/nTz0WLfd1P3vPtBSZEyy/3T0wbRrtQDgzQWJR+Ionuv+3z/+oMGf/VUBr79zfpXfp+qM/6uI1nkf8xYssVf+Jam3g3/89o/+0Ec/+2AL9tBfn9QixAvY/zPVrT+ICoP+ly+1C7/DtZUF9PQRI4d13mrIY7dR2bGTX2cQVs9OgNCzOMwQy1nvlPj56aTR9Kl6iaLrR7askCAA=" alt=""/><picture><source type="image/avif" data-srcset="/static/6763177ee50addd67c4dc57952797f69/7f171/main.avif 750w,/static/6763177ee50addd67c4dc57952797f69/4f36a/main.avif 1080w,/static/6763177ee50addd67c4dc57952797f69/dac68/main.avif 1366w,/static/6763177ee50addd67c4dc57952797f69/f7ebe/main.avif 1920w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/6763177ee50addd67c4dc57952797f69/231da/main.webp" data-srcset="/static/6763177ee50addd67c4dc57952797f69/7513b/main.webp 750w,/static/6763177ee50addd67c4dc57952797f69/317ed/main.webp 1080w,/static/6763177ee50addd67c4dc57952797f69/b5c49/main.webp 1366w,/static/6763177ee50addd67c4dc57952797f69/231da/main.webp 1920w" alt="Next.js의 API Routes 코드 모듈화에 대해서"/></picture><noscript><picture><source type="image/avif" srcSet="/static/6763177ee50addd67c4dc57952797f69/7f171/main.avif 750w,/static/6763177ee50addd67c4dc57952797f69/4f36a/main.avif 1080w,/static/6763177ee50addd67c4dc57952797f69/dac68/main.avif 1366w,/static/6763177ee50addd67c4dc57952797f69/f7ebe/main.avif 1920w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/6763177ee50addd67c4dc57952797f69/231da/main.webp" srcSet="/static/6763177ee50addd67c4dc57952797f69/7513b/main.webp 750w,/static/6763177ee50addd67c4dc57952797f69/317ed/main.webp 1080w,/static/6763177ee50addd67c4dc57952797f69/b5c49/main.webp 1366w,/static/6763177ee50addd67c4dc57952797f69/231da/main.webp 1920w" alt="Next.js의 API Routes 코드 모듈화에 대해서"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></figure><style data-emotion="css 1gxhmkz">.css-1gxhmkz *:not(pre)>code[class*='language-']{border-radius:0.3em;background:var(--little-code-background);border:1px solid var(--little-code-border);color:var(--main-color);padding:0.15em 0.5em;white-space:normal;font-size:13px;}@media (max-width: 800px){.css-1gxhmkz *:not(pre)>code[class*='language-']{display:inline;}}.css-1gxhmkz .gatsby-highlight-code-line{display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;background-color:var(--prism-background);border-left:0.25em solid var(--prism-border-left);font-size:1.4rem;}.css-1gxhmkz .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:var(--highlight-background);box-shadow:inset 0 0 0 1px var(--highlight-border);-webkit-overflow-scrolling:touch;overflow:auto;}.css-1gxhmkz .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.4rem;line-height:24px;}.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{color:var(--pre-code-color);text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1gxhmkz pre[class*='language-']::-webkit-scrollbar,.css-1gxhmkz code[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-1gxhmkz pre[class*='language-']::-webkit-scrollbar-thumb,.css-1gxhmkz code[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{display:inline-block;}}.css-1gxhmkz pre[class*='language-']{overflow:auto;}.css-1gxhmkz .token{font-size:1.4rem;}.css-1gxhmkz pre[data-line]{padding:1em 0 1em 3em;position:relative;}@media print{.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{text-shadow:none;}}.css-1gxhmkz pre[class*='language-']{padding:1em;overflow:auto;margin:0;}.css-1gxhmkz:not(pre)>code[class*='language-']{padding:0.1em 0.3em;border-radius:0.3em;color:#c9d1d9;background:#343942;}.css-1gxhmkz pre[data-line]{position:relative;}.css-1gxhmkz pre[class*='language-']>code[class*='language-']{position:relative;z-index:1;}.css-1gxhmkz .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#2f2a1e;box-shadow:inset 5px 0 0 #674c16;z-index:0;pointer-events:none;line-height:inherit;white-space:pre;}.css-1gxhmkz .namespace{opacity:0.7;}.css-1gxhmkz .token.comment,.css-1gxhmkz .token.prolog,.css-1gxhmkz .token.doctype,.css-1gxhmkz .token.cdata{color:#8b949e;}.css-1gxhmkz .token.punctuation{color:#c9d1d9;}.css-1gxhmkz .token.property,.css-1gxhmkz .token.tag,.css-1gxhmkz .token.boolean,.css-1gxhmkz .token.number,.css-1gxhmkz .token.constant,.css-1gxhmkz .token.symbol,.css-1gxhmkz .token.deleted{color:#79c0ff;}.css-1gxhmkz .token.selector,.css-1gxhmkz .token.attr-name,.css-1gxhmkz .token.string,.css-1gxhmkz .token.char,.css-1gxhmkz .token.builtin,.css-1gxhmkz .token.inserted{color:#a5d6ff;}.css-1gxhmkz .token.operator,.css-1gxhmkz .token.entity,.css-1gxhmkz .token.url,.css-1gxhmkz .language-css .token.string,.css-1gxhmkz .style .token.string{color:#a5d6ff;}.css-1gxhmkz .token.atrule,.css-1gxhmkz .token.attr-value,.css-1gxhmkz .token.keyword{color:#a5d6ff;}.css-1gxhmkz .token.function{color:#d2a8ff;}.css-1gxhmkz .token.regex,.css-1gxhmkz .token.important,.css-1gxhmkz .token.variable{color:#a8daff;}.css-1gxhmkz .token.important,.css-1gxhmkz .token.bold{font-weight:bold;}.css-1gxhmkz .token.italic{font-style:italic;}.css-1gxhmkz .token.entity{cursor:help;}</style><style data-emotion="css 9yupkg">.css-9yupkg{position:relative;min-height:230px;margin:0 auto;padding:0 100px 6vw;font-size:2rem;line-height:1.6em;background:var(--background-color);border-radius:6px;}.css-9yupkg .no-image{padding-top:0;}.css-9yupkg h1,.css-9yupkg h2,.css-9yupkg h3,.css-9yupkg h4,.css-9yupkg h5,.css-9yupkg h6,.css-9yupkg p,.css-9yupkg ul,.css-9yupkg ol,.css-9yupkg dl,.css-9yupkg pre,.css-9yupkg blockquote,.css-9yupkg .post-full-comments,.css-9yupkg .footnotes{min-width:100%;margin:0 0 1.5em;}.css-9yupkg li>ul,.css-9yupkg li>ol{margin:0;}.css-9yupkg li{word-break:break-word;}.css-9yupkg li p{margin:0;}.css-9yupkg a{color:#0a84ff;}.css-9yupkg a[class*='image'],.css-9yupkg a[class*='image']:hover{box-shadow:none;}.css-9yupkg a[class*='image'] span[class*='image'],.css-9yupkg a[class*='image']:hover span[class*='image']{border-radius:6px;}.css-9yupkg strong,.css-9yupkg em{color:var(--strong-color);}.css-9yupkg small{display:inline-block;line-height:1.6em;}.css-9yupkg img,.css-9yupkg video{display:block;max-width:840px;height:auto;margin:2em auto;border:1px solid var(--image-border-color);border-radius:8px;}.css-9yupkg hr+p{margin-top:1.2em;}.css-9yupkg img[src$='#full']{width:100vw;max-width:none;}.css-9yupkg img+br+small{display:block;margin-top:-3em;margin-bottom:1.5em;text-align:center;}.css-9yupkg iframe{margin:10px auto 20px;}.css-9yupkg blockquote{margin:0 0 1.5em;padding:0 1.5em;border-left:3px solid var(--image-border-color);}.css-9yupkg blockquote p{margin:0 0 1em;font-size:inherit;font-style:italic;line-height:inherit;color:inherit;}.css-9yupkg blockquote p:last-child{margin-bottom:0;}.css-9yupkg code{padding:0 5px 2px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:0.8em;font-weight:400!important;line-height:1em;border-radius:3px;}.css-9yupkg p code{word-break:keep-all;}.css-9yupkg pre{overflow-x:auto;max-width:100%;padding:20px;font-size:1.4rem;line-height:1.5em;color:#e5eff5;border-radius:5px;}.css-9yupkg pre code{padding:0;font-size:inherit;line-height:inherit;background:transparent;}.css-9yupkg pre code :not(span){color:inherit;}.css-9yupkg .fluid-width-video-wrapper{margin:1.5em 0 3em;}.css-9yupkg hr{margin:2em 0;}.css-9yupkg h1,.css-9yupkg h2,.css-9yupkg h3,.css-9yupkg h4,.css-9yupkg h5,.css-9yupkg h6{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;color:var(--home-header-color);}.css-9yupkg h1{margin:0.5em 0 0.4em;font-size:4.2rem;font-weight:600;line-height:1.25em;}.css-9yupkg p+h1{margin-top:0.8em;}.css-9yupkg h2{margin:1.2em 0 0.6em;font-size:3.4rem;font-weight:600;line-height:1.25em;}.css-9yupkg p+h2{margin-top:0.8em;}.css-9yupkg h3{margin:1rem 0 0.2em;padding-top:1.8rem;font-size:2.6rem;font-weight:600;line-height:1.3em;}.css-9yupkg h2+h3{margin-top:0.7em;}.css-9yupkg h4{margin:1em 0 0.2em;font-size:2rem;font-weight:800;}.css-9yupkg h2+h4{margin-top:0.7em;}.css-9yupkg h3+h4{margin-top:0;}.css-9yupkg h5{display:block;margin:0.5em 0;font-size:1.8rem;font-weight:600;line-height:1.35em;border:0;}.css-9yupkg h6{margin:0.5em 0 0.2em;font-size:2rem;font-weight:700;}.css-9yupkg table{overflow-x:auto;display:inline-block;border-spacing:0;border-collapse:collapse;width:auto;max-width:100%;margin:0.5em 0 2.5em;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:1.6rem;white-space:nowrap;vertical-align:top;background:radial-gradient(ellipse at left, rgb(0 0 0 / 0.2) 0%, rgb(0 0 0 / 0) 75%) 0 center,radial-gradient(ellipse at right, rgb(0 0 0 / 0.2) 0%, rgb(0 0 0 / 0) 75%) 100% center;background-repeat:no-repeat;background-attachment:scroll,scroll;-webkit-background-size:10px 100%,10px 100%;background-size:10px 100%,10px 100%;-webkit-overflow-scrolling:touch;}.css-9yupkg table th{font-size:1.2rem;font-weight:700;color:var(--home-header-color);text-align:left;text-transform:uppercase;letter-spacing:0.2px;background-color:var(--table-th-background);}.css-9yupkg table th,.css-9yupkg table td{padding:6px 12px;border:var(--table-th-border) 1px solid;}.css-9yupkg table td:first-of-type{background-image:var(--table-first-of-type);background-repeat:no-repeat;-webkit-background-size:20px 100%;background-size:20px 100%;}.css-9yupkg table td:last-child{background-image:var(--table-last-of-type);background-repeat:no-repeat;-webkit-background-position:100% 0;background-position:100% 0;-webkit-background-size:20px 100%;background-size:20px 100%;}.css-9yupkg figcaption{color:var(--figcaption-color);}@media (max-width: 1170px){.css-9yupkg{padding:0 11vw;}}@media (max-width: 800px){.css-9yupkg{padding:0 5vw;font-size:1.8rem;}}@media (max-width: 500px){.css-9yupkg{padding:0;}}@media (max-width: 500px){.css-9yupkg .post-full-custom-excerpt{font-size:1.9rem;line-height:1.5em;}}@media (max-width: 500px){.css-9yupkg p,.css-9yupkg ul,.css-9yupkg ol,.css-9yupkg dl,.css-9yupkg pre,.css-9yupkg .post-full-comments,.css-9yupkg .footnotes{margin-bottom:1.28em;}}@media (max-width: 1040px){.css-9yupkg img,.css-9yupkg video{width:100%;}}@media (max-width: 500px){.css-9yupkg blockquote{padding:0 1.3em;}}@media (max-width: 800px){.css-9yupkg h1{font-size:3.2rem;line-height:1.25em;}.css-9yupkg h2{margin:0.5rem 0 0.3em;font-size:2.8rem;line-height:1.25em;}.css-9yupkg h3{margin:0.5rem 0 0.3em;font-size:2.4rem;line-height:1.3em;}.css-9yupkg h4{margin-bottom:0.3em;font-size:1.8rem;line-height:1.3em;}.css-9yupkg h5{max-width:1060px;padding:0 0 0.5em;font-size:2.4rem;text-align:initial;}.css-9yupkg h6{font-size:1.8rem;line-height:1.4em;}}.css-9yupkg *:not(pre)>code[class*='language-']{border-radius:0.3em;background:var(--little-code-background);border:1px solid var(--little-code-border);color:var(--main-color);padding:0.15em 0.5em;white-space:normal;font-size:13px;}@media (max-width: 800px){.css-9yupkg *:not(pre)>code[class*='language-']{display:inline;}}.css-9yupkg .gatsby-highlight-code-line{display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;background-color:var(--prism-background);border-left:0.25em solid var(--prism-border-left);font-size:1.4rem;}.css-9yupkg .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:var(--highlight-background);box-shadow:inset 0 0 0 1px var(--highlight-border);-webkit-overflow-scrolling:touch;overflow:auto;}.css-9yupkg .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.4rem;line-height:24px;}.css-9yupkg pre[class*='language-'],.css-9yupkg code[class*='language-']{color:var(--pre-code-color);text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-9yupkg pre[class*='language-']::-webkit-scrollbar,.css-9yupkg code[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-9yupkg pre[class*='language-']::-webkit-scrollbar-thumb,.css-9yupkg code[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-9yupkg pre[class*='language-'],.css-9yupkg code[class*='language-']{display:inline-block;}}.css-9yupkg pre[class*='language-']{overflow:auto;}.css-9yupkg .token{font-size:1.4rem;}.css-9yupkg pre[data-line]{padding:1em 0 1em 3em;position:relative;}@media print{.css-9yupkg pre[class*='language-'],.css-9yupkg code[class*='language-']{text-shadow:none;}}.css-9yupkg pre[class*='language-']{padding:1em;overflow:auto;margin:0;}.css-9yupkg:not(pre)>code[class*='language-']{padding:0.1em 0.3em;border-radius:0.3em;color:#c9d1d9;background:#343942;}.css-9yupkg pre[data-line]{position:relative;}.css-9yupkg pre[class*='language-']>code[class*='language-']{position:relative;z-index:1;}.css-9yupkg .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#2f2a1e;box-shadow:inset 5px 0 0 #674c16;z-index:0;pointer-events:none;line-height:inherit;white-space:pre;}.css-9yupkg .namespace{opacity:0.7;}.css-9yupkg .token.comment,.css-9yupkg .token.prolog,.css-9yupkg .token.doctype,.css-9yupkg .token.cdata{color:#8b949e;}.css-9yupkg .token.punctuation{color:#c9d1d9;}.css-9yupkg .token.property,.css-9yupkg .token.tag,.css-9yupkg .token.boolean,.css-9yupkg .token.number,.css-9yupkg .token.constant,.css-9yupkg .token.symbol,.css-9yupkg .token.deleted{color:#79c0ff;}.css-9yupkg .token.selector,.css-9yupkg .token.attr-name,.css-9yupkg .token.string,.css-9yupkg .token.char,.css-9yupkg .token.builtin,.css-9yupkg .token.inserted{color:#a5d6ff;}.css-9yupkg .token.operator,.css-9yupkg .token.entity,.css-9yupkg .token.url,.css-9yupkg .language-css .token.string,.css-9yupkg .style .token.string{color:#a5d6ff;}.css-9yupkg .token.atrule,.css-9yupkg .token.attr-value,.css-9yupkg .token.keyword{color:#a5d6ff;}.css-9yupkg .token.function{color:#d2a8ff;}.css-9yupkg .token.regex,.css-9yupkg .token.important,.css-9yupkg .token.variable{color:#a8daff;}.css-9yupkg .token.important,.css-9yupkg .token.bold{font-weight:bold;}.css-9yupkg .token.italic{font-style:italic;}.css-9yupkg .token.entity{cursor:help;}</style><section class="post-full-content css-9yupkg e2avtx60"><div class="post-content"><h2 id="메타-프레임워크" style="position:relative;">메타 프레임워크<a href="#%EB%A9%94%ED%83%80-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC" aria-label="메타 프레임워크 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>Next.js는 react의 메타 프레임워크다. 메타 프레임워크는 프레임워크의 프레임워크라고도 말할 수 있는데, 프레임워크를 사용하기 위해 기본적으로 세팅해야 하는 환경이나, 필요한 기능을 추상화 한 코드 모듈을 제공해줘서 프레임워크를 더 쉽게 사용할 수 있도록 도와준다.</p>
<p>특히 react의 경우, <a href="https://pozafly.github.io/react/declarative-meaning-of-react-rendering-process/" target="_blank" rel="nofollow">라이브러리의 정체성</a>을 어느정도 가지고 있기 때문에, 사용자에 따라 코드 스타일이나 환경 등이 제각각인 경우가 많았다. 메타 프레임워크는 Best Practice를 모아두어, 개발자가 시행착오를 거치지 않고 여러 통합 환경 및 기능을 사용할 수 있도록 한다. react의 메타 프레임워크로 <strong>Next.js</strong>, <strong>Remix</strong>, <strong>Gatsby</strong> 등의 프레임워크가 존재하며, Vue.js 같은 경우는 <strong>Nuxt.js</strong>라는 메타 프레임워크가 있다.</p>
<p>Next.js는 SSR 뿐 아니라 다양한 기능을 제공하고 있다. 번들링과 컴파일 같은 도구를 기본으로 제공한다. 또한, 리소스를 최적화 기능, 파일 시스템 기반 라우팅, 레이아웃, 배포 등 기능을 내장하고 있다.</p>
<p>아래는 Next.js 공식 홈페이지에서 자신을 설명하고 있는 문장이다.</p>
<blockquote>
<p>Used by some of the world’s largest companies, Next.js enables you to create full-stack Web applications by extending the latest React features, and integrating powerful Rust-based JavaScript tooling for the fastest builds.</p>
</blockquote>
<p>위 문장 중 <strong>full-stack Web application</strong>이라는 문구를 사용했다. full-stack은, 프론트엔드 뿐 아니라 백엔드 코드도 작성할 수 있다는 의미이다. 수 많은 웹 어플리케이션이 Node.js 환경에서 빌드되어 브라우저로 서빙되고 있다. Next.js는 Node.js로 react 기반 프론트엔드 코드를 번들링과 컴파일을 해주고 있으며, 또한 Node.js 런타임 환경에서 백엔드 코드를 실행시킬 수 있다. (조금 더 엄밀하게 말하면 백엔드를 실행시킨다기 보다는 Node.js 런타임 환경에서 API response를 내려주는 함수를 실행시킬 수 있다. 이는 Next.js의 API Routes로 쉽게 구현이 가능하다. 따라서 Next.js는 API Routes 기능과, SSR 기능을 사용할 수 있기 때문에 full-stack Web application이라는 네이밍이 붙었다고 예상할 수 있다.)</p>
<p>이번에 Next.js로 프로젝트를 진행하면서 백엔드 코드를 작성할 일이 생겼다. Google OAuth를 통해 사용자 인증을 하고 싶었다. Google OAuth를 통해 인증을 하려면 2가지 방법이 있는데 첫 번째는 <strong>프론트엔드 단에서 연결</strong>하는 방법과, <strong>프론트엔드에서 백엔드 단을 통해 OAuth를 연결</strong>하는 방법이다. 프론트엔드 단에서만 인증을 요청하면 Google 인증 서버에서 Refresh Token을 넘겨주지 않았다. 하지만, 검증된 백엔드를 통해 Google 인증 서버에 인증을 요청하게 되면 Refresh Token도 함께 받을 수 있다. Refresh Token을 받지 못한다면 Google의 인가된 서비스를 사용하기 위해, 사용자가 1시간에 한 번씩 로그인을 해주어야 하기 때문에 Next.js의 API Routes를 통해 인증을 받기로 했다.</p>
<p>하지만, API Routes를 사용하면 코드가 매우 지저분해진다. 그 이유는 아래의 API Routes에서 조금 더 알아볼 것이다. 아래 글은, API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적이 되겠다.</p>
<p>📌 <em>Next.js가 13 버전으로 올라가면서 서버 컴포넌트를 사용하기 위해 App Router가 도입 되었다. App Router가 도입 되면서 서버 코드를 작성할 수 있는 <code class="language-text">API Routes</code>는 <code class="language-text">Route Handlers</code> 라는 이름으로 변경 되었으며, 아래의 내용 없이도 도메인 별로 서버 코드를 쉽게 작성할 수 있도록 변경되었다. 따라서 아래의 코드는 Next.js 12 버전 이하 또는 Page Route를 사용하는 Next.js 서버 코드라고 보면 된다.</em></p>
<br/>
<h2 id="API-Routes" style="position:relative;">API Routes<a href="#API-Routes" aria-label="API Routes permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>API Routes는 API를 호출할 수 있는 Endpoint를 생성해준다. Next.js의 파일 기반 routing과 마찬가지로 파일 기반으로 API Endpoint가 생성된다. <code class="language-text">pages/api</code> 폴더 내부에 파일을 생성하고, 함수를 작성하면 함수를 기반으로 API를 내려줄 수 있다.</p>
<p>API Routes의 <strong>포지션</strong>에 대해 생각해보자. Node.js로 백엔드를 구성한다면 Express를 사용할 수도 있고, NestJS도 사용할 수 있다. 반드시 서버 프레임워크 구성 환경이 Node.js가 아니라면 Spring과 같은 엔터프라이즈 급 프레임워크로 서버를 구성할 수도 있다. 하지만, API Routes는 서버 프레임워크로 구성 된 서버 코드보다 훨씬 가벼운 개념으로 탄생했다.</p>
<h3 id="Serverless-Function" style="position:relative;">Serverless Function<a href="#Serverless-Function" aria-label="Serverless Function permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>API Routes는 <strong>Serverless Function</strong>으로 구성되어 있다. Serverless Function의 컨셉은 요청(이벤트)이 들어올 때마다 지정된 함수를 실행시켜 원하는 API를 클라이언트에게 전달하는 것이다. 그렇기 때문에 web socket과 같은 연결은 가질 수 없다. 애초에 지속적인 커넥션을 잡고 있을 수 없도록 설계된 모델이기 때문이다.</p>
<p>Serverless Function은 인프라를 관리하지 않아도 되며, 요청이 들어올 때마다 함수를 실행시키기 때문에 적은 비용으로 운영할 수 있고, 동일한 값을 반환한다면 캐싱에도 유용하다. 여전히 물리적인 서버로 운영되고 있지만, 직접 서버의 인프라를 운영하지 않아도 되는 컨셉과 동시에, 함수 하나만 실행하기 때문에 Serverless Function이라는 이름이 붙었다. 이벤트 기반이기 때문에 Serverless에서 동작하는 코드는 상태를 가지고 있지 않다. 즉, 데이터를 유지하지 않는다. 이를 FaaS 라고도 한다.</p>
<p><a href="https://github.com/vercel/next.js/discussions/17679" target="_blank" rel="nofollow">링크</a>를 살펴보면, Next.js의 메인테이너가 API Routes에 대해 설명하고 있는데, API Routes는 Serverless Function 컨셉을 가지고 있지만 아주 큰 커넥션을 가지지 않는다면 DB 와의 통신은 가능하다. 왜냐하면 web socket과 같은 지속적인 커넥션을 맺는 것이 아니라, DB 인스턴스와 단기적인 통신을 통해 데이터를 저장하거나 가공하기 때문이다. 이는 vercel의 공식문서에서 배포된 Serverless Function의 제약조건으로 커넥션 타임이 지정되어 있는 이유이기도 하다.</p>
<p>또한, SSR을 위해 사용하는 <code class="language-text">getStaticProps</code>, <code class="language-text">getServerSideProps</code> 등의 함수 코드도 Serverless Function 형태로 배포된다. 당연히 client-side 번들에는 추가되지 않는다.</p>
<p><em>📌 참고로 Edge API Routes와 API Routes는 다르다. Edge API Routes는 Edge Runtime을 사용하고, API Routes는 Node.js Runtime을 사용한다. 따라서, Edge Runtime에는 Node.js의 <code class="language-text">fs</code>와 같은 Node API 사용이 불가능하다. Edge API Routes는 AWS 람다와 비슷한 환경이다. 또한, Serverless Function으로 사용하고 싶지 않다면 <a href="https://nextjs.org/docs/pages/building-your-application/configuring/custom-server" target="_blank" rel="nofollow">custom server</a>로 변경해 사용할 수 있다.</em></p>
<h3 id="API-Routes-코드-예시" style="position:relative;">API Routes 코드 예시<a href="#API-Routes-%EC%BD%94%EB%93%9C-%EC%98%88%EC%8B%9C" aria-label="API Routes 코드 예시 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>따라서, Serverless Function은, 이벤트가 일어나면 함수 하나를 호출해주는 역할이다. 이런 컨셉에 맞게 API Routes도 마찬가지로 Endpoint당 함수 하나만 사용할 수 있도록 만들어졌다. <a href="https://nextjs.org/docs/pages/building-your-application/routing/api-routes" target="_blank" rel="nofollow">공식문서 api-routes</a>의 예제를 보면, 아래 코드와 같이 <code class="language-text">handler</code> 함수 하나만 달랑 존재한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>이렇게 함수가 하나만 존재할 경우 하나의 Endpoint에 <strong>http method</strong>들을 <code class="language-text">if</code>문 혹은 <code class="language-text">switch</code>문으로 분기를 태울 수 밖에 없는 상황이 발생한다. 위에서 말했듯, API Routes는 Serverless Function 컨셉에 맞게 handler 함수 하나만 작성하는 컨셉으로 만들어졌기 때문이다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Process a POST request</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Handle any other HTTP method</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>위와 같은 상황에서 로직이 길어지면, 코드를 보는 것이 매우 불편해진다. Utility 파일을 새로 생성해서 가독성을 좋게 만들기 위해 여러 시도를 해봤고, 내 기준 Best Practice를 찾았다.</p>
<br/>
<h2 id="API-Routes-코드-위치" style="position:relative;">API Routes 코드 위치<a href="#API-Routes-%EC%BD%94%EB%93%9C-%EC%9C%84%EC%B9%98" aria-label="API Routes 코드 위치 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>모듈화 되어 있지 않은 API관련 Utility 코드를 위치 시키는 방법은 2가지다.</p>
<ol>
<li><code class="language-text">pages/api</code> 경로에 파일을 위치시키고, 파일 명에 <code class="language-text">_</code> 또는 <code class="language-text">.</code> 접두사를 넣어주는 방법.</li>
<li><code class="language-text">pages</code> 폴더 외부에 위치시키는 방법.</li>
</ol>
<h3 id="1-pagesapi-경로에-파일을-위치시키고-파일-명에-code-classlanguage-text_code-또는-code-classlanguage-textcode-접두사를-넣어주는-방법" style="position:relative;">1. pages/api 경로에 파일을 위치시키고, 파일 명에 <code class="language-text">_</code> 또는 <code class="language-text">.</code> 접두사를 넣어주는 방법<a href="#1-pagesapi-%EA%B2%BD%EB%A1%9C%EC%97%90-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EC%9C%84%EC%B9%98%EC%8B%9C%ED%82%A4%EA%B3%A0-%ED%8C%8C%EC%9D%BC-%EB%AA%85%EC%97%90-code-classlanguage-text_code-%EB%98%90%EB%8A%94-code-classlanguage-textcode-%EC%A0%91%EB%91%90%EC%82%AC%EB%A5%BC-%EB%84%A3%EC%96%B4%EC%A3%BC%EB%8A%94-%EB%B0%A9%EB%B2%95" aria-label="1 pagesapi 경로에 파일을 위치시키고 파일 명에 code classlanguage text_code 또는 code classlanguage textcode 접두사를 넣어주는 방법 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>Next.js에서 <code class="language-text">pages/api</code> 경로에 파일을 위치시키는 경우 자동으로 API Routes 코드임을 인식하고, 파일 명으로 API Endpoint를 만들게 된다. 하지만, <a href="https://github.com/vercel/vercel/discussions/4983" target="_blank" rel="nofollow">링크</a>에 따르면 Vercel에 배포할 경우, API Enpoint를 만들지 않도록 할 수 있다.</p>
<p>pages/api 폴더에 생성된 파일 명에 <code class="language-text">_</code> 또는 <code class="language-text">.</code> 접두사를 붙여 주면 API Endpoint를 만들지 않는다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 610px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 33.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABAUlEQVR42o2QS0rEQBRFswInDmyw6apKpdL5VExiOqFFg7FRghH8gPhbgmPBNTh0xccywalk8HiDepw693pHNuP7ZaC9ahHXBeFdjb4oEH6ECGaOv0bZFL+0eDJY87hrKU8aVtsMfZajKjsdmplAHSHXMTKKHTAqGfqEr/cCeWoxNxWrpRl/HUfPNEwTVJ7iCZMQhgY7PLFsdu4hRGYpqkjHLcJ4lqH4NUziCShWkr2HTw66N3RpMLc1wVAR9MeoOptMzf+G0ib47tYBHVlpFufPHG57/E2MajKUK1i6CLMi/3XoYo+GUir27z9YXL5iutiZVeiuwG/zyW5Gh6PhJuMHv6HO4h9zZykAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="api-test-folder"
        title=""
        src="/static/6055ebb1d62cbc411bbc7ec990ab46b4/5d5ad/api-test-folder.png"
        srcset="/static/6055ebb1d62cbc411bbc7ec990ab46b4/0eb09/api-test-folder.png 500w,
/static/6055ebb1d62cbc411bbc7ec990ab46b4/5d5ad/api-test-folder.png 610w"
        sizes="(max-width: 610px) 100vw, 610px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>사진과 같이 <code class="language-text">pages/api/</code> 경로에 <code class="language-text">test1.ts</code> 파일과 <code class="language-text">_test2.ts</code> 파일을 생성했다. 예상대로라면, <code class="language-text">_test2</code>의 경로로 api를 요청했을 경우 오류가 발생해야 한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// test1.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'api 요청 성공 예상'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// _test2.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'api 요청 실패 예상'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>그리고 브라우저에서 <code class="language-text">http://localhost:3000/api/test1</code>, <code class="language-text">http://localhost:3000/api/_test2</code>로 요청을 보내보았다. 결과는 아래 사진과 같다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1724px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABd0lEQVR42j1Qa0vDQBDMb1GhalNzuSS9JmlSqU/sFxEUwVfBFyr6yb+rqKlpUWmstl5y13a8puLBMLO77DB7muN6qIQ1UN2AYzNYCgaxUCwaKMwXxzOzcygUFiPXDThjPqrVZehqTpkH3w+xZNB/zC/o0I5uztG8v8XN3gH2d3bRPL3E+cUVjo/OcHV9N748a+L45CSq+wGvNFYQHG5jr76BFRXADevY3GygvroB5tSwtr4Frf/dR7vzjqfXDlqdNzy3YnSTT3x0uxMeCznCw8NjZBgGp2UHSxaFQ0yQoo6FRR2UWiodgUlsdZkJTUiB4Wg0xXAEKScYgqcCaZqNod5LqxV5nsd9z0MtDMEqFfhBgFBp1Ven+0oHME2iDIVAkiToffaQyQEGWYJB2sUXf0Mq+rlhux1Hapk7jvNnUIXrurm2LCvHpJ6wJqUE5xxZlqmUQpn+QEg+5eE0YRzHEaWUl0ol2LaNcrkMXdfBGMtr9R05E0LwCxUdIQtxBdaVAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="api-call-result"
        title=""
        src="/static/7151bc9d84a6128edb20359dc4dd5eee/8aa99/api-call-result.png"
        srcset="/static/7151bc9d84a6128edb20359dc4dd5eee/0eb09/api-call-result.png 500w,
/static/7151bc9d84a6128edb20359dc4dd5eee/1263b/api-call-result.png 1000w,
/static/7151bc9d84a6128edb20359dc4dd5eee/8aa99/api-call-result.png 1724w"
        sizes="(max-width: 1724px) 100vw, 1724px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>첫 번째 사진은 정상적으로 JSON이 반환된 것을 볼 수 있고, 두 번째 사진은 오류가 발생했다. 따라서, <code class="language-text">_</code> 접두사를 붙인 파일은 Endpoint를 만들지 않은 것을 볼 수 있다.</p>
<p>하지만 접두사 <code class="language-text">_</code>를 포함한 하나의 Utility 파일이면 상관 없지만, 코드를 폴더 구조로 나누고 싶을 수 있다. 공통으로 사용하는 Utility 코드가 생길 수 있기 때문이다. 즉 확장성이 떨어진다. 그리고 여러 개의 파일을 만들게 되면 폴더 명을 포함해, 파일 명에 매번 <code class="language-text">_</code> 접두사를 붙여주어야 한다. 2번째 방법을 사용해보자.</p>
<h3 id="2-pages-폴더-외부에-위치시키는-방법" style="position:relative;">2. pages 폴더 외부에 위치시키는 방법<a href="#2-pages-%ED%8F%B4%EB%8D%94-%EC%99%B8%EB%B6%80%EC%97%90-%EC%9C%84%EC%B9%98%EC%8B%9C%ED%82%A4%EB%8A%94-%EB%B0%A9%EB%B2%95" aria-label="2 pages 폴더 외부에 위치시키는 방법 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 170.20000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAiCAYAAABfqvm9AAAACXBIWXMAABYlAAAWJQFJUiTwAAAD80lEQVR42pVWS4/aZhSdXZV2kUnaziSTGR7mYRsDfr8AY7CxAQMDTJhJ2rSKonaRTRfNplLU56JS//Xp/T4mTNNFxl5cCSTr6Nx7zj33O2rIXTS6XdjfBdAGPsbxHGJbQ6kmotKQUa5Lheqo2myhIrZgLj0olgbD7qPalHFebeBZpc6BCwGW6yKqoo75UMY/77ewgxTZ+gqLzQ5LqsEo4cB52R7tf8iQ2zKer3rQTAuq5cPyAnRNF1JH4x8ywDygR6WahBq1fN7Q8O6lgrffj+CP5pgt1mDjOD2vHNpnlZOhxOcmtlVqOYKi27B7AZx+CNMb8NKdHq9cgGzwdanNgTavXsN2XIzTDLPVltdoMkM0XWAyX0EQlU8KdWBYojmWyxV85WQ4XvwE07AQRFPOrhfGNNMBmoqKC6GZr+UyG7pQw7m/wEnyhlh6iImROxjB8gNSe0JieQUBK1U8DbZ4fPkzfM/HkFr1gjEHYuLcB/YxILVcqZKSTorT0TfQTRsmMWMtdwyHg+WyzR1D2phyGWeDDR5d/wrP9ZBtrhHPlhjGU6imx+1zH+gdIFOuqeAk+hYlK0JXMzizlmryYuoW2pSK0MBFx8XDm98hOyEWqw2myy1CmqNB/ntyUS0yQwKknS7LOk7SH1HXe7AIxHAHXGHD7fM1ZJXP2OwPCfKkpeHB1S9oWEOM4gSDcYoRGTzNLjGMUvJlmg9QoNkJLQWZscNED6HZDpl5Ap8sw3xYlzs4K9e4KLkAWQiUmyKm9hXS6Bqa14NLe8za7ZOha7SWDDD3DD+0fNpS8dmLPyF6McJxzAVhtlltbxCSddgK3he4/7FNcy/K+BUksw/b3yeMolnQbZ8L0qbwKGabtoOHL/+C5EbYXt0gInaMIWP1tCQUy8M9Q41s8wZC10FXt9C5tYqsGjxppLZWAFCo40w28Pn1HxDdMdJpdrAMy0SWj+Nknl/lGq1Wl4ysUii0aW5MYes2HD4kdZ4LeABkFWYbzOjSOb0hmTrhjJiZ/WF0OFQFWm7gTNTwxe431O0QQRgRUEwbMuUXUO4aBfOQqSxpOO7toDgB+S7lPmT+Y8dK6uj5AQWRzVBF9trHejdAP5hgfrnlM2Mpw+ySB+wAyI84ebHj6ejM1hBVsg1loUw52Gh1uWXY+vEVzWtsZptnso0HL/5Gq58gW67pSbLDjDJxutzwU8oC975nyUfGLpGxv57+AEH17oxtuNDoacIOFUtuxjTHXZb3orRtHD9/D8kZYTyZIl1skJCxU3qWJHRSk/klB/7UbfkfQx1fzt+iaZHKUXI48szYTGUGlDNtbhkqFh6v36Fu9JHQ6g3j2d46VAw8zyP0XyaCBtdMXiZ/AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="backend-folder"
        title=""
        src="/static/36c2850e6353eccbbc1476bc97d31973/6d370/backend-folder.png"
        srcset="/static/36c2850e6353eccbbc1476bc97d31973/0eb09/backend-folder.png 500w,
/static/36c2850e6353eccbbc1476bc97d31973/6d370/backend-folder.png 590w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>사진과 같이 <code class="language-text">backend</code> 폴더를 생성한다. 그리고 원하는 대로 코드를 파악하기 쉽도록 잘게 쪼개어 작성한다. Utils만 따로 작성해도 되지만, http method를 여러 개 사용하고 있었기 때문에 조금 더 세분화 했다.</p>
<p>Next.js 13 버전에서 App Router의 API Route 코드는 <code class="language-text">Route Handlers</code> 라는 이름으로 변경되었다고 했는데, 그 구조는 아래와 같다.</p>
<p><img src="/b5bcb81c5abffbdad9bcda0798a5253c/13v-route-handlers.avif" alt="13v-route-handlers"></p>
<p><code class="language-text">app/api</code> 폴더에 routes.ts 파일로 작성할 수 있다. 하지만, 기존 API Routes와 같이 하나의 함수만 존재하는 것은 아니다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">POST</span><span class="token punctuation">(</span>request<span class="token operator">:</span> Request<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<p>위와 같이 함수를 여러 개 정의할 수 있으며 <code class="language-text">GET</code>, <code class="language-text">POST</code> 와 같이 http methods 이름을 함수 명으로 작성하면 된다. Route Handlers의 http method 명을 함수 명으로 사용한 것을 착안해 <code class="language-text">httpMethods</code> 폴더를 backend 폴더 하위에 두고 <code class="language-text">GET.ts</code>, <code class="language-text">POST.ts</code>, <code class="language-text">DELETE.ts</code> 파일을 생성하고 필요한 로직을 작성했다. 예시인 <code class="language-text">GET.ts</code> 파일의 코드다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">GOOGLE_INFO</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/backend/constants/google.ts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> oauth2Client <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/backend/utils/authUtils.ts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> authorizationUrl<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> oauth2Client<span class="token punctuation">.</span><span class="token function">generateAuthUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  access_type<span class="token operator">:</span> <span class="token string">'offline'</span><span class="token punctuation">,</span>
  scope<span class="token operator">:</span> <span class="token constant">GOOGLE_INFO</span><span class="token punctuation">.</span><span class="token constant">SCOPE</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span>
  req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span>
  res<span class="token operator">:</span> NextApiResponse<span class="token operator">&lt;</span>GoogleUrl <span class="token operator">|</span> AxiosError<span class="token operator">></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> location<span class="token operator">:</span> authorizationUrl <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>기존 API Routes 코드에서 분기분으로 GET 코드를 사용했던 것보다 훨씬 한 눈에 파악하기 쉬워졌다.</p>
<p>그리고, http methods 코드를 최종적으로 API Routes 코드에서 한 번에 불러오기 위해 <code class="language-text">도메인/index.ts</code> 파일에서 GET.ts, POST.ts, DELETE.ts 파일들을 <strong>re-export</strong> 해준다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// @/backend/auth/index.ts</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'@/backend/auth/httpMethods/GET.ts'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'@/backend/auth/httpMethods/POST.ts'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'@/backend/auth/httpMethods/DELETE.ts'</span><span class="token punctuation">;</span></code></pre></div>
<p>이제 마지막으로 실제 API Routes 코드인 <code class="language-text">pages/api/auth.ts</code> 파일을 보자. 실제 API Routes를 실행시키고, API Endpoint를 생성해주던 파일이다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// pages/api/auth.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">AUTH</span> <span class="token keyword">from</span> <span class="token string">'@/backend/auth/index.ts'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">RouteMehtod</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">typeof</span> <span class="token constant">AUTH</span><span class="token punctuation">.</span><span class="token constant">GET</span> <span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">AUTH</span><span class="token punctuation">.</span><span class="token constant">POST</span> <span class="token operator">|</span> <span class="token keyword">typeof</span> <span class="token constant">AUTH</span><span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>
  req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span>
  res<span class="token operator">:</span> NextApiResponse
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> HttpFunctions<span class="token operator">:</span> RouteMehtod <span class="token operator">=</span> <span class="token constant">AUTH</span><span class="token punctuation">;</span>
  HttpFunctions<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>index.ts에서 re-export한 파일을 가져와, <code class="language-text">req.method</code> (http 요청이 들어온 메서드 명)가 들어온 이름에 따라 함수를 실행해주도록 했다.</p>
<p>기존 auth.ts 파일의 코드는 아래 사진과 같이 167 라인이었고 그 길이 만큼 코드를 파악하기 어려웠었다. 이제는 auth.ts 파일은 단순히 통로가 되어, http 요청에 따라 실행 될 함수가 작성된 파일을 찾아 보면 되기 때문에 코드 파악이 훨씬 쉬워졌다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1294px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACHElEQVR42o1T23LaMBT0awIBjO+2LFuSr5gQAp1J///HtntE6LTTpMnDDkiWV3t210FmL8jtGZl5QeZ+oHBnLK8/MSwXJGWLtLLfQlIaxEWLwEwXmPGM/viGbnlDaRauT2j6I6p2Qq4HFLpH2QzIlPsQQmiGZ4q4Imj7BYJxfsHz8Qrb9NAC3aG5/9ojWvfsFXyEKG/QdAu6+YwgTBW2SYUoylGkFUY7oW8PsO5I8JCZUFRUVzg87fNPsdqleNwmCOKigZA+cuNhl0Eri6KwWEclL6qxSxQeNnsiwjrMvkQg3oj526iAqS3qoqb8mUEtSJoJceWgx1dk9FLOfEkYpjW2ceUXZaaQFxqVGaHcgQFNCLMaJf/HJN+8j7YmVh/AE4qpQiojVyRUHNlOJ2g3o9Qjuu4C5y5Q7YwNbdjERKK8HRsKEf/Fsn0mwsob4T7X/gZTNjidrqzPFY2vwSs0R2/bFxh7QkxrotIiqmlTMyMsWZvasV6DF5BWBoEw73iLEO6p0M0n1JYPi47p9uyhwy6TCRKf4mr3jm2M9fa29ycCabiQeg/VAKUP7N0BLXtlhiNCXvbEZ4KbV+8B0M91+Hd1vIc3hcqzRxw9ZWXyemSqVFeJOk009Io+scB7rjf/STuQykgoMnZOP9Kc3yaVRiSTMseqY8KzJ0sZUsyJxPx7qv8Q3tNJme6t8XefUp/8rSIJD6e/9+XFz76YX9Cran7uoWrGAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="167-line-code"
        title=""
        src="/static/e4b9a075b6dbeddc0a7df5edeb7fcf63/80132/167-line-code.png"
        srcset="/static/e4b9a075b6dbeddc0a7df5edeb7fcf63/0eb09/167-line-code.png 500w,
/static/e4b9a075b6dbeddc0a7df5edeb7fcf63/1263b/167-line-code.png 1000w,
/static/e4b9a075b6dbeddc0a7df5edeb7fcf63/80132/167-line-code.png 1294w"
        sizes="(max-width: 1294px) 100vw, 1294px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>하지만, 이렇게 리팩토링하면서 한 가지 아쉬운 부분이 존재했다. 공통 에러처리에 대한 부분이다. 백엔드의 코드에서 에러가 발생한다면 공통으로 잡아주고 싶었다. 또한, API Routes로 로깅을 해야하는 상황이 있을 수 있겠다는 생각이 들었다.</p>
<h4 id="Filter-적용" style="position:relative;">Filter 적용<a href="#Filter-%EC%A0%81%EC%9A%A9" aria-label="Filter 적용 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<p>Spring에는 filter와 interceptor가 존재한다. http 요청이 들어오면 먼저 filter를 거치고, interceptor를 거쳐 controller로 요청 데이터가 넘어오게 된다. 이 과정을 착안해서, filter 혹은 interceptor를 만들면 좋겠다고 생각했다. spring에서 filter는 실제 http 요청이 컨테이너로 넘어오기 전에 데이터를 가공하거나 XSS 공격을 막아주는 역할을 한다고 한다. 또한 filter는 체이닝이라는 특성을 가지고 있어, 체이닝 개념으로 사용하면 좋을 것 같다고 생각했다. interceptor와 비교했을 경우 filter라는 명칭이 더 어울릴 것 같아 filter를 만들게 되었다.</p>
<p>filter는 간단하게 HoF으로 handler를 감싸주기만 하면 된다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// @/backend/common/filter.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Hanlder <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/backend/common/interfaces.ts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> errorFilter <span class="token keyword">from</span> <span class="token string">'@/backend/common/errorFilter.ts'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span>handler<span class="token operator">:</span> Hanlder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">errorFilter</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>위와 같이 HoF를 만들어주면 <code class="language-text">return</code> 문에 <code class="language-text">logFilter(errorFilter(handler))</code> 같은 방식으로 추후에 logFilter도 만들어 적용할 수 있다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// pages/api/auth.ts</span>

<span class="token comment">// import 문 생략</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> HttpFunctions<span class="token operator">:</span> RouteMehtod <span class="token operator">=</span> <span class="token constant">AUTH</span><span class="token punctuation">;</span>
  HttpFunctions<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">filter</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>handler 코드에 filter를 감싸주었다. 그러면, 무조건 http 요청이 오면 filter를 거쳐 실제 함수가 실행된다. <code class="language-text">errorFilter.ts</code>를 보자.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// @/backend/common/errorFilter.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Hanlder <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/backend/common/interfaces.ts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextApiRequest<span class="token punctuation">,</span> NextApiResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">HTTP_METHODS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/dist/server/web/http'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">errorFilter</span><span class="token punctuation">(</span>handler<span class="token operator">:</span> Hanlder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> NextApiRequest<span class="token punctuation">,</span> res<span class="token operator">:</span> NextApiResponse<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token constant">HTTP_METHODS</span> <span class="token keyword">as</span> ReadonlyArray<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res
        <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">405</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'허용되지 않는 http method 입니다.'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// NOTE:  공통 에러 처리 추가 가능</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res
        <span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'알 수 없는 오류가 발생했습니다.'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>위 내용은 아래 커밋에서 볼 수 있다.</p>
<ul>
<li><a href="https://github.com/pozafly/jiary/commit/d496003516c56a6f056b6991f62a5f2caafd8219" target="_blank" rel="nofollow">HTTP Method 별 파일 분리 커밋</a></li>
<li><a href="https://github.com/pozafly/jiary/commit/d5b74a7331338e9a238f39ad09c650edd2cbe007" target="_blank" rel="nofollow">공통 에러처리 및 필터 추가 커밋</a></li>
</ul>
<br/>
<h2 id="마치며" style="position:relative;">마치며<a href="#%EB%A7%88%EC%B9%98%EB%A9%B0" aria-label="마치며 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>이번 글은 Next.js의 API Routes의 컨셉을 간단히 알아보고, API Routes로 백엔드 코드를 작성해보면서 코드를 어떻게 분리시킬지 개선한 부분을 작성했다. Next.js의 API Routes는 사실 그렇게까지 많이 사용되고 있지는 않다고 한다. heath 체크 정도로만 사용하지, 백엔드의 역할을 백엔드가 한다고 한다. 그래서 그런지 API Routes 코드를 제대로 모듈화 한 자료를 많이 찾지 못했고, 컨셉을 들여다보며 원하는 방향대로 리팩토링 해봤다.</p>
<p>Next.js를 사용한 곳의 프로젝트 사이즈가 크고, MSA 구조로 되어 있어서 BFF가 필요하다고 하면, API Routes를 데이터 가공 레이어로 활용해보면 좋겠다고 생각했다.</p>
<p>리팩토링 전 코드가 매우 지저분해서 마음에 걸렸었는데, 코드 구조가 보기 좋게 되었다. 이렇게 코드가 딱 깔끔하게 떨어졌을 때의 쾌감은 이루 말할 수 없다.</p>
<blockquote>
<p>참고</p>
<ul>
<li><a href="https://nextjs.org/docs/app/building-your-application/routing/router-handlers" target="_blank" rel="nofollow">https://nextjs.org/docs/app/building-your-application/routing/router-handlers</a></li>
<li><a href="https://www.daleseo.com/meta-frameworks/" target="_blank" rel="nofollow">https://www.daleseo.com/meta-frameworks/</a></li>
<li><a href="https://json.media/blog/proper_understading_of_nextjs" target="_blank" rel="nofollow">https://json.media/blog/proper_understading_of_nextjs</a></li>
<li><a href="https://dev.to/wzulfikar/end-to-end-typing-for-nextjs-api-50kn" target="_blank" rel="nofollow">https://dev.to/wzulfikar/end-to-end-typing-for-nextjs-api-50kn</a></li>
<li><a href="https://github.com/vercel/next.js/discussions/17832" target="_blank" rel="nofollow">https://github.com/vercel/next.js/discussions/17832</a></li>
<li><a href="https://github.com/microsoft/TypeScript/pull/52217" target="_blank" rel="nofollow">https://github.com/microsoft/TypeScript/pull/52217</a></li>
<li><a href="https://dev.to/sneakysensei/nextjs-api-routes-global-error-handling-and-clean-code-practices-3g9p" target="_blank" rel="nofollow">https://dev.to/sneakysensei/nextjs-api-routes-global-error-handling-and-clean-code-practices-3g9p</a></li>
<li><a href="https://github.com/vercel/vercel/discussions/4983" target="_blank" rel="nofollow">https://github.com/vercel/vercel/discussions/4983</a></li>
</ul>
</blockquote></div></section></article><style data-emotion="css lhozv1">.css-lhozv1{position:relative;box-sizing:border-box;width:100%;max-width:760px;margin-right:auto;margin-left:auto;}</style><div class="css-lhozv1"><div></div></div></div></main><style data-emotion="css dcfhc9">.css-dcfhc9{position:relative;padding:0 5vw;}</style><style data-emotion="css u4s22w">.css-u4s22w{background:#0a0b0c;position:relative;padding:0 5vw;}.css-u4s22w .post-card{padding-bottom:0;border-bottom:none;}.css-u4s22w .post-card:after{display:none;}.css-u4s22w .post-card-primary-tag{color:#fff;opacity:0.6;}.css-u4s22w .post-card-title{color:#fff;opacity:0.8;-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-u4s22w .post-card:hover .post-card-image{opacity:1;}.css-u4s22w .post-card-excerpt{color:rgb(255 255 255 / 0.6);}.css-u4s22w .static-avatar{border-color:#000;}.css-u4s22w .post-card-byline-content{color:rgb(255 255 255 / 0.6);}.css-u4s22w .post-card-byline-content a{color:rgb(255 255 255 / 0.8);}.css-u4s22w .author-avatar{border-color:#0a0b0c;}.css-u4s22w .author-profile-image{background:#0a0b0c;}@media (max-width: 650px){.css-u4s22w .post-card{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;margin:25px;padding:25px 0 0;}}</style><aside class="read-next css-u4s22w e7ky4j51"><div class="css-8aaawc"><style data-emotion="css 2ud111">.css-2ud111{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 -25px;padding:60px 0 0;}</style><div class="read-next-feed css-2ud111 e7ky4j50"><style data-emotion="css 49lcs7">.css-49lcs7{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 301px;-ms-flex:1 1 301px;flex:1 1 301px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:220px;margin:0 20px 60px;-webkit-background-size:cover;background-size:cover;}.css-49lcs7 img{-webkit-transform:scale(1)!important;-moz-transform:scale(1)!important;-ms-transform:scale(1)!important;transform:scale(1)!important;-webkit-transition:opacity 0.3s ease-out 0s,-webkit-transform 0.5s ease 0s!important;transition:opacity 0.3s ease-out 0s,transform 0.5s ease 0s!important;}.css-49lcs7:hover .post-card-image:after{opacity:var(--post-card-after-opacity);}.css-49lcs7:hover img[data-main-image]{-webkit-transform:scale(1.03)!important;-moz-transform:scale(1.03)!important;-ms-transform:scale(1.03)!important;transform:scale(1.03)!important;}.css-49lcs7.is-next .post-card-image{background:#191b1f;border:1px solid hsl(230 6% 23%);}.css-49lcs7.is-next .post-card-primary-tag a{color:#90a2aa;}.css-49lcs7.is-next .post-card-excerpt{color:#768086;}.css-49lcs7.is-next .post-card-byline-content{color:#90a2aa;}</style><article class="post-card   is-next css-49lcs7"><style data-emotion="css uih3rl">.css-uih3rl{position:relative;overflow:hidden;display:block;border-radius:12px;}</style><a class="post-card-image-link css-uih3rl" href="/dev-ops/cache-and-restore-keys-in-github-actions/"><style data-emotion="css pg199o">.css-pg199o{overflow:hidden;width:auto;height:200px;background-color:var(--background-color);-webkit-background-size:cover;background-size:cover;border:1px solid var(--image-border-color);border-radius:12px;}.css-pg199o:after{content:'';position:absolute;top:0;left:0;display:block;width:100%;height:100%;opacity:var(--post-card-opacity);background-color:var(--post-card-background);-webkit-transition:all 0.3s ease 0s;transition:all 0.3s ease 0s;}.css-pg199o img{border-radius:12px;}</style><div class="post-card-image css-pg199o ezywgfd6"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:52.083333333333336%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/webp;base64,UklGRtoAAABXRUJQVlA4IM4AAADQAgCdASoUAAoAAAAAJYgCdL1CScCMIDOJauZFWWvwAP7+fCRqJ1HSVO9tIR999fXyP/P57rC8REMKD1//0ioeS1//ZcuF7B+ofR9C21V2uWjaFEHZ/V9j/+YjqrWQX/oM//3/Xef38974//DpwZKlrsnStauDGxKwCIg6sCCzNEAE1v/+tZbF+e3c/dp8J2s0//xoH+/2b/MdD0ufroUYn//1ag//2gH//Wsf0DSlimwf/X6RG3r/0P/tmbftAf4hf79ZmYcMFl0JnQAAAA==" alt=""/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/365cb7658cd8164573e7796d96f879bc/34dc0/main.webp" data-srcset="/static/365cb7658cd8164573e7796d96f879bc/3fe34/main.webp 750w,/static/365cb7658cd8164573e7796d96f879bc/da172/main.webp 1080w,/static/365cb7658cd8164573e7796d96f879bc/b3e28/main.webp 1366w,/static/365cb7658cd8164573e7796d96f879bc/34dc0/main.webp 1920w" alt="GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys) cover image"/><noscript><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/365cb7658cd8164573e7796d96f879bc/34dc0/main.webp" srcSet="/static/365cb7658cd8164573e7796d96f879bc/3fe34/main.webp 750w,/static/365cb7658cd8164573e7796d96f879bc/da172/main.webp 1080w,/static/365cb7658cd8164573e7796d96f879bc/b3e28/main.webp 1366w,/static/365cb7658cd8164573e7796d96f879bc/34dc0/main.webp 1920w" alt="GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys) cover image"/></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></a><style data-emotion="css z5atxi">.css-z5atxi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="post-card-content css-z5atxi ezywgfd5"><style data-emotion="css vm6g88">.css-vm6g88{margin:15px 0 0.2em;font-size:1.2rem;font-weight:500;color:#90a2aa;letter-spacing:0.2px;}.css-vm6g88 a{font-size:1.2rem;}</style><div class="post-card-primary-tag css-vm6g88 ezywgfd4"><a href="/tags/dev-ops/">DevOps</a>,  <a href="/tags/git-hub-actions/">GitHub Actions</a>,  <a href="/tags/automation/">Automation</a></div><style data-emotion="css 1fjrpmt">.css-1fjrpmt{position:relative;display:block;color:#15171A;}.css-1fjrpmt:hover{-webkit-text-decoration:none;text-decoration:none;}</style><a class="post-card-content-link css-1fjrpmt" href="/dev-ops/cache-and-restore-keys-in-github-actions/"><header><style data-emotion="css 1ynvt8d">.css-1ynvt8d{margin:0 0 0.4em;line-height:1.15em;color:var(--post-card-title);}</style><h2 class="post-card-title css-1ynvt8d ezywgfd3">GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys)</h2></header><style data-emotion="css 12i2xil">.css-12i2xil{font-size:1.6rem;color:var(--post-card-description);}.css-12i2xil p{overflow:hidden;display:-webkit-box;width:100%;margin-bottom:0.4em;font-size:1.4rem;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:2;}</style><section class="post-card-excerpt css-12i2xil ezywgfd2"><p>restore-keys는 기존 캐시가 쓸모없어졌음에도 불구하고 기존 캐시를 불러오는 기능이다. 그렇다면, 무효화 되지 않은 캐시를 어디에 사용해야 하는 것일까?</p></section></a><style data-emotion="css 143c7df">.css-143c7df{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding:0;}</style><footer class="post-card-meta css-143c7df ezywgfd1"><style data-emotion="css 137vq87">.css-137vq87{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 50%;-ms-flex:1 1 50%;flex:1 1 50%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-weight:400;line-height:1.4em;color:#90a2aa;letter-spacing:0.2px;}.css-137vq87 time{font-size:1.3rem;}.css-137vq87 span{margin:0;font-size:1.3rem;}.css-137vq87 a{font-weight:600;color:var(--post-card-by-line);}</style><div class="post-card-byline-content css-137vq87 ezywgfd0"><span class="post-card-byline-date"><time dateTime="2023-08-22">2023-08-22</time> <span class="bull">•</span> <span>18 min read</span></span></div></footer></div></article><article class="post-card   is-next css-49lcs7"><a class="post-card-image-link css-uih3rl" href="/diary/geultto-8-retrospect/"><div class="post-card-image css-pg199o ezywgfd6"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:56.97329376854599%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAACE3AAAhNwEzWJ96AAABGklEQVR42qVSu6qDQBDNB+mP2EY7u+AHKAZ8QCCmElvB1i6CpT8gCHYqCvoJqSVX0Bt3nbsrCIGLoMnCsMM5s2cPM3OAlTNNE3zCHdaKu677resalWWJsyzDRVHgqqowxSi3JvxPEGM837fb7cmy7CiKIpIkCZ1OJ0RzhmFGy7Ke77VbHE7n83m0bRvSNIXL5QKPx2P5CFRVHTc7XAR1XadOZiwIAmiaBoZhAIppmrZfkDxCi2CSJMBxHERRBI7jUIdot6BpmiMJaNsW4jgG0kMIwxCu1+tnDmmfBEEA13XB93243+/geR7wPA+Koox7p0x7+HM8HrFhGJgIYFmW55xgiHC7pwx93w9kB195nqP3ILv4otxmh9+eP5BhGA/5lJZDAAAAAElFTkSuQmCC" alt=""/><picture><source type="image/webp" data-srcset="/static/53fe681b532753855e5826673a894e9a/15c6e/main.webp 674w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/53fe681b532753855e5826673a894e9a/44f99/main.png" data-srcset="/static/53fe681b532753855e5826673a894e9a/44f99/main.png 674w" alt="글또 8기 회고 cover image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/53fe681b532753855e5826673a894e9a/15c6e/main.webp 674w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/53fe681b532753855e5826673a894e9a/44f99/main.png" srcSet="/static/53fe681b532753855e5826673a894e9a/44f99/main.png 674w" alt="글또 8기 회고 cover image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></a><div class="post-card-content css-z5atxi ezywgfd5"><div class="post-card-primary-tag css-vm6g88 ezywgfd4"><a href="/tags/diary/">Diary</a></div><a class="post-card-content-link css-1fjrpmt" href="/diary/geultto-8-retrospect/"><header><h2 class="post-card-title css-1ynvt8d ezywgfd3">글또 8기 회고</h2></header><section class="post-card-excerpt css-12i2xil ezywgfd2"><p>6개월 간 참여한 글또 활동 회고. 글쓰기에 대해서.</p></section></a><footer class="post-card-meta css-143c7df ezywgfd1"><div class="post-card-byline-content css-137vq87 ezywgfd0"><span class="post-card-byline-date"><time dateTime="2023-07-16">2023-07-16</time> <span class="bull">•</span> <span>8 min read</span></span></div></footer></div></article></div></div></aside><style data-emotion="css d4eprp">.css-d4eprp{position:relative;padding:0 5vw;position:relative;padding-top:20px;padding-bottom:22px;color:#fff;background:#000;}</style><footer class="css-d4eprp"><style data-emotion="css 98e3yl">.css-98e3yl{width:100%;max-width:1040px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;font-size:1.3rem;color:rgb(255 255 255 / 0.7);}.css-98e3yl a{color:rgb(255 255 255 / 0.7);}.css-98e3yl a:hover{color:rgb(255 255 255 / 1);-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 650px){.css-98e3yl{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="css-98e3yl"><section class="copyright">© <!-- -->2024<!-- --> <span>|  </span><a href="https://www.gatsbyjs.com/" target="_blank" rel="nofollow noreferrer">Pozafly&#x27;s Blog<!-- --> <!-- -->is based on Gatsby</a></section><style data-emotion="css 13qgqyf">.css-13qgqyf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-13qgqyf a{position:relative;margin-left:20px;font-size:1.3rem;}.css-13qgqyf a:before{content:'';position:absolute;top:11px;left:-11px;display:block;width:2px;height:2px;background:#fff;border-radius:100%;}.css-13qgqyf a:first-of-type:before{display:none;}@media (max-width: 650px){.css-13qgqyf a:first-of-type{margin-left:0;}}</style><nav class="css-13qgqyf e69t7dt0"><a href="/">Latest Posts</a><a href="https://github.com/pozafly" target="_blank" rel="noopener noreferrer">Github</a><a href="/rss.xml">RSS</a></nav></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/nextjs/about-modularizing-api-routes-code-in-nextjs/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-bbf8fb6b84dd8cd0eacf.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-2e217b6418d3a70c10c1.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-de96f14b6b6a54ea6dc3.js\"],\"component---src-pages-tags-tsx\":[\"/component---src-pages-tags-tsx-382d762fe8469f585f48.js\"],\"component---src-templates-index-tsx\":[\"/component---src-templates-index-tsx-87a1e322ca81daabd576.js\"],\"component---src-templates-post-tsx\":[],\"component---src-templates-tags-tsx\":[\"/component---src-templates-tags-tsx-dc821f1950af21d2437b.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="144508b40d4b9cf2a1c9";</script><script src="/webpack-runtime-c7022c66002a46f400c1.js" async></script><script src="/framework-8303ab3d511d49936edf.js" async></script><script src="/app-bbf8fb6b84dd8cd0eacf.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>