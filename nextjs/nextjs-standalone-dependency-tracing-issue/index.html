<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.15.0"/><meta name="description" content="Next.js를 standalone 모드로 빌드하면서 종속성 누락 문제를 겪었다. @vercel/nft의 정적 추적 방식, pnpm의 심볼릭 링크 구조, 그리고 pino-pretty를 포함해 종속성이 빠지는 이유와 해결 과정을 기록한다." data-gatsby-head="true"/><meta property="og:site_name" content="Pozafly&#x27;s Blog" data-gatsby-head="true"/><meta property="og:type" content="article" data-gatsby-head="true"/><meta property="og:title" content="Next.js standalone 종속성 추적 삽질기 (feat. pino)" data-gatsby-head="true"/><meta property="og:description" content="Next.js를 standalone 모드로 빌드하면서 종속성 누락 문제를 겪었다. @vercel/nft의 정적 추적 방식, pnpm의 심볼릭 링크 구조, 그리고 pino-pretty를 포함해 종속성이 빠지는 이유와 해결 과정을 기록한다." data-gatsby-head="true"/><meta property="og:url" content="https://pozafly.github.io/nextjs/nextjs-standalone-dependency-tracing-issue/" data-gatsby-head="true"/><meta property="og:image" content="https://pozafly.github.io/static/0152e08f5e4324b47115749c8231fdb1/bb4aa/main.jpg" data-gatsby-head="true"/><meta property="article:published_time" content="2025-09-12T00:00:00.000Z" data-gatsby-head="true"/><meta property="article:tag" content="Next.js" data-gatsby-head="true"/><meta name="github:card" content="summary_large_image" data-gatsby-head="true"/><meta name="github:title" content="Next.js standalone 종속성 추적 삽질기 (feat. pino)" data-gatsby-head="true"/><meta name="github:description" content="Next.js를 standalone 모드로 빌드하면서 종속성 누락 문제를 겪었다. @vercel/nft의 정적 추적 방식, pnpm의 심볼릭 링크 구조, 그리고 pino-pretty를 포함해 종속성이 빠지는 이유와 해결 과정을 기록한다." data-gatsby-head="true"/><meta name="github:url" content="https://pozafly.github.io/nextjs/nextjs-standalone-dependency-tracing-issue/" data-gatsby-head="true"/><meta name="github:image" content="https://pozafly.github.io/static/0152e08f5e4324b47115749c8231fdb1/bb4aa/main.jpg" data-gatsby-head="true"/><meta name="github:label1" content="Written by" data-gatsby-head="true"/><meta name="github:data1" content="Pozafly" data-gatsby-head="true"/><meta name="github:label2" content="Filed under" data-gatsby-head="true"/><meta name="github:data2" content="Next.js" data-gatsby-head="true"/><meta name="github:site" content="@pozafly" data-gatsby-head="true"/><meta name="github:creator" content="@pozafly" data-gatsby-head="true"/><meta property="og:image:width" content="1" data-gatsby-head="true"/><meta property="og:image:height" content="0.5623931623931624" data-gatsby-head="true"/><style data-href="/styles.d4d27a32d6eda6a27949.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Pretendard;font-weight:700;src:local("Pretendard Bold"),url(/fonts/pretendard/Pretendard-Bold.subset.woff2) format("woff2")}@font-face{font-display:swap;font-family:Pretendard;font-weight:600;src:local("Pretendard SemiBold"),url(/fonts/pretendard/Pretendard-SemiBold.subset.woff2) format("woff2")}@font-face{font-display:swap;font-family:Pretendard;font-weight:500;src:local("Pretendard Medium"),url(/fonts/pretendard/Pretendard-Medium.subset.woff2) format("woff2")}@font-face{font-display:swap;font-family:Pretendard;font-weight:400;src:local("Pretendard Regular"),url(/fonts/pretendard/Pretendard-Regular.subset.woff2) format("woff2")}@font-face{font-display:swap;font-family:Pretendard;font-weight:300;src:local("Pretendard Light"),url(/fonts/pretendard/Pretendard-Light.subset.woff2) format("woff2")}</style><link rel="icon" href="/favicon-32x32.png?v=a62d45ddbe29cf42da820a576d9375e1" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .auto-link.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .auto-link.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .auto-link svg,
    h2 .auto-link svg,
    h3 .auto-link svg,
    h4 .auto-link svg,
    h5 .auto-link svg,
    h6 .auto-link svg {
      visibility: hidden;
    }
    h1:hover .auto-link svg,
    h2:hover .auto-link svg,
    h3:hover .auto-link svg,
    h4:hover .auto-link svg,
    h5:hover .auto-link svg,
    h6:hover .auto-link svg,
    h1 .auto-link:focus svg,
    h2 .auto-link:focus svg,
    h3 .auto-link:focus svg,
    h4 .auto-link:focus svg,
    h5 .auto-link:focus svg,
    h6 .auto-link:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://pozafly.github.io/nextjs/nextjs-standalone-dependency-tracing-issue/" data-baseprotocol="https:" data-basehost="pozafly.github.io"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SLQNH3ND3J"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-SLQNH3ND3J',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SLQNH3ND3J', {"anonymize_ip":true,"cookie_expires":0,"send_page_view":false});
      }
      </script><link rel="preload" href="/fonts/pretendard/Pretendard-Bold.subset.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/pretendard/Pretendard-SemiBold.subset.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/pretendard/Pretendard-Medium.subset.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/pretendard/Pretendard-Regular.subset.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preload" href="/fonts/pretendard/Pretendard-Light.subset.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><title data-gatsby-head="true">Next.js standalone 종속성 추적 삽질기 (feat. pino)</title></head><body><script>
  (function() {
    window.__onThemeChange = function() {}; // 컴포넌트에서 정의할 테마 변경 콜백

    let preferredTheme; // 초기화에 사용할 테마
    try {
      const saved = localStorage.getItem('theme') // 로컬 스토리지에 있는 것 사용
      if (saved) {
        preferredTheme = saved.toLowerCase()
      }
    } catch (err) { }

    // 테마 설정 함수
    window.__setPreferredTheme = function(newTheme) {
      window.__theme = newTheme; // 테마는 전역 변수에 저장
      preferredTheme = newTheme;
      document.body.className = newTheme; // 바디에 클래스 추가
      window.__onThemeChange(newTheme); // 콜백 실행

      try {
        localStorage.setItem('theme', newTheme);
      } catch (err) {}
    }

    // 컬러모드 미디어 쿼리 객체를 가져온다
    const darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

    // 컬러모드 변경 탐지 이벤트 리스터 추가
    darkQuery.addListener(function(e) {
      window.__setPreferredTheme(e.matches ? 'dark' : 'light')
    });

    // 테마 설정. 저장된 테마가 없으면 시스템 설정을 사용한다.
    window.__setPreferredTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
  })();
  </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="post-template"><style data-emotion="css-global 10pnfog">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,dl,dt,dd,ol,fieldset,form,label,legend,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;font:inherit;font-size:16px;vertical-align:baseline;border:0;}html .error-front-page,body .error-front-page,div .error-front-page,span .error-front-page,applet .error-front-page,object .error-front-page,iframe .error-front-page,h1 .error-front-page,h2 .error-front-page,h3 .error-front-page,h4 .error-front-page,h5 .error-front-page,h6 .error-front-page,p .error-front-page,blockquote .error-front-page,pre .error-front-page,a .error-front-page,abbr .error-front-page,acronym .error-front-page,address .error-front-page,big .error-front-page,cite .error-front-page,code .error-front-page,del .error-front-page,dfn .error-front-page,em .error-front-page,img .error-front-page,ins .error-front-page,kbd .error-front-page,q .error-front-page,s .error-front-page,samp .error-front-page,small .error-front-page,strike .error-front-page,strong .error-front-page,sub .error-front-page,sup .error-front-page,tt .error-front-page,var .error-front-page,dl .error-front-page,dt .error-front-page,dd .error-front-page,ol .error-front-page,fieldset .error-front-page,form .error-front-page,label .error-front-page,legend .error-front-page,article .error-front-page,aside .error-front-page,canvas .error-front-page,details .error-front-page,embed .error-front-page,figure .error-front-page,figcaption .error-front-page,footer .error-front-page,header .error-front-page,hgroup .error-front-page,menu .error-front-page,nav .error-front-page,output .error-front-page,ruby .error-front-page,section .error-front-page,summary .error-front-page,time .error-front-page,mark .error-front-page,audio .error-front-page,video .error-front-page{font-size:1.6rem;}html{overflow:hidden scroll;box-sizing:border-box;font-size:62.5%;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgb(0 0 0 / 0);}body{overflow-x:hidden;font-size:1.6rem;-moz-font-feature-settings:'liga' on;font-weight:400;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;line-height:1.6em;color:var(--body-color);letter-spacing:0;background:var(--background-color);text-rendering:optimizeLegibility;word-break:break-word;}body::-webkit-scrollbar{width:6px;background-color:transparent;}body::-webkit-scrollbar-thumb{background-color:hsl(230 5% 35%);border-radius:8px;}body.light{--body-color:#303a3e;--background-color:#fff;--main-color:#000;--link-color:#0a0b0c;--border-top-color:#e4eaed;--nav-background:rgb(255 255 255 / 0.4);--nav-border-color:rgb(0 0 0 / 0.05);--header-color:var(--background-color);--header-after:var(--background-color);--header-before:rgb(0 0 0 / 0.15);--author-border:#fff;--home-header-color:#15171A;--home-header-border-bottom:#eaeff1;--header-author-link:#15171A;--no-image-border:#eaeff1;--strong-font-weight:600;--anchor-color:#0b63f0;--anchor-secondary-color:#768086;--loader-color:hsla(230 40% 10% / 0.8);--loader-color2:hsla(230 40% 10% / 0.2);--image-border-color:hsl(230 25% 94%);--image-border-color__dark:hsl(230 6% 23%);--post-card-title:rgb(21 23 26);--post-card-description:rgb(48 58 62);--post-card-by-line:#434952;--strong-color:#0a0b0c;--figcaption-color:#000;--table-first-of-type:linear-gradient(
        to right,
        rgb(255 255 255) 50%,
        rgb(255 255 255 / 0) 100%
      );--table-last-of-type:linear-gradient(
        to left,
        rgb(255 255 255) 50%,
        rgb(255 255 255 / 0) 100%
      );--table-th-background:#f4f8fb;--table-th-border:#e1edf4;--tag-boxshadow:hsl(218 53% 10% / 0.12);--tag-background:#f5f5f5;--post-full-border:#e4eaed;--post-full-meta-link:#2c3036;--post-full-meta-link-hover:#15171A;--post-full-title:#0b0c0e;--highlight-background:#fafafa;--highlight-border:#d1d1d1;--pre-code-color:#000;--little-code-background:var(--highlight-background);--little-code-border:#d1d1d1;--prism-background:hsl(0 0% 90.66%);--prism-border-left:hsl(0 0% 82.88%);--about-box-shadow:10px 10px 30px #bebebe,-10px -10px 30px #fff;--post-card-opacity:0;--post-card-background:rgb(0 0 0 / 0.1);--post-card-after-opacity:1;}body.dark{--body-color:rgba(255 255 255 / 0.75);--background-color:#191b1f;--main-color:#fff;--link-color:rgba(255 255 255 / 0.9);--border-top-color:#2b2f36;--nav-background:rgba(25 27 31 / 0.4);--nav-border-color:rgba(255 255 255 / 0.05);--header-color:#0a0b0c;--header-after:#191b1f;--header-before:rgba(0 0 0 / 0.6);--author-border:#1a1c20;--home-header-color:rgba(255 255 255 / 0.9);--home-header-border-bottom:#272a30;--header-author-link:rgba(255 255 255 / 0.75);--no-image-border:#3b4049;--strong-font-weight:500;--anchor-color:#2071f3;--anchor-secondary-color:#90a2aa;--loader-color:hsl(230 40% 90% / 0.8);--loader-color2:hsl(230 40% 90% / 0.2);--image-border-color:hsl(230 6% 23%);--image-border-color__dark:hsl(230 6% 23%);--post-card-title:rgba(255 255 255 / 0.85);--post-card-description:#768086;--post-card-by-line:rgba(255 255 255 / 0.75);--strong-color:#f2f2f2;--figcaption-color:rgba(255 255 255 / 0.6);--table-first-of-type:linear-gradient(
        to right,
        #191b1f 50%,
        #191b1f 100%
      );--table-last-of-type:linear-gradient(270deg, #191b1f 50%, rgb(25 27 31));--table-th-background:#2b2f36;--table-th-border:var(--table-th-background);--tag-background:#1f2125;--tag-boxshadow:#090f1a;--post-full-border:#3b4049;--post-full-meta-link:rgb(255 255 255 / 0.75);--post-full-meta-link-hover:#fff;--post-full-title:rgb(255 255 255 / 0.9);--highlight-background:rgb(32 36 39);--highlight-border:none;--pre-code-color:#c9d1d9;--little-code-background:rgb(96 98 100 / 0.4);--little-code-border:none;--prism-background:rgb(0 0 0 / 0.4);--prism-border-left:#818181;--about-box-shadow:10px 20px 20px hsl(0 0 0 / 0.3);--post-card-opacity:0.6;--post-card-background:rgb(0 0 0 / 0.3);--post-card-after-opacity:0.1;}html,body{font-family:Pretendard,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;}a{color:var(--anchor-color);-webkit-text-decoration:none;text-decoration:none;background-color:transparent;}a:hover{-webkit-text-decoration:underline;text-decoration:underline;}a:active,a:hover{outline:0;}ol,ul{max-width:100%;padding-left:1.3em;list-style:none;}blockquote,q{quotes:none;}blockquote:before,blockquote:after,q:before,q:after{content:none;}table{border-spacing:0;border-collapse:collapse;}img{max-width:100%;border:0;}*,*:before,*:after{box-sizing:inherit;}b,strong{font-weight:var(--strong-font-weight);}i,em,dfn{font-style:italic;}small{font-size:80%;}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline;}sup{top:-0.5em;}sub{bottom:-0.25em;}mark{background-color:#fdffb6;}code,kbd,pre,samp{font-family:monospace;font-size:1em;}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit;}button{overflow:visible;border:none;}button,select{text-transform:none;}button,html input[type='button'],input[type='reset'],input[type='submit']{cursor:pointer;-webkit-appearance:button;}button[disabled],html input[disabled]{cursor:default;}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0;}input{line-height:normal;}input:focus{outline:none;}input[type='checkbox'],input[type='radio']{box-sizing:border-box;padding:0;}input[type='number']::-webkit-inner-spin-button,input[type='number']::-webkit-outer-spin-button{height:auto;}input[type='search']{box-sizing:content-box;-webkit-appearance:textfield;}input[type='search']::-webkit-search-cancel-button,input[type='search']::-webkit-search-decoration{-webkit-appearance:none;}legend{padding:0;border:0;}textarea{resize:vertical;overflow:auto;}td,th{padding:0;}hr{position:relative;display:block;width:100%;height:1px;margin:2.5em 0 3.5em;padding:0;border:0;border-top:1px solid var(--border-top-color);}audio,canvas,iframe,img,svg,video{vertical-align:middle;}svg:not(:root){overflow:hidden;}fieldset{margin:0;padding:0;border:0;}p,ul,ol,dl,blockquote{margin:0 0 1.5em;}ul{list-style:disc;}ol{list-style:decimal;}ol ol,ul ul,ul ol,ol ul{margin:0.5em 0 1em;}li{margin:0.4em 0;padding-left:0.3em;line-height:1.6em;}dt{float:left;width:120px;margin:0 20px 0 0;font-weight:500;color:#15171A;text-align:right;}dd{margin:0 0 5px;text-align:left;}blockquote{margin:1.5em 0;padding:0 1.6em;border-left:#e5eff5 0.5em solid;}blockquote p{margin:0.8em 0;font-size:1.2em;font-weight:400;}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;font-size:0.9em;opacity:0.8;}blockquote cite{font-weight:700;}blockquote cite a{font-weight:400;}h1,h2,h3,h4,h5,h6{margin-top:0;font-weight:600;line-height:1.15;text-rendering:optimizeLegibility;}h1 a.auto-link,h2 a.auto-link,h3 a.auto-link,h4 a.auto-link,h5 a.auto-link,h6 a.auto-link{box-shadow:none!important;}h1 a.auto-link:hover,h2 a.auto-link:hover,h3 a.auto-link:hover,h4 a.auto-link:hover,h5 a.auto-link:hover,h6 a.auto-link:hover{box-shadow:none!important;}h1 a.auto-link svg,h2 a.auto-link svg,h3 a.auto-link svg,h4 a.auto-link svg,h5 a.auto-link svg,h6 a.auto-link svg{opacity:0;fill:var(--link-color)!important;-webkit-transition:0.25s ease;transition:0.25s ease;}h1:hover a.auto-link svg,h2:hover a.auto-link svg,h3:hover a.auto-link svg,h4:hover a.auto-link svg,h5:hover a.auto-link svg,h6:hover a.auto-link svg{opacity:1;}h1{margin:0 0 0.5em;font-size:5.5rem;font-weight:600;}@media (max-width: 500px){h1{font-size:2.2rem;}}h2{margin:1.5em 0 0.5em;font-size:2.2rem;}@media (max-width: 500px){h2{font-size:1.8rem;}}h3{margin:1.5em 0 0.5em;font-size:1.8rem;font-weight:500;}@media (max-width: 500px){h3{font-size:1.7rem;}}h4{margin:1.5em 0 0.5em;font-size:1.6rem;font-weight:500;}h5{margin:1.5em 0 0.5em;font-size:1.4rem;font-weight:500;}h6{margin:1.5em 0 0.5em;font-size:1.4rem;font-weight:500;}.medium-zoom-overlay{-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);}.gatsby-resp-image-background-image{border-radius:6px;}.gatsby-resp-image-wrapper{margin:40px 0;}@media (max-width: 800px){.gatsby-resp-image-wrapper{width:100%;margin:initial;}}.medium-zoom-image{box-shadow:none!important;}.copyright{font-size:1.4rem;}.copyright a{font-size:inherit;}</style><style data-emotion="css vva9px">.css-vva9px .site-main{margin-top:64px;padding-bottom:4vw;background:var(--background-color);}</style><style data-emotion="css 163jdes">.css-163jdes{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}.css-163jdes .site-main{margin-top:64px;padding-bottom:4vw;background:var(--background-color);}</style><div class="css-163jdes e1xu36er0"><header class="site-header"><style data-emotion="css 1kbvt30">.css-1kbvt30{position:relative;padding:0 5vw;position:fixed;z-index:1000;top:0;right:0;left:0;background:var(--nav-background);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);border-bottom:1px solid var(--nav-border-color);}</style><div class="css-1kbvt30"><style data-emotion="css 8aaawc">.css-8aaawc{width:100%;max-width:1040px;margin:0 auto;}</style><div class="css-8aaawc"><style data-emotion="css tetqay">.css-tetqay{position:relative;z-index:100;overflow-y:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;height:52px;font-size:1.3rem;}</style><nav class="css-tetqay"><style data-emotion="css qxzoul">.css-qxzoul{overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:10px;font-weight:500;text-transform:uppercase;letter-spacing:0.2px;white-space:nowrap;-webkit-overflow-scrolling:touch;-ms-overflow-scrolling:touch;}@media (max-width: 700px){.css-qxzoul{margin-right:0;}}</style><div class="site-nav-left css-qxzoul esgr0m44"><style data-emotion="css yn94hc">.css-yn94hc{position:relative;z-index:100;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:32px;padding:12px 0;font-size:1.7rem;font-weight:700;line-height:1.8rem;color:#fff;text-transform:none;letter-spacing:-0.5px;}.css-yn94hc:hover{-webkit-text-decoration:none;text-decoration:none;}.css-yn94hc img{display:block;width:auto;height:21px;}@media (max-width: 700px){.css-yn94hc{margin-right:18px;}}</style><a class="site-nav-logo css-yn94hc" href="/"><img src="/static/a62d45ddbe29cf42da820a576d9375e1/aef42/alien.png" alt="Pozafly&#x27;s Blog" width="21" height="21"/></a><style data-emotion="css 1xdepn">.css-1xdepn{position:relative;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}</style><div class="css-1xdepn esgr0m43"><style data-emotion="css f30i1v">.css-f30i1v{position:absolute;z-index:1000;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0 0 0 -12px;padding:0;list-style:none;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-f30i1v li{display:block;margin:0;padding:0;}.css-f30i1v li a{position:relative;display:block;padding:10px 12px;font-size:1.2rem;color:var(--main-color);opacity:0.7;-webkit-transition:opacity 0.2s ease-in-out;transition:opacity 0.2s ease-in-out;}@media (max-width: 700px){.css-f30i1v li a{padding:10px 8px;}}.css-f30i1v li a:hover{-webkit-text-decoration:none;text-decoration:none;opacity:1;}.css-f30i1v .nav-current{opacity:1;}</style><ul role="menu" class="css-f30i1v"><li role="menuitem"><a href="/">Home</a></li><li role="menuitem"><a href="/about/">About</a></li><li role="menuitem"><a href="/tags/">Tags</a></li><li role="menuitem"><a href="/tags/diary/">Diary</a></li></ul><style data-emotion="css 289bqd">.css-289bqd{position:absolute;top:10px;-webkit-transform:translateY(175%);-moz-transform:translateY(175%);-ms-transform:translateY(175%);transform:translateY(175%);font-size:1.7rem;font-weight:400;color:var(--main-color);text-transform:none;visibility:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-289bqd .dash{left:-25px;}.css-289bqd .dash:before{content:'- ';opacity:0.5;}@media (max-width: 700px){.css-289bqd{overflow:hidden;max-width:calc(100vw - 126px);text-overflow:ellipsis;white-space:nowrap;}}</style><span class="nav-post-title css-289bqd esgr0m40">Next.js standalone 종속성 추적 삽질기 (feat. pino)</span></div></div><style data-emotion="css 1wxq7hc">.css-1wxq7hc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:0 1 auto;-ms-flex:0 1 auto;flex:0 1 auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}</style><div class="css-1wxq7hc esgr0m42"><style data-emotion="css 150gfpr">.css-150gfpr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (max-width: 700px){.css-150gfpr .not-mobile{display:none;}}</style><div class="css-150gfpr esgr0m41"><style data-emotion="css u4kwjs">.css-u4kwjs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;margin:0;padding:10px;opacity:0.8;-webkit-transition:opacity 0.35s ease;transition:opacity 0.35s ease;}.css-u4kwjs:hover{opacity:1;}.css-u4kwjs svg{height:1.8rem;fill:var(--main-color);-webkit-transition:fill 0.45s ease;transition:fill 0.45s ease;}.css-u4kwjs.is-white svg{fill:#fff;}</style><a class="not-mobile css-u4kwjs" href="https://github.com/pozafly" title="Github" target="_blank" rel="noopener noreferrer"><svg width="21px" height="21px" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"></path></svg></a><style data-emotion="css-global 8o55qm">body .theme-toggler{overflow:hidden;margin:6px;padding:2px;background:transparent;border-radius:50%;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;}body .theme-toggler #switch{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;width:21px;height:21px;padding:0;background:transparent;border:0;}body .theme-toggler .mode{position:relative;width:18px;height:18px;opacity:0.8;background:#000;-webkit-clip-path:path(
          'M17.5306 13.5882C16.6384 13.8558 15.689 14 14.7044 14C9.5004 14 5.28174 9.97061 5.28174 5.00005C5.28174 3.32422 5.76127 1.75538 6.59643 0.411865C2.77326 1.55853 0 4.96994 0 9.00001C0 13.9706 4.21866 18 9.42265 18C12.8721 18 15.8887 16.2296 17.5306 13.5882Z'
        );clip-path:path(
          'M17.5306 13.5882C16.6384 13.8558 15.689 14 14.7044 14C9.5004 14 5.28174 9.97061 5.28174 5.00005C5.28174 3.32422 5.76127 1.75538 6.59643 0.411865C2.77326 1.55853 0 4.96994 0 9.00001C0 13.9706 4.21866 18 9.42265 18C12.8721 18 15.8887 16.2296 17.5306 13.5882Z'
        );border-radius:50%;-webkit-transition:all 0.45s ease;transition:all 0.45s ease;}body .theme-toggler .mode:before{content:'';position:absolute;z-index:-1;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-moz-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:5px;height:5px;opacity:0;background:inherit;border-radius:50%;-webkit-transition:box-shadow 0.4s 0s ease;transition:box-shadow 0.4s 0s ease;}body .theme-toggler .mode:after{content:'';position:absolute;top:-20%;left:30%;width:90%;height:90%;background:rgb(255 255 255 / 1);border-radius:50%;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;}body .theme-toggler .mode:hover{opacity:1;}body .theme-toggler:hover{background:rgb(215 215 215 / 0.9);}body .theme-toggler.is-white .mode{background:#fff;}body .theme-toggler.is-white:hover{background:rgb(215 215 215 / 0.2);}body.dark .theme-toggler{background:transparent;}body.dark .theme-toggler:hover{background:rgb(255 255 255 / 0.1);}body.dark .theme-toggler .mode{-webkit-transform:scale(0.5);-moz-transform:scale(0.5);-ms-transform:scale(0.5);transform:scale(0.5);overflow:initial;opacity:0.8;background:white;-webkit-clip-path:none;clip-path:none;}body.dark .theme-toggler .mode:before{opacity:1;box-shadow:0 -16px 0 0 white,0 16px 0 0 white,-16px 0 0 0 white,16px 0 0 0 white,12px 12px 0 0 white,12px -12px 0 0 white,-12px 12px 0 0 white,-12px -12px 0 0 white;}body.dark .theme-toggler .mode:after{-webkit-transform:translateX(50%) translateY(-50%);-moz-transform:translateX(50%) translateY(-50%);-ms-transform:translateX(50%) translateY(-50%);transform:translateX(50%) translateY(-50%);opacity:0;-webkit-transition:background 0.45s ease;transition:background 0.45s ease;}body.dark .theme-toggler.is-white .mode:before{box-shadow:0 -16px 0 0 white,0 16px 0 0 white,-16px 0 0 0 white,16px 0 0 0 white,12px 12px 0 0 white,12px -12px 0 0 white,-12px 12px 0 0 white,-12px -12px 0 0 white;}</style><button class="theme-toggler " aria-label="theme toggle button" type="button"><div id="switch"><div class="mode"></div></div></button></div></div></nav></div></div></header><style data-emotion="css 1h9yqcb">.css-1h9yqcb{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;position:relative;padding:0 5vw;}</style><main id="site-main" class="site-main css-1h9yqcb"><div class="css-8aaawc"><style data-emotion="css 150a24d">.css-150a24d{position:relative;}</style><article class="css-150a24d"><style data-emotion="css iltggy">.css-iltggy{position:relative;margin:0 auto;padding:70px 100px 50px;word-break:keep-all;border-top-left-radius:3px;border-top-right-radius:3px;}@media (max-width: 1170px){.css-iltggy{padding:60px 11vw 50px;}}@media (max-width: 800px){.css-iltggy{padding-right:5vw;padding-left:5vw;}}@media (max-width: 500px){.css-iltggy{padding:20px 0 35px;}}</style><header class="post-full-header css-iltggy edf4ga72"><style data-emotion="css 1njwbu9">.css-1njwbu9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;font-size:1.2rem;font-weight:600;line-height:1.4em;color:#738a94;}.css-1njwbu9 a{font-size:1.2rem;color:var(--anchor-secondary-color);}</style><section class="post-full-tags css-1njwbu9 emmlh0d3"><a href="/tags/next-js/">Next.js</a>,  <a href="/tags/dev-ops/">DevOps</a></section><style data-emotion="css 18a1ftz">.css-18a1ftz{margin:0 0 0.2em;color:var(--post-full-title);word-break:keep-all;}@media (max-width: 500px){.css-18a1ftz{margin-top:0.2em;font-size:3.3rem;}}</style><h1 class="post-full-title css-18a1ftz edf4ga71">Next.js standalone 종속성 추적 삽질기 (feat. pino)</h1><style data-emotion="css d62skr">.css-d62skr{margin:20px 0 0;font-size:2rem;font-weight:300;line-height:1.4em;color:var(--post-card-description);}@media (max-width: 500px){.css-d62skr{font-size:1.9rem;line-height:1.5em;}}</style><p class="post-full-custom-excerpt css-d62skr emmlh0d2">Next.js를 standalone 모드로 빌드하면서 종속성 누락 문제를 겪었다. @vercel/nft의 정적 추적 방식, pnpm의 심볼릭 링크 구조, 그리고 pino-pretty를 포함해 종속성이 빠지는 이유와 해결 과정을 기록한다.</p><style data-emotion="css sglr6c">.css-sglr6c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:35px 0 0;padding-top:15px;border-top:1px solid var(--post-full-border);}.css-sglr6c .post-full-byline-content{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}.css-sglr6c .post-full-byline-content .author-list{-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;padding:0 12px 0 0;}.css-sglr6c .post-full-byline-meta{margin:2px 0 0;font-size:1.4rem;line-height:1.2em;color:#768086;letter-spacing:0.2px;}.css-sglr6c .post-full-byline-meta .author-name{margin:0 0 3px;font-size:1.4rem;font-weight:500;line-height:1.3em;}.css-sglr6c .post-full-byline-meta .author-name a{font-size:13px;color:var(--post-full-meta-link);}.css-sglr6c .post-full-byline-meta .author-name a:hover{color:var(--post-full-meta-link-hover);}.css-sglr6c .post-full-byline-meta .byline-reading-time,.css-sglr6c .post-full-byline-meta .byline-meta-date,.css-sglr6c .post-full-byline-meta .byline-modified-time{font-size:13px;}.css-sglr6c .post-full-byline-meta .bull{display:inline-block;margin:0 4px;opacity:0.6;}</style><div class="post-full-byline css-sglr6c emmlh0d1"><section class="post-full-byline-content"><style data-emotion="css 12fmpzj">.css-12fmpzj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 0 0 4px;padding:0;list-style:none;}</style><ul class="author-list css-12fmpzj emmlh0d0"><style data-emotion="css 4q5div">.css-4q5div{position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin:0;padding:0;}.css-4q5div:hover .author-name-tooltip{-webkit-transform:translate(-10px, -2px);-moz-transform:translate(-10px, -2px);-ms-transform:translate(-10px, -2px);transform:translate(-10px, -2px);opacity:1;}</style><li class="author-list-item css-4q5div e13xkhp00"><style data-emotion="css aezf96">.css-aezf96{overflow:hidden;display:block;width:40px;height:40px;margin:0 -4px;border:2px solid var(--author-border);border-radius:100%;}@media (max-width: 500px){.css-aezf96{width:36px;height:36px;}}</style><a class="author-avatar css-aezf96" href="/about/"><style data-emotion="css 1ip6e3z">.css-1ip6e3z{display:block;width:100%;height:100%;object-fit:cover;background:var(--background-color);border-radius:100%;}.css-1ip6e3z img{border-radius:100%;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper author-profile-image css-1ip6e3z"><div aria-hidden="true" style="padding-top:100%"></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#6808f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/ae5f4/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/87ddd/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/2988d/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/8c061761f263c344f2c0416607c8adf1/b9493/pozafly.jpg" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/5e3dc/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/d18de/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/b9493/pozafly.jpg 120w" alt="Pozafly"/></picture><noscript><picture><source type="image/webp" srcSet="/static/8c061761f263c344f2c0416607c8adf1/ae5f4/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/87ddd/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/2988d/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/8c061761f263c344f2c0416607c8adf1/b9493/pozafly.jpg" srcSet="/static/8c061761f263c344f2c0416607c8adf1/5e3dc/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/d18de/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/b9493/pozafly.jpg 120w" alt="Pozafly"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a></li></ul><section class="post-full-byline-meta"><div class="author-name"><a href="/about/">Pozafly</a></div><div class="byline-meta-content"><time class="byline-meta-date" dateTime="2025-09-12"> <!-- -->2025-09-12</time><span class="byline-reading-time"><span class="bull">•</span>13 min read</span></div></section></section></div></header><style data-emotion="css 1y1xnji">.css-1y1xnji{width:80%;max-height:800px;margin:25px auto 100px;-webkit-background-size:cover;background-size:cover;}.css-1y1xnji .image-wrapper{overflow:hidden;width:100%;border:1px solid var(--image-border-color);border-radius:8px;}.css-1y1xnji .image-wrapper img{border-radius:8px;}@media (max-width: 1170px){.css-1y1xnji .image-wrapper img{max-width:1170px;}}@media (max-width: 800px){.css-1y1xnji{width:100%;margin:25px auto 60px;}}</style><figure class="css-1y1xnji e16cwxex1"><div class="image-wrapper"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:56.23931623931624%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIDBQb/xAAXAQADAQAAAAAAAAAAAAAAAAABAwQF/9oADAMBAAIQAxAAAAHLjx3ZaFkFf//EABsQAAICAwEAAAAAAAAAAAAAAAECAAMREhQh/9oACAEBAAEFAnPpxLKyWM2PeyKZ/8QAGREBAAIDAAAAAAAAAAAAAAAAAQARAyFR/9oACAEDAQE/AQsvkM+p/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEDITH/2gAIAQIBAT8BwcNn/8QAHBAAAgIDAQEAAAAAAAAAAAAAAAERIgIhYTFB/9oACAEBAAY/AvkrRaxL2+GXGxYTWBN+n//EAB0QAQEAAgEFAAAAAAAAAAAAAAERACFRMXGx8PH/2gAIAQEAAT8hQSRqcHvOJg1Xj7iMcnQnepcnQqo9rk0NG4pn/9oADAMBAAIAAwAAABAk3//EABoRAQACAwEAAAAAAAAAAAAAAAEAEUGBkfD/2gAIAQMBAT8QsBgvIYC325//xAAaEQEAAgMBAAAAAAAAAAAAAAABABEhMaHw/9oACAECAQE/EEtnShGtXuT/xAAdEAEAAgICAwAAAAAAAAAAAAABETEAIVFhQXGR/9oACAEBAAE/EHrGtYOYOz0hMlN9gGSoMzSG+omMYigShQ1UmEShCIkAdarWAQjFuFX5d/KrF4U1SjU6eAz/2Q==" alt=""/><picture><source type="image/avif" data-srcset="/static/0152e08f5e4324b47115749c8231fdb1/b400f/main.avif 500w,/static/0152e08f5e4324b47115749c8231fdb1/4ec68/main.avif 800w,/static/0152e08f5e4324b47115749c8231fdb1/d4b7e/main.avif 1170w" sizes="100vw"/><source type="image/webp" data-srcset="/static/0152e08f5e4324b47115749c8231fdb1/d4cbf/main.webp 500w,/static/0152e08f5e4324b47115749c8231fdb1/03a08/main.webp 800w,/static/0152e08f5e4324b47115749c8231fdb1/63766/main.webp 1170w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/0152e08f5e4324b47115749c8231fdb1/bb4aa/main.jpg" data-srcset="/static/0152e08f5e4324b47115749c8231fdb1/a5dc9/main.jpg 500w,/static/0152e08f5e4324b47115749c8231fdb1/7f0a0/main.jpg 800w,/static/0152e08f5e4324b47115749c8231fdb1/bb4aa/main.jpg 1170w" alt="Next.js standalone 종속성 추적 삽질기 (feat. pino)"/></picture><noscript><picture><source type="image/avif" srcSet="/static/0152e08f5e4324b47115749c8231fdb1/b400f/main.avif 500w,/static/0152e08f5e4324b47115749c8231fdb1/4ec68/main.avif 800w,/static/0152e08f5e4324b47115749c8231fdb1/d4b7e/main.avif 1170w" sizes="100vw"/><source type="image/webp" srcSet="/static/0152e08f5e4324b47115749c8231fdb1/d4cbf/main.webp 500w,/static/0152e08f5e4324b47115749c8231fdb1/03a08/main.webp 800w,/static/0152e08f5e4324b47115749c8231fdb1/63766/main.webp 1170w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/0152e08f5e4324b47115749c8231fdb1/bb4aa/main.jpg" srcSet="/static/0152e08f5e4324b47115749c8231fdb1/a5dc9/main.jpg 500w,/static/0152e08f5e4324b47115749c8231fdb1/7f0a0/main.jpg 800w,/static/0152e08f5e4324b47115749c8231fdb1/bb4aa/main.jpg 1170w" alt="Next.js standalone 종속성 추적 삽질기 (feat. pino)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><style data-emotion="css 2cqlea">.css-2cqlea{max-width:728px;margin:10px auto;font-size:12px;text-align:center;}.css-2cqlea a,.css-2cqlea span{font-size:12px;color:var(--anchor-secondary-color);}@media (max-width: 800px){.css-2cqlea{font-size:11px;}.css-2cqlea a,.css-2cqlea span{font-size:11px;}}</style><figcaption class="css-2cqlea e16cwxex0">Background photo by <a href="https://unsplash.com/ko/@loganvoss" target="_blank" rel="noreferrer">Logan Voss</a> <!-- -->on<!-- --> <a href="https://unsplash.com" target="_blank" rel="noreferrer">Unsplash</a></figcaption></figure><style data-emotion="css 13di0oz">.css-13di0oz *:not(pre)>code[class*='language-']{border-radius:0.3em;background:var(--little-code-background);border:1px solid var(--little-code-border);color:var(--main-color);padding:0.15em 0.5em;white-space:normal;font-size:13px;}@media (max-width: 800px){.css-13di0oz *:not(pre)>code[class*='language-']{display:inline;}}.css-13di0oz .gatsby-highlight-code-line{display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;border-left:0.25em solid var(--prism-border-left);font-size:1.4rem;background-image:linear-gradient(90deg, var(--prism-background) 60%, rgba(0, 0, 0, 0) 100%),none!important;}.css-13di0oz .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:var(--highlight-background);box-shadow:inset 0 0 0 1px var(--highlight-border);-webkit-overflow-scrolling:touch;overflow:auto;}.css-13di0oz .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.4rem;line-height:24px;}.css-13di0oz pre[class*='language-'],.css-13di0oz code[class*='language-']{color:var(--pre-code-color);text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-13di0oz pre[class*='language-']::-webkit-scrollbar,.css-13di0oz code[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-13di0oz pre[class*='language-']::-webkit-scrollbar-thumb,.css-13di0oz code[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-13di0oz pre[class*='language-'],.css-13di0oz code[class*='language-']{display:inline-block;}}.css-13di0oz pre[class*='language-']{overflow:auto;}.css-13di0oz .token{font-size:1.4rem;}.css-13di0oz pre[data-line]{padding:1em 0 1em 3em;position:relative;}@media print{.css-13di0oz pre[class*='language-'],.css-13di0oz code[class*='language-']{text-shadow:none;}}.css-13di0oz pre[class*='language-']{padding:1em;overflow:auto;margin:0;}.css-13di0oz:not(pre)>code[class*='language-']{padding:0.1em 0.3em;border-radius:0.3em;color:#c9d1d9;background:#343942;}.css-13di0oz pre[data-line]{position:relative;}.css-13di0oz pre[class*='language-']>code[class*='language-']{position:relative;z-index:1;}.css-13di0oz .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#2f2a1e;box-shadow:inset 5px 0 0 #674c16;z-index:0;pointer-events:none;line-height:inherit;white-space:pre;}.css-13di0oz .namespace{opacity:0.7;}.css-13di0oz .token.comment,.css-13di0oz .token.prolog,.css-13di0oz .token.doctype,.css-13di0oz .token.cdata{color:#8b949e;}.css-13di0oz .token.punctuation{color:#c9d1d9;}.css-13di0oz .token.property,.css-13di0oz .token.tag,.css-13di0oz .token.boolean,.css-13di0oz .token.number,.css-13di0oz .token.constant,.css-13di0oz .token.symbol,.css-13di0oz .token.deleted{color:#79c0ff;}.css-13di0oz .token.selector,.css-13di0oz .token.attr-name,.css-13di0oz .token.string,.css-13di0oz .token.char,.css-13di0oz .token.builtin,.css-13di0oz .token.inserted{color:#a5d6ff;}.css-13di0oz .token.operator,.css-13di0oz .token.entity,.css-13di0oz .token.url,.css-13di0oz .language-css .token.string,.css-13di0oz .style .token.string{color:#a5d6ff;}.css-13di0oz .token.atrule,.css-13di0oz .token.attr-value,.css-13di0oz .token.keyword{color:#a5d6ff;}.css-13di0oz .token.function{color:#d2a8ff;}.css-13di0oz .token.regex,.css-13di0oz .token.important,.css-13di0oz .token.variable{color:#a8daff;}.css-13di0oz .token.important,.css-13di0oz .token.bold{font-weight:bold;}.css-13di0oz .token.italic{font-style:italic;}.css-13di0oz .token.entity{cursor:help;}</style><style data-emotion="css 1x2k2ne">.css-1x2k2ne{position:relative;min-height:230px;margin:0 auto;padding:0 100px 6vw;font-size:2rem;line-height:1.6em;background:var(--background-color);border-radius:6px;}.css-1x2k2ne .no-image{padding-top:0;}.css-1x2k2ne h1,.css-1x2k2ne h2,.css-1x2k2ne h3,.css-1x2k2ne h4,.css-1x2k2ne h5,.css-1x2k2ne h6,.css-1x2k2ne p,.css-1x2k2ne ul,.css-1x2k2ne ol,.css-1x2k2ne dl,.css-1x2k2ne pre,.css-1x2k2ne blockquote,.css-1x2k2ne .post-full-comments,.css-1x2k2ne .footnotes{min-width:100%;margin:0 0 1.5em;}.css-1x2k2ne li>ul,.css-1x2k2ne li>ol{margin:0;}.css-1x2k2ne li{word-break:break-word;}.css-1x2k2ne li p{margin:0;}.css-1x2k2ne a[class*='image'],.css-1x2k2ne a[class*='image']:hover{box-shadow:none;}.css-1x2k2ne a[class*='image'] span[class*='image'],.css-1x2k2ne a[class*='image']:hover span[class*='image']{border-radius:6px;}.css-1x2k2ne strong,.css-1x2k2ne em{color:var(--strong-color);}.css-1x2k2ne small{display:inline-block;line-height:1.6em;}.css-1x2k2ne img,.css-1x2k2ne video{display:block;max-width:840px;height:auto;margin:2em auto;border:1px solid var(--image-border-color);border-radius:8px;}.css-1x2k2ne hr+p{margin-top:1.2em;}.css-1x2k2ne img[src$='#full']{width:100vw;max-width:none;}.css-1x2k2ne img+br+small{display:block;margin-top:-3em;margin-bottom:1.5em;text-align:center;}.css-1x2k2ne iframe{margin:10px auto 20px;}.css-1x2k2ne blockquote{margin:0 0 1.5em;padding:0 1.5em;border-left:3px solid var(--image-border-color);}.css-1x2k2ne blockquote p{margin:0 0 1em;font-size:inherit;font-style:italic;line-height:inherit;color:inherit;}.css-1x2k2ne blockquote p:last-child{margin-bottom:0;}.css-1x2k2ne code{padding:0 5px 2px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:0.8em;font-weight:400!important;line-height:1em;border-radius:3px;}.css-1x2k2ne p code{word-break:keep-all;}.css-1x2k2ne pre{overflow-x:auto;max-width:100%;padding:20px;font-size:1.4rem;line-height:1.5em;color:#e5eff5;border-radius:5px;}.css-1x2k2ne pre code{padding:0;font-size:inherit;line-height:inherit;background:transparent;}.css-1x2k2ne pre code :not(span){color:inherit;}.css-1x2k2ne .fluid-width-video-wrapper{margin:1.5em 0 3em;}.css-1x2k2ne hr{margin:2em 0;}.css-1x2k2ne h1,.css-1x2k2ne h2,.css-1x2k2ne h3,.css-1x2k2ne h4,.css-1x2k2ne h5,.css-1x2k2ne h6{color:var(--home-header-color);}.css-1x2k2ne h1{margin:0.5em 0 0.4em;font-size:4.2rem;font-weight:600;line-height:1.25em;}.css-1x2k2ne p+h1{margin-top:0.8em;}.css-1x2k2ne h2{margin:1.2em 0 0.6em;font-size:3.4rem;font-weight:600;line-height:1.25em;}.css-1x2k2ne p+h2{margin-top:0.8em;}.css-1x2k2ne h3{margin:1rem 0 0.2em;padding-top:1.8rem;font-size:2.6rem;font-weight:600;line-height:1.3em;}.css-1x2k2ne h2+h3{margin-top:0.7em;}.css-1x2k2ne h4{margin:1em 0 0.2em;font-size:2rem;font-weight:800;}.css-1x2k2ne h2+h4{margin-top:0.7em;}.css-1x2k2ne h3+h4{margin-top:0;}.css-1x2k2ne h5{display:block;margin:0.5em 0;font-size:1.8rem;font-weight:600;line-height:1.35em;border:0;}.css-1x2k2ne h6{margin:0.5em 0 0.2em;font-size:2rem;font-weight:700;}.css-1x2k2ne table{overflow-x:auto;display:inline-block;border-spacing:0;border-collapse:collapse;width:auto;max-width:100%;margin:0.5em 0 2.5em;font-size:1.6rem;white-space:nowrap;vertical-align:top;background:radial-gradient(ellipse at left, rgb(0 0 0 / 0.2) 0%, rgb(0 0 0 / 0) 75%) 0 center,radial-gradient(ellipse at right, rgb(0 0 0 / 0.2) 0%, rgb(0 0 0 / 0) 75%) 100% center;background-repeat:no-repeat;background-attachment:scroll,scroll;-webkit-background-size:10px 100%,10px 100%;background-size:10px 100%,10px 100%;-webkit-overflow-scrolling:touch;}.css-1x2k2ne table th{font-size:1.2rem;font-weight:700;color:var(--home-header-color);text-align:left;text-transform:uppercase;letter-spacing:0.2px;background-color:var(--table-th-background);}.css-1x2k2ne table th,.css-1x2k2ne table td{padding:6px 12px;border:var(--table-th-border) 1px solid;}.css-1x2k2ne table td:first-of-type{background-image:var(--table-first-of-type);background-repeat:no-repeat;-webkit-background-size:20px 100%;background-size:20px 100%;}.css-1x2k2ne table td:last-child{background-image:var(--table-last-of-type);background-repeat:no-repeat;-webkit-background-position:100% 0;background-position:100% 0;-webkit-background-size:20px 100%;background-size:20px 100%;}.css-1x2k2ne figcaption{color:var(--figcaption-color);}@media (max-width: 1170px){.css-1x2k2ne{padding:0 11vw;}}@media (max-width: 800px){.css-1x2k2ne{padding:0 5vw;font-size:1.8rem;}}@media (max-width: 500px){.css-1x2k2ne{padding:0;}}@media (max-width: 500px){.css-1x2k2ne .post-full-custom-excerpt{font-size:1.9rem;line-height:1.5em;}}@media (max-width: 500px){.css-1x2k2ne p,.css-1x2k2ne ul,.css-1x2k2ne ol,.css-1x2k2ne dl,.css-1x2k2ne pre,.css-1x2k2ne .post-full-comments,.css-1x2k2ne .footnotes{margin-bottom:1.28em;}}@media (max-width: 1040px){.css-1x2k2ne img,.css-1x2k2ne video{width:100%;}}@media (max-width: 500px){.css-1x2k2ne blockquote{padding:0 1.3em;}}@media (max-width: 800px){.css-1x2k2ne h1{font-size:3.2rem;line-height:1.25em;}.css-1x2k2ne h2{margin:0.5rem 0 0.3em;font-size:2.8rem;line-height:1.25em;}.css-1x2k2ne h3{margin:0.5rem 0 0.3em;font-size:2.4rem;line-height:1.3em;}.css-1x2k2ne h4{margin-bottom:0.3em;font-size:1.8rem;line-height:1.3em;}.css-1x2k2ne h5{max-width:1060px;padding:0 0 0.5em;font-size:2.4rem;text-align:initial;}.css-1x2k2ne h6{font-size:1.8rem;line-height:1.4em;}}.css-1x2k2ne *:not(pre)>code[class*='language-']{border-radius:0.3em;background:var(--little-code-background);border:1px solid var(--little-code-border);color:var(--main-color);padding:0.15em 0.5em;white-space:normal;font-size:13px;}@media (max-width: 800px){.css-1x2k2ne *:not(pre)>code[class*='language-']{display:inline;}}.css-1x2k2ne .gatsby-highlight-code-line{display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;border-left:0.25em solid var(--prism-border-left);font-size:1.4rem;background-image:linear-gradient(90deg, var(--prism-background) 60%, rgba(0, 0, 0, 0) 100%),none!important;}.css-1x2k2ne .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:var(--highlight-background);box-shadow:inset 0 0 0 1px var(--highlight-border);-webkit-overflow-scrolling:touch;overflow:auto;}.css-1x2k2ne .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.4rem;line-height:24px;}.css-1x2k2ne pre[class*='language-'],.css-1x2k2ne code[class*='language-']{color:var(--pre-code-color);text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1x2k2ne pre[class*='language-']::-webkit-scrollbar,.css-1x2k2ne code[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-1x2k2ne pre[class*='language-']::-webkit-scrollbar-thumb,.css-1x2k2ne code[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-1x2k2ne pre[class*='language-'],.css-1x2k2ne code[class*='language-']{display:inline-block;}}.css-1x2k2ne pre[class*='language-']{overflow:auto;}.css-1x2k2ne .token{font-size:1.4rem;}.css-1x2k2ne pre[data-line]{padding:1em 0 1em 3em;position:relative;}@media print{.css-1x2k2ne pre[class*='language-'],.css-1x2k2ne code[class*='language-']{text-shadow:none;}}.css-1x2k2ne pre[class*='language-']{padding:1em;overflow:auto;margin:0;}.css-1x2k2ne:not(pre)>code[class*='language-']{padding:0.1em 0.3em;border-radius:0.3em;color:#c9d1d9;background:#343942;}.css-1x2k2ne pre[data-line]{position:relative;}.css-1x2k2ne pre[class*='language-']>code[class*='language-']{position:relative;z-index:1;}.css-1x2k2ne .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#2f2a1e;box-shadow:inset 5px 0 0 #674c16;z-index:0;pointer-events:none;line-height:inherit;white-space:pre;}.css-1x2k2ne .namespace{opacity:0.7;}.css-1x2k2ne .token.comment,.css-1x2k2ne .token.prolog,.css-1x2k2ne .token.doctype,.css-1x2k2ne .token.cdata{color:#8b949e;}.css-1x2k2ne .token.punctuation{color:#c9d1d9;}.css-1x2k2ne .token.property,.css-1x2k2ne .token.tag,.css-1x2k2ne .token.boolean,.css-1x2k2ne .token.number,.css-1x2k2ne .token.constant,.css-1x2k2ne .token.symbol,.css-1x2k2ne .token.deleted{color:#79c0ff;}.css-1x2k2ne .token.selector,.css-1x2k2ne .token.attr-name,.css-1x2k2ne .token.string,.css-1x2k2ne .token.char,.css-1x2k2ne .token.builtin,.css-1x2k2ne .token.inserted{color:#a5d6ff;}.css-1x2k2ne .token.operator,.css-1x2k2ne .token.entity,.css-1x2k2ne .token.url,.css-1x2k2ne .language-css .token.string,.css-1x2k2ne .style .token.string{color:#a5d6ff;}.css-1x2k2ne .token.atrule,.css-1x2k2ne .token.attr-value,.css-1x2k2ne .token.keyword{color:#a5d6ff;}.css-1x2k2ne .token.function{color:#d2a8ff;}.css-1x2k2ne .token.regex,.css-1x2k2ne .token.important,.css-1x2k2ne .token.variable{color:#a8daff;}.css-1x2k2ne .token.important,.css-1x2k2ne .token.bold{font-weight:bold;}.css-1x2k2ne .token.italic{font-style:italic;}.css-1x2k2ne .token.entity{cursor:help;}</style><section class="post-full-content css-1x2k2ne edf4ga70"><div class="post-content"><p>Next.js를 실행하면 클라이언트 측 로그는 브라우저의 콘솔에 나타나지만, 서버 측 로그는 제대로 된 로그를 출력해주지 않았다. 이번에 프로젝트에 Next.js의 node 환경에서 log를 찍기 위해 라이브러리를 사용하면서 만난 트러블슈팅을 기록한다.</p>
<p>먼저 <a href="https://github.com/pinojs/pino" target="_blank" rel="nofollow">pino</a>라는 라이브러리를 사용했는데, pino는 node 진영에서 <a href="https://github.com/winstonjs/winston" target="_blank" rel="nofollow">winston</a>과 함께 많이 사용되는 로깅 라이브러리다. 짧게 이야기하면 로깅 라이브러리는 비동기를 사용하는 pino로 결정. 그리고 <a href="https://github.com/pinojs/pino-pretty" target="_blank" rel="nofollow">pino-pretty</a> 라이브러리는 pino로 찍은 로그를 더 알아보기 쉬운 형태로 포매팅 해주는 도구다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 847px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 78.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAABmklEQVR42o2TCY7jIBBFfY60AS9hX2yM8R47mfsfaopE6R5p1N3+khEYXvELiowxbq2zzgmlpJTKGMoZynN8Qtk4juuyhanvYrMs64ef8nZA0iIqfodDCMd+d4MX3nRdQE1ENuD6ign5HQarIfQ1oyW7Qgq4polE6JRtzvkyz8KogkEEhq4Mn1bGGGu910KwsqSUEdi5rE/DnIFto5QFnjFSXXFZnYUvl0sf4zTP1jU8XdLHK2H0TvvVIU8Vb72GGcEEpo0xwzj2cQh9bNo29D1EhDYOSWBNKagAq7WGldAXySZPcJ7n8O92HPt+rOt22/dtS+1+HPfHH2ghkHMOKgj2RP8ogw+cQ7AnABEgxO3+eKxpfOtCku86l5LiwFNKv3IWUlhjuVG14lppIhThqqgqyA+m86c+0/6vSJQEg8t941ZKIXOuEJOptt8n99Npw5PY1rWfVhuWxlksNQJet8h4THm6NlJ8CzdNCxUWhimMq/ctlibBxqci5xoBX3wPxxiXeWmHwfRxmiYET0popBwyLZIGV/UP5v8C3XGMVSiCtPMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="pino-pretty-formatting"
        title=""
        src="/static/7d887646d34bf30c82ed744634c1a64c/ba37d/pino-pretty-formatting.png"
        srcset="/static/7d887646d34bf30c82ed744634c1a64c/b30f8/pino-pretty-formatting.png 500w,
/static/7d887646d34bf30c82ed744634c1a64c/ba37d/pino-pretty-formatting.png 847w"
        sizes="(max-width: 847px) 100vw, 847px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>pino를 Next.js 프로젝트에 예쁘게 입혔지만 포맷이 마음에 들지 않았기 때문에 pino-pretty 라이브러리를 추가로 설치하고 프로젝트에 설정해주었다.</p>
<p>로컬에서 두 도구를 사용해 API Routes, SSR 측 fetching API 로그를 콘솔에서 확인 후에 테스트를 해보기 위해 테스트 서버로 올렸다. 하지만, 로컬에선 멀쩡히 예쁘게 찍히던 pino 로그가 테스트 서버로 올리자마자 아래 에러와 함께 /500 페이지로 이동했다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">error: unable to determine transport target for "pino-pretty"</code></pre></div>
<p>처음에는 <strong>설정이 틀렸나?</strong> 했다가, 한참을 돌아보니 Next.js의 standalone 빌드 방식 + pino의 transport 로딩 구조 + pnpm의 심볼릭 링크 특성이 합쳐져 터진 문제였다. 일단 pino 설정 코드부터 보자.</p>
<br/>
<h2 id="pino-설정-코드" style="position:relative;">pino 설정 코드<a href="#pino-%EC%84%A4%EC%A0%95-%EC%BD%94%EB%93%9C" aria-label="pino 설정 코드 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> pino <span class="token keyword">from</span> <span class="token string">'pino'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">pino</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// level 등은 생략</span>
  transport<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    target<span class="token operator">:</span> <span class="token string">'pino-pretty'</span><span class="token punctuation">,</span></span>    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      colorize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      translateTime<span class="token operator">:</span> <span class="token string">'SYS:HH:MM:ss'</span><span class="token punctuation">,</span>
      customColors<span class="token operator">:</span> <span class="token string">'err:red,info:blue'</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token punctuation">(</span>isLocal <span class="token operator">?</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token punctuation">{</span> singleLine<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>pino는 transport 옵션을 줄 수 있는데, 로그를 전송하고 변환할 수 있게 해줄 수 있는 옵션이다. 포매팅을 넣고 싶다면 <code class="language-text">target</code> 에 적어줄 수 있다(<a href="https://github.com/pinojs/pino/blob/main/docs/transports.md#pino-pretty" target="_blank" rel="nofollow">공식 문서</a>).</p>
<p>target에 문자열로 pino-pretty를 적어주는 방법이다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1005px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 10.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiElEQVR42j2Myw6CMADA/A8vHowmajLGNmAMgjwlICCI//8plXjw0KS9dCd0iMsq2udEWjSY9IPLB/L6QT/OxHWPV7/Q9YDfrui8Q4cxKkqQgUWFbnOHtgkX4bPbH46cbx7jsjLMb7Ky5F41FE1HNy1M8zYJIjwVIJVBSIM0dpvFP7RN/326Cr600EQo2nz5KwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="pretty-log"
        title=""
        src="/static/b111cfde7499f70a1c7c6eb5bf2cc100/66ac9/pretty-log.png"
        srcset="/static/b111cfde7499f70a1c7c6eb5bf2cc100/b30f8/pretty-log.png 500w,
/static/b111cfde7499f70a1c7c6eb5bf2cc100/332ff/pretty-log.png 1000w,
/static/b111cfde7499f70a1c7c6eb5bf2cc100/66ac9/pretty-log.png 1005w"
        sizes="(max-width: 1005px) 100vw, 1005px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>위 사진과 같이 이 방법으로 로컬에서 문제 없이 동작했다. 하지만, 테스트 서버에서의 로그는 unable to determine transport target for “pino-pretty” 라고 에러를 뱉고 있었다. (물론 빌드도 문제 없이 성공했다)</p>
<p>처음엔 몇 가지 해결책을 시도해봤다.</p>
<ol>
<li>devDependencies → dependencies로 승격</li>
</ol>
<p>pino-pretty 라이브러리는 운영에 배포되면 안되겠다는 가벼운 생각 때문에 devDependencies로 설치했지만, 생각해보니 코드 모두 운영에 올라가야 맞다는 생각으로 dependencies로 옮겨주었다. 여전히 해결되지 않았다.</p>
<ol start="2">
<li>import로 라이브러리 가져오기</li>
</ol>
<p>문자열로 선언해서 라이브러리를 가져오지 못할 것이라 예상해서 아래 코드와 같이 먼저 import 구분으로 가져왔다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> pinoPretty <span class="token keyword">from</span> <span class="token string">'pino-pretty'</span><span class="token punctuation">;</span></span>
transport<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  target<span class="token operator">:</span> pinoPretty<span class="token punctuation">,</span></span>  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>프로젝트는 package.json에 type module을 통해 프로젝트 전체를 ESM으로 사용하고 있었기 때문에 import 구문이 문제가 없을 것이라 생각했지만,</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">⨯ TypeError: The "path" argument must be of type string. Received function build
    at eval (src/shared/server/common/config/loggerConfig.ts:15:20)
    ...
> 15 | const logger = pino({
     |                    ^
  17 |   transport: {
  18 |     target: pinoPretty, {
  code: 'ERR_INVALID_ARG_TYPE',</code></pre></div>
<p>이런 에러가 발생했다. ERR_INVALID_ARG_TYPE 에러는 Node.js에서 함수나 메서드에 넘긴 인자의 타입이 예상한 타입과 다를 때 발생하는 에러인데, path에 function 타입 대신 string 타입을 넣어야 한다는 뜻이다.</p>
<p>node_modules에 있는 pino-pretty/index.js 파일을 까보았다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">build</span> <span class="token punctuation">(</span><span class="token parameter">opts <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pretty <span class="token operator">=</span> <span class="token function">prettyFactory</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">abstractTransport</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>default <span class="token operator">=</span> build</code></pre></div>
<p>역시 pino 및 pino-pretty는 Node.js 서버 환경에서 주로 사용하는 라이브러리라 그런지 CommonJS 형태로 작성되어 있다.</p>
<p>default로 export 하는 것은 함수다. 따라서 공식문서에서 권장하는 대로 string 값인 ‘pino-pretty’ 를 적어주는게 맞았던 것이다. CommonJs 문법으로 작성된 걸 보니 혹시나 싶어 require로 가져오도록 해봤지만 여전히 해결되지 않았다.</p>
<p>왜 로컬에서는 동작하고, 테스트 서버 환경에서는 동작하지 않는지 곰곰이 생각해보니 Next.js를 standalone으로 배포하고 있다는게 떠올랐다.</p>
<br/>
<h2 id="Nextjs의-standalone-빌드" style="position:relative;">Next.js의 standalone 빌드<a href="#Nextjs%EC%9D%98-standalone-%EB%B9%8C%EB%93%9C" aria-label="Nextjs의 standalone 빌드 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p><a href="https://nextjs.org/docs/pages/api-reference/config/next-config-js/output#automatically-copying-traced-files" target="_blank" rel="nofollow">Next.js output 공식문서</a>에 따르면 standalone은 node_modules에서 프로덕션 배포에 필요한 파일만 복사하는 방식을 사용한다.</p>
<p>즉, 어플리케이션을 실행하는데 필요한 최소한의 코드만 node_modules에 가져가고, 이는 빌드 시 <code class="language-text">.next/standalone</code> 하위에 저장하고 사용하겠다는 뜻이다. 즉, 사용하지 않은 코드 및 모듈은 모두 트리쉐이킹 되어 artifact에 포함되지 않는다. 그러면 docker image에 파일크기가 적은 상태로 빌드 되고, image 용량이 줄기 때문에 빌드 시간 및 EKS에 도달하는 속도도 획기적으로 줄일 수 있게 된다.</p>
<p>테스트 서버에서 pino-pretty 모듈을 찾지 못했기 때문에 standalone으로 빌드된 artifact에 pino-pretty가 없을 것 같았다. 얼른 빌드해 보았다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAC4jAAAuIwF4pT92AAACPElEQVR42p1U2XLaQBDUX+Qh5tItrW4JcQkbYxOwTdnYVEHsVPL/f9GZGRBPJEZ+aFaUVr3TM72t6baCqRIU0ztYfgwvKmAHKTqm9yVohhvCIoL79RaOnwihRWtLd75G2LZ82KaLb49bmNtfUH6EIB/DT0q0DZfQkLBDhD16iGYLxLdLWG4EJ8ykSt0JBI0Iu0xoeZg97lAtNnCon+lgiiAbIirGiPIRuC1c7UWETHZlhNg/p9i/Vug6Kfy4DzfMZQMf2LBCD991hf1Lgd/vS/TcjAaTwQmyYw/d5pJ1R2F4v0E+XcEmySFJjfsTkktrMaEqVYOh0E+PPlBpH3k1g+nFUh2De2d4UcMpMyGZ26Dpzp8/qKKx9NAjsBeverasjEvkE6Er1jBViMWuQtQvyTa5ENrqMCA/OeCSaZ8kG57Cw/st0uGI5B4JSbZLN4fJ+P/FhGJu28fweoXV9kP6xv5jL7ILasmdyyQfvMYhEfbHEhImEbpRLiu/Y9LPiHgOvPdUoUF9DMgi8/Ub+TBHkA5kU0u3P5XJ77kdPAuNZXSljx7K6zvcPLzAIuuEJJmHw7IdSqN2LfkM+J3ceypA0x1iJsuwvMHND7rTrzIIvse8KqqUr6Fuc1CE/4RJYcIe1ryj50KqZP70hvXuD5Jyinw0kwizyDqcPvW+s6CDWYkiaPVtsAglDaRaPElFh4DI5Jk/kH3/AcedSYmv1Q3v0WDG8xWWm590aoG4nIjcpKwocIenoDiHVt1DJ8Bf1qRSuQXrE3AAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="standalone-artifact-not-pino-pretty"
        title=""
        src="/static/e8889878404084c700358eafec662579/a331c/standalone-artifact-not-pino-pretty.png"
        srcset="/static/e8889878404084c700358eafec662579/b30f8/standalone-artifact-not-pino-pretty.png 500w,
/static/e8889878404084c700358eafec662579/a331c/standalone-artifact-not-pino-pretty.png 800w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>역시나 <code class="language-text">.next/standalone/node_modules</code> 에서 pino-pretty는 찾을 수 없었다. 원인을 찾았으니 이제 해결만 하면 된다. .next/standalone/node_modules에 pino-pretty 모듈만 넣어줄 수 있다면 문제는 해결 될 것이다.</p>
<h3 id="outputFileTracingIncludes" style="position:relative;">outputFileTracingIncludes<a href="#outputFileTracingIncludes" aria-label="outputFileTracingIncludes permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><a href="https://nextjs.org/docs/pages/api-reference/config/next-config-js/output#caveats" target="_blank" rel="nofollow">공식문서</a>에 따르면 next.config.js 파일에 outputFileTracingIncludes 설정을 하면 추적에 필요한 파일을 standalone으로 빌드한 artifact에 포함시켜줄 수 있다고 한다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// next.config.js</span>
<span class="token literal-property property">outputFileTracingIncludes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'/'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./node_modules/pino-pretty/**/*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>위와 같이 현재 로컬에 있는 <code class="language-text">./node_modules/pino-pretty</code> 디렉토리를 찾아 하위에 있는 파일을 모두 artifact에 넣도록 설정한다.
그리고 다시 빌드.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 688px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 38.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFElEQVR42pWS2U7DMBBF/R+gpFkcZ3HsLE4TpymUggCBEIuEhJD4/8+4jI3Ux7Y8HM2D7aN7R2ZysLj7+IJZ9mjttUdocyBvhn/BeNXC3jzCbHao2tEj6o7okdFMy8aTlPosWJQWWG9vsdm/IhEKsp2gOgttZpRqQBDluFxxhHF+FiziFYkkdu8ThmWGkIakI3ihUTUjSj3QXCPKJAL3KCmOwsK0hJMuTyN6OyHOFEl7pCTMaQrZIaf6K7oXRMJLj8GcNeIlZLPF/ds3BO3UJXKCi5BT3cxzKh2nPbs3PmFCdZSxuHp4oYMWhTK0hhpprn111+BU1ZjuHyrHJDT0XZ4/f7ys7iafUvWWmL38VMK0+Ev4C+oo72TEtpHoAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="get-pino-pretty"
        title=""
        src="/static/a3205c6acc94483a883158927cab50c9/d21f0/get-pino-pretty.png"
        srcset="/static/a3205c6acc94483a883158927cab50c9/b30f8/get-pino-pretty.png 500w,
/static/a3205c6acc94483a883158927cab50c9/d21f0/get-pino-pretty.png 688w"
        sizes="(max-width: 688px) 100vw, 688px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>드디어 잘 들어왔다.</p>
<br/>
<h2 id="다시-문제-발생" style="position:relative;">다시 문제 발생<a href="#%EB%8B%A4%EC%8B%9C-%EB%AC%B8%EC%A0%9C-%EB%B0%9C%EC%83%9D" aria-label="다시 문제 발생 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>기대하는 마음을 안고 다시 테스트 서버로 배포해봤다. 하지만 이번엔 에러 메시지가 바뀌었다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">uncaughtException: [Error: Cannot find module 'colorette']</code></pre></div>
<p><code class="language-text">colorette</code>는 뭐지? 프로젝트에서는 사용하지 않는 라이브러리다. 아마도 pino-pretty의 내부 종속성이 아닐까? pino-pretty/index.js에서 사용하고 있는 모듈이었다. 그러면 next.config.js에 <code class="language-text">outputFileTracingIncludes</code> 에 pino-pretty에서 사용하고 있는 모듈을 넣어주면 그만이다.</p>
<p>종속성을 파악해보자.</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh"><span class="token function">node</span> <span class="token parameter variable">-e</span> <span class="token string">"console.log(Object.keys(require('pino-pretty/package.json').dependencies || {}))"</span></code></pre></div>
<div class="gatsby-highlight has-highlighted-lines" data-language="text"><pre class="language-text"><code class="language-text">[
<span class="gatsby-highlight-code-line">  'colorette',</span>  'dateformat',
  'fast-copy',
  'fast-safe-stringify',
  'help-me',
  'joycon',
  'minimist',
  'on-exit-leak-free',
  'pino-abstract-transport',
  'pump',
  'readable-stream',
  'secure-json-parse',
  'sonic-boom',
  'strip-json-comments'
]</code></pre></div>
<p>하위 종속성이 꽤 많다. 프로젝트는 <a href="https://pnpm.io/ko/" target="_blank" rel="nofollow">pnpm</a>을 사용하고 있으므로, colorette를 포함한 하위 종속성은 로컬의 <code class="language-text">node_modules/.pnpm</code> 디렉토리 하위에 저장된다. 따라서 해당 경로를 찾아 artifact에 포함시켜야 한다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token literal-property property">outputFileTracingIncludes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'/'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'./node_modules/pino-pretty/**/*'</span><span class="token punctuation">,</span>
    <span class="token string">'./node_modules/.pnpm/pino-pretty@*/*'</span><span class="token punctuation">,</span>
    <span class="token string">'./node_modules/.pnpm/pino-pretty@*/node_modules/**'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 684px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 161.20000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAABYlAAAWJQFJUiTwAAADE0lEQVR42p1WWVIiURDkHjOiQu97P6CBZpNFFtGYCC8w33P/A+RUFrbBOGg8+SjoVjrJrMyqR+vei+DGOeaHX0jKAaK8jzDrod313+vWCayrxReC9icPKEdT+EmBIDVwwkwqRVfqzg217AHlw6aeo149C0iOtDeUGiExQwSZwU3H07IG5Ld3/BgPrxWqxVhY9hAVA3hxIW2okPXGiOXeGvDWCVV2va2F5QpuVGgvKZ2gnrTBjTIr2QrYfpOdljVm2xd0gwSpGQnoAD/vXfy4c/Sdsttd70ujWs3FnRuh6wvL1Q7lcKbsWGRK9yk9lZ6Gcu+npR1gR2Sb6QPyuoaTlPDlYVci5EkF0kMa5Mnfu0FqAaigCZLcw+8/K5SSzVF/CJMWWn0zQNqvhZ350vFWE94buYkcD8Z1cTwcsV1uUIYxhqVBVRjUmcSp6+InHzwL/cd6Z9gWU2LHx8BxcFhtsF8sUUUJpgTLDeZZhtLzBTBUNRY9DMVtiY9cL/cvmD8+IZTmZ0bMEEPi/JRNyxwG/2Rs+njEaLmVGS+0ZzTCF0Osc3gOSDn1ao/hfKOh1vgIGGNzBSD742MhkuvNAUFiZPP0deziopLZrnTGzWim+bwU8IsMxxLuaraWccvfA87Raz7HMf2M7QWGASabJ+nhTpZEqUaEYgjl2+zGi4DznUheH3TxxtI7Mv3W+vpPsrCraIowZP+4wbkwbp1rGW6f1WkyiwoxRZbDOUvLbXMu+VklcwmQnZ4z0kc6zG3DTU5jTuvMt8zhYqNnCo1pnNZto2Ev9cxhG/il545/yTAgWHYauaQc6sJt2JJlLtuHppGtBeD+NCkC2ABwDC9tGAvJO5XMMFMmJ8YTU2zOlU8ZTmT0PMkhx4294rly03EvGmERm6OOH6NCqVl/rO7ScS4JXluO3ptk6V9FlxkbNeF0MPE4ZU/p/LdmWUdPJPPB+I2RToy803Ey5jFrzXAikTnlMFOHdUmQpbzfe/E1s7zFYL5WZymR8VHA1Fzn8vrlVZcsf4nRFMptfppw/Cg3H9T6v4+AfwE6SrV9+DZ0yQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="include-colorette"
        title=""
        src="/static/276e208c7641fcd28e086616ec75092c/bf424/include-colorette.png"
        srcset="/static/276e208c7641fcd28e086616ec75092c/b30f8/include-colorette.png 500w,
/static/276e208c7641fcd28e086616ec75092c/bf424/include-colorette.png 684w"
        sizes="(max-width: 684px) 100vw, 684px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>하지만 여전히 테스트 서버에서는 실패한다. 이상하다. 생각해보면 pino-pretty가 <strong>로컬</strong>에서 내부적으로 모듈을 사용할 때 require 문법으로 모듈을 가져올텐데, <code class="language-text">.pnpm</code> 하위 모듈을 어떻게 가져올 수 있을까?</p>
<br/>
<h2 id="pnpm의-node_modules-저장-방식" style="position:relative;">pnpm의 node_modules 저장 방식<a href="#pnpm%EC%9D%98-node_modules-%EC%A0%80%EC%9E%A5-%EB%B0%A9%EC%8B%9D" aria-label="pnpm의 node_modules 저장 방식 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>모든 프로젝트에서 단말기 저장장치의 효율 및 속도 때문에 <a href="https://pnpm.io/ko/" target="_blank" rel="nofollow">pnpm</a> 을 패키지 매니저로 사용하고 있다.</p>
<p>node_modules는 일반적으로 flat(hoisted) 구조로 패키지에서 사용하는 종속성 하위 구조 모두 flat하게 저장하지만, pnpm은 심볼릭 링크를 통해 전역의 pnpm store에 저장된 모듈을 단순히 연결시켜주는 역할을 하고 있다.</p>
<blockquote>
<p>만약 패키지 매니저의 설치 매커니즘을 조금 더 깊게 알고 싶다면 아래의 블로그를 보면 도움이 될 것이다.</p>
<ul>
<li><a href="https://toss.tech/article/node-modules-and-yarn-berry" target="_blank" rel="nofollow">node_modules로부터 우리를 구원해 줄 Yarn Berry - toss</a></li>
<li><a href="https://engineering.ab180.co/stories/yarn-to-pnpm" target="_blank" rel="nofollow">Yarn 대신 pnpm으로 넘어간 3가지 이유 - ab180</a></li>
</ul>
</blockquote>
<p>기본적으로 node.js는 require 구문을 만나면 루트를 기준으로 node_modules를 찾고, 없으면 상위로 올라가며 탐색한다. (require(‘pkg’) → ./node_modules/pkg → ../node_modules/pkg … )
그리고 .pnpm은 현재 모듈의 파일 위치에서 시작해, 상위로 올라가며 node_modules/&#x3C;이름> 을 찾는다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">project/
└─ node_modules/
   ├─ pino-pretty  ->  .pnpm/pino-pretty@X.Y.Z/node_modules/pino-pretty   (심링크)
   └─ .pnpm/
      ├─ pino-pretty@X.Y.Z/
      │  └─ node_modules/
      │     └─ pino-pretty/
      │        └─ index.js   &lt;-- 여기서 require('colorette') 호출
      └─ colorette@A.B.C/
         └─ node_modules/
            └─ colorette/</code></pre></div>
<p>따라서, <strong>로컬</strong>에서 import(require) 구문으로 모듈을 가져오는건 해당 모듈(pino-pretty)를 찾고, 없으면 project/node_modules 에서 관련 모듈(colorette)을 찾아서 가져오는 형태다.</p>
<p>즉,</p>
<ul>
<li>pino-pretty/index.js가 require(‘colorette’)를 호출하면,</li>
<li>node.js는 먼저 현재 모듈 경로 기준으로 <code class="language-text">../node_modules/colorette</code>를 찾고,</li>
<li>pnpm이 만들어 둔 심링크를 따라가서 <code class="language-text">.pnpm/colorette@A.B.C/node_modules/colorette</code>를 로드함.</li>
</ul>
<p><strong>테스트 서버</strong>로 넘어가보자.</p>
<p>지금 빌드 artifact는 <code class="language-text">.next/standalone/node_modules/pino-pretty</code>가 설치되었고 그 안에, index.js에서 <code class="language-text">require('colorette')</code> 하고 있다. colorette는 <code class="language-text">.next/standalone/node_modules/.pnpm/pino-pretty@10.3.1/node_modules/colorette</code> 에 존재한다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">.next/
└─ standalone/
   └─ node_modules/
      ├─ pino-pretty -> .pnpm/pino-pretty@X.Y.Z/node_modules/pino-pretty     (심링크)
      ├─ .pnpm/
      │  └─ pino-pretty@X.Y.Z/
      │     └─ node_modules/
      │        └─ pino-pretty/
      │           ├─ /node_modules
      │           │   └─ colorette@X.Y.Z       &lt;--  못찾음
      │           └─ index.js   &lt;-- 여기서 require('colorette')
      └─ (여기 colorette 관련 항목 없음)  ← ← ←  ⚠ MODULE_NOT_FOUND</code></pre></div>
<p>즉, 하위 모듈을 가져가진 했지만, 디렉토리 구조 상 찾을 수 없었다.</p>
<p>그렇다면, pnpm으로 패키지 설치 시 npm과 yarn과 같이 심볼링 링크 형태가 아니라 flat 구조로 설치하고 종속성을 가지고 들어가면 되지 않을까? 여기서 그냥 GitHub Actions에서 pnpm으로 설치한 node_modules 전체를 artifact에 포함시킬까도 고민했지만 비효율이 발생하므로 그러고 싶지 않았다.</p>
<br/>
<h2 id="pnpm의-node-linker" style="position:relative;">pnpm의 node-linker<a href="#pnpm%EC%9D%98-node-linker" aria-label="pnpm의 node linker permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>pnpm도 npm과 yarn과 마찬가지로 flat하게 설치할 수 있다. pnpm의 <a href="https://pnpm.io/settings#nodelinker" target="_blank" rel="nofollow">node-linker</a> 에서 <code class="language-text">hoisted</code> 설정을 해주면 심볼릭 링크 대신 flat한 구조로 설치해준다.</p>
<p>로컬에서 확인할 때는 <code class="language-text">.npmrc</code> 파일을 프로젝트 root에 만들고 아래와 같이 적어주자.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">node-linker=hoisted</code></pre></div>
<p>그리고 <code class="language-text">pnpm install</code> 로 패키지를 다시 설치해주면 flat 구조로 node_modules가 구성되었고, 종속성 모두 새롭게 설치된 것을 볼 수 있다.</p>
<p>하지만, 이렇게 hoisted 모드를 사용하게 되면 pnpm을 사용하는 이유가 사라진다. 글로벌 store의 의미는 퇴색된다(물론 다른 장점도 있긴 하지만..). 그래서 로컬 환경은 hoisted 모드를 사용하지말도록 .npmrc 파일을 지운다. 대신, GitHub Actions에서만 hoisted 모드를 사용하도록 한다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pnpm hoisted linker setting
  <span class="token key atrule">run</span><span class="token punctuation">:</span> pnpm config set node<span class="token punctuation">-</span>linker hoisted <span class="token punctuation">-</span><span class="token punctuation">-</span>location=project</code></pre></div>
<p>이제는 <code class="language-text">.pnpm</code> 하위 디렉토리를 만들지 않을 것이므로 next.config.js 설정을 다시 바꿔주도록 하자.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token literal-property property">outputFileTracingIncludes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'/'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'./node_modules/pino-pretty/**/*'</span><span class="token punctuation">,</span>
    <span class="token comment">// 그리고 하위 종속성 모두를 포함하는 경로를 다 적어주어야 함.</span>
    <span class="token string">'./node_modules/colorette/**/*'</span><span class="token punctuation">,</span>
    <span class="token comment">// 등등</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>문제는, 하위 종속성 모두 다 적어주어야 한다는 것이다. 그리고 하위 종속성의 하위 종속성까지.. 의존성 트리 전체를 다 들고와야 한다. 그리고 pino-pretty를 업데이트라도 하는 날에는 다시 모든 의존성 트리를 검색하고, 설치한 다음 다시 들고 들어가야한다.</p>
<p>그러면, 다시 원래대로 돌아와서 의존성 트리를 손수 관리해야 하는 문제에 봉착하게 되는 것이다. 현실적으로 pino-pretty를 프로젝트 서비스가 종료될 때까지 버전을 고정하지 않는 이상 불가능하다. 무조건 Next.js에서 빌드할 때 자동으로 추척하도록 만들어 하위 트리를 묶어 들어갈 수 있도록 조치해야만 한다.</p>
<br/>
<h2 id="Nextjs-standalone-모드에서-의존성-트리를-추적하는-방법" style="position:relative;">Next.js standalone 모드에서 의존성 트리를 추적하는 방법<a href="#Nextjs-standalone-%EB%AA%A8%EB%93%9C%EC%97%90%EC%84%9C-%EC%9D%98%EC%A1%B4%EC%84%B1-%ED%8A%B8%EB%A6%AC%EB%A5%BC-%EC%B6%94%EC%A0%81%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95" aria-label="Nextjs standalone 모드에서 의존성 트리를 추적하는 방법 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>기본적으로 번들러는 <code class="language-text">import</code> 및 <code class="language-text">require</code> 구문을 찾고 구문이 만약 node_modules에 존재한다면 해당 모듈을 빌드 artifact로 복사한다. Next.js standalone 모드에서의 추적은 <a href="https://github.com/vercel/nft" target="_blank" rel="nofollow">@vercel/nft</a> 라이브러리가 담당하고 있다.</p>
<p>문서를 들여다보면, 상용 번들러와 마찬가지로 <code class="language-text">import</code>, <code class="language-text">require</code> 등을 추적하고 있다. 우리가 Next.js를 patch-package 해서 사용하지 않는 이상 고치는 것은 유지보수에 힘들 것이다(Next.js는 아주 잦은 업데이트가 있기 때문에…).</p>
<p>결국 Next.js에서 제대로 pino-pretty를 추적하도록 만들어줘야만 한다.</p>
<p>@vercel/nft는 의존성 트리를 어떻게 추적할까? 먼저 파일을 AST로 파싱해서 ‘정적’ 참조를 따라간다. 용어 정리를 해보자.</p>
<h3 id="1-정적static-동적dynamic-import" style="position:relative;">1. 정적(static), 동적(dynamic) import<a href="#1-%EC%A0%95%EC%A0%81static-%EB%8F%99%EC%A0%81dynamic-import" aria-label="1 정적static 동적dynamic import permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<h4 id="정적-import" style="position:relative;">정적 import<a href="#%EC%A0%95%EC%A0%81-import" aria-label="정적 import permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./bar.js'</span><span class="token punctuation">;</span></code></pre></div>
<p>from절 뒤에 리터럴로 패키지를 명확하게 명시.</p>
<h4 id="동적-import" style="position:relative;">동적 import<a href="#%EB%8F%99%EC%A0%81-import" aria-label="동적 import permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>import 함수를 사용하여 파일 상단이 아닌 조건부로 패키지를 가져온다.</p>
<blockquote>
<p><a href="https://tc39.es/proposal-dynamic-import/" target="_blank" rel="nofollow">ECMAScript proposal</a>: import() 에서 import()를 dynamic import라고 부름.</p>
</blockquote>
<h3 id="2-정적-참조Statically-analyzable-reference-동적-참조Dynamic-reference" style="position:relative;">2. 정적 참조(Statically analyzable reference), 동적 참조(Dynamic reference)<a href="#2-%EC%A0%95%EC%A0%81-%EC%B0%B8%EC%A1%B0Statically-analyzable-reference-%EB%8F%99%EC%A0%81-%EC%B0%B8%EC%A1%B0Dynamic-reference" aria-label="2 정적 참조Statically analyzable reference 동적 참조Dynamic reference permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<h4 id="정적-참조" style="position:relative;">정적 참조<a href="#%EC%A0%95%EC%A0%81-%EC%B0%B8%EC%A1%B0" aria-label="정적 참조 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<p>공식 용어는 아니지만, 번들러에서 쓰는 개념.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 정적 참조</span>
<span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'pino-pretty'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ 정적 참조</span></code></pre></div>
<p>소스 코드에서 모듈 경로가 <strong>문자열 리터럴로 고정</strong>되어 있어 빌드 타임에 추적 가능한 참조.</p>
<h4 id="동적-참조" style="position:relative;">동적 참조<a href="#%EB%8F%99%EC%A0%81-%EC%B0%B8%EC%A1%B0" aria-label="동적 참조 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> name <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LIB</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ❌ 빌드 시 추적 불가</span>
<span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ❌ 빌드 시 추적 불가</span></code></pre></div>
<p>따라서 정적 import와 동적 import는 ‘정적 참조’ 이므로(리터럴 문자열로 패키지명을 적었으므로) 번들러 및 nft가 추적이 가능하다.
하지만, pino-pretty는 왜 동적참조인가?</p>
<p>pino-pretty를 사용하는 pino 라이브러리를 살짝 까보자.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// node_modules/pino/lib/transport.js</span>
<span class="token keyword">function</span> <span class="token function">fixTarget</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> filePath <span class="token keyword">of</span> callers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      <span class="token keyword">const</span> context <span class="token operator">=</span> filePath <span class="token operator">===</span> <span class="token string">'node:repl'</span> <span class="token operator">?</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> sep <span class="token operator">:</span> filePath<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">      fixTarget <span class="token operator">=</span> <span class="token function">createRequire</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span></span>      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fixTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">unable to determine transport target for "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>origin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> fixTarget<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>createRequire는 Node.js의 함수로, 특정 파일/디렉토리 경로를 기준으로 require.resolve를 수행할 수 있게 해준다. 결국 이건 Node의 모듈 해석 알고리즘을 따르고 있다.</p>
<p>즉, ‘pino-pretty’ 를 문자열로 적어주면 <code class="language-text">require.resolve('pino-pretty')</code> 가 되어 node_modules/pino-pretty 디렉토리를 찾아 절대 경로를 반환하게 된다. 하지만, 변수로 ‘pino-pretty’ 라는 문자열을 만들어냈으므로 이는 <strong>동적 참조</strong>이고, @vercel/nft가 추적하지 못하게 된 것이다.</p>
<p>결국 우리에게 필요한건, 코드 베이스에 <code class="language-text">import pinoPretty from 'pino-pretty'</code> 또는 <code class="language-text">import(pino-pretty)</code> 이다.</p>
<br/>
<h2 id="해결-방법" style="position:relative;">해결 방법<a href="#%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95" aria-label="해결 방법 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>허무하지만 정말 간단하다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> pino <span class="token keyword">from</span> <span class="token string">'pino'</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_APP_ENV</span> <span class="token operator">!==</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'pino-pretty'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span>
<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">pino</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">transport</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'pino-pretty'</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>테스트 서버 및 운영 서버에서 동적 import를 사용해서 ‘정적 참조’ 시키면 된다.</p>
<div class="gatsby-highlight" data-language="mermaid"><pre class="language-mermaid"><code class="language-mermaid"><span class="token keyword">flowchart</span> TD
  <span class="token keyword">classDef</span> bad <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#ffe6e6<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#ff4d4f<span class="token punctuation">,</span><span class="token property">color</span><span class="token operator">:</span>#a8071a</span><span class="token punctuation">;</span>
  <span class="token keyword">classDef</span> good <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#e6fffb<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#36cfc9<span class="token punctuation">,</span><span class="token property">color</span><span class="token operator">:</span>#006d75</span><span class="token punctuation">;</span>

  A1<span class="token text string">["transport.target: 'pino-pretty' ← 문자열"]</span> <span class="token arrow operator">--></span> B<span class="token text string">["Next build (standalone)"]</span>
  A2<span class="token text string">["await import('pino-pretty') ← 리터럴"]</span> <span class="token arrow operator">--></span> B<span class="token text string">["Next build (standalone)"]</span>

  B <span class="token arrow operator">--></span><span class="token label property">|target 문자열만 있음|</span> C<span class="token text string">["@vercel/nft 정적 추적 실패&lt;br/>- 리터럴 import 없음(변수처리 되어 resolve)&lt;br/>- 추적 누락"]</span>
  B <span class="token arrow operator">--></span><span class="token label property">|리터럴 import 있음|</span> C2<span class="token text string">["@vercel/nft 정적 추적 성공&lt;br/>- pino-pretty 의존성 포함"]</span>

  C <span class="token arrow operator">--></span> D<span class="token text string">[".next/standalone/node_modules&lt;br/>- pino: O&lt;br/>- pino-pretty: X&lt;br/>- deps: X"]</span>
  C2 <span class="token arrow operator">--></span> D2<span class="token text string">[".next/standalone/node_modules&lt;br/>- pino: O&lt;br/>- pino-pretty: O&lt;br/>- deps: O"]</span>

  D <span class="token arrow operator">--></span> E<span class="token text string">["런타임: transport 로드&lt;br/>require('pino-pretty') 시도"]</span>
  D2 <span class="token arrow operator">--></span> E2<span class="token text string">["런타임: transport 로드&lt;br/>require('pino-pretty') 성공"]</span>

  E <span class="token arrow operator">--></span> F<span class="token text string">["에러: unable to determine transport target for 'pino-pretty'"]</span>
  E2 <span class="token arrow operator">--></span> F2<span class="token text string">["예쁜 로그 정상 출력"]</span>

  <span class="token keyword">class</span> F bad<span class="token punctuation">;</span>
  <span class="token keyword">class</span> F2 good<span class="token punctuation">;</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 996px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 123.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAABYlAAAWJQFJUiTwAAADjklEQVR42pVV2VIaURDlJ1JJjEJYZAeBGZaBGRiGfRlQQFTc0LLykpQxeciiptS8J2pp1If4rSfd14IyVSkDD1137jC37zl9ug+WdNZAodJAudZAWq9A1laRVItoLnbQbC0hptfgy9YQylEUlxChNRyVEU2k4Q1FEY4lEFc0SMkMfOEYLDaXFylNx2BriHZ3BflyHeV6C9VGG73VdXT6a6i1OjA7y8joRZEoEk9BVlQEKTEnSqSzBCIHT2ABFn4wyjXUzEWo+SqkTA+pbIkS9FBvtpEsmQgbJqKFJoJGC37FgJcOeoIRigX4FyT4CCknFwmtTg/doAk05lIPeukBYbHaQKPdEQhTWl58w6HQs5xSESOkjE7J5gVCLV9EWErAohDdUt3EYq+PXLEJSe3TRyX0VtawSCgjuQqcqQJccaKUM+GRM/D4Q1SvKByeAOb9YUIZgzf4sBcI+cYW1ahCFI1yQ4iULZTR7Q8I4QBVKke7t4p8pQklV0BK1ameBUTjCjI5A3qxgnyJRCOBLK9eu6BSsbtETTNKcPmCQjX+kFUMRmSqTxx+UtDqcGPG5gSf4ZijPa8vrU7xnvdCZUaZoZvr1CZcguWVAT59/oJKwxQfWZ1uzNrnwd++nveN4197kXCWDpVqphCFi87vuMBSMk03u0Sy0YH/xRihwxMUtej2V4Ugbappa6mL/to6dKrnpEktI9gv5hxY39zG3d0dzs/PcXV1hcvLS7F/+26f6uSYPCHXiZs0LCXhpjbwUtOOwkfhpHZgFhNTHiXtLK/g5PQMh0fHODr+Jtazs+9Yp7FkFaeiPEPyt6mRT05P8fXwSCTj9ZQuGGxsT0+Ze47dgg+yAI+Df+dkk9AeI+TmHJAot7e3uLi4EIKMgvc/fv4U88uN/BTScQ2tFIVKHTu7e9jc3sHWcHccQ3q3u/dGTItAO5XKAVI5FBkHmwAjevbKNjllu+hDOza2h7j//RvXv37h5uYG19fXuL+/x/uDj4Kq3e2bZlICyJI5NMkDGzTTHHVymRaNIxvFrBBmitFzeoPCQDnp4+BxjCUUUZaJG5tr9JwoswD/orx/8GG6PmTV2HnZMFWixxRVsjNe2dojchJzLIhI+HRS4djc1JyQaT2YJZkmjRo/jxrdRp5oc/D6tNIWtnKD/jo1WqWkjoDcJitPo0p/BzlCNy9rsMfzsEtZ2NNV2ENxYuT5y1gfxx+2JzPBUDK/dAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="complete-pretty-log"
        title=""
        src="/static/8513faacc23b781eb52a34eb70d3c677/14920/complete-pretty-log.png"
        srcset="/static/8513faacc23b781eb52a34eb70d3c677/b30f8/complete-pretty-log.png 500w,
/static/8513faacc23b781eb52a34eb70d3c677/14920/complete-pretty-log.png 996w"
        sizes="(max-width: 996px) 100vw, 996px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>아주 이쁘다..</p>
<br/>
<h2 id="정리" style="position:relative;">정리<a href="#%EC%A0%95%EB%A6%AC" aria-label="정리 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<h3 id="핵심-개념-1-pino-pino-pretty-그리고-transport-로딩" style="position:relative;">핵심 개념 1: pino, pino-pretty, 그리고 transport 로딩<a href="#%ED%95%B5%EC%8B%AC-%EA%B0%9C%EB%85%90-1-pino-pino-pretty-%EA%B7%B8%EB%A6%AC%EA%B3%A0-transport-%EB%A1%9C%EB%94%A9" aria-label="핵심 개념 1 pino pino pretty 그리고 transport 로딩 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ul>
<li>pino: 빠른 JSON 로거. 기본 출력은 머신 친화적(JSON) 이라서 수집 파이프라인(ELK, Loki, CloudWatch 등)에 좋다.</li>
<li>pino-pretty: pino 로그를 사람이 읽기 좋게 변환해주는 트랜스포트(transport).
<ul>
<li>코드 설정: pino({ transport: { target: ‘pino-pretty’, options: {…} } })</li>
</ul>
</li>
<li>transport target 동작: pino의 transport는 target에 적힌 문자열을 런타임에 require()로 해석한다. -> 동적 참조이다.
<ul>
<li>즉, 서버가 실제로 구동될 때 모듈을 찾는다.</li>
<li>그런데 <strong>구동할 때 찾는다</strong>는 말은, 이미 빌드 산출물에 그 모듈이 들어있어야 한다는 뜻.</li>
</ul>
</li>
</ul>
<p>여기서 Next.js standalone과 충돌이 난다.</p>
<h3 id="핵심-개념-2-Nextjs-standalone과-vercelnft의-정적-추적" style="position:relative;">핵심 개념 2: Next.js standalone과 @vercel/nft의 정적 추적<a href="#%ED%95%B5%EC%8B%AC-%EA%B0%9C%EB%85%90-2-Nextjs-standalone%EA%B3%BC-vercelnft%EC%9D%98-%EC%A0%95%EC%A0%81-%EC%B6%94%EC%A0%81" aria-label="핵심 개념 2 Nextjs standalone과 vercelnft의 정적 추적 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ul>
<li>output: ‘standalone’ 빌드 시, .next/standalone 안에 실행에 필요한 최소 파일만 모여든다.</li>
<li>무엇이 필요한가?를 결정하는 엔진이 [@vercel/nft].
<ul>
<li>빌드할 때 코드를 AST로 파싱해서, 정적으로 판별 가능한 import/require만 따라간다.</li>
<li>포함됨: import ‘x’, import x from ‘x’, require(‘x’), await import(‘x’) (문자열 리터럴)</li>
<li>누락됨: require(‘pino-’ + env), await import(variable) (표현식/변수)</li>
</ul>
</li>
<li>중요한 포인트:
transport.target: ‘pino-pretty’는 런타임 문자열이기 때문에 빌드 타임 정적 추적 대상이 아니다.
→ 그래서 standalone 산출물에 pino-pretty가 안 들어간다.</li>
</ul>
<p>실제로 .next/standalone/node_modules를 보면, pino는 있는데 pino-pretty는 없다는 걸 확인할 수 있다.</p>
<h3 id="핵심-개념-3-pnpm의-구조와-왜-더-까다로워지는지" style="position:relative;">핵심 개념 3: pnpm의 구조와 왜 더 까다로워지는지<a href="#%ED%95%B5%EC%8B%AC-%EA%B0%9C%EB%85%90-3-pnpm%EC%9D%98-%EA%B5%AC%EC%A1%B0%EC%99%80-%EC%99%9C-%EB%8D%94-%EA%B9%8C%EB%8B%A4%EB%A1%9C%EC%9B%8C%EC%A7%80%EB%8A%94%EC%A7%80" aria-label="핵심 개념 3 pnpm의 구조와 왜 더 까다로워지는지 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<ul>
<li>pnpm은 .pnpm 디렉터리에 패키지를 설치하고, node_modules는 심볼릭 링크로 구성한다. (공간 효율 최고)</li>
<li>npm/yarn처럼 flat하게 파일이 쫙 깔리는 게 아니라, 링크 체인을 타고 들어간다.</li>
<li>이 구조는 @vercel/nft의 파일 추적이나, Next의 outputFileTracingIncludes에서 경로 패턴/심볼릭 링크 처리가 까다로워지게 만든다.
→ <strong>겉보기엔 들어온 것 같은데 실행 시점엔 여전히 못 찾는</strong> 상황이 생기기 딱 좋다.</li>
</ul>
<br/>
<h2 id="마치며" style="position:relative;">마치며<a href="#%EB%A7%88%EC%B9%98%EB%A9%B0" aria-label="마치며 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>이번 트러블슈팅을 하며 아무 생각 없이 썼던 import 구문에서 어떤 처리들이 일어나고 있는지를 알게 되었고, standalone 빌드 환경과 pnpm과 Next.js 빌드 관계에 대해 다시 한 번 짚어볼 수 있는 시간이었다. 아직까지도 사용하고 있는 Gatsby도 config 파일에서 문자열로 라이브러리를 등록해 사용하고 있는데, pino와 마찬가지로 리터럴 문자열로 node_modules에 있는 라이브러리를 참조하고 있다는 사실을 추가로 알게 되었다.</p>
<p>참고로, 테스트 서버에서는 pino-pretty를 사용해 로깅하지만 운영 서버에서는 pretty를 실시간성 로그에만 사용하고, pino-pretty를 이용하지 않은 pure log를 파일로 저장해두는 것이 좋을 것 같다.</p>
<p>프로젝트에서 Next.js의 page router를 사용하고 있어 SSR 환경에서의 API fetching이 일어날 때 자동으로 로깅을 남겨주지 않는다.
언젠가 app router로 넘어가게 될텐데, 중요한 부분 및 파일로 로그를 적재해야할 부분은 pino로 남겨두어야겠다.</p>
<p>덧) 사실 <a href="https://www.tomups.com/posts/log-nextjs-request-response-as-json/" target="_blank" rel="nofollow">이런 방법</a>도 있단다..</p></div></section></article><style data-emotion="css lhozv1">.css-lhozv1{position:relative;box-sizing:border-box;width:100%;max-width:760px;margin-right:auto;margin-left:auto;}</style><div class="css-lhozv1"><div></div></div></div></main><style data-emotion="css dcfhc9">.css-dcfhc9{position:relative;padding:0 5vw;}</style><style data-emotion="css 1exn8a1">.css-1exn8a1{background:#0a0b0c;position:relative;padding:0 5vw;}.css-1exn8a1 .post-card{padding-bottom:0;border-bottom:none;}.css-1exn8a1 .post-card:after{display:none;}.css-1exn8a1 .post-card-primary-tag{color:#fff;opacity:0.6;}.css-1exn8a1 .post-card-title{color:#fff;word-break:keep-all;opacity:0.8;-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-1exn8a1 .post-card:hover .post-card-image{opacity:1;}.css-1exn8a1 .post-card-excerpt{color:rgb(255 255 255 / 0.6);}.css-1exn8a1 .static-avatar{border-color:#000;}.css-1exn8a1 .post-card-byline-content{color:rgb(255 255 255 / 0.6);}.css-1exn8a1 .post-card-byline-content a{color:rgb(255 255 255 / 0.8);}.css-1exn8a1 .author-avatar{border-color:#0a0b0c;}.css-1exn8a1 .author-profile-image{background:#0a0b0c;}@media (max-width: 650px){.css-1exn8a1 .post-card{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;margin:25px;padding:25px 0 0;}}</style><aside class="read-next css-1exn8a1 e7ky4j51"><div class="css-8aaawc"><style data-emotion="css 2ud111">.css-2ud111{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 -25px;padding:60px 0 0;}</style><div class="read-next-feed css-2ud111 e7ky4j50"><style data-emotion="css 1ncrsd">.css-1ncrsd{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:0 1 326px;-ms-flex:0 1 326px;flex:0 1 326px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:0 25px 50px;padding:25px;background:linear-gradient(
    #1a1c20,
    #0a0b0c
  );border-radius:12px;}.css-1ncrsd a{-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-1ncrsd a:hover{-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 1170px){.css-1ncrsd{-webkit-flex:1 1 261px;-ms-flex:1 1 261px;flex:1 1 261px;margin-bottom:5vw;}}@media (max-width: 650px){.css-1ncrsd{display:none;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;margin:0 25px;padding:0;background:none;}}</style><article class="read-next-card css-1ncrsd ez817vd4"><header class="read-next-card-header"><style data-emotion="css 18chcim">.css-18chcim{margin:0;font-size:1.3rem;font-weight:300;line-height:1em;color:rgb(255 255 255 / 0.6);letter-spacing:0.4px;}.css-18chcim span,.css-18chcim a{font-size:inherit;}.css-18chcim a{font-weight:500;color:#fff;-webkit-text-decoration:none;text-decoration:none;opacity:0.8;}.css-18chcim a:hover{opacity:1;}</style><h3 class="css-18chcim ez817vd3"><span>More in</span> <a href="/tags/next-js/">Next.js</a></h3></header><style data-emotion="css 1vix6iq">.css-1vix6iq{font-size:1.3rem;}.css-1vix6iq ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:0;padding:0;list-style:none;}.css-1vix6iq li{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;margin:0;padding:20px 0;border-bottom:rgb(255 255 255 / 0.1);}.css-1vix6iq li:last-of-type{padding-bottom:5px;border:none;}.css-1vix6iq h4{margin:0;font-size:1.3rem;font-weight:600;line-height:1.6em;}.css-1vix6iq li a{display:block;font-size:inherit;color:#fff;opacity:0.8;}.css-1vix6iq li a:hover{opacity:1;}</style><div class="read-next-card-content css-1vix6iq ez817vd2"><ul><li><h4><a href="/nextjs/about-modularizing-api-routes-code-in-nextjs/">Next.js의 API Routes 코드 모듈화에 대해서</a></h4><style data-emotion="css 1qhf9t">.css-1qhf9t{margin-top:2px;font-size:1.2rem;font-weight:400;line-height:1.4em;}.css-1qhf9t p{margin:0;font-size:inherit;color:rgb(255 255 255 / 0.6);}.css-1qhf9t p time{font-size:inherit;}</style><div class="read-next-card-meta css-1qhf9t ez817vd1"><p><time dateTime="2023-07-26">2023-07-26</time> -<!-- --> <!-- -->11 min read</p></div></li></ul></div><style data-emotion="css ok4czd">.css-ok4czd{position:relative;margin:40px 0 5px;}.css-ok4czd a{padding:7px 12px 8px 14px;font-size:1.3rem;color:rgb(255 255 255 / 0.6);border:1px solid rgb(255 255 255 / 0.6);border-radius:999px;-webkit-transition:all 0.35s ease-in-out;transition:all 0.35s ease-in-out;}.css-ok4czd a:hover{color:#fecd35;-webkit-text-decoration:none;text-decoration:none;border-color:#fecd35;}</style><footer class="read-next-card-footer css-ok4czd ez817vd0"><a href="/tags/next-js/">See all 2 posts<!-- --> →</a></footer></article><style data-emotion="css 1a2xhz7">.css-1a2xhz7{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 301px;-ms-flex:1 1 301px;flex:1 1 301px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:220px;margin:0 20px 60px;-webkit-background-size:cover;background-size:cover;}.css-1a2xhz7 img{-webkit-transform:scale(1)!important;-moz-transform:scale(1)!important;-ms-transform:scale(1)!important;transform:scale(1)!important;-webkit-transition:opacity 0.3s ease-out 0s,-webkit-transform 0.5s ease 0s!important;transition:opacity 0.3s ease-out 0s,transform 0.5s ease 0s!important;}.css-1a2xhz7:hover .post-card-image:after{opacity:var(--post-card-after-opacity);}.css-1a2xhz7:hover img[data-main-image]{-webkit-transform:scale(1.03)!important;-moz-transform:scale(1.03)!important;-ms-transform:scale(1.03)!important;transform:scale(1.03)!important;}.css-1a2xhz7.is-next .post-card-image{background:#191b1f;border:1px solid var(--image-border-color__dark);}.css-1a2xhz7.is-next .post-card-primary-tag a{color:#90a2aa;}.css-1a2xhz7.is-next .post-card-excerpt{color:#768086;}.css-1a2xhz7.is-next .post-card-byline-content{color:#90a2aa;}</style><article class="post-card is-next css-1a2xhz7"><style data-emotion="css uih3rl">.css-uih3rl{position:relative;overflow:hidden;display:block;border-radius:12px;}</style><a class="post-card-image-link css-uih3rl" href="/html/securely-create-a-pdf-page-with-css/"><style data-emotion="css pg199o">.css-pg199o{overflow:hidden;width:auto;height:200px;background-color:var(--background-color);-webkit-background-size:cover;background-size:cover;border:1px solid var(--image-border-color);border-radius:12px;}.css-pg199o:after{content:'';position:absolute;top:0;left:0;display:block;width:100%;height:100%;opacity:var(--post-card-opacity);background-color:var(--post-card-background);-webkit-transition:all 0.3s ease 0s;transition:all 0.3s ease 0s;}.css-pg199o img{border-radius:12px;}</style><div class="post-card-image css-pg199o ezywgfd6"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:52.5%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKklEQVR42pWT0U7CMBSGu3nFg+iNS9DoAxB9ARIeghm9dO+i0QteQLxAJJAt8CgwE2AjoHZAu0Dy2xYDi+vidvHnpKfnfGn/0xLOObRiDHyzQQyktd3u9jV9JBMmmlgQgPZ6oN3uQWIt8zwDSrJOJpvG5TJGhMA3TPjEUFGux2fnO6io+wtNA9drda3I8zAUzSPDUJC9TFPlo/5A1fHV6h+gKJCF360WJqcWFrd3CK+u8eU4mF5cYmHbmByfgHY6BYEvTcxqNTDXxfLpGZ/3DqKHR7C3NqaWBdp+LwhsvmJWrSpoUKlg2Whgbt9gXq8LPwmo6+UE/npIEx76Qh+lkvDv6ODhIK+HminvByPisPCUk+8wDMU0+ynJfP53mITGsfanyLy0RvdTfgD4wgAkBeu5twAAAABJRU5ErkJggg==" alt=""/><picture><source type="image/webp" data-srcset="/static/39ee9e2452b5c68830fa2ebb9eec0967/17074/main.webp 750w,/static/39ee9e2452b5c68830fa2ebb9eec0967/e4fbc/main.webp 1080w,/static/39ee9e2452b5c68830fa2ebb9eec0967/7d981/main.webp 1200w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/39ee9e2452b5c68830fa2ebb9eec0967/d8bb9/main.png" data-srcset="/static/39ee9e2452b5c68830fa2ebb9eec0967/8c964/main.png 750w,/static/39ee9e2452b5c68830fa2ebb9eec0967/10850/main.png 1080w,/static/39ee9e2452b5c68830fa2ebb9eec0967/d8bb9/main.png 1200w" alt="PDF 페이지 CSS로 안전하게 작성하기 cover image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/39ee9e2452b5c68830fa2ebb9eec0967/17074/main.webp 750w,/static/39ee9e2452b5c68830fa2ebb9eec0967/e4fbc/main.webp 1080w,/static/39ee9e2452b5c68830fa2ebb9eec0967/7d981/main.webp 1200w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/39ee9e2452b5c68830fa2ebb9eec0967/d8bb9/main.png" srcSet="/static/39ee9e2452b5c68830fa2ebb9eec0967/8c964/main.png 750w,/static/39ee9e2452b5c68830fa2ebb9eec0967/10850/main.png 1080w,/static/39ee9e2452b5c68830fa2ebb9eec0967/d8bb9/main.png 1200w" alt="PDF 페이지 CSS로 안전하게 작성하기 cover image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></a><style data-emotion="css z5atxi">.css-z5atxi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="post-card-content css-z5atxi ezywgfd5"><style data-emotion="css 1k7wcu">.css-1k7wcu{margin:15px 0 0.2em;font-size:1.2rem;font-weight:500;color:#90a2aa;letter-spacing:0.2px;}.css-1k7wcu a{font-size:1.2rem;color:var(--anchor-secondary-color);}</style><div class="post-card-primary-tag css-1k7wcu ezywgfd4"><a href="/tags/css/">CSS</a>,  <a href="/tags/html/">HTML</a>,  <a href="/tags/pdf/">PDF</a></div><style data-emotion="css 1fjrpmt">.css-1fjrpmt{position:relative;display:block;color:#15171A;}.css-1fjrpmt:hover{-webkit-text-decoration:none;text-decoration:none;}</style><a class="post-card-content-link css-1fjrpmt" href="/html/securely-create-a-pdf-page-with-css/"><header><style data-emotion="css 18yvs8h">.css-18yvs8h{margin:0 0 0.4em;line-height:1.15em;color:var(--post-card-title);word-break:keep-all;}</style><h2 class="post-card-title css-18yvs8h ezywgfd3">PDF 페이지 CSS로 안전하게 작성하기</h2></header><style data-emotion="css 1uf2vd9">.css-1uf2vd9{font-size:1.6rem;color:var(--post-card-description);}.css-1uf2vd9 p{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;width:100%;margin-bottom:0.4em;font-size:1.4rem;text-overflow:ellipsis;word-break:keep-all;}</style><section class="post-card-excerpt css-1uf2vd9 ezywgfd2"><p>웹을 개발하다 보면, PDF로 문서를 사용자에게 제공하는 기능을 구현해야 할 때가 있다. 다른 개발자분들이 헤매지 않을 수 있도록 정리해 보았다.</p></section></a><style data-emotion="css 143c7df">.css-143c7df{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding:0;}</style><footer class="post-card-meta css-143c7df ezywgfd1"><style data-emotion="css 137vq87">.css-137vq87{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 50%;-ms-flex:1 1 50%;flex:1 1 50%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-weight:400;line-height:1.4em;color:#90a2aa;letter-spacing:0.2px;}.css-137vq87 time{font-size:1.3rem;}.css-137vq87 span{margin:0;font-size:1.3rem;}.css-137vq87 a{font-weight:600;color:var(--post-card-by-line);}</style><div class="post-card-byline-content css-137vq87 ezywgfd0"><span class="post-card-byline-date"><time dateTime="2025-08-30T21:13">2025-08-30</time> <span class="bull">•</span> <span>10 min read</span></span></div></footer></div></article></div></div></aside><style data-emotion="css d4eprp">.css-d4eprp{position:relative;padding:0 5vw;position:relative;padding-top:20px;padding-bottom:22px;color:#fff;background:#000;}</style><footer class="css-d4eprp"><style data-emotion="css 98e3yl">.css-98e3yl{width:100%;max-width:1040px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;font-size:1.3rem;color:rgb(255 255 255 / 0.7);}.css-98e3yl a{color:rgb(255 255 255 / 0.7);}.css-98e3yl a:hover{color:rgb(255 255 255 / 1);-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 650px){.css-98e3yl{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="css-98e3yl"><section class="copyright">© <!-- -->2025<!-- --> <span>|  </span><a href="https://www.gatsbyjs.com/" target="_blank" rel="nofollow noreferrer">Pozafly&#x27;s Blog<!-- --> <!-- -->is based on Gatsby</a></section><style data-emotion="css 13qgqyf">.css-13qgqyf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-13qgqyf a{position:relative;margin-left:20px;font-size:1.3rem;}.css-13qgqyf a:before{content:'';position:absolute;top:11px;left:-11px;display:block;width:2px;height:2px;background:#fff;border-radius:100%;}.css-13qgqyf a:first-of-type:before{display:none;}@media (max-width: 650px){.css-13qgqyf a:first-of-type{margin-left:0;}}</style><nav class="css-13qgqyf e69t7dt0"><a href="/">Latest Posts</a><a href="https://github.com/pozafly" target="_blank" rel="noopener noreferrer">Github</a><a href="/rss.xml">RSS</a></nav></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/nextjs/nextjs-standalone-dependency-tracing-issue/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-54484e1c65ecf944a06f.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-ffdabbb04b36e7b959cd.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-abecc008a895b39ff90b.js\"],\"component---src-pages-tags-tsx\":[\"/component---src-pages-tags-tsx-d03bc5c2220084f6a0ab.js\"],\"component---src-templates-index-tsx\":[\"/component---src-templates-index-tsx-e8ed446a0eab2c50675d.js\"],\"component---src-templates-post-tsx\":[],\"component---src-templates-tags-tsx\":[\"/component---src-templates-tags-tsx-97a6ef03653b3520e40d.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="9c95f289c5097a9ad7ff";</script><script src="/webpack-runtime-7b43c402171a97fdd877.js" async></script><script src="/app-54484e1c65ecf944a06f.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>