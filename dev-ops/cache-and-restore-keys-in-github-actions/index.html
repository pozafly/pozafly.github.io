<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.3"/><meta name="description" content="restore-keys는 기존 캐시가 쓸모없어졌음에도 불구하고 기존 캐시를 불러오는 기능이다. 그렇다면, 무효화 되지 않은 캐시를 어디에 사용해야 하는 것일까?" data-gatsby-head="true"/><meta property="og:site_name" content="Pozafly&#x27;s Blog" data-gatsby-head="true"/><meta property="og:type" content="article" data-gatsby-head="true"/><meta property="og:title" content="GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys)" data-gatsby-head="true"/><meta property="og:description" content="restore-keys는 기존 캐시가 쓸모없어졌음에도 불구하고 기존 캐시를 불러오는 기능이다. 그렇다면, 무효화 되지 않은 캐시를 어디에 사용해야 하는 것일까?" data-gatsby-head="true"/><meta property="og:url" content="https://pozafly.github.io/dev-ops/cache-and-restore-keys-in-github-actions/" data-gatsby-head="true"/><meta property="og:image" content="https://pozafly.github.io/static/365cb7658cd8164573e7796d96f879bc/7b19c/main.webp" data-gatsby-head="true"/><meta property="article:published_time" content="2023-08-22T00:00:00.000Z" data-gatsby-head="true"/><meta property="article:tag" content="DevOps" data-gatsby-head="true"/><meta name="github:card" content="summary_large_image" data-gatsby-head="true"/><meta name="github:title" content="GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys)" data-gatsby-head="true"/><meta name="github:description" content="restore-keys는 기존 캐시가 쓸모없어졌음에도 불구하고 기존 캐시를 불러오는 기능이다. 그렇다면, 무효화 되지 않은 캐시를 어디에 사용해야 하는 것일까?" data-gatsby-head="true"/><meta name="github:url" content="https://pozafly.github.io/dev-ops/cache-and-restore-keys-in-github-actions/" data-gatsby-head="true"/><meta name="github:image" content="https://pozafly.github.io/static/365cb7658cd8164573e7796d96f879bc/7b19c/main.webp" data-gatsby-head="true"/><meta name="github:label1" content="Written by" data-gatsby-head="true"/><meta name="github:data1" content="Pozafly" data-gatsby-head="true"/><meta name="github:label2" content="Filed under" data-gatsby-head="true"/><meta name="github:data2" content="DevOps" data-gatsby-head="true"/><meta name="github:site" content="@pozafly" data-gatsby-head="true"/><meta name="github:creator" content="@pozafly" data-gatsby-head="true"/><meta property="og:image:width" content="1" data-gatsby-head="true"/><meta property="og:image:height" content="0.5205128205128204" data-gatsby-head="true"/><link rel="icon" href="/favicon-32x32.png?v=a62d45ddbe29cf42da820a576d9375e1" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .auto-link.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .auto-link.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .auto-link svg,
    h2 .auto-link svg,
    h3 .auto-link svg,
    h4 .auto-link svg,
    h5 .auto-link svg,
    h6 .auto-link svg {
      visibility: hidden;
    }
    h1:hover .auto-link svg,
    h2:hover .auto-link svg,
    h3:hover .auto-link svg,
    h4:hover .auto-link svg,
    h5:hover .auto-link svg,
    h6:hover .auto-link svg,
    h1 .auto-link:focus svg,
    h2 .auto-link:focus svg,
    h3 .auto-link:focus svg,
    h4 .auto-link:focus svg,
    h5 .auto-link:focus svg,
    h6 .auto-link:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://pozafly.github.io/dev-ops/cache-and-restore-keys-in-github-actions/" data-baseprotocol="https:" data-basehost="pozafly.github.io"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SLQNH3ND3J"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-SLQNH3ND3J',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SLQNH3ND3J', {"anonymize_ip":true,"cookie_expires":0,"send_page_view":false});
      }
      </script><title data-gatsby-head="true">GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys)</title></head><body><script>
  (function() {
    window.__onThemeChange = function() {}; // 컴포넌트에서 정의할 테마 변경 콜백

    let preferredTheme; // 초기화에 사용할 테마
    try {
      const saved = localStorage.getItem('theme') // 로컬 스토리지에 있는 것 사용
      if (saved) {
        preferredTheme = saved.toLowerCase()
      }
    } catch (err) { }

    // 테마 설정 함수
    window.__setPreferredTheme = function(newTheme) {
      window.__theme = newTheme; // 테마는 전역 변수에 저장
      preferredTheme = newTheme;
      document.body.className = newTheme; // 바디에 클래스 추가
      window.__onThemeChange(newTheme); // 콜백 실행

      try {
        localStorage.setItem('theme', newTheme);
      } catch (err) {}
    }

    // 컬러모드 미디어 쿼리 객체를 가져온다
    const darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

    // 컬러모드 변경 탐지 이벤트 리스터 추가
    darkQuery.addListener(function(e) {
      window.__setPreferredTheme(e.matches ? 'dark' : 'light')
    });

    // 테마 설정. 저장된 테마가 없으면 시스템 설정을 사용한다.
    window.__setPreferredTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
  })();
  </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="post-template"><style data-emotion="css-global lqbgyg">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,dl,dt,dd,ol,fieldset,form,label,legend,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;font:inherit;font-size:16px;vertical-align:baseline;border:0;}html .error-front-page,body .error-front-page,div .error-front-page,span .error-front-page,applet .error-front-page,object .error-front-page,iframe .error-front-page,h1 .error-front-page,h2 .error-front-page,h3 .error-front-page,h4 .error-front-page,h5 .error-front-page,h6 .error-front-page,p .error-front-page,blockquote .error-front-page,pre .error-front-page,a .error-front-page,abbr .error-front-page,acronym .error-front-page,address .error-front-page,big .error-front-page,cite .error-front-page,code .error-front-page,del .error-front-page,dfn .error-front-page,em .error-front-page,img .error-front-page,ins .error-front-page,kbd .error-front-page,q .error-front-page,s .error-front-page,samp .error-front-page,small .error-front-page,strike .error-front-page,strong .error-front-page,sub .error-front-page,sup .error-front-page,tt .error-front-page,var .error-front-page,dl .error-front-page,dt .error-front-page,dd .error-front-page,ol .error-front-page,fieldset .error-front-page,form .error-front-page,label .error-front-page,legend .error-front-page,article .error-front-page,aside .error-front-page,canvas .error-front-page,details .error-front-page,embed .error-front-page,figure .error-front-page,figcaption .error-front-page,footer .error-front-page,header .error-front-page,hgroup .error-front-page,menu .error-front-page,nav .error-front-page,output .error-front-page,ruby .error-front-page,section .error-front-page,summary .error-front-page,time .error-front-page,mark .error-front-page,audio .error-front-page,video .error-front-page{font-size:1.6rem;}body{overflow-x:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:1.6rem;-moz-font-feature-settings:'liga' on;font-weight:400;font-style:normal;line-height:1.6em;color:var(--body-color);letter-spacing:0;background:var(--background-color);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;word-break:break-word;}body::-webkit-scrollbar{width:6px;background-color:transparent;}body::-webkit-scrollbar-thumb{background-color:hsl(230 5% 35%);border-radius:8px;}body.light{--body-color:#303a3e;--background-color:#fff;--main-color:#000;--link-color:#0a0b0c;--border-top-color:#e4eaed;--nav-background:rgb(255 255 255 / 0.4);--nav-border-color:rgb(0 0 0 / 0.05);--header-color:var(--background-color);--header-after:var(--background-color);--header-before:rgb(255 255 255 / 0.05);--author-border:#fff;--home-header-color:#15171A;--home-header-border-bottom:#eaeff1;--header-author-link:#15171A;--no-image-border:#eaeff1;--strong-font-weight:600;--anchor-color:#0a84ff;--anchor-secondary-color:#768086;--loader-color:hsla(230 40% 10% / 0.8);--loader-color2:hsla(230 40% 10% / 0.2);--image-border-color:hsl(230 25% 94%);--image-border-color__dark:hsl(230 5% 15%);--post-card-title:rgb(21 23 26);--post-card-description:rgb(48 58 62);--post-card-by-line:#434952;--strong-color:#0a0b0c;--figcaption-color:#000;--table-first-of-type:linear-gradient(
        to right,
        rgb(255 255 255) 50%,
        rgb(255 255 255 / 0) 100%
      );--table-last-of-type:linear-gradient(
        to left,
        rgb(255 255 255) 50%,
        rgb(255 255 255 / 0) 100%
      );--table-th-background:#f4f8fb;--table-th-border:#e1edf4;--tag-boxshadow:hsl(218 53% 10% / 0.12);--tag-background:#f5f5f5;--post-full-border:#e4eaed;--post-full-meta-link:#2c3036;--post-full-meta-link-hover:#15171A;--post-full-title:#0b0c0e;--highlight-background:#fafafa;--highlight-border:#d1d1d1;--pre-code-color:#000;--little-code-background:var(--highlight-background);--little-code-border:#d1d1d1;--prism-background:hsl(0 0% 90.66%);--prism-border-left:hsl(0 0% 82.88%);--about-box-shadow:10px 10px 30px #bebebe,-10px -10px 30px #fff;--post-card-opacity:0;--post-card-background:rgb(0 0 0 / 0.1);--post-card-after-opacity:1;}body.dark{--body-color:rgba(255 255 255 / 0.75);--background-color:#0d1117;--main-color:#fff;--link-color:rgba(255 255 255 / 0.9);--border-top-color:#2b2f36;--nav-background:rgba(13 17 23 / 0.6);--nav-border-color:rgba(255 255 255 / 0.05);--header-color:#0a0b0c;--header-after:#0d1117;--header-before:rgba(0 0 0 / 0.6);--author-border:#1a1c20;--home-header-color:rgba(255 255 255 / 0.9);--home-header-border-bottom:#272a30;--header-author-link:rgba(255 255 255 / 0.75);--no-image-border:#3b4049;--strong-font-weight:500;--anchor-color:#5596ff;--anchor-secondary-color:#90a2aa;--loader-color:hsl(230 40% 90% / 0.8);--loader-color2:hsl(230 40% 90% / 0.2);--image-border-color:hsl(230 5% 15%);--image-border-color__dark:hsl(230 5% 15%);--post-card-title:rgba(255 255 255 / 0.85);--post-card-description:#768086;--post-card-by-line:rgba(255 255 255 / 0.75);--strong-color:#f2f2f2;--figcaption-color:rgba(255 255 255 / 0.6);--table-first-of-type:linear-gradient(
        to right,
        #191b1f 50%,
        #191b1f 100%
      );--table-last-of-type:linear-gradient(270deg, #191b1f 50%, rgb(25 27 31));--table-th-background:#2b2f36;--table-th-border:var(--table-th-background);--tag-boxshadow:#1d2024;--tag-background:#1f2125;--post-full-border:#3b4049;--post-full-meta-link:rgb(255 255 255 / 0.75);--post-full-meta-link-hover:#fff;--post-full-title:rgb(255 255 255 / 0.9);--highlight-background:rgb(25 30 34);--highlight-border:none;--pre-code-color:#c9d1d9;--little-code-background:rgb(96 98 100 / 0.4);--little-code-border:none;--prism-background:rgb(0 0 0 / 0.4);--prism-border-left:#818181;--about-box-shadow:10px 20px 20px hsl(0 0 0 / 0.3);--post-card-opacity:0.6;--post-card-background:rgb(0 0 0 / 0.3);--post-card-after-opacity:0.1;}a{color:var(--anchor-color);-webkit-text-decoration:none;text-decoration:none;background-color:transparent;}a:hover{-webkit-text-decoration:underline;text-decoration:underline;}a:active,a:hover{outline:0;}ol,ul{max-width:100%;padding-left:1.3em;list-style:none;}blockquote,q{quotes:none;}blockquote:before,blockquote:after,q:before,q:after{content:none;}table{border-spacing:0;border-collapse:collapse;}img{max-width:100%;border:0;}html{overflow:hidden scroll;box-sizing:border-box;font-family:sans-serif;font-size:62.5%;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgb(0 0 0 / 0);}*,*:before,*:after{box-sizing:inherit;}b,strong{font-weight:var(--strong-font-weight);}i,em,dfn{font-style:italic;}small{font-size:80%;}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline;}sup{top:-0.5em;}sub{bottom:-0.25em;}mark{background-color:#fdffb6;}code,kbd,pre,samp{font-family:monospace;font-size:1em;}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit;}button{overflow:visible;border:none;}button,select{text-transform:none;}button,html input[type='button'],input[type='reset'],input[type='submit']{cursor:pointer;-webkit-appearance:button;}button[disabled],html input[disabled]{cursor:default;}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0;}input{line-height:normal;}input:focus{outline:none;}input[type='checkbox'],input[type='radio']{box-sizing:border-box;padding:0;}input[type='number']::-webkit-inner-spin-button,input[type='number']::-webkit-outer-spin-button{height:auto;}input[type='search']{box-sizing:content-box;-webkit-appearance:textfield;}input[type='search']::-webkit-search-cancel-button,input[type='search']::-webkit-search-decoration{-webkit-appearance:none;}legend{padding:0;border:0;}textarea{resize:vertical;overflow:auto;}td,th{padding:0;}hr{position:relative;display:block;width:100%;height:1px;margin:2.5em 0 3.5em;padding:0;border:0;border-top:1px solid var(--border-top-color);}audio,canvas,iframe,img,svg,video{vertical-align:middle;}svg:not(:root){overflow:hidden;}fieldset{margin:0;padding:0;border:0;}p,ul,ol,dl,blockquote{margin:0 0 1.5em;}ul{list-style:disc;}ol{list-style:decimal;}ol ol,ul ul,ul ol,ol ul{margin:0.5em 0 1em;}li{margin:0.4em 0;padding-left:0.3em;line-height:1.6em;}dt{float:left;width:120px;margin:0 20px 0 0;font-weight:500;color:#15171A;text-align:right;}dd{margin:0 0 5px;text-align:left;}blockquote{margin:1.5em 0;padding:0 1.6em;border-left:#e5eff5 0.5em solid;}blockquote p{margin:0.8em 0;font-size:1.2em;font-weight:400;}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;font-size:0.9em;opacity:0.8;}blockquote cite{font-weight:700;}blockquote cite a{font-weight:400;}h1,h2,h3,h4,h5,h6{margin-top:0;font-weight:600;line-height:1.15;text-rendering:optimizeLegibility;}h1 a.auto-link,h2 a.auto-link,h3 a.auto-link,h4 a.auto-link,h5 a.auto-link,h6 a.auto-link{box-shadow:none!important;}h1 a.auto-link:hover,h2 a.auto-link:hover,h3 a.auto-link:hover,h4 a.auto-link:hover,h5 a.auto-link:hover,h6 a.auto-link:hover{box-shadow:none!important;}h1 a.auto-link svg,h2 a.auto-link svg,h3 a.auto-link svg,h4 a.auto-link svg,h5 a.auto-link svg,h6 a.auto-link svg{opacity:0;fill:var(--link-color)!important;-webkit-transition:0.25s ease;transition:0.25s ease;}h1:hover a.auto-link svg,h2:hover a.auto-link svg,h3:hover a.auto-link svg,h4:hover a.auto-link svg,h5:hover a.auto-link svg,h6:hover a.auto-link svg{opacity:1;}h1{margin:0 0 0.5em;font-size:5.5rem;font-weight:600;}@media (max-width: 500px){h1{font-size:2.2rem;}}h2{margin:1.5em 0 0.5em;font-size:2.2rem;}@media (max-width: 500px){h2{font-size:1.8rem;}}h3{margin:1.5em 0 0.5em;font-size:1.8rem;font-weight:500;}@media (max-width: 500px){h3{font-size:1.7rem;}}h4{margin:1.5em 0 0.5em;font-size:1.6rem;font-weight:500;}h5{margin:1.5em 0 0.5em;font-size:1.4rem;font-weight:500;}h6{margin:1.5em 0 0.5em;font-size:1.4rem;font-weight:500;}.medium-zoom-overlay{-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);}.gatsby-resp-image-background-image{border-radius:6px;}.gatsby-resp-image-wrapper{margin:40px 0;}@media (max-width: 800px){.gatsby-resp-image-wrapper{width:100%;margin:initial;}}.medium-zoom-image{box-shadow:none!important;}.copyright{font-size:1.4rem;}.copyright a{font-size:inherit;}</style><style data-emotion="css vva9px">.css-vva9px .site-main{margin-top:64px;padding-bottom:4vw;background:var(--background-color);}</style><style data-emotion="css 163jdes">.css-163jdes{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}.css-163jdes .site-main{margin-top:64px;padding-bottom:4vw;background:var(--background-color);}</style><div class="css-163jdes e1xu36er0"><header class="site-header"><style data-emotion="css 1kbvt30">.css-1kbvt30{position:relative;padding:0 5vw;position:fixed;z-index:1000;top:0;right:0;left:0;background:var(--nav-background);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);border-bottom:1px solid var(--nav-border-color);}</style><div class="css-1kbvt30"><style data-emotion="css 8aaawc">.css-8aaawc{width:100%;max-width:1040px;margin:0 auto;}</style><div class="css-8aaawc"><style data-emotion="css tetqay">.css-tetqay{position:relative;z-index:100;overflow-y:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;height:52px;font-size:1.3rem;}</style><nav class="css-tetqay"><style data-emotion="css qxzoul">.css-qxzoul{overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:10px;font-weight:500;text-transform:uppercase;letter-spacing:0.2px;white-space:nowrap;-webkit-overflow-scrolling:touch;-ms-overflow-scrolling:touch;}@media (max-width: 700px){.css-qxzoul{margin-right:0;}}</style><div class="site-nav-left css-qxzoul esgr0m44"><style data-emotion="css yn94hc">.css-yn94hc{position:relative;z-index:100;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:32px;padding:12px 0;font-size:1.7rem;font-weight:700;line-height:1.8rem;color:#fff;text-transform:none;letter-spacing:-0.5px;}.css-yn94hc:hover{-webkit-text-decoration:none;text-decoration:none;}.css-yn94hc img{display:block;width:auto;height:21px;}@media (max-width: 700px){.css-yn94hc{margin-right:18px;}}</style><a class="site-nav-logo css-yn94hc" href="/"><img src="/static/a62d45ddbe29cf42da820a576d9375e1/aef42/alien.png" alt="Pozafly&#x27;s Blog" width="21" height="21"/></a><style data-emotion="css 1xdepn">.css-1xdepn{position:relative;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}</style><div class="css-1xdepn esgr0m43"><style data-emotion="css f30i1v">.css-f30i1v{position:absolute;z-index:1000;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0 0 0 -12px;padding:0;list-style:none;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-f30i1v li{display:block;margin:0;padding:0;}.css-f30i1v li a{position:relative;display:block;padding:10px 12px;font-size:1.2rem;color:var(--main-color);opacity:0.7;-webkit-transition:opacity 0.2s ease-in-out;transition:opacity 0.2s ease-in-out;}@media (max-width: 700px){.css-f30i1v li a{padding:10px 8px;}}.css-f30i1v li a:hover{-webkit-text-decoration:none;text-decoration:none;opacity:1;}.css-f30i1v .nav-current{opacity:1;}</style><ul role="menu" class="css-f30i1v"><li role="menuitem"><a href="/">Home</a></li><li role="menuitem"><a href="/about/">About</a></li><li role="menuitem"><a href="/tags/">Tags</a></li><li role="menuitem"><a href="/tags/diary/">Diary</a></li></ul><style data-emotion="css 289bqd">.css-289bqd{position:absolute;top:10px;-webkit-transform:translateY(175%);-moz-transform:translateY(175%);-ms-transform:translateY(175%);transform:translateY(175%);font-size:1.7rem;font-weight:400;color:var(--main-color);text-transform:none;visibility:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-289bqd .dash{left:-25px;}.css-289bqd .dash:before{content:'- ';opacity:0.5;}@media (max-width: 700px){.css-289bqd{overflow:hidden;max-width:calc(100vw - 126px);text-overflow:ellipsis;white-space:nowrap;}}</style><span class="nav-post-title css-289bqd esgr0m40">GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys)</span></div></div><style data-emotion="css 1wxq7hc">.css-1wxq7hc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:0 1 auto;-ms-flex:0 1 auto;flex:0 1 auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}</style><div class="css-1wxq7hc esgr0m42"><style data-emotion="css 150gfpr">.css-150gfpr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (max-width: 700px){.css-150gfpr .not-mobile{display:none;}}</style><div class="css-150gfpr esgr0m41"><style data-emotion="css u4kwjs">.css-u4kwjs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;margin:0;padding:10px;opacity:0.8;-webkit-transition:opacity 0.35s ease;transition:opacity 0.35s ease;}.css-u4kwjs:hover{opacity:1;}.css-u4kwjs svg{height:1.8rem;fill:var(--main-color);-webkit-transition:fill 0.45s ease;transition:fill 0.45s ease;}.css-u4kwjs.is-white svg{fill:#fff;}</style><a class="not-mobile css-u4kwjs" href="https://github.com/pozafly" title="Github" target="_blank" rel="noopener noreferrer"><svg width="21px" height="21px" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"></path></svg></a><style data-emotion="css-global 8o55qm">body .theme-toggler{overflow:hidden;margin:6px;padding:2px;background:transparent;border-radius:50%;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;}body .theme-toggler #switch{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;width:21px;height:21px;padding:0;background:transparent;border:0;}body .theme-toggler .mode{position:relative;width:18px;height:18px;opacity:0.8;background:#000;-webkit-clip-path:path(
          'M17.5306 13.5882C16.6384 13.8558 15.689 14 14.7044 14C9.5004 14 5.28174 9.97061 5.28174 5.00005C5.28174 3.32422 5.76127 1.75538 6.59643 0.411865C2.77326 1.55853 0 4.96994 0 9.00001C0 13.9706 4.21866 18 9.42265 18C12.8721 18 15.8887 16.2296 17.5306 13.5882Z'
        );clip-path:path(
          'M17.5306 13.5882C16.6384 13.8558 15.689 14 14.7044 14C9.5004 14 5.28174 9.97061 5.28174 5.00005C5.28174 3.32422 5.76127 1.75538 6.59643 0.411865C2.77326 1.55853 0 4.96994 0 9.00001C0 13.9706 4.21866 18 9.42265 18C12.8721 18 15.8887 16.2296 17.5306 13.5882Z'
        );border-radius:50%;-webkit-transition:all 0.45s ease;transition:all 0.45s ease;}body .theme-toggler .mode:before{content:'';position:absolute;z-index:-1;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-moz-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:5px;height:5px;opacity:0;background:inherit;border-radius:50%;-webkit-transition:box-shadow 0.4s 0s ease;transition:box-shadow 0.4s 0s ease;}body .theme-toggler .mode:after{content:'';position:absolute;top:-20%;left:30%;width:90%;height:90%;background:rgb(255 255 255 / 1);border-radius:50%;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;}body .theme-toggler .mode:hover{opacity:1;}body .theme-toggler:hover{background:rgb(215 215 215 / 0.9);}body .theme-toggler.is-white .mode{background:#fff;}body .theme-toggler.is-white:hover{background:rgb(215 215 215 / 0.2);}body.dark .theme-toggler{background:transparent;}body.dark .theme-toggler:hover{background:rgb(255 255 255 / 0.1);}body.dark .theme-toggler .mode{-webkit-transform:scale(0.5);-moz-transform:scale(0.5);-ms-transform:scale(0.5);transform:scale(0.5);overflow:initial;opacity:0.8;background:white;-webkit-clip-path:none;clip-path:none;}body.dark .theme-toggler .mode:before{opacity:1;box-shadow:0 -16px 0 0 white,0 16px 0 0 white,-16px 0 0 0 white,16px 0 0 0 white,12px 12px 0 0 white,12px -12px 0 0 white,-12px 12px 0 0 white,-12px -12px 0 0 white;}body.dark .theme-toggler .mode:after{-webkit-transform:translateX(50%) translateY(-50%);-moz-transform:translateX(50%) translateY(-50%);-ms-transform:translateX(50%) translateY(-50%);transform:translateX(50%) translateY(-50%);opacity:0;-webkit-transition:background 0.45s ease;transition:background 0.45s ease;}body.dark .theme-toggler.is-white .mode:before{box-shadow:0 -16px 0 0 white,0 16px 0 0 white,-16px 0 0 0 white,16px 0 0 0 white,12px 12px 0 0 white,12px -12px 0 0 white,-12px 12px 0 0 white,-12px -12px 0 0 white;}</style><button class="theme-toggler " aria-label="theme toggle button" type="button"><div id="switch"><div class="mode"></div></div></button></div></div></nav></div></div></header><style data-emotion="css 1h9yqcb">.css-1h9yqcb{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;position:relative;padding:0 5vw;}</style><main id="site-main" class="site-main css-1h9yqcb"><div class="css-8aaawc"><style data-emotion="css 150a24d">.css-150a24d{position:relative;}</style><article class="css-150a24d"><style data-emotion="css iltggy">.css-iltggy{position:relative;margin:0 auto;padding:70px 100px 50px;word-break:keep-all;border-top-left-radius:3px;border-top-right-radius:3px;}@media (max-width: 1170px){.css-iltggy{padding:60px 11vw 50px;}}@media (max-width: 800px){.css-iltggy{padding-right:5vw;padding-left:5vw;}}@media (max-width: 500px){.css-iltggy{padding:20px 0 35px;}}</style><header class="post-full-header css-iltggy edf4ga72"><style data-emotion="css 1njwbu9">.css-1njwbu9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;font-size:1.2rem;font-weight:600;line-height:1.4em;color:#738a94;}.css-1njwbu9 a{font-size:1.2rem;color:var(--anchor-secondary-color);}</style><section class="post-full-tags css-1njwbu9 emmlh0d3"><a href="/tags/dev-ops/">DevOps</a>,  <a href="/tags/git-hub-actions/">GitHub Actions</a>,  <a href="/tags/automation/">Automation</a></section><style data-emotion="css 18a1ftz">.css-18a1ftz{margin:0 0 0.2em;color:var(--post-full-title);word-break:keep-all;}@media (max-width: 500px){.css-18a1ftz{margin-top:0.2em;font-size:3.3rem;}}</style><h1 class="post-full-title css-18a1ftz edf4ga71">GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys)</h1><style data-emotion="css 1gjy1ma">.css-1gjy1ma{margin:20px 0 0;font-size:2rem;font-weight:360;line-height:1.4em;color:var(--post-card-description);}@media (max-width: 500px){.css-1gjy1ma{font-size:1.9rem;line-height:1.5em;}}</style><p class="post-full-custom-excerpt css-1gjy1ma emmlh0d2">restore-keys는 기존 캐시가 쓸모없어졌음에도 불구하고 기존 캐시를 불러오는 기능이다. 그렇다면, 무효화 되지 않은 캐시를 어디에 사용해야 하는 것일까?</p><style data-emotion="css r2irbu">.css-r2irbu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:35px 0 0;padding-top:15px;border-top:1px solid var(--post-full-border);}.css-r2irbu .post-full-byline-content{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}.css-r2irbu .post-full-byline-content .author-list{-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;padding:0 12px 0 0;}.css-r2irbu .post-full-byline-meta{margin:2px 0 0;font-size:1.4rem;line-height:1.2em;color:#768086;letter-spacing:0.2px;}.css-r2irbu .post-full-byline-meta .author-name{margin:0 0 3px;font-size:1.4rem;font-weight:500;line-height:1.3em;}.css-r2irbu .post-full-byline-meta .author-name a{font-size:13px;color:var(--post-full-meta-link);}.css-r2irbu .post-full-byline-meta .author-name a:hover{color:var(--post-full-meta-link-hover);}.css-r2irbu .post-full-byline-meta .byline-reading-time,.css-r2irbu .post-full-byline-meta .byline-meta-date{font-size:13px;}.css-r2irbu .post-full-byline-meta .bull{display:inline-block;margin:0 4px;opacity:0.6;}</style><div class="post-full-byline css-r2irbu emmlh0d1"><section class="post-full-byline-content"><style data-emotion="css 12fmpzj">.css-12fmpzj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 0 0 4px;padding:0;list-style:none;}</style><ul class="author-list css-12fmpzj emmlh0d0"><style data-emotion="css 4q5div">.css-4q5div{position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin:0;padding:0;}.css-4q5div:hover .author-name-tooltip{-webkit-transform:translate(-10px, -2px);-moz-transform:translate(-10px, -2px);-ms-transform:translate(-10px, -2px);transform:translate(-10px, -2px);opacity:1;}</style><li class="author-list-item css-4q5div e13xkhp00"><style data-emotion="css aezf96">.css-aezf96{overflow:hidden;display:block;width:40px;height:40px;margin:0 -4px;border:2px solid var(--author-border);border-radius:100%;}@media (max-width: 500px){.css-aezf96{width:36px;height:36px;}}</style><a class="author-avatar css-aezf96" href="/about/"><style data-emotion="css 1ip6e3z">.css-1ip6e3z{display:block;width:100%;height:100%;object-fit:cover;background:var(--background-color);border-radius:100%;}.css-1ip6e3z img{border-radius:100%;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper author-profile-image css-1ip6e3z"><div aria-hidden="true" style="padding-top:100%"></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#6808f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/e73fe/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/61ca6/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/507b0/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/2f28c/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/499f6/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg 120w" alt="Pozafly"/></picture><noscript><picture><source type="image/webp" srcSet="/static/8c061761f263c344f2c0416607c8adf1/e73fe/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/61ca6/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/507b0/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg" srcSet="/static/8c061761f263c344f2c0416607c8adf1/2f28c/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/499f6/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg 120w" alt="Pozafly"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a></li></ul><section class="post-full-byline-meta"><div class="author-name"><a href="/about/">Pozafly</a></div><div class="byline-meta-content"><time class="byline-meta-date" dateTime="2023-08-22">2023-08-22</time><span class="byline-reading-time"><span class="bull">•</span>19 min read</span></div></section></section></div></header><style data-emotion="css 1y1xnji">.css-1y1xnji{width:80%;max-height:800px;margin:25px auto 100px;-webkit-background-size:cover;background-size:cover;}.css-1y1xnji .image-wrapper{overflow:hidden;width:100%;border:1px solid var(--image-border-color);border-radius:8px;}.css-1y1xnji .image-wrapper img{border-radius:8px;}@media (max-width: 1170px){.css-1y1xnji .image-wrapper img{max-width:1170px;}}@media (max-width: 800px){.css-1y1xnji{width:100%;margin:25px auto 60px;}}</style><figure class="css-1y1xnji e16cwxex1"><div class="image-wrapper"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:52.051282051282044%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/webp;base64,UklGRtoAAABXRUJQVlA4IM4AAADQAgCdASoUAAoAAAAAJYgCdL1CScCMIDOJauZFWWvwAP7+fCRqJ1HSVO9tIR999fXyP/P57rC8REMKD1//0ioeS1//ZcuF7B+ofR9C21V2uWjaFEHZ/V9j/+YjqrWQX/oM//3/Xef38974//DpwZKlrsnStauDGxKwCIg6sCCzNEAE1v/+tZbF+e3c/dp8J2s0//xoH+/2b/MdD0ufroUYn//1ag//2gH//Wsf0DSlimwf/X6RG3r/0P/tmbftAf4hf79ZmYcMFl0JnQAAAA==" alt=""/><picture><source type="image/avif" data-srcset="/static/365cb7658cd8164573e7796d96f879bc/8c605/main.avif 500w,/static/365cb7658cd8164573e7796d96f879bc/2ee88/main.avif 800w,/static/365cb7658cd8164573e7796d96f879bc/b3a7a/main.avif 1170w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/365cb7658cd8164573e7796d96f879bc/7b19c/main.webp" data-srcset="/static/365cb7658cd8164573e7796d96f879bc/5933c/main.webp 500w,/static/365cb7658cd8164573e7796d96f879bc/9077d/main.webp 800w,/static/365cb7658cd8164573e7796d96f879bc/7b19c/main.webp 1170w" alt="GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys)"/></picture><noscript><picture><source type="image/avif" srcSet="/static/365cb7658cd8164573e7796d96f879bc/8c605/main.avif 500w,/static/365cb7658cd8164573e7796d96f879bc/2ee88/main.avif 800w,/static/365cb7658cd8164573e7796d96f879bc/b3a7a/main.avif 1170w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/365cb7658cd8164573e7796d96f879bc/7b19c/main.webp" srcSet="/static/365cb7658cd8164573e7796d96f879bc/5933c/main.webp 500w,/static/365cb7658cd8164573e7796d96f879bc/9077d/main.webp 800w,/static/365cb7658cd8164573e7796d96f879bc/7b19c/main.webp 1170w" alt="GitHub Actions 캐시 조금 더 다뤄보기 (feat. restore-keys)"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></figure><style data-emotion="css 1gxhmkz">.css-1gxhmkz *:not(pre)>code[class*='language-']{border-radius:0.3em;background:var(--little-code-background);border:1px solid var(--little-code-border);color:var(--main-color);padding:0.15em 0.5em;white-space:normal;font-size:13px;}@media (max-width: 800px){.css-1gxhmkz *:not(pre)>code[class*='language-']{display:inline;}}.css-1gxhmkz .gatsby-highlight-code-line{display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;background-color:var(--prism-background);border-left:0.25em solid var(--prism-border-left);font-size:1.4rem;}.css-1gxhmkz .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:var(--highlight-background);box-shadow:inset 0 0 0 1px var(--highlight-border);-webkit-overflow-scrolling:touch;overflow:auto;}.css-1gxhmkz .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.4rem;line-height:24px;}.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{color:var(--pre-code-color);text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1gxhmkz pre[class*='language-']::-webkit-scrollbar,.css-1gxhmkz code[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-1gxhmkz pre[class*='language-']::-webkit-scrollbar-thumb,.css-1gxhmkz code[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{display:inline-block;}}.css-1gxhmkz pre[class*='language-']{overflow:auto;}.css-1gxhmkz .token{font-size:1.4rem;}.css-1gxhmkz pre[data-line]{padding:1em 0 1em 3em;position:relative;}@media print{.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{text-shadow:none;}}.css-1gxhmkz pre[class*='language-']{padding:1em;overflow:auto;margin:0;}.css-1gxhmkz:not(pre)>code[class*='language-']{padding:0.1em 0.3em;border-radius:0.3em;color:#c9d1d9;background:#343942;}.css-1gxhmkz pre[data-line]{position:relative;}.css-1gxhmkz pre[class*='language-']>code[class*='language-']{position:relative;z-index:1;}.css-1gxhmkz .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#2f2a1e;box-shadow:inset 5px 0 0 #674c16;z-index:0;pointer-events:none;line-height:inherit;white-space:pre;}.css-1gxhmkz .namespace{opacity:0.7;}.css-1gxhmkz .token.comment,.css-1gxhmkz .token.prolog,.css-1gxhmkz .token.doctype,.css-1gxhmkz .token.cdata{color:#8b949e;}.css-1gxhmkz .token.punctuation{color:#c9d1d9;}.css-1gxhmkz .token.property,.css-1gxhmkz .token.tag,.css-1gxhmkz .token.boolean,.css-1gxhmkz .token.number,.css-1gxhmkz .token.constant,.css-1gxhmkz .token.symbol,.css-1gxhmkz .token.deleted{color:#79c0ff;}.css-1gxhmkz .token.selector,.css-1gxhmkz .token.attr-name,.css-1gxhmkz .token.string,.css-1gxhmkz .token.char,.css-1gxhmkz .token.builtin,.css-1gxhmkz .token.inserted{color:#a5d6ff;}.css-1gxhmkz .token.operator,.css-1gxhmkz .token.entity,.css-1gxhmkz .token.url,.css-1gxhmkz .language-css .token.string,.css-1gxhmkz .style .token.string{color:#a5d6ff;}.css-1gxhmkz .token.atrule,.css-1gxhmkz .token.attr-value,.css-1gxhmkz .token.keyword{color:#a5d6ff;}.css-1gxhmkz .token.function{color:#d2a8ff;}.css-1gxhmkz .token.regex,.css-1gxhmkz .token.important,.css-1gxhmkz .token.variable{color:#a8daff;}.css-1gxhmkz .token.important,.css-1gxhmkz .token.bold{font-weight:bold;}.css-1gxhmkz .token.italic{font-style:italic;}.css-1gxhmkz .token.entity{cursor:help;}</style><style data-emotion="css 1mpsxtc">.css-1mpsxtc{position:relative;min-height:230px;margin:0 auto;padding:0 100px 6vw;font-size:2rem;line-height:1.6em;background:var(--background-color);border-radius:6px;}.css-1mpsxtc .no-image{padding-top:0;}.css-1mpsxtc h1,.css-1mpsxtc h2,.css-1mpsxtc h3,.css-1mpsxtc h4,.css-1mpsxtc h5,.css-1mpsxtc h6,.css-1mpsxtc p,.css-1mpsxtc ul,.css-1mpsxtc ol,.css-1mpsxtc dl,.css-1mpsxtc pre,.css-1mpsxtc blockquote,.css-1mpsxtc .post-full-comments,.css-1mpsxtc .footnotes{min-width:100%;margin:0 0 1.5em;}.css-1mpsxtc li>ul,.css-1mpsxtc li>ol{margin:0;}.css-1mpsxtc li{word-break:break-word;}.css-1mpsxtc li p{margin:0;}.css-1mpsxtc a[class*='image'],.css-1mpsxtc a[class*='image']:hover{box-shadow:none;}.css-1mpsxtc a[class*='image'] span[class*='image'],.css-1mpsxtc a[class*='image']:hover span[class*='image']{border-radius:6px;}.css-1mpsxtc strong,.css-1mpsxtc em{color:var(--strong-color);}.css-1mpsxtc small{display:inline-block;line-height:1.6em;}.css-1mpsxtc img,.css-1mpsxtc video{display:block;max-width:840px;height:auto;margin:2em auto;border:1px solid var(--image-border-color);border-radius:8px;}.css-1mpsxtc hr+p{margin-top:1.2em;}.css-1mpsxtc img[src$='#full']{width:100vw;max-width:none;}.css-1mpsxtc img+br+small{display:block;margin-top:-3em;margin-bottom:1.5em;text-align:center;}.css-1mpsxtc iframe{margin:10px auto 20px;}.css-1mpsxtc blockquote{margin:0 0 1.5em;padding:0 1.5em;border-left:3px solid var(--image-border-color);}.css-1mpsxtc blockquote p{margin:0 0 1em;font-size:inherit;font-style:italic;line-height:inherit;color:inherit;}.css-1mpsxtc blockquote p:last-child{margin-bottom:0;}.css-1mpsxtc code{padding:0 5px 2px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:0.8em;font-weight:400!important;line-height:1em;border-radius:3px;}.css-1mpsxtc p code{word-break:keep-all;}.css-1mpsxtc pre{overflow-x:auto;max-width:100%;padding:20px;font-size:1.4rem;line-height:1.5em;color:#e5eff5;border-radius:5px;}.css-1mpsxtc pre code{padding:0;font-size:inherit;line-height:inherit;background:transparent;}.css-1mpsxtc pre code :not(span){color:inherit;}.css-1mpsxtc .fluid-width-video-wrapper{margin:1.5em 0 3em;}.css-1mpsxtc hr{margin:2em 0;}.css-1mpsxtc h1,.css-1mpsxtc h2,.css-1mpsxtc h3,.css-1mpsxtc h4,.css-1mpsxtc h5,.css-1mpsxtc h6{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;color:var(--home-header-color);}.css-1mpsxtc h1{margin:0.5em 0 0.4em;font-size:4.2rem;font-weight:600;line-height:1.25em;}.css-1mpsxtc p+h1{margin-top:0.8em;}.css-1mpsxtc h2{margin:1.2em 0 0.6em;font-size:3.4rem;font-weight:600;line-height:1.25em;}.css-1mpsxtc p+h2{margin-top:0.8em;}.css-1mpsxtc h3{margin:1rem 0 0.2em;padding-top:1.8rem;font-size:2.6rem;font-weight:600;line-height:1.3em;}.css-1mpsxtc h2+h3{margin-top:0.7em;}.css-1mpsxtc h4{margin:1em 0 0.2em;font-size:2rem;font-weight:800;}.css-1mpsxtc h2+h4{margin-top:0.7em;}.css-1mpsxtc h3+h4{margin-top:0;}.css-1mpsxtc h5{display:block;margin:0.5em 0;font-size:1.8rem;font-weight:600;line-height:1.35em;border:0;}.css-1mpsxtc h6{margin:0.5em 0 0.2em;font-size:2rem;font-weight:700;}.css-1mpsxtc table{overflow-x:auto;display:inline-block;border-spacing:0;border-collapse:collapse;width:auto;max-width:100%;margin:0.5em 0 2.5em;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:1.6rem;white-space:nowrap;vertical-align:top;background:radial-gradient(ellipse at left, rgb(0 0 0 / 0.2) 0%, rgb(0 0 0 / 0) 75%) 0 center,radial-gradient(ellipse at right, rgb(0 0 0 / 0.2) 0%, rgb(0 0 0 / 0) 75%) 100% center;background-repeat:no-repeat;background-attachment:scroll,scroll;-webkit-background-size:10px 100%,10px 100%;background-size:10px 100%,10px 100%;-webkit-overflow-scrolling:touch;}.css-1mpsxtc table th{font-size:1.2rem;font-weight:700;color:var(--home-header-color);text-align:left;text-transform:uppercase;letter-spacing:0.2px;background-color:var(--table-th-background);}.css-1mpsxtc table th,.css-1mpsxtc table td{padding:6px 12px;border:var(--table-th-border) 1px solid;}.css-1mpsxtc table td:first-of-type{background-image:var(--table-first-of-type);background-repeat:no-repeat;-webkit-background-size:20px 100%;background-size:20px 100%;}.css-1mpsxtc table td:last-child{background-image:var(--table-last-of-type);background-repeat:no-repeat;-webkit-background-position:100% 0;background-position:100% 0;-webkit-background-size:20px 100%;background-size:20px 100%;}.css-1mpsxtc figcaption{color:var(--figcaption-color);}@media (max-width: 1170px){.css-1mpsxtc{padding:0 11vw;}}@media (max-width: 800px){.css-1mpsxtc{padding:0 5vw;font-size:1.8rem;}}@media (max-width: 500px){.css-1mpsxtc{padding:0;}}@media (max-width: 500px){.css-1mpsxtc .post-full-custom-excerpt{font-size:1.9rem;line-height:1.5em;}}@media (max-width: 500px){.css-1mpsxtc p,.css-1mpsxtc ul,.css-1mpsxtc ol,.css-1mpsxtc dl,.css-1mpsxtc pre,.css-1mpsxtc .post-full-comments,.css-1mpsxtc .footnotes{margin-bottom:1.28em;}}@media (max-width: 1040px){.css-1mpsxtc img,.css-1mpsxtc video{width:100%;}}@media (max-width: 500px){.css-1mpsxtc blockquote{padding:0 1.3em;}}@media (max-width: 800px){.css-1mpsxtc h1{font-size:3.2rem;line-height:1.25em;}.css-1mpsxtc h2{margin:0.5rem 0 0.3em;font-size:2.8rem;line-height:1.25em;}.css-1mpsxtc h3{margin:0.5rem 0 0.3em;font-size:2.4rem;line-height:1.3em;}.css-1mpsxtc h4{margin-bottom:0.3em;font-size:1.8rem;line-height:1.3em;}.css-1mpsxtc h5{max-width:1060px;padding:0 0 0.5em;font-size:2.4rem;text-align:initial;}.css-1mpsxtc h6{font-size:1.8rem;line-height:1.4em;}}.css-1mpsxtc *:not(pre)>code[class*='language-']{border-radius:0.3em;background:var(--little-code-background);border:1px solid var(--little-code-border);color:var(--main-color);padding:0.15em 0.5em;white-space:normal;font-size:13px;}@media (max-width: 800px){.css-1mpsxtc *:not(pre)>code[class*='language-']{display:inline;}}.css-1mpsxtc .gatsby-highlight-code-line{display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;background-color:var(--prism-background);border-left:0.25em solid var(--prism-border-left);font-size:1.4rem;}.css-1mpsxtc .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:var(--highlight-background);box-shadow:inset 0 0 0 1px var(--highlight-border);-webkit-overflow-scrolling:touch;overflow:auto;}.css-1mpsxtc .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.4rem;line-height:24px;}.css-1mpsxtc pre[class*='language-'],.css-1mpsxtc code[class*='language-']{color:var(--pre-code-color);text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1mpsxtc pre[class*='language-']::-webkit-scrollbar,.css-1mpsxtc code[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-1mpsxtc pre[class*='language-']::-webkit-scrollbar-thumb,.css-1mpsxtc code[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-1mpsxtc pre[class*='language-'],.css-1mpsxtc code[class*='language-']{display:inline-block;}}.css-1mpsxtc pre[class*='language-']{overflow:auto;}.css-1mpsxtc .token{font-size:1.4rem;}.css-1mpsxtc pre[data-line]{padding:1em 0 1em 3em;position:relative;}@media print{.css-1mpsxtc pre[class*='language-'],.css-1mpsxtc code[class*='language-']{text-shadow:none;}}.css-1mpsxtc pre[class*='language-']{padding:1em;overflow:auto;margin:0;}.css-1mpsxtc:not(pre)>code[class*='language-']{padding:0.1em 0.3em;border-radius:0.3em;color:#c9d1d9;background:#343942;}.css-1mpsxtc pre[data-line]{position:relative;}.css-1mpsxtc pre[class*='language-']>code[class*='language-']{position:relative;z-index:1;}.css-1mpsxtc .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#2f2a1e;box-shadow:inset 5px 0 0 #674c16;z-index:0;pointer-events:none;line-height:inherit;white-space:pre;}.css-1mpsxtc .namespace{opacity:0.7;}.css-1mpsxtc .token.comment,.css-1mpsxtc .token.prolog,.css-1mpsxtc .token.doctype,.css-1mpsxtc .token.cdata{color:#8b949e;}.css-1mpsxtc .token.punctuation{color:#c9d1d9;}.css-1mpsxtc .token.property,.css-1mpsxtc .token.tag,.css-1mpsxtc .token.boolean,.css-1mpsxtc .token.number,.css-1mpsxtc .token.constant,.css-1mpsxtc .token.symbol,.css-1mpsxtc .token.deleted{color:#79c0ff;}.css-1mpsxtc .token.selector,.css-1mpsxtc .token.attr-name,.css-1mpsxtc .token.string,.css-1mpsxtc .token.char,.css-1mpsxtc .token.builtin,.css-1mpsxtc .token.inserted{color:#a5d6ff;}.css-1mpsxtc .token.operator,.css-1mpsxtc .token.entity,.css-1mpsxtc .token.url,.css-1mpsxtc .language-css .token.string,.css-1mpsxtc .style .token.string{color:#a5d6ff;}.css-1mpsxtc .token.atrule,.css-1mpsxtc .token.attr-value,.css-1mpsxtc .token.keyword{color:#a5d6ff;}.css-1mpsxtc .token.function{color:#d2a8ff;}.css-1mpsxtc .token.regex,.css-1mpsxtc .token.important,.css-1mpsxtc .token.variable{color:#a8daff;}.css-1mpsxtc .token.important,.css-1mpsxtc .token.bold{font-weight:bold;}.css-1mpsxtc .token.italic{font-style:italic;}.css-1mpsxtc .token.entity{cursor:help;}</style><section class="post-full-content css-1mpsxtc edf4ga70"><div class="post-content"><p>컴퓨터는 캐시를 활용해 가까운 곳에서 데이터를 전달받거나, 이미 생산된 데이터를 만들기 위해 똑같은 작업을 반복하지 않아도 만들어둔 데이터를 캐시에서 꺼내 쓸 수 있다. 캐시에 저장된 데이터를 사용해 반복 작업으로부터 벗어나면 그만큼 기다려야 하는 시간을 벌 수 있다.</p>
<p>캐시란, <strong>데이터나 값을 미리 복사해 놓는 임시 장소</strong>를 가리킨다. 캐시는 로컬 컴퓨터에도 물리적으로 있고, 네트워크상에도 CDN과 같은 플랫폼에 존재한다. CI 환경에서도 캐시를 지원하고 있고. 또, 캐시라는 단어는 임시 장소를 가리키기도 하지만, 장소에 저장된 데이터 자체를 말하기도 한다.</p>
<p>예전에 Travis CI를 사용해 보면서 가상 환경에서 프로젝트를 빌드하고 서빙하는 과정을 겪어본 적이 있다. CI 환경에서 캐시란, 주로 프로젝트에 필요한 의존성 파일을 캐시에 저장 후, 빌드할 때 꺼내쓰는 것을 말한다. 이번에 GitHub Actions로 CI 환경을 만들어 보면서, 캐시 설정 중 <code class="language-text">restore-keys</code> 라는 옵션이 있는데, 이 옵션이 존재하는 이유가 궁금했다.</p>
<p>캐시에서 가장 중요하게 생각되는 부분은 무효화(invalidate)다. 캐시 무효화가 되지 않아 개인정보가 노출되는 사건이 있을 수 있고, 배포가 제대로 반영되지 않는 현상도 있을 수 있기 때문이다. <code class="language-text">restore-keys</code> 는 복원 키라고도 말하는데, 캐시에 변동 사항이 생겨 캐싱 된 의존성 파일이 쓸모없어졌고, 새로운 캐시를 생성해야 하는 상황에서 기존 캐시를 불러오는 기능이다. 그렇다면, 무효화 되지 않은 캐시를 어디에 사용해야 하는 것일까?</p>
<p>이번 글은, GitHub Actions에서 의존성과 관련된 캐시를 어떻게 다루고 있고, 이를 어떻게 더 성능이 좋게 관리할 수 있는지에 대한 이야기다. 패키지 매니저는 npm을 기준으로 설명한다. GitHub Actions의 기본적인 문법은 자세하게 이야기하지 않는다.</p>
<hr>
<h2 id="알아야-할-배경" style="position:relative;">알아야 할 배경<a href="#%EC%95%8C%EC%95%84%EC%95%BC-%ED%95%A0-%EB%B0%B0%EA%B2%BD" aria-label="알아야 할 배경 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>우선 GitHub Actions에서 돌아가는 워크플로우(Workflow)는 가상 환경임을 알아야 한다. 이 환경을 러너(Runner)라고 한다. 러너는 몇 가지 OS를 선택할 수 있으며 주로 CI 환경에 적합한 것은 Linux다. GitHub Actions는 yml 파일로 이루어진 명령어 조합으로 동작하며, 워크플로우 안에 있는 Job(작업) 단위로 러너가 각각 만들어지고, 각 러너에서 새롭게 시작한다. 따라서, 의존성 파일은 Job 별로 새로 만들어져야 한다.</p>
<p>npm 패키지 설치 시 생성되는 <strong>npm 캐시</strong>는 Linux 기준으로 <code class="language-text">~/.npm</code> 디렉토리에 전역으로 존재하며, GitHub Actions의 캐시와는 다른 npm 만의 캐시다. 이 캐시는 <code class="language-text">npm install, npm ci</code> 등의 명령어로 패키지를 설치 할 때 속도를 더 빠르게 해준다. 이 npm 캐시 자체를 GitHub Actions 환경의 캐시로도 저장할 수 있다.</p>
<br/>
<h2 id="GitHub-Actions-Cache" style="position:relative;">GitHub Actions Cache<a href="#GitHub-Actions-Cache" aria-label="GitHub Actions Cache permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>GitHub Actions에서 캐시를 사용하려면, GitHub에서 만들어 둔 <a href="actions/cache">actions/cache</a> 액션을 사용하면 간편하게 사용할 수 있다.</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
    <span class="token key atrule">with</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> ~/.something
      <span class="token key atrule">key</span><span class="token punctuation">:</span> something</code></pre></div>
<p>steps에서 <code class="language-text">uses</code> 키워드를 사용해 액션을 가져오고, 액션에 필요한 인자를 <code class="language-text">with</code> 키워드로 넘겨줄 수 있다.</p>
<p>npm의 <code class="language-text">node_modules</code> 의존성 파일을 캐시 해두고 CI 환경에서 다시 설치하지 않고 빠르게 사용하는 것이 GitHub Actions 캐시 사용의 목적이다. 이 캐시는 저장될 때, key가 생성되고, 다시 GitHub Actions가 동작하면 이전 워크플로우가 돌 때 설치되었던 node_modules가 캐시가 되어있다면 그것을 사용한다. 따라서 key는 매우 중요한 역할이라고 볼 수 있다.</p>
<br/>
<h2 id="캐시-적용" style="position:relative;">캐시 적용<a href="#%EC%BA%90%EC%8B%9C-%EC%A0%81%EC%9A%A9" aria-label="캐시 적용 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>우선에는 테스트하고자 하는 디렉토리에서 CRA를 사용해 react를 설치하고 <code class="language-text">.github/workflow</code> 디렉토리에 <code class="language-text">cache-test.yml</code> 파일을 생성했다.</p>
<ul>
<li>local 파일에 react 패키지 설치</li>
<li>캐싱 경로는 <code class="language-text">~/.npm</code></li>
<li>key는 <code class="language-text">package-lock.json</code> 파일 기준으로 생성</li>
<li>npm ci 설치</li>
<li>build</li>
</ul>
<div class="gatsby-highlight has-highlighted-lines" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Cache Test
<span class="token key atrule">on</span><span class="token punctuation">:</span> push
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3 <span class="token comment"># repository에서 소스 파일을 러너의 디렉토리에 가져온다.</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3 <span class="token comment"># 버전에 맞게 node.js 설치</span>
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version-file</span><span class="token punctuation">:</span> <span class="token string">'.nvmrc'</span> <span class="token comment"># .nvmrc 파일을 기준으로 삼는다.</span>
          <span class="token key atrule">cache</span><span class="token punctuation">:</span> npm
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span> <span class="token comment"># actions/cache에 넘겨줄 변수 사용 키워드</span>
<span class="gatsby-highlight-code-line">          <span class="token key atrule">path</span><span class="token punctuation">:</span> ~/.npm <span class="token comment"># 경로에 있는 파일이 캐시가 된다</span></span>          <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment"># 캐시 키 이름</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci <span class="token comment"># node clean install</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build</code></pre></div>
<p>actions/cache 액션에서 알아야 할 키워드는 <code class="language-text">path</code> 다. <a href="https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows#example-using-the-cache-action" target="_blank" rel="nofollow">GitHub Actions의 공식 문서</a>에서는 위 코드와 같이 <code class="language-text">path: ~/.npm</code> 이라고 예시에 명시되어 있다. 이 의미가 처음에는 node.js의 의존성인 node_modules 디렉토리가, 러너의 <code class="language-text">~/.npm</code> 경로에 캐싱이 되는 줄 알았다. 하지만 그렇지 않다. <strong>path에 명시되어 있는 경로에 있는 파일</strong>이 캐싱이 되고, 캐싱된 파일을 재사용할 경우 path에 명시되어 있는 경로에 다시 옮겨져 실행된다.</p>
<p>그도 그럴 것이 사용하는 도구가 npm이기 때문에 node_modules를 알고 있는 것이지, java 개발자가 gradle 같은 빌드 툴을 이용한다면 node_modules와는 상관없을 것이기 때문에 당연한 것이다.</p>
<p>어쨌든, node_modules 자체가 캐싱이 되는 것이 아닌, path에 명시한 경로에 해당하는 파일이 캐시에 저장된다는 사실을 기억하자.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 32.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABCklEQVR42oXQ2W6DMBQEUBsMGIJXNkPZGqJK6f//3/TGUdt0UftwNF5GlnzZfL5iOa5Yj1fYboHyI1QzUU739R809Uz7yfcz2Nm3OJoOF7IZh0UZrGQ3Fs/WY7eO+CjuqXPLwzVoKwUuSiRZFaWEaeVQlgoiLaKcCpmQyLIS+T9EKsGSIuJJjl7Sg920ow0b/EDfdQNk7SFVc1e/p/9VSXfVA+16sDBfMG0vGNcLzWBBqXuczM0Qs9IdTjb8UD2ibhXPBzBRBwg9Q6gnZGZFegrgJFEzeD2Blx1Ybr8x4IUjFlw6JHFNRA22dQF7P2IfJmzdiNH4D0E7yobSYvzCQGY0P5o5j+Q9hcQbtyaknT7adG4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="first-github-action-result"
        title=""
        src="/static/2d1a39a608748c3d95792ef732398e84/f97d7/first-github-action-result.png"
        srcset="/static/2d1a39a608748c3d95792ef732398e84/0eb09/first-github-action-result.png 500w,
/static/2d1a39a608748c3d95792ef732398e84/1263b/first-github-action-result.png 1000w,
/static/2d1a39a608748c3d95792ef732398e84/f97d7/first-github-action-result.png 2000w,
/static/2d1a39a608748c3d95792ef732398e84/e058c/first-github-action-result.png 2166w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>의존성 설치에 16s가 소요 되었다. Post cache actions step은, GitHub Actions의 step이 종료되면 <code class="language-text">actions/cache</code> 패키지가 워크플로우를 종료하면서 추가로 마무리하는 action이다. 이 step에서, 캐시가 저장되었음을 캐시 key와 함께 알려주고 있다. 그러면 캐시가 실제로 GitHub에 저장되어 있는지 확인해 보자. GitHub Repository의 Actions -> Caches 탭을 통해 캐시 저장소로 들어가 본다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 830px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 85.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACrElEQVR42pVU2XLaQBDcSrCxhZDQhYQE6OSUEIdlA75IsEMlVakklf//l87M2iR5ie08TI202unt6Z6VqJ2pUFsOgjCD0jRQV1rQDBedbgzddFGrq2i22rDaAbwggstB35qKhknLwND1UQ2GWEQxUlWFOFV0KnAQJiOZ+Z0B+d32ehJQ0WxYbhedXoIoHdPhA+iqjsqxcRmGeCgKPBY5ZqYBcUKMamca3tUU1BsGGrqDcwI4peezpoUGsWNA/nZKe0/OdZkV2he4AfqOC1c34RsWdN2G2Nw+YP/5Gx6+fEcyLiWAZnXQ5DA9WZiMSlzd7LG8usP2/oAFZdsLUdcc2N0U690BeXWNzf0jRDaeUcEMw3wJuxOCGTPoMRjQ66XIJgsJnI7niAYFWk5A2rfhdRNMykuMZxeEsYIw+wuM8hLDYolitcbsYoMgGsLxI7SDWAY/m6SnRcGZD9ZtX3agUXb8mIxK5brwpztcrK9xefMR67s91rd79LMJHHaTTOBghl7/T3T6mWQoAUkalUxk3RWSQLCzfJr2rBm3edzI+aXgPbrlU7sVqu0HqbNgsDkJmi+uqOWNPP09uc4O88kvhQSk+mRYIp+vUSw3ELwYj56M6acTmUdlhXQy/93Ov4JZMqDeJj2tJ8aCReVidjmlsYmGBQbTBcJsKgteZGiTLE0P7jVNwW6BT4cfECwut5sR6KhYyfY5okEuR+a1lmUXlgubTBxMaWwkbTaAN9Dd1Z91Obr4mincoTzgeWaFSotBMkUnHsGPxzBpphT6+JohR4YMbLp9tGnAWSoR2i6qKMEqTlGlA5R+AMugW/IfgBZdQzb28PUnROl62I5zbOdL7GjA1/Qb6rYsnBuelOEtGjZoljkbxFSYxCYybUSWg9i00DOdN7X7N+CTpq6MX3ObuommNPNKAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="github-actions-tab"
        title=""
        src="/static/d03fedc6626c277b814e953996be2b7a/026af/github-actions-tab.png"
        srcset="/static/d03fedc6626c277b814e953996be2b7a/0eb09/github-actions-tab.png 500w,
/static/d03fedc6626c277b814e953996be2b7a/026af/github-actions-tab.png 830w"
        sizes="(max-width: 830px) 100vw, 830px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>그러면 방금 설치한 의존성 파일이 캐시 된 것을 확인할 수 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 16.799999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAj0lEQVR42n3PTQ7CIBAFYA4gaoEWilCoBdT6t3Djyvvf6gk0mrhx8eXNTDKZDNEuoR8itq1B09m/uHIQfeF/KBsgTUCrR5BwuuPxfGE63uDCjP3hCp8uGDMfzzXLrCRTA6iwoEx9NZ2pSr0RGkS7iJ1P+cpUr/G89MGkrZbeYs01KDdYNV0mq+UzU2vKe7wBUVxOYdYYKNYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="cache-ui"
        title=""
        src="/static/8d35330702837546ad6fdbd0d57f6504/f97d7/cache-ui.png"
        srcset="/static/8d35330702837546ad6fdbd0d57f6504/0eb09/cache-ui.png 500w,
/static/8d35330702837546ad6fdbd0d57f6504/1263b/cache-ui.png 1000w,
/static/8d35330702837546ad6fdbd0d57f6504/f97d7/cache-ui.png 2000w,
/static/8d35330702837546ad6fdbd0d57f6504/d5be6/cache-ui.png 2242w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>workflow에서 생성된 캐시 key와 동일한 네이밍을 가지고 있는 것을 볼 수 있다. 그리고 오른쪽에 휴지통 아이콘이 있는 것으로 봤을 때 직접 UI에서 캐시를 삭제해 줄 수 있다는 것을 알 수 있다. (물론 CLI로 삭제도 가능하다)</p>
<p>이번에는 저장된 캐시가 잘 동작하는지 보기 위해 <code class="language-text">src</code> 파일 내부의 소스 코드를 하나 수정하고 push 한다. yml 파일은 수정하지 않았다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSklEQVR42n2R2XaDMAxESYAEYxsvmDUbbdrk/79wOixJaU/ah3tGkm1JliJfH3EcbujPH5OasoM0DZR9jXbtv0SbRCDXHtrWENRkrxDv5KSvGM/GN38RbdMcaaZhfQvL7oxvIIsSO1FgnxtikckZodyUdH6crRBPnRIKXcJWRzh+X/sOGf0kK5AKi00qESU5kTPpA4XtyI4FJtX0GY+Z0JcnhPqKUA1oujv9C4xlgXBlx7QNC6mKBKjcQwkDJUvEYiTMmgds9oaFOJPeBbSuQkcaWyIog1o71IVHVcxaa7Ng6Ts0kp3F2ZMtyVJ+eZyN4UIk55UwEMc7pNSEM0kS8U26Yok9kkUkJpVQiMr2hP7tjub8ie5yg2vPEOPG15hfuti5XcNlcrFTh+/tAff+gFvbY/ABJ+txMm7SC/0JV/6wh8V+3D0SITS+AIh/0JuNyXSLAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="apply-cache"
        title=""
        src="/static/61b44358d59a1293160eddc6d0831f5c/f97d7/apply-cache.png"
        srcset="/static/61b44358d59a1293160eddc6d0831f5c/0eb09/apply-cache.png 500w,
/static/61b44358d59a1293160eddc6d0831f5c/1263b/apply-cache.png 1000w,
/static/61b44358d59a1293160eddc6d0831f5c/f97d7/apply-cache.png 2000w,
/static/61b44358d59a1293160eddc6d0831f5c/5f4ca/apply-cache.png 2178w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>상단의 Run actions/cache@v3에 따르면 캐시가 정상적으로 복원되었다고 명시되어 있다. 이유는, 첫 번째 GitHub Actions가 동작할 때 만들어 둔 캐시가 있기 때문이고, 그를 복원시켰기 때문이다.</p>
<p>하지만 캐시가 존재하지만, 다시 <code class="language-text">Run npm ci</code> step이 실행되었다. 총 17s가 소요되었다. 캐시를 적용하든 하지 않든 거의 동일한 결과라고 볼 수 있다. 이유는 캐시가 있다고 해도 <code class="language-text">run</code> 명령어가 조건 없이 실행되도록 yml 파일에 설정되어 있기 때문이다. 그러면, 조건에 따라 npm ci를 건너뛰어도 되지 않을까? 그러면, step에 <code class="language-text">if</code>를 사용해 캐시가 존재하면 패키지를 설치하지 않도록 해보자.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
  <span class="token key atrule">id</span><span class="token punctuation">:</span> npm<span class="token punctuation">-</span>cache
  <span class="token key atrule">with</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> ~/.npm
    <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line"><span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.npm<span class="token punctuation">-</span>cache.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true' <span class="token punctuation">}</span><span class="token punctuation">}</span></span>  <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci
<span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build</code></pre></div>
<p>if 문을 사용하기 위해 9번째 라인에는 <code class="language-text">id</code>를 명시 해주었다. id는 if 문에 <code class="language-text">steps.npm-cache</code>로 사용되며, step의 결과물로 cache-hit를 얻기 위해 사용되었다.</p>
<p>그리고, if 문으로 <code class="language-text">cache-hit</code> 이 false일 경우에만, <code class="language-text">npm ci</code>를 실행하도록 변경했다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 26.400000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAiUlEQVR42p3PXQrCMBAE4LSm+dskG5OmWhBExD55/+uNSU9g+/CxMAsDI8h63GNCpQBtAgZpIC76lHGyEGu+4ft8Y3t9UJcHiCt8Wk7hskIoy3sJtaBf7dKu50dNJkIM0kK1AhcKXCytjCG1hxj7DHOcNR5zzMg8o7T511TBIcMTw7Wf1fQ3rQg/bq5v+x+1wCAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="fail-workflow"
        title=""
        src="/static/05e2001fb46dc9e34908648bf8ad90b0/f97d7/fail-workflow.png"
        srcset="/static/05e2001fb46dc9e34908648bf8ad90b0/0eb09/fail-workflow.png 500w,
/static/05e2001fb46dc9e34908648bf8ad90b0/1263b/fail-workflow.png 1000w,
/static/05e2001fb46dc9e34908648bf8ad90b0/f97d7/fail-workflow.png 2000w,
/static/05e2001fb46dc9e34908648bf8ad90b0/38915/fail-workflow.png 2182w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>워크플로우가 실패했다. 패키지를 설치하지 않도록 if 문을 사용한 부분은 의도대로 되었지만, build 부분에서 실패한 것이다. 이유는, <code class="language-text">node_modules</code>가 없기 때문이다. GitHub Actions 러너는 Job이 실행될 때마다 새로운 러너 환경을 가진다. 즉, 컴퓨터가 새롭게 세팅되는 것이다.</p>
<p>위에서 살펴봤던 <code class="language-text">path</code> 옵션을 떠올려 보자. <code class="language-text">path</code> 옵션은, node_modules가 저장될 경로를 명시하는 것이 아니라, 캐시 할 파일의 경로를 주는 옵션이다. 지금 path는 <code class="language-text">~/.npm</code> 이다. <code class="language-text">~/.npm</code> 경로에는 무엇이 있을까?</p>
<br/>
<h2 id="npm" style="position:relative;">~/.npm<a href="#npm" aria-label="npm permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>로컬 컴퓨터의 <code class="language-text">~/.npm</code> 디렉토리에 들어가보았다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1280px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABdUlEQVR42mWQ2Y6bQBBF+ZqRxwa8sDWYrdnBeOyxGY8nkRJFymP+//WksKIsysNVqau7T926xjapWAWahemysHyWdsCzqXhaeTxbHgtb6tpntZG+rVhuU5aOZuUWWH75n4y9bnDDjOU6YO2GbLy9QJQAQukprN0ey4kwdzGmm2MFFXbYYqv6L1D1W0Z3vKDrI7sgY5/XnKc7Kq6p+rMMymmGE5EeyPuJ8nAjGu5UX37gVa8yQP8DewCbw4WsGuWzJkpbXi7vxHnzAPqxpj1eydsr1Sig4Y1k/CB5/SqwAlsAdvBHs3sjLQeU5LjxEhylKfujnAuSsmcX1eTdRFicyASqu6s4fMfv72ziA6YA5yxNr/xVC4xE94TpnGMqteRwvqGyTtabcOJBQBNpc6EQd7NyAY7371Snz2QybB6UtvP9jUCP4rDoJbuGbZDIig3d6RNKv1BIXm46Z3d9fJqdzspk5frtG3Ev90kvb0cceedl4jio+AlEW/Lgg10+OAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="npm-path"
        title=""
        src="/static/6163f2c8829ea6b7d7f0afa2e7d3acf6/bbbf7/npm-path.png"
        srcset="/static/6163f2c8829ea6b7d7f0afa2e7d3acf6/0eb09/npm-path.png 500w,
/static/6163f2c8829ea6b7d7f0afa2e7d3acf6/1263b/npm-path.png 1000w,
/static/6163f2c8829ea6b7d7f0afa2e7d3acf6/bbbf7/npm-path.png 1280w"
        sizes="(max-width: 1280px) 100vw, 1280px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p><a href="https://docs.npmjs.com/cli/v9/commands/npm-cache" target="_blank" rel="nofollow">npm-cache</a>에 설명 되어 있듯, <code class="language-text">~/.npm</code> 에는 npm 자체에서 사용하는 캐시 파일이 들어있다. 이는 <code class="language-text">npm install</code> 혹은 <code class="language-text">npm ci</code> 명령어를 사용해 패키지를 설치할 때 사용할 캐시 된 파일이 들어있는 곳이다. npm 패키지를 설치할 때 해당 경로에 있는 캐시를 가져와 설치를 돕는다. 단, <code class="language-text">~/.npm</code> 경로는 OS 별로 저장 경로가 다르다.</p>
<p>그러면 GitHub Actions의 공식 문서에서 권장하는 것처럼 <code class="language-text">key: ${{ runner.os }}</code> 부분에 <code class="language-text">runner.os</code> 가 명시되어 있는 이유도, 러너를 다른 환경에서 돌리게 된다면 key가 무효화 되어야 하기 때문임을 알 수 있다. <a href="https://github.com/actions/cache/blob/main/examples.md#node---npm" target="_blank" rel="nofollow">참고</a></p>
<p>결론적으로 <code class="language-text">~/.npm</code> 경로에는 node_modules가 존재하는 것이 아니라 패키지 설치 시 더 빠르게 도와주는 npm의 캐시 된 파일이 캐시되어 있었다. <a href="https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows#example-using-the-cache-action" target="_blank" rel="nofollow">공식 문서</a>에서도 아래 코드와 같이 예제가 존재한다.</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.cache<span class="token punctuation">-</span>npm.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true' <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> List the state of node modules
  <span class="token key atrule">continue-on-error</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">run</span><span class="token punctuation">:</span> npm list

<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
  <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install

<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
  <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build</code></pre></div>
<p><code class="language-text">npm install</code> 명령어는 캐시 히트와 상관 없이 실행된다. 새롭게 node_modules가 존재해야만 build를 할 수 있기 때문이다.</p>
<p>캐시를 적용하기 위해 다시 if 문을 제거하고 반드시 패키지를 설치하도록 해봤다. 정상적으로 빌드까지 완료되었다. 하지만, 패키지를 설치하는 과정이 포함되어 있기 때문에 캐시를 사용하지 않고 워크플로우를 사용하는 시간과 거의 동일한 시간이 걸리는 것을 볼 수 있다. 따라서 캐시를 사용하는 이유가 없어 보인다.</p>
<p>그러면, path에 명시된 <code class="language-text">~/.npm</code> 파일 말고, <code class="language-text">node_modules</code> 자체를 캐시 하면 어떨까? Gtihub Actions에 cache 탭에 들어가서 휴지통 아이콘을 클릭하고 캐시를 지웠다. 그리고 아래와 같이 yml 파일을 수정하고 적용했다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
  <span class="token key atrule">id</span><span class="token punctuation">:</span> npm<span class="token punctuation">-</span>cache
  <span class="token key atrule">with</span><span class="token punctuation">:</span>
<span class="gatsby-highlight-code-line">    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token important">**/node_modules</span></span>    <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.npm<span class="token punctuation">-</span>cache.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true' <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci
<span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build</code></pre></div>
<p><code class="language-text">path</code>를 node_modules로 변경했고, if 문을 추가 했다. push 해서 캐시를 만들고, 한 번 더 push해서 캐시가 잘 사용되는지 확인했다. 즉, node_modules가 복원되어 설치 하지 않는지 확인하기 위해 src 아래의 코드를 수정하고 push를 한 번 더 했다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABUElEQVR42n3SyXKDMAwGYCjB4A1vEAJZSCaZpD102vd/ub8yJm0u9PCNvICssZz5/oj9+Y7xdMN+uqPxA5TdrtKuX9WQLN9wCO2Xj7eolcOmUgv9Mk7zgknEf9Zkb6UAqzVM2MG1IyzFeADjDSphZvWCSzMnzjf1qqxgAlwH2O4A2+6h3A41zUtuiEVeSmTx5DnKFEleKrxFTKUxi3OZEvpwRNtdyQX98ID3E6w7UsVXGHeCsQc0iq5EE+mh6TApAwr+5FGIFnllKGHJMTQevQnEo9MOnmu0yhA76zRFqRcNOtrruKAGMLqzJKdxVVTIpGkRtgeqcoCkZFxaqCZAxUY9NT6tvZB0LZz2oppIMrqALD6V28c3LvdPXN+/6Ak9EHYTwnAm07/a2TkZL3PMYjft0mFDVQo6vaIqK0GkmxsWu86V/60oEvP637dMpBfwA2W30lLQ9HOkAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="not-execute-ci"
        title=""
        src="/static/29de0aeb143b0105140392eb90c61a4d/f97d7/not-execute-ci.png"
        srcset="/static/29de0aeb143b0105140392eb90c61a4d/0eb09/not-execute-ci.png 500w,
/static/29de0aeb143b0105140392eb90c61a4d/1263b/not-execute-ci.png 1000w,
/static/29de0aeb143b0105140392eb90c61a4d/f97d7/not-execute-ci.png 2000w,
/static/29de0aeb143b0105140392eb90c61a4d/9a26f/not-execute-ci.png 2176w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>정상적으로 <code class="language-text">node_modules</code>가 패키지 내로 들어왔으며 cache-hit이 true가 되면서 npm ci가 실행되지않았다. 캐시 덕분에 시간을 아낄 수 있었다.</p>
<br/>
<h2 id="restore-keys" style="position:relative;">restore-keys<a href="#restore-keys" aria-label="restore keys permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>드디어 restore-keys 옵션이다. restore-keys 옵션은 기본 키와 일치하는 캐시를 찾을 수 없는 경우, restore-key를 사용해 최근에 생성된 가장 가까운 일치하는 캐시를 다운로드할 수 있다. 이렇게 하면 빌드/설치 단계에서 최신 의존성 몇 개만 추가로 가져오면 되므로 빌드 시간을 절약할 수 있는 기능이다.</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
  ${{ runner.os }}-node-
  ${{ runner.os }}</span></code></pre></div>
<ol>
<li>캐시 미스가 발생하면 restore-keys에 해당하는 캐시를 찾는다. 정확히 일치하는 항목이 있으면 이 작업은 캐시에 있는 파일을 path 디렉터리로 가져온다. 정확히 일치하는 항목이 없으면 작업은 복원 키의 부분 일치 항목을 검색한다.
작업이 부분적으로 일치하는 항목을 찾으면 가장 최근 캐시가 경로 디렉터리에 복원된다.</li>
<li>캐시 작업이 완료되고 작업의 다음 단계가 실행된다.</li>
<li>작업이 완료되면 이 작업은 경로 디렉토리의 내용으로 새 캐시를 자동으로 생성한다.</li>
</ol>
<hr>
<p>일반적으로 생각할 때 캐시 미스가 발생하면 기존의 캐시는 버리고 새로 의존성을 다운받아 새로운 캐시로 설정하는 것을 생각하기 쉽다. 위에서 작업했던 결과물은 key가 일치하지 않으면 새로운 의존성를 다운받고 다운받은 의존성을 캐시에 저장했다. 이것이 일반적으로 생각하는 캐시 형태다. 그렇다면 restore-keys 속성은 도대체 어떨 때 사용하는 것일까? 테스트해 보자.</p>
<h3 id="캐시-무효화" style="position:relative;">캐시 무효화<a href="#%EC%BA%90%EC%8B%9C-%EB%AC%B4%ED%9A%A8%ED%99%94" aria-label="캐시 무효화 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>캐시 무효화는 중요하다. 의존성을 새로 설치하면 캐시에 저장된 기존 의존성을 무시하고 다시 설치해야 한다. <code class="language-text">key</code> 라는 설정으로 이미 캐시 무효화 설정이 되어 있다.</p>
<p>이제, 하나의 모듈을 설치해서 다시 액션을 실행시켜 보자. 나는 <code class="language-text">lodash</code> 패키지를 그냥 하나 설치하고 push 했다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 75.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9ElEQVR42pWU6XKjQAyEMddwD8ONsQ12Kpu8/wv2tgTe3aQqW+UfX0kDHk1L9Ngbljsu6zuuZH18om5n2GaCdePPHO8rxu94aeHwGGf8Im/9iM11uFmH1TXYmpZ0uLe9xme+uhYPxrGqESYloqRCTBLm3nDecLt/YKJSOVkUPnEdYyfxDNcvaIjm/1DUA3JSU/HaDvC8IEFhO92QVS1/0CPnWvK86pj3SIsG0onJLJLcIWEu67RsEKWVKgxNAc83JMpY7Iz5+oZuvGE43zFdHlT8QD+vGuW5zradtGDE1oI41yKhKXUtSC0tKMOUdkRd6QaUbEGVUqFE/QgCC4raOLWIqTZO99nJ2mS1HuLJKdoqW8vKVnPZpO0SUbS33GiLUsQPU8iovnOS5xElZ9yoquwxPxY2eQ15t7dhDrjp2PgTnvQuckWBDFsU+hGlB+bPqa+gBaVYVu4FFaozBzKSlwrKIA2HKkXFFqL26w+S17C0QzMsamD5kuIvtUF62EF8pl4r/0tMpDuv501Ztk8sd7J9oJ1WlM28057/xnZRqu6iPNdfnlOc3pQoH5DUV8TVBVE5I8hH+PmEoFiYTzgZh1NsGesDq/hJTRx8PhO8MNtnWMk/iNzdfm/9+cXFd2IhvWYFnSDXLreaB7TTiU5QGz1jmOI3G39Znecj/rMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="not-found-cache"
        title=""
        src="/static/6aad3accc0fe45bc3c8beffa0a925b0b/f97d7/not-found-cache.png"
        srcset="/static/6aad3accc0fe45bc3c8beffa0a925b0b/0eb09/not-found-cache.png 500w,
/static/6aad3accc0fe45bc3c8beffa0a925b0b/1263b/not-found-cache.png 1000w,
/static/6aad3accc0fe45bc3c8beffa0a925b0b/f97d7/not-found-cache.png 2000w,
/static/6aad3accc0fe45bc3c8beffa0a925b0b/93333/not-found-cache.png 2174w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>결과를 보면, 로컬에 있는 package-lock.json이 npm 패키지를 설치하면서 변경되었고, 캐시 key가 변경되었기 때문에 GitHub Actions에서는 캐시 키를 찾을 수 없다는 것을 말해주고 있다. 마찬가지로 GitHub 러너에서 npm 패키지를 새롭게 다운받는다. 총 20s가 소요된 것을 볼 수 있다.</p>
<p>이마저도 조금 더 빠르게 만들 수 없을까? restore-keys 옵션을 사용해 보자.</p>
<h3 id="restore-keys-적용" style="position:relative;">restore-keys 적용<a href="#restore-keys-%EC%A0%81%EC%9A%A9" aria-label="restore keys 적용 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<div class="gatsby-highlight has-highlighted-lines" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
  <span class="token key atrule">id</span><span class="token punctuation">:</span> npm<span class="token punctuation">-</span>cache
  <span class="token key atrule">with</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token important">**/node_modules</span>
    <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">    <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></span><span class="gatsby-highlight-code-line"><span class="token scalar string">      ${{ runner.os }}-node-</span></span><span class="gatsby-highlight-code-line"><span class="token scalar string">      ${{ runner.os }}</span></span><span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.npm<span class="token punctuation">-</span>cache.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true' <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">run</span><span class="token punctuation">:</span> npm ci</code></pre></div>
<p>restore-keys 옵션은, list 형식으로 여러 prefix를 붙여줄 수 있다. 그러면 prefix 기준으로 단계별로 cache에 저장된 key의 prefix를 포함하는 단어가 있는지 찾고, 이 단어 기준 포함하는 key가 있다면 가장 최근의 해당 캐시를 가져온다.</p>
<p>restore-keys 옵션을 사용하기 위해, key를 새롭게 생성해주어야 하기 때문에 npm 패키지를 아무거나 새로 설치해 준다.</p>
<ul>
<li>emotion npm 패키지 설치</li>
<li>yml 파일에 restore-keys 추가</li>
</ul>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 103.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC3ElEQVR42pWU2Y7cRgxFtZe2WrSvPT3T7cEgz4aBIIaR//+qm8uSOrEHYwd+OCBLUt2iSBaDeb9hf3nD9nxguhW6nX+KaZefYrk3SHIN24xo2gmO5KVBltdEn/bwFW1K4qxCkJYISfQBQZCUaCuDT/2Iu2fCbix2/R8XspEbn9+qCjbNUZEoKRC+I4izEllhUNYNo7NQJJaTogxhpBDGuScgJUVmJRSYSJJS4L1gomoKObTjjmbYUNkeGUUlFSk5Psw9Qfwjj8P8+9MGKaOTQrjhQig6XVE3CwozonIzYmWYrxphZhAJ9KO0oq/9O0H8yNuaBzFs7XbU3QuFr9D9DYVeUdgduXtG0b7QPkHVExkZfccUNUxNh1A1CHOiHCKxqUbQDiv+uDzjbdnwOq34NM64DxPu44Iv84Rvy4iv84i/psHzJ/mb6899iydtcDWOAbSoyGhaBK5bMF3uaJhDVbEwdesRX9cO1tPAcYMlxnRwpGGuWzfAnN8XpLcd24bVtN2MYb76ovTTBf38dBSJtFwbHlq7ESVFcorLYR76j+Il0p9hJjmsvNBAkaZfvVA/X9BRqB23w/K97RZ/cE4hL8DuENJTUPBNLxVzFGr6jVEM0Lw13jKi2g6kh/VXbvKCpe642fjelQ5J1ClI/7hFXMj/y4fyO0JBSn3kJft+kzoii/yN+KAn5bl8KGISlTR1ZXr/W7JRTnxs/qGJP7hy/94UCV8EpPS+/BQUsSD+9cZfCkqED/Kzgnnlzkj17wnGjEbypHifH9V6n5/fYliumPcXjOsVw/IEwyo/ivN/FN8ha806BK5fMKx3jPsr+u0O0+8o3cLBQNrN+yWHRNWsKAU+e/h5s3kK+hVt5SY2N8PM9AzlLicbYg6CqJoQ6412PoYAJ0qYWU9APyW1Epgu/0772RikbI3nbsCtHzgQZvq9n9gyoS/W0X9gTw5/LEpMmcKqFOYsRyKzMCnwD2V04lt2gZOtAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="restore-test"
        title=""
        src="/static/d2f937ea762d48e1dda730f638431bcc/f97d7/restore-test.png"
        srcset="/static/d2f937ea762d48e1dda730f638431bcc/0eb09/restore-test.png 500w,
/static/d2f937ea762d48e1dda730f638431bcc/1263b/restore-test.png 1000w,
/static/d2f937ea762d48e1dda730f638431bcc/f97d7/restore-test.png 2000w,
/static/d2f937ea762d48e1dda730f638431bcc/38915/restore-test.png 2182w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>재미있는 현상이 발생한다.</p>
<h4 id="cache-action-step" style="position:relative;">cache action step<a href="#cache-action-step" aria-label="cache action step permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<ul>
<li>package-lock.json 파일이 수정되었기 때문에 새로운 key가 생성됨. 따라서 캐시 <strong>미스</strong> 상태.</li>
<li>restore-keys에 따라 기존 GitHub Actions를 통해 생성했던 캐시를 prefix 기준, 가장 최신 캐시를 복원(restore)한다. 즉, node_modules를 복원한다.</li>
</ul>
<h4 id="Run-npm-ci-step" style="position:relative;">Run npm ci step<a href="#Run-npm-ci-step" aria-label="Run npm ci step permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<ul>
<li>패키지를 설치한다. -> package.json.lock 파일이 변경 되었고 새로운 패키지가 설치되어야 하기 때문이다.</li>
<li>25s가 소요 되었다. (생각보다 오래 걸림)</li>
</ul>
<h4 id="Post-cache-actions-step" style="position:relative;">Post cache actions step<a href="#Post-cache-actions-step" aria-label="Post cache actions step permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<ul>
<li>기존 cache size는 42MB로, 이번에 npm 패키지를 추가하면서 43MB로 변경되었다.</li>
<li>새로 만든 key로 캐시를 저장한다.</li>
</ul>
<p>캐시에서 node_modules를 복원했지만, 패키지를 다시 설치하면서 25s가 소요 되었다. 우리가 원한 것은, 캐시에서 node_modules를 가져왔고, <code class="language-text">npm install</code> 명령어로 패키지를 설치하면 빠르게 설치 될 것을 예상했지만, 그렇지 않았다. 이유는 <code class="language-text">npm ci</code> 때문이다.</p>
<h3 id="npm-ci---npm-install" style="position:relative;">npm ci -> npm install<a href="#npm-ci---npm-install" aria-label="npm ci   npm install permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><a href="https://docs.npmjs.com/cli/v9/commands/npm-ci" target="_blank" rel="nofollow">npm ci</a>는 clean 설치로, <code class="language-text">node_modules</code> 디렉토리를 삭제한 뒤 <code class="language-text">package-lock.json</code> 파일 기준으로 모든 의존성을 새롭게 설치한다. npm 공식 문서에 따르면 npm ci를 사용하는 이유는 2가지다. ( <code class="language-text">npm ci</code>는 Continuous Integration이 아닌, clean install 줄임말임)</p>
<blockquote>
<p><strong>속도</strong></p>
<p><code class="language-text">npm install</code> 명령어와 비슷하지만, npm install 보다 2배 정도 빠르며 이를 통해 CI / CD에서 유용하게 사용된다. 하지만, 공식 문서 예전 버전 <code class="language-text">npm ci</code> 설명에서 속도와 관련한 이야기가 존재했지만, 최근 버전에서는 그 말이 사라졌다. 즉, <code class="language-text">npm install</code> 또한 마찬가지로 <code class="language-text">npm ci</code>에 비해 큰 차이를 보이지는 않는다.</p>
<p><strong>안정성</strong></p>
<p><code class="language-text">npm install</code> 명령은, 시맨틱 버전에 따라 package.json 파일에 명시된 버전 범위에 따라 <a href="https://docs.npmjs.com/downloading-and-installing-packages-locally#installing-an-unscoped-package" target="_blank" rel="nofollow">다른 버전이 설치</a>된다. 물론 버저닝 기호에 따라 큰 범위를 벗어나지는 않지만, 레지스트리에 업로드된 npm 패키지가 업데이트 된 경우 GitHub Actions 러너에 다른 버전이 깔릴 가능성이 있다. 하지만, npm ci는 package-lock.json 파일을 바라보고 있기 때문에 정확한 버전을 설치해 준다. 또한, node_modules 디렉토리가 기존에 존재하면 지우고 새롭게 다운받아 주기 때문에 안정성이 높다.</p>
</blockquote>
<p>마지막 결과에서 보듯 복원된 캐시인 node_modules가 디렉토리에 존재해도, 오랜 시간만큼 걸리기 때문에 여전히 우리가 원하는 결과를 가져오지 못했다. 그렇다면, <code class="language-text">npm install</code> 명령어로 바꿔보자. 그래야 restore-keys를 사용해 기존 캐시를 가져오고, npm install로 node_modules를 제거하지 않으면서 이번에 추가된 패키지만을 추가로 설치할 수 있을 것 같다.</p>
<p>이번에도 다른 패키지를 설치한 다음 push 해보자.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
  <span class="token key atrule">id</span><span class="token punctuation">:</span> npm<span class="token punctuation">-</span>cache
  <span class="token key atrule">with</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token important">**/node_modules</span>
    <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="token scalar string">      ${{ runner.os }}-node-</span>
<span class="token scalar string">      ${{ runner.os }}</span>
<span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.npm<span class="token punctuation">-</span>cache.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true' <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="gatsby-highlight-code-line">  <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install</span><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build</code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVR42oWS6W6DMBCEjblsc9hgrkAgVIlStX3/55uuzRFVatUfn2ZYS2h3dtnt8YVpfWK5f6DuZ+TVgNJeTrQdSf9HN5NXZuwA201o+it03UMVNUReQWQGiSzBY4kwyYjcKz+Id7xXG+SZqq7IuieUXaHHT2TNHXE5ITFviM2KSN/AVQcuG3BhEaTaw6VFSLWNzbs6U7r1Y+aGutM90tx1aCGLlr47qLIlb6lWe5Vea0SiREBdHbgOI4JluoGk8SLXbhAjCAWCSLz0RP6A0Tvj6UkYpugE/fC6vqMdFjSEaS6Uof2F+g/sqVnZoKh6sMv8QDfd4bTuZshyG3Mb9/ADlNlxnqJRPqKj1iPz2oKlRQ9RLRBmJhbExUhL6BHmEzH6ZQSJW4TZNNlVkIoKPK3orfI+iGjkwrQw7uZquj9qWe5n48I/RnYnJPMXIqMt+5zTLWuvqc/2G5Xrz68ObmUnAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="npm-install-test"
        title=""
        src="/static/0aa849b19fcfaf8195ba83961f1af8ea/f97d7/npm-install-test.png"
        srcset="/static/0aa849b19fcfaf8195ba83961f1af8ea/0eb09/npm-install-test.png 500w,
/static/0aa849b19fcfaf8195ba83961f1af8ea/1263b/npm-install-test.png 1000w,
/static/0aa849b19fcfaf8195ba83961f1af8ea/f97d7/npm-install-test.png 2000w,
/static/0aa849b19fcfaf8195ba83961f1af8ea/38915/npm-install-test.png 2182w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>패키지 설치가 17s로 약간은 줄긴 했지만, 큰 효과는 아니다. local에서 node_modules 디렉토리가 있는 상태로 패키지를 따로 추가하지 않고 npm install을 하면 2s 밖에 걸리지 않는다. 왜냐하면 새로 설치할 패키지가 없기 때문이다. 그 정도 효과를 기대했지만, 측정 값은 그렇지 않다.</p>
<br/>
<h2 id="여러-개의-path" style="position:relative;">여러 개의 path<a href="#%EC%97%AC%EB%9F%AC-%EA%B0%9C%EC%9D%98-path" aria-label="여러 개의 path permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>마지막으로 <code class="language-text">~/.npm</code> 캐시와 <code class="language-text">**/node_modules</code> 모두를 캐시 해서 사용하면 어떻게 될까?</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
  <span class="token key atrule">id</span><span class="token punctuation">:</span> npm<span class="token punctuation">-</span>cache
  <span class="token key atrule">with</span><span class="token punctuation">:</span>
<span class="gatsby-highlight-code-line">    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span></span><span class="gatsby-highlight-code-line"><span class="token scalar string">      **/node_modules</span></span><span class="gatsby-highlight-code-line"><span class="token scalar string">      ~/.npm</span></span>    <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="token scalar string">      ${{ runner.os }}-node-</span>
<span class="token scalar string">      ${{ runner.os }}</span>
<span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.npm<span class="token punctuation">-</span>cache.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true' <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install
<span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build</code></pre></div>
<p>path에 node_modules와 npm 캐시 두 경로 모두 포함시켰다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 63.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABoUlEQVR42p2S2W7cMAxF5V3Wasmyx8vMOGmCAu3//98NJTuepgWmaB8OuMCmSF6y7e0n1u077m8/EOYN2k0wfv5nurBCdSOYMD1sP0NT0GqPrGyRV+K/YWWjwKVD3Ro0okNRy6fEB5/BKq4Ru2yVhyQbfS47il3KcbIJerShfOziacHYodB9IhaouAErGrCcKPgf/LXDRlq4MCNcrskq26Oh8etWU3GFjIrn5WchfkB+LP47sSA3I+TwDuHvUOM7ZPiGSi+o7R2VvaE0VxRiRC4C8rZHXhtkDe2a4oLiBwFZraPKASbcoPwC6RbEByKim9GaC1o7kfoDQbtVfbqEaAtuqbj6QkmiMRk/oGXH8VhWnSPm53jkV3RK5UG1c+75oKR45JTf6KCn9TURLrekdBTnC/oXjpzQ/iEmoewARf8yP21w0wv8/AozXMEtjZu4HJBvhiM3PuKUi3aPJX3bCAdmaR/T8IKxv++4dRdBLTtp2TYJkdXdaXPuCH/gEkllqx1u/YjFD1hdwKjpqGmn53Gn0VzKpZhsI+y+3/NcHuf0ARhcJicpDVB7AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="2path"
        title=""
        src="/static/5effc46fa07f1ac5ff41503235de6d04/f97d7/2path.png"
        srcset="/static/5effc46fa07f1ac5ff41503235de6d04/0eb09/2path.png 500w,
/static/5effc46fa07f1ac5ff41503235de6d04/1263b/2path.png 1000w,
/static/5effc46fa07f1ac5ff41503235de6d04/f97d7/2path.png 2000w,
/static/5effc46fa07f1ac5ff41503235de6d04/5f4ca/2path.png 2178w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>가장 효과가 좋았다. 패키지 설치가 놀랍게도 4s만 소요되었다. GitHub Actions 공식 예제에서 <code class="language-text">~/.npm</code> path만 캐시에 저장한 것을 미루어 봤을 때, npm install 및 npm ci 명령어는 <code class="language-text">~/.npm</code> 캐시를 참조하고 있음을 알 수 있으며, node_modules가 존재하면 npm install 명령어는 node_modules에 존재하지 않는 새로운 패키지만 추가로 설치한다는 가설이 검증되었다.</p>
<p>그리고, path가 1개일 때 캐시 사이즈는 43MB 정도였지만, 사진에는 그 두배인 87MB로 표기되고 있다.</p>
<p>이 때, <code class="language-text">node_modules</code> path를 사용할 때, 공식 문서 예제에는 <code class="language-text">'</code> 로 <code class="language-text">'node_modules'</code> 와 같이 되어 있지만, path를 2개 이상 적어줄 경우 <code class="language-text">'</code> 를 빼고 적어주어야 한다.</p>
<blockquote>
<p>※ <a href="https://github.com/actions/cache/blob/main/examples.md#node---npm" target="_blank" rel="nofollow">actions/cache</a>에 따르면 node_modules를 캐시하는 것은 권장되지 않는다고 한다. 노드 버전에 따라 중단될 수 있고, <code class="language-text">npm ci</code> 에서 동작하지 않기 때문이라고 한다. (npm ci는 node_modules를 제거하고 다시 설치하기 때문)</p>
</blockquote>
<p>결론적으로 새로운 패키지를 설치하고 GitHub Actions의 워크플로우를 실행시켰을 때,</p>
<ul>
<li><code class="language-text">node_modules</code> 디렉토리와, <code class="language-text">~/.npm</code> 디렉토리 모두를 캐시</li>
<li><code class="language-text">npm install</code> 명령어로 패키지 설치</li>
</ul>
<p>조건을 만족했을 경우 패키지 설치 속도가 가장 빨랐다. 따라서, restore-keys 옵션을 사용할 때, restore-keys로 복원된 캐시 데이터는 그 캐시 데이터만으로 작업하는 것이 아니라, 캐시 기반 추가적인 작업이 존재해야 원하는 효과를 얻을 수 있다.</p>
<p>하지만, 이렇게 설정할 경우에도 주의점(단점)은 존재한다.</p>
<br/>
<h2 id="주의점" style="position:relative;">주의점<a href="#%EC%A3%BC%EC%9D%98%EC%A0%90" aria-label="주의점 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<h3 id="안정성" style="position:relative;">안정성<a href="#%EC%95%88%EC%A0%95%EC%84%B1" aria-label="안정성 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><code class="language-text">npm install</code> 명령어를 사용했기 때문에 네트워크를 통해 npm 레지스트리의 버전이 변경되었을 경우, 원하지 않는 버전이 설치되어 오류가 발생할 가능성이 있다. 이 부분은 npm 버저닝을 틸트(~) 및 캐럿(^)을 사용하지 않도록 함으로 예방할 수 있다. 그렇지 않더라도 주로 캐럿을 사용할 것이고, 이는 하위 호환성이 보장되기 때문에 크게 걱정할 필요는 없다. 만약 호환성이 걱정된다면, npm 패키지 설치가 잦지 않고, 시간을 좀 더 드리는 방법으로, restore-key를 사용하지 않고 <code class="language-text">npm ci</code> 명령어를 사용하면 된다.</p>
<h3 id="권장-방식-아님" style="position:relative;">권장 방식 아님<a href="#%EA%B6%8C%EC%9E%A5-%EB%B0%A9%EC%8B%9D-%EC%95%84%EB%8B%98" aria-label="권장 방식 아님 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>위에서 봤듯이 <code class="language-text">node_modules</code> 캐싱은 actions/cache 액션을 만든 메인테이너가 권장하는 방식은 아니다.</p>
<h3 id="스노우-볼" style="position:relative;">스노우 볼<a href="#%EC%8A%A4%EB%85%B8%EC%9A%B0-%EB%B3%BC" aria-label="스노우 볼 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>캐시 설정을 할 때, 가장 주의해야 하는 경우이다. <code class="language-text">~/.npm</code> 경로에 있는 npm 캐시는, 패키지를 삭제해도 용량이 줄지 않는다. 즉, <code class="language-text">npm uninstall [패키지명]</code> 명령어로 패키지를 삭제해도 <code class="language-text">~/.npm</code> 캐시의 용량은 줄어들지 않고 누적된다. 이는 npm이 캐시를 다루는 방식이기 때문이다. <a href="https://glebbahmutov.com/blog/do-not-let-npm-cache-snowball/" target="_blank" rel="nofollow">링크</a></p>
<p>따라서, GitHub Actions 워크플로우가 실행될 때마다 큰 용량의 <code class="language-text">~/.npm</code> 캐시를 다시 러너로 가져온다. 프로젝트가 노후화될수록 빌드 시간이 늘어날 상황이 생길 수 있다.</p>
<p>만약, 스노우 볼을 방지하기 위해서는 <code class="language-text">restore-keys</code> 옵션을 사용하지 않는다면 해결할 수 있다. 캐싱은 <code class="language-text">key</code>로 하되 <code class="language-text">key</code>에 맞지 않는다면, restore-keys로 복원하지 않고 마음 편안하게 <code class="language-text">npm ci</code> 로 clean 설치해 주면 그만이기 때문이다.</p>
<hr>
<p>위와 같은 주의점이 있을 수 있지만, 나는 문제가 발생하기 전까지는 <code class="language-text">~/.npm</code>, <code class="language-text">node_modules</code> 를 캐시에 저장하고, <code class="language-text">npm install</code> 명령어로 패키지를 설치하는 방법을 선택할 것 같다.</p>
<br/>
<h2 id="정리" style="position:relative;">정리<a href="#%EC%A0%95%EB%A6%AC" aria-label="정리 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Cache Test
<span class="token key atrule">on</span><span class="token punctuation">:</span> push
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version-file</span><span class="token punctuation">:</span> <span class="token string">'.nvmrc'</span>
          <span class="token key atrule">cache</span><span class="token punctuation">:</span> npm
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
        <span class="token key atrule">id</span><span class="token punctuation">:</span> npm<span class="token punctuation">-</span>cache
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
            **/node_modules
            ~/.npm</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
            ${{ runner.os }}-node-
            ${{ runner.os }}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.npm<span class="token punctuation">-</span>cache.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true' <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build</code></pre></div>
<ul>
<li><code class="language-text">~/.npm</code> 데이터와, <code class="language-text">node_modules</code> 데이터 모두를 GitHub Actions에 캐시 한다.</li>
<li>워크플로우가 트리거 되면 두 데이터 모두 러너 환경에 복원된다.</li>
<li>만약 의존성이 변경되었다면 <code class="language-text">npm install</code> 명령어로 의존성 설치가 시작된다.</li>
<li>node_modules가 러너 환경에 존재하기 때문에 <code class="language-text">npm ci</code> 명령어보다 <code class="language-text">npm install</code> 명령어가 빠르게 패키지를 설치한다.</li>
<li>추가로 <code class="language-text">~/.npm</code> 데이터가 있기 때문에 <code class="language-text">npm install</code> 로 의존성을 설치하면 npm 캐시로 인해 더 빠르게 패키지를 설치한다.</li>
</ul>
<p>결과: CRA와 가벼운 몇몇 패키지 설치 시 27s에서 4s로 줄임. <strong>85%</strong> 가량의 효율성 확보.</p>
<br/>
<h2 id="Gatsby-블로그-GitHub-Actions로-배포하기" style="position:relative;">Gatsby 블로그 GitHub Actions로 배포하기<a href="#Gatsby-%EB%B8%94%EB%A1%9C%EA%B7%B8-GitHub-Actions%EB%A1%9C-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0" aria-label="Gatsby 블로그 GitHub Actions로 배포하기 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>내 블로그는 <a href="https://github.com/tschaub/gh-pages" target="_blank" rel="nofollow">gh-pages</a>라는 npm 패키지로 GitHub Pages에 배포한다. gh-pages를 사용하기 전 빌드를 로컬 컴퓨터에서 돌리는데, GitHub Actions를 사용하면 내 컴퓨터의 컴퓨팅 파워를 조금이라도 아낄 수 있겠다고 생각했다. (19년도 인텔 맥북이라 빌드 돌리면 팬 돌아감…)</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> Gatsby Deployment
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> source
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">deployment</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token comment"># ci 과정을 하고 싶지 않을 때, commit message에 아래 문구를 포함.</span>
<span class="gatsby-highlight-code-line">    <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token tag">!contains(github.event.head_commit.message</span><span class="token punctuation">,</span> '<span class="token punctuation">[</span>ci skip<span class="token punctuation">]</span>') <span class="token punctuation">}</span><span class="token punctuation">}</span></span>    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># time zone이 세팅 되지 않으면 배포 시 ReactDOM 관련 Error 발생.</span>
      <span class="token comment"># GitHub Actions linux 환경에서 Gatsby 빌드 시 time zone 맞추는 작업 필요.</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Time Zone Setting
<span class="gatsby-highlight-code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> sudo timedatectl set<span class="token punctuation">-</span>timezone Asia/Seoul</span>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">node-version-file</span><span class="token punctuation">:</span> <span class="token string">'.nvmrc'</span>
          <span class="token key atrule">cache</span><span class="token punctuation">:</span> npm
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v3
        <span class="token key atrule">id</span><span class="token punctuation">:</span> npm<span class="token punctuation">-</span>cache
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="token scalar string">            **/node_modules</span>
<span class="gatsby-highlight-code-line"><span class="token scalar string">            **/.cache</span></span><span class="gatsby-highlight-code-line"><span class="token scalar string">            **/public</span></span>          <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/package-lock.json')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">restore-keys</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="token scalar string">            ${{ runner.os }}-node-</span>
<span class="token scalar string">            ${{ runner.os }}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.npm<span class="token punctuation">-</span>cache.outputs.cache<span class="token punctuation">-</span>hit <span class="token tag">!=</span> 'true' <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm run build
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> peaceiris/actions<span class="token punctuation">-</span>gh<span class="token punctuation">-</span>pages@v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">github_token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GH_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">publish_dir</span><span class="token punctuation">:</span> ./public
          <span class="token key atrule">publish_branch</span><span class="token punctuation">:</span> master
</code></pre></div>
<p>GitHub Actions를 사용하면서, Gatsby로 만든 블로그도 로컬에서 빌드하지 않고 GitHub Actions로 배포해보기로 했다. 몇 번의 실험 결과 path에 <code class="language-text">.cache</code> 파일과 <code class="language-text">public</code> 파일을 추가해주면 빌드속도가 비약적으로 상승한다. <code class="language-text">.cache</code> 파일과 <code class="language-text">public</code> 파일은 <code class="language-text">gatsby build</code> 명령어로 빌드할 때의 캐시 파일이기 때문이다. 빌드 시간이 5분 가까이 걸리던 것이, 28초가 되었다.</p>
<p><code class="language-text">~/.npm</code> 을 제외시킨 이유는 Gatsby는 패키지 설치 명령어가 실행되는 경우가 드물기 때문이다. 빌드할 때, node_modules는 빌드시 필요하기 때문에 포함시켰다.</p>
<p>또한, <a href="https://blog.outsider.ne.kr/1513" target="_blank" rel="nofollow">커밋 메시지로 GitHub Actions 실행 취소하기</a>를 참고해 커밋 메시지에 해당 문구가 포함되어 있다면 배포하지 않도록 처리했다.</p>
<p>한 가지 눈여겨봐야 할 부분은 Time Zone setting 부분이다. Time Zone setting을 하지 않고 GitHub Actions으로 블로그를 배포했을 경우, 메인 페이지가 오류 때문에 카드 부분이 2번 렌더링 되는 이슈가 생겼다. GitHub Actions의 러너가 npm 모듈을 다운받을 때, <a href="#%EC%A3%BC%EC%9D%98%EC%A0%90">주의점</a>에서 살펴봤던 <strong>안정성</strong> 문제 때문에 Gatsby에서 이미지를 다루는 모듈이 호환성 문제가 생긴 줄 알았다. GitHub Actions로 배포하지 않고 기존처럼 local에서 빌드해서 배포했을 때는 문제가 없었다.</p>
<p>또한 오류 메시지를 추적해 보니, 서버에서 렌더링 된 HTML과 클라이언트에서 렌더링 된 HTML이 달라 생기는 오류였고, 이는 날짜와 연관이 깊다는 사실을 알아냈다. 즉, Node.js가 HTML을 생성하기 위해 Gatsby 엔진을 빌드할 환경의 Time Zone을 참조하게 되어 있었기 때문에 생기는 오류였다.</p>
<p>따라서, Linux 환경이 한국의 시간에 맞게 Time Zone 세팅을 해주게 되었다.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Time Zone Setting
  <span class="token key atrule">run</span><span class="token punctuation">:</span> sudo timedatectl set<span class="token punctuation">-</span>timezone Asia/Seoul</code></pre></div>
<br/>
<h3 id="번외---GitHub-Actions의-캐시-매커니즘" style="position:relative;">번외 - GitHub Actions의 캐시 매커니즘<a href="#%EB%B2%88%EC%99%B8---GitHub-Actions%EC%9D%98-%EC%BA%90%EC%8B%9C-%EB%A7%A4%EC%BB%A4%EB%8B%88%EC%A6%98" aria-label="번외   GitHub Actions의 캐시 매커니즘 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>GitHub에서 워크플로우가 실행될 때 사진의 파란색 부분은 러너에서 실제로 CLI로 실행되는 명령어의 log를 나타내고 있다. 마지막 Post cache actions step의 명령어를 보자.</p>
<p>첫 번째 step인 cache action이 실행될 때 restore-keys에 명시된 캐시를 찾았을 때 <code class="language-text">unzstd</code> 명령어를 통해 압축된 파일을 푼다. 그리고 마지막 Post cache action step에서는 <code class="language-text">zstdmt</code> 라는 명령어를 통해 다시 압축한다.</p>
<p>두 명령어 모두 Zstandard라는 압축 프로그램이다. Facebook에서 개발한 고속 압축 알고리즘으로, 다양한 응용 분야에서 데이터 압축을 효율적으로 수행할 수 있도록 설계되었다. 따라서, 캐시를 사용할 때, node_modules 디렉토리를 직접 캐싱하는 것이 아니라, 위 명령어로 압축한 파일을 풀고 다시 저장한다.</p>
<br/>
<blockquote>
<p>참고</p>
<ul>
<li><a href="https://docs.travis-ci.com/user/caching/" target="_blank" rel="nofollow">Travis CI - Caching Dependencies and Directories</a></li>
<li><a href="https://github.com/orgs/community/discussions/25027" target="_blank" rel="nofollow">GitHub Community</a></li>
<li><a href="https://glebbahmutov.com/blog/do-not-let-npm-cache-snowball/" target="_blank" rel="nofollow">Do Not Let NPM Cache Snowball on CI</a></li>
<li><a href="https://fe-developers.kakaoent.com/2022/220106-github-actions/" target="_blank" rel="nofollow">카카오웹툰은 GitHub Actions를 어떻게 사용하고 있을까?</a></li>
<li><a href="https://blog.banksalad.com/tech/github-action-npm-cache/" target="_blank" rel="nofollow">뱅크샐러드 Web chapter에서 GitHub Action 기반의 CI 속도를 개선한 방법</a></li>
</ul>
</blockquote></div></section></article><style data-emotion="css lhozv1">.css-lhozv1{position:relative;box-sizing:border-box;width:100%;max-width:760px;margin-right:auto;margin-left:auto;}</style><div class="css-lhozv1"><div></div></div></div></main><style data-emotion="css dcfhc9">.css-dcfhc9{position:relative;padding:0 5vw;}</style><style data-emotion="css 1iakx8z">.css-1iakx8z{background:#0b0c0f;position:relative;padding:0 5vw;}.css-1iakx8z .post-card{padding-bottom:0;border-bottom:none;}.css-1iakx8z .post-card:after{display:none;}.css-1iakx8z .post-card-primary-tag{color:#fff;opacity:0.6;}.css-1iakx8z .post-card-title{color:#fff;word-break:keep-all;opacity:0.8;-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-1iakx8z .post-card:hover .post-card-image{opacity:1;}.css-1iakx8z .post-card-excerpt{color:rgb(255 255 255 / 0.6);}.css-1iakx8z .static-avatar{border-color:#000;}.css-1iakx8z .post-card-byline-content{color:rgb(255 255 255 / 0.6);}.css-1iakx8z .post-card-byline-content a{color:rgb(255 255 255 / 0.8);}.css-1iakx8z .author-avatar{border-color:#0a0b0c;}.css-1iakx8z .author-profile-image{background:#0a0b0c;}@media (max-width: 650px){.css-1iakx8z .post-card{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;margin:25px;padding:25px 0 0;}}</style><aside class="read-next css-1iakx8z e7ky4j51"><div class="css-8aaawc"><style data-emotion="css 2ud111">.css-2ud111{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 -25px;padding:60px 0 0;}</style><div class="read-next-feed css-2ud111 e7ky4j50"><style data-emotion="css 150cnm3">.css-150cnm3{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:0 1 326px;-ms-flex:0 1 326px;flex:0 1 326px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:0 25px 50px;padding:25px;background:linear-gradient(#1a1c20, #0b0c0f);border-radius:12px;}.css-150cnm3 a{-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-150cnm3 a:hover{-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 1170px){.css-150cnm3{-webkit-flex:1 1 261px;-ms-flex:1 1 261px;flex:1 1 261px;margin-bottom:5vw;}}@media (max-width: 650px){.css-150cnm3{display:none;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;margin:0 25px;padding:0;background:none;}}</style><article class="read-next-card css-150cnm3 ez817vd4"><header class="read-next-card-header"><style data-emotion="css 18chcim">.css-18chcim{margin:0;font-size:1.3rem;font-weight:300;line-height:1em;color:rgb(255 255 255 / 0.6);letter-spacing:0.4px;}.css-18chcim span,.css-18chcim a{font-size:inherit;}.css-18chcim a{font-weight:500;color:#fff;-webkit-text-decoration:none;text-decoration:none;opacity:0.8;}.css-18chcim a:hover{opacity:1;}</style><h3 class="css-18chcim ez817vd3"><span>More in</span> <a href="/tags/dev-ops/">DevOps</a></h3></header><style data-emotion="css 1vix6iq">.css-1vix6iq{font-size:1.3rem;}.css-1vix6iq ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:0;padding:0;list-style:none;}.css-1vix6iq li{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;margin:0;padding:20px 0;border-bottom:rgb(255 255 255 / 0.1);}.css-1vix6iq li:last-of-type{padding-bottom:5px;border:none;}.css-1vix6iq h4{margin:0;font-size:1.3rem;font-weight:600;line-height:1.6em;}.css-1vix6iq li a{display:block;font-size:inherit;color:#fff;opacity:0.8;}.css-1vix6iq li a:hover{opacity:1;}</style><div class="read-next-card-content css-1vix6iq ez817vd2"><ul><li><h4><a href="/tripllo/(10)vue-travis-automation/">(10) Frontend -travis 배포 자동화</a></h4><style data-emotion="css 1qhf9t">.css-1qhf9t{margin-top:2px;font-size:1.2rem;font-weight:400;line-height:1.4em;}.css-1qhf9t p{margin:0;font-size:inherit;color:rgb(255 255 255 / 0.6);}.css-1qhf9t p time{font-size:inherit;}</style><div class="read-next-card-meta css-1qhf9t ez817vd1"><p><time dateTime="2021-04-07">2021-04-07</time> -<!-- --> <!-- -->9 min read</p></div></li></ul></div><style data-emotion="css ok4czd">.css-ok4czd{position:relative;margin:40px 0 5px;}.css-ok4czd a{padding:7px 12px 8px 14px;font-size:1.3rem;color:rgb(255 255 255 / 0.6);border:1px solid rgb(255 255 255 / 0.6);border-radius:999px;-webkit-transition:all 0.35s ease-in-out;transition:all 0.35s ease-in-out;}.css-ok4czd a:hover{color:#fecd35;-webkit-text-decoration:none;text-decoration:none;border-color:#fecd35;}</style><footer class="read-next-card-footer css-ok4czd ez817vd0"><a href="/tags/dev-ops/">See all 2 posts<!-- --> →</a></footer></article><style data-emotion="css 1a2xhz7">.css-1a2xhz7{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 301px;-ms-flex:1 1 301px;flex:1 1 301px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:220px;margin:0 20px 60px;-webkit-background-size:cover;background-size:cover;}.css-1a2xhz7 img{-webkit-transform:scale(1)!important;-moz-transform:scale(1)!important;-ms-transform:scale(1)!important;transform:scale(1)!important;-webkit-transition:opacity 0.3s ease-out 0s,-webkit-transform 0.5s ease 0s!important;transition:opacity 0.3s ease-out 0s,transform 0.5s ease 0s!important;}.css-1a2xhz7:hover .post-card-image:after{opacity:var(--post-card-after-opacity);}.css-1a2xhz7:hover img[data-main-image]{-webkit-transform:scale(1.03)!important;-moz-transform:scale(1.03)!important;-ms-transform:scale(1.03)!important;transform:scale(1.03)!important;}.css-1a2xhz7.is-next .post-card-image{background:#191b1f;border:1px solid var(--image-border-color__dark);}.css-1a2xhz7.is-next .post-card-primary-tag a{color:#90a2aa;}.css-1a2xhz7.is-next .post-card-excerpt{color:#768086;}.css-1a2xhz7.is-next .post-card-byline-content{color:#90a2aa;}</style><article class="post-card   is-next css-1a2xhz7"><style data-emotion="css uih3rl">.css-uih3rl{position:relative;overflow:hidden;display:block;border-radius:12px;}</style><a class="post-card-image-link css-uih3rl" href="/environment/putting-rules-into-import-syntax-with-eslint/"><style data-emotion="css pg199o">.css-pg199o{overflow:hidden;width:auto;height:200px;background-color:var(--background-color);-webkit-background-size:cover;background-size:cover;border:1px solid var(--image-border-color);border-radius:12px;}.css-pg199o:after{content:'';position:absolute;top:0;left:0;display:block;width:100%;height:100%;opacity:var(--post-card-opacity);background-color:var(--post-card-background);-webkit-transition:all 0.3s ease 0s;transition:all 0.3s ease 0s;}.css-pg199o img{border-radius:12px;}</style><div class="post-card-image css-pg199o ezywgfd6"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:66.71875%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAUGBAj/xAAXAQADAQAAAAAAAAAAAAAAAAADBAgJ/9oADAMBAAIQAxAAAAHvHe+f5P0/BF+Ih//EABoQAQACAwEAAAAAAAAAAAAAAAMCBQABBBL/2gAIAQEAAQUC6GPkWPhM3zri0xvYTrybRVxDH//EAB8RAAICAQQDAAAAAAAAAAAAAAECAwQSAAURFDJBgf/aAAgBAwEBPwG1utZUqNXnLStXJurJE+C2ezPikRwU4dUVizEvzKX4I8QN/X2V+I/Gv//EACERAAICAQQCAwAAAAAAAAAAAAECAwQRAAUGEhMxISJS/9oACAECAQE/AavEdulijhsVN0SbBLXK12jIFYscI1KfxiXqvUhktwDBwQxBOpuEW0ldYPJLCGIjkeWtEzp8YZo/v0JHte7Y/R96/8QAKRAAAgECAwUJAAAAAAAAAAAAAQIDERIABEETMTJRkQUhIiNCU2KBkv/aAAgBAQAGPwLKwy7Ta513SBI0vLGNb3J5KBriiSLf7beCT8Pa3QHHCcZPtBp5LsnFPFHFapj8/ikPqvA7hQ7sUlo4+SKeld31ixXkpWouYtSuguqQvIVoNMf/xAAfEAEAAgIBBQEAAAAAAAAAAAABESEAYVExQXGBseH/2gAIAQEAAT8hOZJ8EwBJsnuWCWkJMbB+tY0N3gl+H7l5NnRrIoCaClVkpuNG7UlcKE5ydvOXQa9keUMArP/aAAwDAQACAAMAAAAQMC//xAAZEQEBAAMBAAAAAAAAAAAAAAABEQAhMWH/2gAIAQMBAT8Q4O0KU9CJGmAMBgUAWqtWKDO7QfNF/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREhUf/aAAgBAgEBPxBYdg6WI/aaU4gf8yz1NIiqAxf/xAAZEAEBAQEBAQAAAAAAAAAAAAABESExAKH/2gAIAQEAAT8Q0HMw9uc8VKcfFzB1TDpsLF4sQFMk23dfQ95nPAkThPFrXyLQQletTC1yUzDoTQO+UZGmJV7sU1EQB//Z" alt=""/><picture><source type="image/webp" data-srcset="/static/745053477406742b937cf317c03bd51c/62859/main.webp 640w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/745053477406742b937cf317c03bd51c/e70fc/main.jpg" data-srcset="/static/745053477406742b937cf317c03bd51c/e70fc/main.jpg 640w" alt="ESLint로 import 구문에 규칙 넣기 cover image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/745053477406742b937cf317c03bd51c/62859/main.webp 640w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/745053477406742b937cf317c03bd51c/e70fc/main.jpg" srcSet="/static/745053477406742b937cf317c03bd51c/e70fc/main.jpg 640w" alt="ESLint로 import 구문에 규칙 넣기 cover image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></a><style data-emotion="css z5atxi">.css-z5atxi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="post-card-content css-z5atxi ezywgfd5"><style data-emotion="css 1k7wcu">.css-1k7wcu{margin:15px 0 0.2em;font-size:1.2rem;font-weight:500;color:#90a2aa;letter-spacing:0.2px;}.css-1k7wcu a{font-size:1.2rem;color:var(--anchor-secondary-color);}</style><div class="post-card-primary-tag css-1k7wcu ezywgfd4"><a href="/tags/environment/">Environment</a>,  <a href="/tags/es-lint/">ESLint</a></div><style data-emotion="css 1fjrpmt">.css-1fjrpmt{position:relative;display:block;color:#15171A;}.css-1fjrpmt:hover{-webkit-text-decoration:none;text-decoration:none;}</style><a class="post-card-content-link css-1fjrpmt" href="/environment/putting-rules-into-import-syntax-with-eslint/"><header><style data-emotion="css 18yvs8h">.css-18yvs8h{margin:0 0 0.4em;line-height:1.15em;color:var(--post-card-title);word-break:keep-all;}</style><h2 class="post-card-title css-18yvs8h ezywgfd3">ESLint로 import 구문에 규칙 넣기</h2></header><style data-emotion="css 13tchzb">.css-13tchzb{font-size:1.6rem;color:var(--post-card-description);}.css-13tchzb p{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;width:100%;margin-bottom:0.4em;font-size:1.4rem;text-overflow:ellipsis;word-break:keep-all;-webkit-line-clamp:2;}</style><section class="post-card-excerpt css-13tchzb ezywgfd2"><p>규칙을 가지고 import 구문이 정리된다면, 해당 파일에서는 어떤 종속성을 가지고 있고 어떤 기능을 사용하는지 한 눈에 파악하기 쉬울 것이다.</p></section></a><style data-emotion="css 143c7df">.css-143c7df{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding:0;}</style><footer class="post-card-meta css-143c7df ezywgfd1"><style data-emotion="css 137vq87">.css-137vq87{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 50%;-ms-flex:1 1 50%;flex:1 1 50%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-weight:400;line-height:1.4em;color:#90a2aa;letter-spacing:0.2px;}.css-137vq87 time{font-size:1.3rem;}.css-137vq87 span{margin:0;font-size:1.3rem;}.css-137vq87 a{font-weight:600;color:var(--post-card-by-line);}</style><div class="post-card-byline-content css-137vq87 ezywgfd0"><span class="post-card-byline-date"><time dateTime="2023-09-06">2023-09-06</time> <span class="bull">•</span> <span>9 min read</span></span></div></footer></div></article><article class="post-card   is-next css-1a2xhz7"><a class="post-card-image-link css-uih3rl" href="/nextjs/about-modularizing-api-routes-code-in-nextjs/"><div class="post-card-image css-pg199o ezywgfd6"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:52.34375%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/webp;base64,UklGRlABAABXRUJQVlA4IEQBAAAQBgCdASoUAAoAAAAAJQBOmUI4G2AKEr3kT9TfSAd8bMV4y7BHP9V/MDjAP1APvhp9S1P4WAaWWwAA/v//FO+/uU2wVgdvo3t7+/esHdVnt/ADvJNu//kKsryq7K4/kH6dQSpGZH/Wmy5Hn/aiP/iWMNYE/L04/fxOh6w6LNfMVCO2e4bk1w+gWtpgjXx8dPwxbP/af/3X+0eo//xh3vW8bP8x/59L+P+uAb/nTz0WLfd1P3vPtBSZEyy/3T0wbRrtQDgzQWJR+Ionuv+3z/+oMGf/VUBr79zfpXfp+qM/6uI1nkf8xYssVf+Jam3g3/89o/+0Ec/+2AL9tBfn9QixAvY/zPVrT+ICoP+ly+1C7/DtZUF9PQRI4d13mrIY7dR2bGTX2cQVs9OgNCzOMwQy1nvlPj56aTR9Kl6iaLrR7askCAA=" alt=""/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/6763177ee50addd67c4dc57952797f69/231da/main.webp" data-srcset="/static/6763177ee50addd67c4dc57952797f69/7513b/main.webp 750w,/static/6763177ee50addd67c4dc57952797f69/317ed/main.webp 1080w,/static/6763177ee50addd67c4dc57952797f69/b5c49/main.webp 1366w,/static/6763177ee50addd67c4dc57952797f69/231da/main.webp 1920w" alt="Next.js의 API Routes 코드 모듈화에 대해서 cover image"/><noscript><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/6763177ee50addd67c4dc57952797f69/231da/main.webp" srcSet="/static/6763177ee50addd67c4dc57952797f69/7513b/main.webp 750w,/static/6763177ee50addd67c4dc57952797f69/317ed/main.webp 1080w,/static/6763177ee50addd67c4dc57952797f69/b5c49/main.webp 1366w,/static/6763177ee50addd67c4dc57952797f69/231da/main.webp 1920w" alt="Next.js의 API Routes 코드 모듈화에 대해서 cover image"/></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></a><div class="post-card-content css-z5atxi ezywgfd5"><div class="post-card-primary-tag css-1k7wcu ezywgfd4"><a href="/tags/next-js/">Next.js</a></div><a class="post-card-content-link css-1fjrpmt" href="/nextjs/about-modularizing-api-routes-code-in-nextjs/"><header><h2 class="post-card-title css-18yvs8h ezywgfd3">Next.js의 API Routes 코드 모듈화에 대해서</h2></header><section class="post-card-excerpt css-13tchzb ezywgfd2"><p>API Routes를 사용하면 코드가 매우 지저분해진다. API Routes를 사용하면서 어떻게 하면 코드를 보기 좋은 형태로 남길 수 있을지 고민한 흔적.</p></section></a><footer class="post-card-meta css-143c7df ezywgfd1"><div class="post-card-byline-content css-137vq87 ezywgfd0"><span class="post-card-byline-date"><time dateTime="2023-07-26">2023-07-26</time> <span class="bull">•</span> <span>11 min read</span></span></div></footer></div></article></div></div></aside><style data-emotion="css r21a16">.css-r21a16{position:relative;padding:0 5vw;position:relative;padding-top:20px;padding-bottom:22px;color:#fff;background:#0b0c0f;}</style><footer class="css-r21a16"><style data-emotion="css 98e3yl">.css-98e3yl{width:100%;max-width:1040px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;font-size:1.3rem;color:rgb(255 255 255 / 0.7);}.css-98e3yl a{color:rgb(255 255 255 / 0.7);}.css-98e3yl a:hover{color:rgb(255 255 255 / 1);-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 650px){.css-98e3yl{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="css-98e3yl"><section class="copyright">© <!-- -->2024<!-- --> <span>|  </span><a href="https://www.gatsbyjs.com/" target="_blank" rel="nofollow noreferrer">Pozafly&#x27;s Blog<!-- --> <!-- -->is based on Gatsby</a></section><style data-emotion="css 13qgqyf">.css-13qgqyf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-13qgqyf a{position:relative;margin-left:20px;font-size:1.3rem;}.css-13qgqyf a:before{content:'';position:absolute;top:11px;left:-11px;display:block;width:2px;height:2px;background:#fff;border-radius:100%;}.css-13qgqyf a:first-of-type:before{display:none;}@media (max-width: 650px){.css-13qgqyf a:first-of-type{margin-left:0;}}</style><nav class="css-13qgqyf e69t7dt0"><a href="/">Latest Posts</a><a href="https://github.com/pozafly" target="_blank" rel="noopener noreferrer">Github</a><a href="/rss.xml">RSS</a></nav></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/dev-ops/cache-and-restore-keys-in-github-actions/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-db5c9dcfc2ccf4844ceb.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-66b172154af8f94c40a0.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-48d1bd7f5a61cb72569a.js\"],\"component---src-pages-tags-tsx\":[\"/component---src-pages-tags-tsx-555d88891cc82a7d577e.js\"],\"component---src-templates-index-tsx\":[\"/component---src-templates-index-tsx-2bf5c31f06d39b0876e3.js\"],\"component---src-templates-post-tsx\":[],\"component---src-templates-tags-tsx\":[\"/component---src-templates-tags-tsx-181d88e5375fff10a375.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="5040abc7b9cfc2c8814b";</script><script src="/webpack-runtime-1e5dfda775b28f29b82e.js" async></script><script src="/app-db5c9dcfc2ccf4844ceb.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>