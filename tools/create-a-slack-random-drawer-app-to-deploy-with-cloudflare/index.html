<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.3"/><meta name="description" content="Bolt-js와 Ngrok을 사용한 서버 개발환경, Cloudflare의 Workers에 배포하기까지의 마이그레이션 과정의 기록." data-gatsby-head="true"/><meta property="og:site_name" content="Pozafly&#x27;s Blog" data-gatsby-head="true"/><meta property="og:type" content="article" data-gatsby-head="true"/><meta property="og:title" content="Cloudflare로 배포하는 슬랙 랜덤 추첨기 앱 만들기" data-gatsby-head="true"/><meta property="og:description" content="Bolt-js와 Ngrok을 사용한 서버 개발환경, Cloudflare의 Workers에 배포하기까지의 마이그레이션 과정의 기록." data-gatsby-head="true"/><meta property="og:url" content="https://pozafly.github.io/tools/create-a-slack-random-drawer-app-to-deploy-with-cloudflare/" data-gatsby-head="true"/><meta property="og:image" content="https://pozafly.github.io/static/2d8dcfa2060685360c28aafc7bea38ad/62427/main.png" data-gatsby-head="true"/><meta property="article:published_time" content="2024-03-15T14:25:47.000Z" data-gatsby-head="true"/><meta property="article:tag" content="Tool" data-gatsby-head="true"/><meta name="github:card" content="summary_large_image" data-gatsby-head="true"/><meta name="github:title" content="Cloudflare로 배포하는 슬랙 랜덤 추첨기 앱 만들기" data-gatsby-head="true"/><meta name="github:description" content="Bolt-js와 Ngrok을 사용한 서버 개발환경, Cloudflare의 Workers에 배포하기까지의 마이그레이션 과정의 기록." data-gatsby-head="true"/><meta name="github:url" content="https://pozafly.github.io/tools/create-a-slack-random-drawer-app-to-deploy-with-cloudflare/" data-gatsby-head="true"/><meta name="github:image" content="https://pozafly.github.io/static/2d8dcfa2060685360c28aafc7bea38ad/62427/main.png" data-gatsby-head="true"/><meta name="github:label1" content="Written by" data-gatsby-head="true"/><meta name="github:data1" content="Pozafly" data-gatsby-head="true"/><meta name="github:label2" content="Filed under" data-gatsby-head="true"/><meta name="github:data2" content="Tool" data-gatsby-head="true"/><meta name="github:site" content="@pozafly" data-gatsby-head="true"/><meta name="github:creator" content="@pozafly" data-gatsby-head="true"/><meta property="og:image:width" content="1" data-gatsby-head="true"/><meta property="og:image:height" content="0.6675213675213676" data-gatsby-head="true"/><link rel="icon" href="/favicon-32x32.png?v=a62d45ddbe29cf42da820a576d9375e1" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a62d45ddbe29cf42da820a576d9375e1"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .auto-link.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .auto-link.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .auto-link svg,
    h2 .auto-link svg,
    h3 .auto-link svg,
    h4 .auto-link svg,
    h5 .auto-link svg,
    h6 .auto-link svg {
      visibility: hidden;
    }
    h1:hover .auto-link svg,
    h2:hover .auto-link svg,
    h3:hover .auto-link svg,
    h4:hover .auto-link svg,
    h5:hover .auto-link svg,
    h6:hover .auto-link svg,
    h1 .auto-link:focus svg,
    h2 .auto-link:focus svg,
    h3 .auto-link:focus svg,
    h4 .auto-link:focus svg,
    h5 .auto-link:focus svg,
    h6 .auto-link:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><link rel="canonical" href="https://pozafly.github.io/tools/create-a-slack-random-drawer-app-to-deploy-with-cloudflare/" data-baseprotocol="https:" data-basehost="pozafly.github.io"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SLQNH3ND3J"></script><script>
      
      function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='G-SLQNH3ND3J',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
      if(!(navigator.doNotTrack == "1" || window.doNotTrack == "1")) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SLQNH3ND3J', {"anonymize_ip":true,"cookie_expires":0,"send_page_view":false});
      }
      </script><title data-gatsby-head="true">Cloudflare로 배포하는 슬랙 랜덤 추첨기 앱 만들기</title></head><body><script>
  (function() {
    window.__onThemeChange = function() {}; // 컴포넌트에서 정의할 테마 변경 콜백

    let preferredTheme; // 초기화에 사용할 테마
    try {
      const saved = localStorage.getItem('theme') // 로컬 스토리지에 있는 것 사용
      if (saved) {
        preferredTheme = saved.toLowerCase()
      }
    } catch (err) { }

    // 테마 설정 함수
    window.__setPreferredTheme = function(newTheme) {
      window.__theme = newTheme; // 테마는 전역 변수에 저장
      preferredTheme = newTheme;
      document.body.className = newTheme; // 바디에 클래스 추가
      window.__onThemeChange(newTheme); // 콜백 실행

      try {
        localStorage.setItem('theme', newTheme);
      } catch (err) {}
    }

    // 컬러모드 미디어 쿼리 객체를 가져온다
    const darkQuery = window.matchMedia('(prefers-color-scheme: dark)');

    // 컬러모드 변경 탐지 이벤트 리스터 추가
    darkQuery.addListener(function(e) {
      window.__setPreferredTheme(e.matches ? 'dark' : 'light')
    });

    // 테마 설정. 저장된 테마가 없으면 시스템 설정을 사용한다.
    window.__setPreferredTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
  })();
  </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="post-template"><style data-emotion="css-global xeysos">html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,dl,dt,dd,ol,fieldset,form,label,legend,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;font:inherit;font-size:16px;vertical-align:baseline;border:0;}html .error-front-page,body .error-front-page,div .error-front-page,span .error-front-page,applet .error-front-page,object .error-front-page,iframe .error-front-page,h1 .error-front-page,h2 .error-front-page,h3 .error-front-page,h4 .error-front-page,h5 .error-front-page,h6 .error-front-page,p .error-front-page,blockquote .error-front-page,pre .error-front-page,a .error-front-page,abbr .error-front-page,acronym .error-front-page,address .error-front-page,big .error-front-page,cite .error-front-page,code .error-front-page,del .error-front-page,dfn .error-front-page,em .error-front-page,img .error-front-page,ins .error-front-page,kbd .error-front-page,q .error-front-page,s .error-front-page,samp .error-front-page,small .error-front-page,strike .error-front-page,strong .error-front-page,sub .error-front-page,sup .error-front-page,tt .error-front-page,var .error-front-page,dl .error-front-page,dt .error-front-page,dd .error-front-page,ol .error-front-page,fieldset .error-front-page,form .error-front-page,label .error-front-page,legend .error-front-page,article .error-front-page,aside .error-front-page,canvas .error-front-page,details .error-front-page,embed .error-front-page,figure .error-front-page,figcaption .error-front-page,footer .error-front-page,header .error-front-page,hgroup .error-front-page,menu .error-front-page,nav .error-front-page,output .error-front-page,ruby .error-front-page,section .error-front-page,summary .error-front-page,time .error-front-page,mark .error-front-page,audio .error-front-page,video .error-front-page{font-size:1.6rem;}body{overflow-x:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:1.6rem;-moz-font-feature-settings:'liga' on;font-weight:400;font-style:normal;line-height:1.6em;color:var(--body-color);letter-spacing:0;background:var(--background-color);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;word-break:break-word;}body::-webkit-scrollbar{width:6px;background-color:transparent;}body::-webkit-scrollbar-thumb{background-color:hsl(230 5% 35%);border-radius:8px;}body.light{--body-color:#303a3e;--background-color:#fff;--main-color:#000;--link-color:#0a0b0c;--border-top-color:#e4eaed;--nav-background:rgb(255 255 255 / 0.4);--nav-border-color:rgb(0 0 0 / 0.05);--header-color:var(--background-color);--header-after:var(--background-color);--header-before:rgb(255 255 255 / 0.05);--author-border:#fff;--home-header-color:#15171A;--home-header-border-bottom:#eaeff1;--header-author-link:#15171A;--no-image-border:#eaeff1;--strong-font-weight:600;--anchor-color:#768086;--loader-color:hsla(230 40% 10% / 0.8);--loader-color2:hsla(230 40% 10% / 0.2);--image-border-color:hsl(230 25% 94%);--post-card-title:rgb(21 23 26);--post-card-description:rgb(48 58 62);--post-card-by-line:#434952;--strong-color:#0a0b0c;--figcaption-color:#000;--table-first-of-type:linear-gradient(
        to right,
        rgb(255 255 255) 50%,
        rgb(255 255 255 / 0) 100%
      );--table-last-of-type:linear-gradient(
        to left,
        rgb(255 255 255) 50%,
        rgb(255 255 255 / 0) 100%
      );--table-th-background:#f4f8fb;--table-th-border:#e1edf4;--tag-boxshadow:hsl(218 53% 10% / 0.12);--tag-background:#f5f5f5;--post-full-border:#e4eaed;--post-full-meta-link:#2c3036;--post-full-meta-link-hover:#15171A;--post-full-title:#0b0c0e;--highlight-background:#fafafa;--highlight-border:#d1d1d1;--pre-code-color:#000;--little-code-background:var(--highlight-background);--little-code-border:#d1d1d1;--prism-background:hsl(0 0% 90.66%);--prism-border-left:hsl(0 0% 82.88%);--about-box-shadow:10px 10px 30px #bebebe,-10px -10px 30px #fff;--post-card-opacity:0;--post-card-background:rgb(0 0 0 / 0.1);--post-card-after-opacity:1;}body.dark{--body-color:rgba(255 255 255 / 0.75);--background-color:#191b1f;--main-color:#fff;--link-color:rgba(255 255 255 / 0.9);--border-top-color:#2b2f36;--nav-background:rgba(25 27 31 / 0.4);--nav-border-color:rgba(255 255 255 / 0.05);--header-color:#0a0b0c;--header-after:#191b1f;--header-before:rgba(0 0 0 / 0.6);--author-border:#1a1c20;--home-header-color:rgba(255 255 255 / 0.9);--home-header-border-bottom:#272a30;--header-author-link:rgba(255 255 255 / 0.75);--no-image-border:#3b4049;--strong-font-weight:500;--anchor-color:#90a2aa;--loader-color:hsl(230 40% 90% / 0.8);--loader-color2:hsl(230 40% 90% / 0.2);--image-border-color:hsl(230 6% 23%);--post-card-title:rgba(255 255 255 / 0.85);--post-card-description:#768086;--post-card-by-line:rgba(255 255 255 / 0.75);--strong-color:#f2f2f2;--figcaption-color:rgba(255 255 255 / 0.6);--table-first-of-type:linear-gradient(
        to right,
        #191b1f 50%,
        #191b1f 100%
      );--table-last-of-type:linear-gradient(270deg, #191b1f 50%, rgb(25 27 31));--table-th-background:#2b2f36;--table-th-border:var(--table-th-background);--tag-boxshadow:#090f1a;--tag-background:#282b31;--post-full-border:#3b4049;--post-full-meta-link:rgb(255 255 255 / 0.75);--post-full-meta-link-hover:#fff;--post-full-title:rgb(255 255 255 / 0.9);--highlight-background:rgb(32 36 39);--highlight-border:none;--pre-code-color:#c9d1d9;--little-code-background:rgb(96 98 100 / 0.4);--little-code-border:none;--prism-background:rgb(0 0 0 / 0.4);--prism-border-left:#818181;--about-box-shadow:10px 20px 20px hsl(230 4% 8% / 0.3);--post-card-opacity:0.6;--post-card-background:rgb(0 0 0 / 0.3);--post-card-after-opacity:0.1;}a{color:var(--anchor-color);-webkit-text-decoration:none;text-decoration:none;background-color:transparent;}a:hover{-webkit-text-decoration:underline;text-decoration:underline;}a:active,a:hover{outline:0;}ol,ul{max-width:100%;padding-left:1.3em;list-style:none;}blockquote,q{quotes:none;}blockquote:before,blockquote:after,q:before,q:after{content:none;}table{border-spacing:0;border-collapse:collapse;}img{max-width:100%;border:0;}html{overflow:hidden scroll;box-sizing:border-box;font-family:sans-serif;font-size:62.5%;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgb(0 0 0 / 0);}*,*:before,*:after{box-sizing:inherit;}b,strong{font-weight:var(--strong-font-weight);}i,em,dfn{font-style:italic;}small{font-size:80%;}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline;}sup{top:-0.5em;}sub{bottom:-0.25em;}mark{background-color:#fdffb6;}code,kbd,pre,samp{font-family:monospace;font-size:1em;}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit;}button{overflow:visible;border:none;}button,select{text-transform:none;}button,html input[type='button'],input[type='reset'],input[type='submit']{cursor:pointer;-webkit-appearance:button;}button[disabled],html input[disabled]{cursor:default;}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0;}input{line-height:normal;}input:focus{outline:none;}input[type='checkbox'],input[type='radio']{box-sizing:border-box;padding:0;}input[type='number']::-webkit-inner-spin-button,input[type='number']::-webkit-outer-spin-button{height:auto;}input[type='search']{box-sizing:content-box;-webkit-appearance:textfield;}input[type='search']::-webkit-search-cancel-button,input[type='search']::-webkit-search-decoration{-webkit-appearance:none;}legend{padding:0;border:0;}textarea{resize:vertical;overflow:auto;}td,th{padding:0;}hr{position:relative;display:block;width:100%;height:1px;margin:2.5em 0 3.5em;padding:0;border:0;border-top:1px solid var(--border-top-color);}audio,canvas,iframe,img,svg,video{vertical-align:middle;}svg:not(:root){overflow:hidden;}fieldset{margin:0;padding:0;border:0;}p,ul,ol,dl,blockquote{margin:0 0 1.5em;}ul{list-style:disc;}ol{list-style:decimal;}ol ol,ul ul,ul ol,ol ul{margin:0.5em 0 1em;}li{margin:0.4em 0;padding-left:0.3em;line-height:1.6em;}dt{float:left;width:120px;margin:0 20px 0 0;font-weight:500;color:#15171A;text-align:right;}dd{margin:0 0 5px;text-align:left;}blockquote{margin:1.5em 0;padding:0 1.6em;border-left:#e5eff5 0.5em solid;}blockquote p{margin:0.8em 0;font-size:1.2em;font-weight:400;}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;font-size:0.9em;opacity:0.8;}blockquote cite{font-weight:700;}blockquote cite a{font-weight:400;}h1,h2,h3,h4,h5,h6{margin-top:0;font-weight:600;line-height:1.15;text-rendering:optimizeLegibility;}h1 a.auto-link,h2 a.auto-link,h3 a.auto-link,h4 a.auto-link,h5 a.auto-link,h6 a.auto-link{box-shadow:none!important;}h1 a.auto-link:hover,h2 a.auto-link:hover,h3 a.auto-link:hover,h4 a.auto-link:hover,h5 a.auto-link:hover,h6 a.auto-link:hover{box-shadow:none!important;}h1 a.auto-link svg,h2 a.auto-link svg,h3 a.auto-link svg,h4 a.auto-link svg,h5 a.auto-link svg,h6 a.auto-link svg{opacity:0;fill:var(--link-color)!important;-webkit-transition:0.25s ease;transition:0.25s ease;}h1:hover a.auto-link svg,h2:hover a.auto-link svg,h3:hover a.auto-link svg,h4:hover a.auto-link svg,h5:hover a.auto-link svg,h6:hover a.auto-link svg{opacity:1;}h1{margin:0 0 0.5em;font-size:5.5rem;font-weight:600;}@media (max-width: 500px){h1{font-size:2.2rem;}}h2{margin:1.5em 0 0.5em;font-size:2.2rem;}@media (max-width: 500px){h2{font-size:1.8rem;}}h3{margin:1.5em 0 0.5em;font-size:1.8rem;font-weight:500;}@media (max-width: 500px){h3{font-size:1.7rem;}}h4{margin:1.5em 0 0.5em;font-size:1.6rem;font-weight:500;}h5{margin:1.5em 0 0.5em;font-size:1.4rem;font-weight:500;}h6{margin:1.5em 0 0.5em;font-size:1.4rem;font-weight:500;}.medium-zoom-overlay{-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);}.gatsby-resp-image-background-image{border-radius:6px;}.gatsby-resp-image-wrapper{margin:40px 0;}@media (max-width: 800px){.gatsby-resp-image-wrapper{width:100%;margin:initial;}}.medium-zoom-image{box-shadow:none!important;}.copyright{font-size:1.4rem;}.copyright a{font-size:inherit;}</style><style data-emotion="css vva9px">.css-vva9px .site-main{margin-top:64px;padding-bottom:4vw;background:var(--background-color);}</style><style data-emotion="css 163jdes">.css-163jdes{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;}.css-163jdes .site-main{margin-top:64px;padding-bottom:4vw;background:var(--background-color);}</style><div class="css-163jdes e1xu36er0"><header class="site-header"><style data-emotion="css 1kbvt30">.css-1kbvt30{position:relative;padding:0 5vw;position:fixed;z-index:1000;top:0;right:0;left:0;background:var(--nav-background);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter:saturate(180%) blur(20px);border-bottom:1px solid var(--nav-border-color);}</style><div class="css-1kbvt30"><style data-emotion="css 8aaawc">.css-8aaawc{width:100%;max-width:1040px;margin:0 auto;}</style><div class="css-8aaawc"><style data-emotion="css tetqay">.css-tetqay{position:relative;z-index:100;overflow-y:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;height:52px;font-size:1.3rem;}</style><nav class="css-tetqay"><style data-emotion="css qxzoul">.css-qxzoul{overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:10px;font-weight:500;text-transform:uppercase;letter-spacing:0.2px;white-space:nowrap;-webkit-overflow-scrolling:touch;-ms-overflow-scrolling:touch;}@media (max-width: 700px){.css-qxzoul{margin-right:0;}}</style><div class="site-nav-left css-qxzoul esgr0m44"><style data-emotion="css yn94hc">.css-yn94hc{position:relative;z-index:100;display:inline-block;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin-right:32px;padding:12px 0;font-size:1.7rem;font-weight:700;line-height:1.8rem;color:#fff;text-transform:none;letter-spacing:-0.5px;}.css-yn94hc:hover{-webkit-text-decoration:none;text-decoration:none;}.css-yn94hc img{display:block;width:auto;height:21px;}@media (max-width: 700px){.css-yn94hc{margin-right:18px;}}</style><a class="site-nav-logo css-yn94hc" href="/"><img src="/static/a62d45ddbe29cf42da820a576d9375e1/aef42/alien.png" alt="Pozafly&#x27;s Blog" width="21" height="21"/></a><style data-emotion="css 1xdepn">.css-1xdepn{position:relative;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}</style><div class="css-1xdepn esgr0m43"><style data-emotion="css f30i1v">.css-f30i1v{position:absolute;z-index:1000;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0 0 0 -12px;padding:0;list-style:none;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-f30i1v li{display:block;margin:0;padding:0;}.css-f30i1v li a{position:relative;display:block;padding:10px 12px;font-size:1.2rem;color:var(--main-color);opacity:0.7;-webkit-transition:opacity 0.2s ease-in-out;transition:opacity 0.2s ease-in-out;}@media (max-width: 700px){.css-f30i1v li a{padding:10px 8px;}}.css-f30i1v li a:hover{-webkit-text-decoration:none;text-decoration:none;opacity:1;}.css-f30i1v .nav-current{opacity:1;}</style><ul role="menu" class="css-f30i1v"><li role="menuitem"><a href="/">Home</a></li><li role="menuitem"><a href="/about/">About</a></li><li role="menuitem"><a href="/tags/">Tags</a></li><li role="menuitem"><a href="/tags/diary/">Diary</a></li></ul><style data-emotion="css 289bqd">.css-289bqd{position:absolute;top:10px;-webkit-transform:translateY(175%);-moz-transform:translateY(175%);-ms-transform:translateY(175%);transform:translateY(175%);font-size:1.7rem;font-weight:400;color:var(--main-color);text-transform:none;visibility:hidden;opacity:0;-webkit-transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);transition:all 1s cubic-bezier(0.19, 1, 0.22, 1);}.css-289bqd .dash{left:-25px;}.css-289bqd .dash:before{content:'- ';opacity:0.5;}@media (max-width: 700px){.css-289bqd{overflow:hidden;max-width:calc(100vw - 126px);text-overflow:ellipsis;white-space:nowrap;}}</style><span class="nav-post-title css-289bqd esgr0m40">Cloudflare로 배포하는 슬랙 랜덤 추첨기 앱 만들기</span></div></div><style data-emotion="css 1wxq7hc">.css-1wxq7hc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:0 1 auto;-ms-flex:0 1 auto;flex:0 1 auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}</style><div class="css-1wxq7hc esgr0m42"><style data-emotion="css 150gfpr">.css-150gfpr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}@media (max-width: 700px){.css-150gfpr .not-mobile{display:none;}}</style><div class="css-150gfpr esgr0m41"><style data-emotion="css u4kwjs">.css-u4kwjs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;margin:0;padding:10px;opacity:0.8;-webkit-transition:opacity 0.35s ease;transition:opacity 0.35s ease;}.css-u4kwjs:hover{opacity:1;}.css-u4kwjs svg{height:1.8rem;fill:var(--main-color);-webkit-transition:fill 0.45s ease;transition:fill 0.45s ease;}.css-u4kwjs.is-white svg{fill:#fff;}</style><a class="not-mobile css-u4kwjs" href="https://github.com/pozafly" title="Github" target="_blank" rel="noopener noreferrer"><svg width="21px" height="21px" viewBox="0 0 1024 1024" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" transform="scale(64)"></path></svg></a><style data-emotion="css-global 8o55qm">body .theme-toggler{overflow:hidden;margin:6px;padding:2px;background:transparent;border-radius:50%;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;}body .theme-toggler #switch{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;width:21px;height:21px;padding:0;background:transparent;border:0;}body .theme-toggler .mode{position:relative;width:18px;height:18px;opacity:0.8;background:#000;-webkit-clip-path:path(
          'M17.5306 13.5882C16.6384 13.8558 15.689 14 14.7044 14C9.5004 14 5.28174 9.97061 5.28174 5.00005C5.28174 3.32422 5.76127 1.75538 6.59643 0.411865C2.77326 1.55853 0 4.96994 0 9.00001C0 13.9706 4.21866 18 9.42265 18C12.8721 18 15.8887 16.2296 17.5306 13.5882Z'
        );clip-path:path(
          'M17.5306 13.5882C16.6384 13.8558 15.689 14 14.7044 14C9.5004 14 5.28174 9.97061 5.28174 5.00005C5.28174 3.32422 5.76127 1.75538 6.59643 0.411865C2.77326 1.55853 0 4.96994 0 9.00001C0 13.9706 4.21866 18 9.42265 18C12.8721 18 15.8887 16.2296 17.5306 13.5882Z'
        );border-radius:50%;-webkit-transition:all 0.45s ease;transition:all 0.45s ease;}body .theme-toggler .mode:before{content:'';position:absolute;z-index:-1;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-moz-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:5px;height:5px;opacity:0;background:inherit;border-radius:50%;-webkit-transition:box-shadow 0.4s 0s ease;transition:box-shadow 0.4s 0s ease;}body .theme-toggler .mode:after{content:'';position:absolute;top:-20%;left:30%;width:90%;height:90%;background:rgb(255 255 255 / 1);border-radius:50%;-webkit-transition:all 0.3s ease;transition:all 0.3s ease;}body .theme-toggler .mode:hover{opacity:1;}body .theme-toggler:hover{background:rgb(215 215 215 / 0.9);}body .theme-toggler.is-white .mode{background:#fff;}body .theme-toggler.is-white:hover{background:rgb(215 215 215 / 0.2);}body.dark .theme-toggler{background:transparent;}body.dark .theme-toggler:hover{background:rgb(255 255 255 / 0.1);}body.dark .theme-toggler .mode{-webkit-transform:scale(0.5);-moz-transform:scale(0.5);-ms-transform:scale(0.5);transform:scale(0.5);overflow:initial;opacity:0.8;background:white;-webkit-clip-path:none;clip-path:none;}body.dark .theme-toggler .mode:before{opacity:1;box-shadow:0 -16px 0 0 white,0 16px 0 0 white,-16px 0 0 0 white,16px 0 0 0 white,12px 12px 0 0 white,12px -12px 0 0 white,-12px 12px 0 0 white,-12px -12px 0 0 white;}body.dark .theme-toggler .mode:after{-webkit-transform:translateX(50%) translateY(-50%);-moz-transform:translateX(50%) translateY(-50%);-ms-transform:translateX(50%) translateY(-50%);transform:translateX(50%) translateY(-50%);opacity:0;-webkit-transition:background 0.45s ease;transition:background 0.45s ease;}body.dark .theme-toggler.is-white .mode:before{box-shadow:0 -16px 0 0 white,0 16px 0 0 white,-16px 0 0 0 white,16px 0 0 0 white,12px 12px 0 0 white,12px -12px 0 0 white,-12px 12px 0 0 white,-12px -12px 0 0 white;}</style><button class="theme-toggler " aria-label="theme toggle button" type="button"><div id="switch"><div class="mode"></div></div></button></div></div></nav></div></div></header><style data-emotion="css 1h9yqcb">.css-1h9yqcb{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;position:relative;padding:0 5vw;}</style><main id="site-main" class="site-main css-1h9yqcb"><div class="css-8aaawc"><style data-emotion="css 150a24d">.css-150a24d{position:relative;}</style><article class="css-150a24d"><style data-emotion="css 7tju5o">.css-7tju5o{position:relative;margin:0 auto;padding:70px 100px 50px;border-top-left-radius:3px;border-top-right-radius:3px;}@media (max-width: 1170px){.css-7tju5o{padding:60px 11vw 50px;}}@media (max-width: 800px){.css-7tju5o{padding-right:5vw;padding-left:5vw;}}@media (max-width: 500px){.css-7tju5o{padding:20px 0 35px;}}</style><header class="post-full-header css-7tju5o edf4ga72"><style data-emotion="css ueomv1">.css-ueomv1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;font-size:1.2rem;font-weight:600;line-height:1.4em;color:#738a94;}.css-ueomv1 a{font-size:1.2rem;}</style><section class="post-full-tags css-ueomv1 emmlh0d3"><a href="/tags/tool/">Tool</a>,  <a href="/tags/slack/">Slack</a>,  <a href="/tags/bot/">Bot</a></section><style data-emotion="css 18a1ftz">.css-18a1ftz{margin:0 0 0.2em;color:var(--post-full-title);word-break:keep-all;}@media (max-width: 500px){.css-18a1ftz{margin-top:0.2em;font-size:3.3rem;}}</style><h1 class="post-full-title css-18a1ftz edf4ga71">Cloudflare로 배포하는 슬랙 랜덤 추첨기 앱 만들기</h1><style data-emotion="css 1gjy1ma">.css-1gjy1ma{margin:20px 0 0;font-size:2rem;font-weight:360;line-height:1.4em;color:var(--post-card-description);}@media (max-width: 500px){.css-1gjy1ma{font-size:1.9rem;line-height:1.5em;}}</style><p class="post-full-custom-excerpt css-1gjy1ma emmlh0d2">Bolt-js와 Ngrok을 사용한 서버 개발환경, Cloudflare의 Workers에 배포하기까지의 마이그레이션 과정의 기록.</p><style data-emotion="css r2irbu">.css-r2irbu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin:35px 0 0;padding-top:15px;border-top:1px solid var(--post-full-border);}.css-r2irbu .post-full-byline-content{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}.css-r2irbu .post-full-byline-content .author-list{-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;padding:0 12px 0 0;}.css-r2irbu .post-full-byline-meta{margin:2px 0 0;font-size:1.4rem;line-height:1.2em;color:#768086;letter-spacing:0.2px;}.css-r2irbu .post-full-byline-meta .author-name{margin:0 0 3px;font-size:1.4rem;font-weight:500;line-height:1.3em;}.css-r2irbu .post-full-byline-meta .author-name a{font-size:13px;color:var(--post-full-meta-link);}.css-r2irbu .post-full-byline-meta .author-name a:hover{color:var(--post-full-meta-link-hover);}.css-r2irbu .post-full-byline-meta .byline-reading-time,.css-r2irbu .post-full-byline-meta .byline-meta-date{font-size:13px;}.css-r2irbu .post-full-byline-meta .bull{display:inline-block;margin:0 4px;opacity:0.6;}</style><div class="post-full-byline css-r2irbu emmlh0d1"><section class="post-full-byline-content"><style data-emotion="css 12fmpzj">.css-12fmpzj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 0 0 4px;padding:0;list-style:none;}</style><ul class="author-list css-12fmpzj emmlh0d0"><style data-emotion="css 4q5div">.css-4q5div{position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;margin:0;padding:0;}.css-4q5div:hover .author-name-tooltip{-webkit-transform:translate(-10px, -2px);-moz-transform:translate(-10px, -2px);-ms-transform:translate(-10px, -2px);transform:translate(-10px, -2px);opacity:1;}</style><li class="author-list-item css-4q5div e13xkhp00"><style data-emotion="css aezf96">.css-aezf96{overflow:hidden;display:block;width:40px;height:40px;margin:0 -4px;border:2px solid var(--author-border);border-radius:100%;}@media (max-width: 500px){.css-aezf96{width:36px;height:36px;}}</style><a class="author-avatar css-aezf96" href="/about/"><style data-emotion="css 1ip6e3z">.css-1ip6e3z{display:block;width:100%;height:100%;object-fit:cover;background:var(--background-color);border-radius:100%;}.css-1ip6e3z img{border-radius:100%;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper author-profile-image css-1ip6e3z"><div aria-hidden="true" style="padding-top:100%"></div><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#6808f8;position:absolute;top:0;left:0;bottom:0;right:0"></div><picture><source type="image/webp" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/e73fe/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/61ca6/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/507b0/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg" data-srcset="/static/8c061761f263c344f2c0416607c8adf1/2f28c/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/499f6/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg 120w" alt="Pozafly"/></picture><noscript><picture><source type="image/webp" srcSet="/static/8c061761f263c344f2c0416607c8adf1/e73fe/pozafly.webp 40w,/static/8c061761f263c344f2c0416607c8adf1/61ca6/pozafly.webp 80w,/static/8c061761f263c344f2c0416607c8adf1/507b0/pozafly.webp 120w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg" srcSet="/static/8c061761f263c344f2c0416607c8adf1/2f28c/pozafly.jpg 40w,/static/8c061761f263c344f2c0416607c8adf1/499f6/pozafly.jpg 80w,/static/8c061761f263c344f2c0416607c8adf1/73bb6/pozafly.jpg 120w" alt="Pozafly"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a></li></ul><section class="post-full-byline-meta"><div class="author-name"><a href="/about/">Pozafly</a></div><div class="byline-meta-content"><time class="byline-meta-date" dateTime="2024-03-15">2024-03-15</time><span class="byline-reading-time"><span class="bull">•</span>23 min read</span></div></section></section></div></header><style data-emotion="css 1y1xnji">.css-1y1xnji{width:80%;max-height:800px;margin:25px auto 100px;-webkit-background-size:cover;background-size:cover;}.css-1y1xnji .image-wrapper{overflow:hidden;width:100%;border:1px solid var(--image-border-color);border-radius:8px;}.css-1y1xnji .image-wrapper img{border-radius:8px;}@media (max-width: 1170px){.css-1y1xnji .image-wrapper img{max-width:1170px;}}@media (max-width: 800px){.css-1y1xnji{width:100%;margin:25px auto 60px;}}</style><figure class="css-1y1xnji e16cwxex1"><div class="image-wrapper"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:66.75213675213676%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADeElEQVR42i2T7U9bZRjG+51/ZMb5icg3o1GMMyFOzTKIW3TRzSgsLiEme0nEObahThYaiSMwZgxDqjDKa3kph9JCGQPWlsJK29OX0zcKpcCg55xaXvbz6fTDfXKek/P8nuu57us2KIk0sbUMG74IG8EY6VCC3LAD7a9htKEpMgGF1HqWTFhhMxRFtdvRLQOo4xYyfpmk2BtPrhMTHCW+hqH4UFIbpP1Rttx+sh4/er8NfciBPupkZ87LWixF7sk8arHmHpMfGUSXxtkMhIinMi9hUcEJx5IYIuLnaDJN9sky2vhj9pxLaJYZ8r0SOYuTdaFwY1UmL0no8wuoS160+Xk0l4udVT/K/7CIkkRWEhiK1Ij4kPKFUKU59gen/1P3aAKtexxtsrjZS97pRPN4UZd9qP4gqmeJ5/4AyYRQJmAhAZOVOIYiNRJPCrkJniprBJwLFEwj6EJhoc/G4eIqCWmGnM3BC7eXgstDXtSRgKaEBaFFF3HhoxyNEwgLYEC8yNEEwy4fX0lLVE3cI2CxotsW2LDY8ZsGOHOigsXOHqJDY6xbJ9hyOIiPjXGzupqbtxt4FgyzLGzxheLFKyeYmnvKp9YgF0dc1Jh/4rrUgmJ1cLr8BOfer+D0u+9x9oOPqHjzLU6Wl3OhsorPT53ivKjS0lLqr15jOyCTWlkVV46ncFqnmfnkB1Y+rEPuriRlPUPy0dBLZa8dO8bbr5dR+sqrnDv5MaXHj/NGWRn1tbV8UVVFSUkJNy5f5kD4GRMNMwRlBZ8cxdHRx/I7lwj0VJPp6WVbrB988y1NZz/DVF1Dv1BxrbKSzu/rMDfcov7L8/QajZjb7tPeZGRLqAsHI8LDYJSQ6HJscYW4aZDM32b0jn7U1occPOzmqKWNfeNdCi2/gmTlaHmFQ7cbvF4ORWwOQhFeyCH2Z+yk3R4BlGMkn4XRZjwUzBJaq4ndn5t5fqeZ3XvtbDUaWb9Sy1bzL6LTEqptElXkMOdyo03b0WZFnKZFzKZEbj0CuO0JoI3N8o+YDq1rmL2799mpu8P2rSay391m82odqYs1ZG/dIGf6A7WnA210GHV2lry5i4JY65NWkVVxgNuFIT+5gF6c3T/7RZhHRZhHULsGyHX2sdvWSbahkdjXF0hfucRO43X2fvsR9YER1dSO/nsjelcruqlNTJY4yG7jXx/1R4cRuzhJAAAAAElFTkSuQmCC" alt=""/><picture><source type="image/avif" data-srcset="/static/2d8dcfa2060685360c28aafc7bea38ad/aad76/main.avif 500w,/static/2d8dcfa2060685360c28aafc7bea38ad/ba9bc/main.avif 800w,/static/2d8dcfa2060685360c28aafc7bea38ad/3243c/main.avif 1170w" sizes="100vw"/><source type="image/webp" data-srcset="/static/2d8dcfa2060685360c28aafc7bea38ad/76f01/main.webp 500w,/static/2d8dcfa2060685360c28aafc7bea38ad/56f2e/main.webp 800w,/static/2d8dcfa2060685360c28aafc7bea38ad/6b427/main.webp 1170w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/2d8dcfa2060685360c28aafc7bea38ad/62427/main.png" data-srcset="/static/2d8dcfa2060685360c28aafc7bea38ad/05bc0/main.png 500w,/static/2d8dcfa2060685360c28aafc7bea38ad/db40e/main.png 800w,/static/2d8dcfa2060685360c28aafc7bea38ad/62427/main.png 1170w" alt="Cloudflare로 배포하는 슬랙 랜덤 추첨기 앱 만들기"/></picture><noscript><picture><source type="image/avif" srcSet="/static/2d8dcfa2060685360c28aafc7bea38ad/aad76/main.avif 500w,/static/2d8dcfa2060685360c28aafc7bea38ad/ba9bc/main.avif 800w,/static/2d8dcfa2060685360c28aafc7bea38ad/3243c/main.avif 1170w" sizes="100vw"/><source type="image/webp" srcSet="/static/2d8dcfa2060685360c28aafc7bea38ad/76f01/main.webp 500w,/static/2d8dcfa2060685360c28aafc7bea38ad/56f2e/main.webp 800w,/static/2d8dcfa2060685360c28aafc7bea38ad/6b427/main.webp 1170w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/2d8dcfa2060685360c28aafc7bea38ad/62427/main.png" srcSet="/static/2d8dcfa2060685360c28aafc7bea38ad/05bc0/main.png 500w,/static/2d8dcfa2060685360c28aafc7bea38ad/db40e/main.png 800w,/static/2d8dcfa2060685360c28aafc7bea38ad/62427/main.png 1170w" alt="Cloudflare로 배포하는 슬랙 랜덤 추첨기 앱 만들기"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div><style data-emotion="css 1pu7cw5">.css-1pu7cw5{max-width:728px;margin:10px auto;font-size:12px;text-align:center;}.css-1pu7cw5 a,.css-1pu7cw5 span{font-size:12px;}@media (max-width: 800px){.css-1pu7cw5{font-size:11px;}.css-1pu7cw5 a,.css-1pu7cw5 span{font-size:11px;}}</style><figcaption class="css-1pu7cw5 e16cwxex0">Photo by <a href="https://blog.logrocket.com/build-a-slackbot-in-node-js-with-slacks-bolt-api/" target="_blank" rel="noreferrer">LogRocket</a></figcaption></figure><style data-emotion="css 1gxhmkz">.css-1gxhmkz *:not(pre)>code[class*='language-']{border-radius:0.3em;background:var(--little-code-background);border:1px solid var(--little-code-border);color:var(--main-color);padding:0.15em 0.5em;white-space:normal;font-size:13px;}@media (max-width: 800px){.css-1gxhmkz *:not(pre)>code[class*='language-']{display:inline;}}.css-1gxhmkz .gatsby-highlight-code-line{display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;background-color:var(--prism-background);border-left:0.25em solid var(--prism-border-left);font-size:1.4rem;}.css-1gxhmkz .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:var(--highlight-background);box-shadow:inset 0 0 0 1px var(--highlight-border);-webkit-overflow-scrolling:touch;overflow:auto;}.css-1gxhmkz .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.4rem;line-height:24px;}.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{color:var(--pre-code-color);text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1gxhmkz pre[class*='language-']::-webkit-scrollbar,.css-1gxhmkz code[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-1gxhmkz pre[class*='language-']::-webkit-scrollbar-thumb,.css-1gxhmkz code[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{display:inline-block;}}.css-1gxhmkz pre[class*='language-']{overflow:auto;}.css-1gxhmkz .token{font-size:1.4rem;}.css-1gxhmkz pre[data-line]{padding:1em 0 1em 3em;position:relative;}@media print{.css-1gxhmkz pre[class*='language-'],.css-1gxhmkz code[class*='language-']{text-shadow:none;}}.css-1gxhmkz pre[class*='language-']{padding:1em;overflow:auto;margin:0;}.css-1gxhmkz:not(pre)>code[class*='language-']{padding:0.1em 0.3em;border-radius:0.3em;color:#c9d1d9;background:#343942;}.css-1gxhmkz pre[data-line]{position:relative;}.css-1gxhmkz pre[class*='language-']>code[class*='language-']{position:relative;z-index:1;}.css-1gxhmkz .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#2f2a1e;box-shadow:inset 5px 0 0 #674c16;z-index:0;pointer-events:none;line-height:inherit;white-space:pre;}.css-1gxhmkz .namespace{opacity:0.7;}.css-1gxhmkz .token.comment,.css-1gxhmkz .token.prolog,.css-1gxhmkz .token.doctype,.css-1gxhmkz .token.cdata{color:#8b949e;}.css-1gxhmkz .token.punctuation{color:#c9d1d9;}.css-1gxhmkz .token.property,.css-1gxhmkz .token.tag,.css-1gxhmkz .token.boolean,.css-1gxhmkz .token.number,.css-1gxhmkz .token.constant,.css-1gxhmkz .token.symbol,.css-1gxhmkz .token.deleted{color:#79c0ff;}.css-1gxhmkz .token.selector,.css-1gxhmkz .token.attr-name,.css-1gxhmkz .token.string,.css-1gxhmkz .token.char,.css-1gxhmkz .token.builtin,.css-1gxhmkz .token.inserted{color:#a5d6ff;}.css-1gxhmkz .token.operator,.css-1gxhmkz .token.entity,.css-1gxhmkz .token.url,.css-1gxhmkz .language-css .token.string,.css-1gxhmkz .style .token.string{color:#a5d6ff;}.css-1gxhmkz .token.atrule,.css-1gxhmkz .token.attr-value,.css-1gxhmkz .token.keyword{color:#a5d6ff;}.css-1gxhmkz .token.function{color:#d2a8ff;}.css-1gxhmkz .token.regex,.css-1gxhmkz .token.important,.css-1gxhmkz .token.variable{color:#a8daff;}.css-1gxhmkz .token.important,.css-1gxhmkz .token.bold{font-weight:bold;}.css-1gxhmkz .token.italic{font-style:italic;}.css-1gxhmkz .token.entity{cursor:help;}</style><style data-emotion="css 9yupkg">.css-9yupkg{position:relative;min-height:230px;margin:0 auto;padding:0 100px 6vw;font-size:2rem;line-height:1.6em;background:var(--background-color);border-radius:6px;}.css-9yupkg .no-image{padding-top:0;}.css-9yupkg h1,.css-9yupkg h2,.css-9yupkg h3,.css-9yupkg h4,.css-9yupkg h5,.css-9yupkg h6,.css-9yupkg p,.css-9yupkg ul,.css-9yupkg ol,.css-9yupkg dl,.css-9yupkg pre,.css-9yupkg blockquote,.css-9yupkg .post-full-comments,.css-9yupkg .footnotes{min-width:100%;margin:0 0 1.5em;}.css-9yupkg li>ul,.css-9yupkg li>ol{margin:0;}.css-9yupkg li{word-break:break-word;}.css-9yupkg li p{margin:0;}.css-9yupkg a{color:#0a84ff;}.css-9yupkg a[class*='image'],.css-9yupkg a[class*='image']:hover{box-shadow:none;}.css-9yupkg a[class*='image'] span[class*='image'],.css-9yupkg a[class*='image']:hover span[class*='image']{border-radius:6px;}.css-9yupkg strong,.css-9yupkg em{color:var(--strong-color);}.css-9yupkg small{display:inline-block;line-height:1.6em;}.css-9yupkg img,.css-9yupkg video{display:block;max-width:840px;height:auto;margin:2em auto;border:1px solid var(--image-border-color);border-radius:8px;}.css-9yupkg hr+p{margin-top:1.2em;}.css-9yupkg img[src$='#full']{width:100vw;max-width:none;}.css-9yupkg img+br+small{display:block;margin-top:-3em;margin-bottom:1.5em;text-align:center;}.css-9yupkg iframe{margin:10px auto 20px;}.css-9yupkg blockquote{margin:0 0 1.5em;padding:0 1.5em;border-left:3px solid var(--image-border-color);}.css-9yupkg blockquote p{margin:0 0 1em;font-size:inherit;font-style:italic;line-height:inherit;color:inherit;}.css-9yupkg blockquote p:last-child{margin-bottom:0;}.css-9yupkg code{padding:0 5px 2px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:0.8em;font-weight:400!important;line-height:1em;border-radius:3px;}.css-9yupkg p code{word-break:keep-all;}.css-9yupkg pre{overflow-x:auto;max-width:100%;padding:20px;font-size:1.4rem;line-height:1.5em;color:#e5eff5;border-radius:5px;}.css-9yupkg pre code{padding:0;font-size:inherit;line-height:inherit;background:transparent;}.css-9yupkg pre code :not(span){color:inherit;}.css-9yupkg .fluid-width-video-wrapper{margin:1.5em 0 3em;}.css-9yupkg hr{margin:2em 0;}.css-9yupkg h1,.css-9yupkg h2,.css-9yupkg h3,.css-9yupkg h4,.css-9yupkg h5,.css-9yupkg h6{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;color:var(--home-header-color);}.css-9yupkg h1{margin:0.5em 0 0.4em;font-size:4.2rem;font-weight:600;line-height:1.25em;}.css-9yupkg p+h1{margin-top:0.8em;}.css-9yupkg h2{margin:1.2em 0 0.6em;font-size:3.4rem;font-weight:600;line-height:1.25em;}.css-9yupkg p+h2{margin-top:0.8em;}.css-9yupkg h3{margin:1rem 0 0.2em;padding-top:1.8rem;font-size:2.6rem;font-weight:600;line-height:1.3em;}.css-9yupkg h2+h3{margin-top:0.7em;}.css-9yupkg h4{margin:1em 0 0.2em;font-size:2rem;font-weight:800;}.css-9yupkg h2+h4{margin-top:0.7em;}.css-9yupkg h3+h4{margin-top:0;}.css-9yupkg h5{display:block;margin:0.5em 0;font-size:1.8rem;font-weight:600;line-height:1.35em;border:0;}.css-9yupkg h6{margin:0.5em 0 0.2em;font-size:2rem;font-weight:700;}.css-9yupkg table{overflow-x:auto;display:inline-block;border-spacing:0;border-collapse:collapse;width:auto;max-width:100%;margin:0.5em 0 2.5em;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans','Ubuntu','Droid Sans','Helvetica Neue',sans-serif;font-size:1.6rem;white-space:nowrap;vertical-align:top;background:radial-gradient(ellipse at left, rgb(0 0 0 / 0.2) 0%, rgb(0 0 0 / 0) 75%) 0 center,radial-gradient(ellipse at right, rgb(0 0 0 / 0.2) 0%, rgb(0 0 0 / 0) 75%) 100% center;background-repeat:no-repeat;background-attachment:scroll,scroll;-webkit-background-size:10px 100%,10px 100%;background-size:10px 100%,10px 100%;-webkit-overflow-scrolling:touch;}.css-9yupkg table th{font-size:1.2rem;font-weight:700;color:var(--home-header-color);text-align:left;text-transform:uppercase;letter-spacing:0.2px;background-color:var(--table-th-background);}.css-9yupkg table th,.css-9yupkg table td{padding:6px 12px;border:var(--table-th-border) 1px solid;}.css-9yupkg table td:first-of-type{background-image:var(--table-first-of-type);background-repeat:no-repeat;-webkit-background-size:20px 100%;background-size:20px 100%;}.css-9yupkg table td:last-child{background-image:var(--table-last-of-type);background-repeat:no-repeat;-webkit-background-position:100% 0;background-position:100% 0;-webkit-background-size:20px 100%;background-size:20px 100%;}.css-9yupkg figcaption{color:var(--figcaption-color);}@media (max-width: 1170px){.css-9yupkg{padding:0 11vw;}}@media (max-width: 800px){.css-9yupkg{padding:0 5vw;font-size:1.8rem;}}@media (max-width: 500px){.css-9yupkg{padding:0;}}@media (max-width: 500px){.css-9yupkg .post-full-custom-excerpt{font-size:1.9rem;line-height:1.5em;}}@media (max-width: 500px){.css-9yupkg p,.css-9yupkg ul,.css-9yupkg ol,.css-9yupkg dl,.css-9yupkg pre,.css-9yupkg .post-full-comments,.css-9yupkg .footnotes{margin-bottom:1.28em;}}@media (max-width: 1040px){.css-9yupkg img,.css-9yupkg video{width:100%;}}@media (max-width: 500px){.css-9yupkg blockquote{padding:0 1.3em;}}@media (max-width: 800px){.css-9yupkg h1{font-size:3.2rem;line-height:1.25em;}.css-9yupkg h2{margin:0.5rem 0 0.3em;font-size:2.8rem;line-height:1.25em;}.css-9yupkg h3{margin:0.5rem 0 0.3em;font-size:2.4rem;line-height:1.3em;}.css-9yupkg h4{margin-bottom:0.3em;font-size:1.8rem;line-height:1.3em;}.css-9yupkg h5{max-width:1060px;padding:0 0 0.5em;font-size:2.4rem;text-align:initial;}.css-9yupkg h6{font-size:1.8rem;line-height:1.4em;}}.css-9yupkg *:not(pre)>code[class*='language-']{border-radius:0.3em;background:var(--little-code-background);border:1px solid var(--little-code-border);color:var(--main-color);padding:0.15em 0.5em;white-space:normal;font-size:13px;}@media (max-width: 800px){.css-9yupkg *:not(pre)>code[class*='language-']{display:inline;}}.css-9yupkg .gatsby-highlight-code-line{display:block;margin-right:-1.3125rem;margin-left:-1.3125rem;padding-right:1em;padding-left:1.25em;background-color:var(--prism-background);border-left:0.25em solid var(--prism-border-left);font-size:1.4rem;}.css-9yupkg .gatsby-highlight{margin-bottom:1.75rem;margin-left:-1.3125rem;margin-right:-1.3125rem;border-radius:10px;background:var(--highlight-background);box-shadow:inset 0 0 0 1px var(--highlight-border);-webkit-overflow-scrolling:touch;overflow:auto;}.css-9yupkg .gatsby-highlight pre[class*='language-']{float:left;min-width:100%;font-size:1.4rem;line-height:24px;}.css-9yupkg pre[class*='language-'],.css-9yupkg code[class*='language-']{color:var(--pre-code-color);text-shadow:none;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-9yupkg pre[class*='language-']::-webkit-scrollbar,.css-9yupkg code[class*='language-']::-webkit-scrollbar{background-color:transparent;height:4px;}.css-9yupkg pre[class*='language-']::-webkit-scrollbar-thumb,.css-9yupkg code[class*='language-']::-webkit-scrollbar-thumb{border-radius:8px;background-color:hsla(230, 5%, 35%, 1);}@media (max-width: 800px){.css-9yupkg pre[class*='language-'],.css-9yupkg code[class*='language-']{display:inline-block;}}.css-9yupkg pre[class*='language-']{overflow:auto;}.css-9yupkg .token{font-size:1.4rem;}.css-9yupkg pre[data-line]{padding:1em 0 1em 3em;position:relative;}@media print{.css-9yupkg pre[class*='language-'],.css-9yupkg code[class*='language-']{text-shadow:none;}}.css-9yupkg pre[class*='language-']{padding:1em;overflow:auto;margin:0;}.css-9yupkg:not(pre)>code[class*='language-']{padding:0.1em 0.3em;border-radius:0.3em;color:#c9d1d9;background:#343942;}.css-9yupkg pre[data-line]{position:relative;}.css-9yupkg pre[class*='language-']>code[class*='language-']{position:relative;z-index:1;}.css-9yupkg .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#2f2a1e;box-shadow:inset 5px 0 0 #674c16;z-index:0;pointer-events:none;line-height:inherit;white-space:pre;}.css-9yupkg .namespace{opacity:0.7;}.css-9yupkg .token.comment,.css-9yupkg .token.prolog,.css-9yupkg .token.doctype,.css-9yupkg .token.cdata{color:#8b949e;}.css-9yupkg .token.punctuation{color:#c9d1d9;}.css-9yupkg .token.property,.css-9yupkg .token.tag,.css-9yupkg .token.boolean,.css-9yupkg .token.number,.css-9yupkg .token.constant,.css-9yupkg .token.symbol,.css-9yupkg .token.deleted{color:#79c0ff;}.css-9yupkg .token.selector,.css-9yupkg .token.attr-name,.css-9yupkg .token.string,.css-9yupkg .token.char,.css-9yupkg .token.builtin,.css-9yupkg .token.inserted{color:#a5d6ff;}.css-9yupkg .token.operator,.css-9yupkg .token.entity,.css-9yupkg .token.url,.css-9yupkg .language-css .token.string,.css-9yupkg .style .token.string{color:#a5d6ff;}.css-9yupkg .token.atrule,.css-9yupkg .token.attr-value,.css-9yupkg .token.keyword{color:#a5d6ff;}.css-9yupkg .token.function{color:#d2a8ff;}.css-9yupkg .token.regex,.css-9yupkg .token.important,.css-9yupkg .token.variable{color:#a8daff;}.css-9yupkg .token.important,.css-9yupkg .token.bold{font-weight:bold;}.css-9yupkg .token.italic{font-style:italic;}.css-9yupkg .token.entity{cursor:help;}</style><section class="post-full-content css-9yupkg edf4ga70"><div class="post-content"><p>재직 중인 회사에서 달에 한 번, 월간 플랫폼을 진행하고 있다. 팀에서 한 명이 무엇을 할 지 정한 뒤 기획하고, 오후 4시부터 팀별 활동을 할 수 있는 시간이다. 항상 달마다 월간 플랫폼 기획자를 뽑아야 했다.</p>
<p>월간 플랫폼 기획자를 뽑아야 하는 날이 오면 당첨자 추첨 웹사이트를 찾고, 일일이 이름을 기재하고 한 명을 뽑는 일을 하고 있었다. 이 과정이 아주 번거로운 일은 아니지만, 예전부터 Slack 앱을 만들어보고 싶기도 했고 추첨 앱을 만들어두면 월간 플랫폼뿐만이 아니라 사내 다른 일을 할 때에도 활용할 수 있지 않을까 생각이 들었다.</p>
<p>물론 Slack에는 무작위 추첨 기능이 있는 앱이 이미 존재한다. <a href="https://app-luckydraw.11stcorp.com/" target="_blank" rel="nofollow">lucky-draw</a>라는 앱이다. 11번가에서 제작했으며, <a href="https://app-luckydraw.11stcorp.com/" target="_blank" rel="nofollow">AWS Lambda를 통해 배포 과정</a>에 대한 글도 있다. 다만, 사용성이 조금 아쉬웠다.</p>
<p>추첨을 하기 위해 채널을 새로 생성해야 했고, 생성된 채널에 참여된 대상만 한정 지어 추첨할 수 있으며 매번 추첨을 위한 인원을 초대해야 한다는 점이다. 그리고, 채널을 일일이 만들지 않고, 현재 채널에서 제외하고 싶은 인원(지난주 당첨 되었던 사람)을 제외할 수 없다는 점이다.</p>
<p>그래서 체험 겸 Slack 앱을 만들어보기로 했다.</p>
<blockquote>
<p>※ App(앱)</p>
<p>앱이라는 용어는 맥락에 따라 다르게 해석할 여지가 무척 많기 때문에 아래에서 설명하는 앱에 대한 정의를 먼저 하겠다.</p>
<ul>
<li>데스크탑 앱 : MacOS, Windows OS, Mobile OS에 설치되는 Slack 어플리케이션 자체.</li>
<li>서드파티 앱 : 내가 만들 Slack 어플리케이션에 붙일 서드파티 앱. (reminder 등이 있음)</li>
</ul>
</blockquote>
<p>코드 저장소는 아래와 같다.</p>
<ul>
<li><a href="https://github.com/pozafly/its-you" target="_blank" rel="nofollow">main branch (Cloudflare 배포 용)</a></li>
<li><a href="https://github.com/pozafly/its-you" target="_blank" rel="nofollow">only-bolt branch (Bolt-js 용)</a></li>
</ul>
<br/>
<h2 id="웹훅Webhook" style="position:relative;">웹훅(Webhook)<a href="#%EC%9B%B9%ED%9B%85Webhook" aria-label="웹훅Webhook permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>공식 홈페이지의 <a href="https://api.slack.com/" target="_blank" rel="nofollow">Slack API</a>를 먼저 훑어보았다. 웹훅(Webhook)을 통해 메시지를 보낼 수 있는 기본 Slack 앱을 만들 수 있다고 한다. 먼저 Slack에서 Network 통신을 어떻게 하는지 알기 위해서 이 개념을 알아야 한다.</p>
<p>웹훅(Webhook)이란, 하나의 시스템이 다른 시스템에 어떤 이벤트가 발생했음을 알리는 방법이다(<a href="https://developers.portone.io/blog/posts/2024-02/v2-webhook?v=v1" target="_blank" rel="nofollow">출처 - 포트원</a>). 어느 시스템에서 다른 시스템에 이벤트가 발생했다고 알려주는 매커니즘이기 때문에 주로 ‘알림’ 기능에 많이 사용된다. (알림 외 코드 푸시, 블로그에 댓글 게시 등에도 사용됨)</p>
<p>알림 기능은 실시간으로 서로 정보를 주고받는 것이 중요하다. 실시간으로 이벤트가 발생한 것을 감지하기 위해서는 폴링(Polling)과 웹훅을 사용할 수 있는데, 폴링의 경우는 클라이언트에서 지속해서 서버에서 이벤트가 발생했는지를 알기 위한 HTTP 요청을 보낸다. 반면 웹훅은 서버에서 이벤트가 발생했을 경우 클라이언트로 이벤트가 발생했음을 알린다. 즉, 전통적인 네트워크 요청처럼 <code class="language-text">클라이언트 -> 서버</code>의 요청은 알림 하나를 받기 위해 여러 번의 네트워크 요청이 있어야 하지만, 웹훅을 사용하면 <code class="language-text">서버 -> 클라이언트</code> 네트워크 통신은 한 번 일어나기 때문에 매우 효율적이라고 할 수 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 704px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 66.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0klEQVR42oVTa28aMRDk//+gfq2q9kukqukjoTQKBUFRQg64l88+3/luurPGBGikIq04765nd2bXE+/D0HUD+l4sDLA2oCx8PB+N8WQ85weP7NmhKjp0jGveCMHqJynRmB5tG9A0PXYvTi86F9D6VzA9S062dVgtDfa7liBqqZgC0nH3xeL5T4dxHMRGrf7+XYHpV6Nndv/402Hx4MGf+gTg5kOJz58qhBCLRkCx5dxin3kIHJJvemukiEcYYvXVwmItFsIonUaqs+8G819OAb0/AtKq0iuFtVCZ3RXYPjn1kWKiU1edSNNd6OtcL7r3J60n50KXQvOw89isG71ciK+u+tPAityrjuzQNnEQVjRnHn2nDnmByVXZ4Wlj8fuhEvqt+jis1A3jxaHFZmVxf1srfW4E/Yz/A8hKL7IOy3mt3zRTXwOKNFnM4bTJ7E1ABkin1C4bONGFiaZ+1YzdONnTYRgjdfmnfvS/STnbWsx+VLj5mEsHBvm+vaDMi9RMz8d73Ft9CNeA7JDfZd7JpC1a6YDdXXeYALv/Au69rIrF4rHC9Fuuk87kxZw6PE65MZeAjNN/tthh5Af3jRXS84u+KHTa1ZRz/rZ9G59jHEoY/gIurO8q+M10FQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="api-vs-webhook"
        title=""
        src="/static/fa462fee2e18569b47d6108f5fe986b2/3be76/api-vs-webhook.png"
        srcset="/static/fa462fee2e18569b47d6108f5fe986b2/0eb09/api-vs-webhook.png 500w,
/static/fa462fee2e18569b47d6108f5fe986b2/3be76/api-vs-webhook.png 704w"
        sizes="(max-width: 704px) 100vw, 704px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>위 이미지에서 보듯, 웹훅은 서로 다른 시스템 간 양방향 통신을 위한 것이다. 3가지 용어를 기억하자. (아래의 용어는 설명을 위한 용어로, 공식 용어는 아니다)</p>
<ul>
<li>데스크탑 앱 (Desktop App)
<ul>
<li>Mac OS 또는 Windows, Mobile OS에 설치될 데스크탑 어플리케이션 (메신저).</li>
</ul>
</li>
<li>슬랙 자체 서버 (Slack API Server - 가명)
<ul>
<li>데스크탑 앱과 우리가 만들 앱 서버를 중계해 주는 슬랙 서비스 자체 서버.</li>
</ul>
</li>
<li>나의 서드파티 앱 서버 (My Third-party App Server)
<ul>
<li>우리가 Slack 데스크탑 앱에 설치할 App 자체를 위한 서버.</li>
</ul>
</li>
</ul>
<p>Slack App에서는 어떻게 웹훅을 사용하고 있는지 도식화해 보면 아래와 같다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1920px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.199999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAALABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMCBAYJ/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB7uVNCwiPD//EABsQAQEAAQUAAAAAAAAAAAAAAAIDARAREhMk/9oACAEBAAEFAu700KUJZ3DmHnidP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EACQQAAIBAgUEAwAAAAAAAAAAAAECAxESAAQTIUEQIjFRFDKR/9oACAEBAAY/AsxRM62iIoWTSZYWLjV1YWe1Zu1gjvEzKjKYzSQMMS5X5MkLzLLbOHpmoS1bGjDI8QeKopdVdhcrVIx5Q8djXDbbyefeBcK/vsY+o546f//EAB0QAQEAAgIDAQAAAAAAAAAAAAERACExQWFx4YH/2gAIAQEAAT8hd50d6FvTOwz5yvzulaS406wmoFgUrT1dyZPPNT8KCxRCggxKW58kp6eT8z7n/9oADAMBAAIAAwAAABAQz//EABoRAAMBAAMAAAAAAAAAAAAAAAERIUEQMWH/2gAIAQMBAT8QIBeMVTE2Ffe9bvH/xAAaEQADAQADAAAAAAAAAAAAAAABESExEGGR/9oACAECAQE/EBC+3aPCwpmGynj/xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhMYGx/9oACAEBAAE/EOH1uIcVTN4u3aS046yhcJhMJtmMrQQKilQoq3AIoYVlRSIYSnXIjAhCbBNQgQAQAAABDnv05//Z'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="slack-webhook"
        title=""
        src="/static/12e0c209c52c6fd29b7eaee5b6d2c51b/aaf92/slack-webhook.jpg"
        srcset="/static/12e0c209c52c6fd29b7eaee5b6d2c51b/953fe/slack-webhook.jpg 500w,
/static/12e0c209c52c6fd29b7eaee5b6d2c51b/0a251/slack-webhook.jpg 1000w,
/static/12e0c209c52c6fd29b7eaee5b6d2c51b/aaf92/slack-webhook.jpg 1920w"
        sizes="(max-width: 1920px) 100vw, 1920px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>먼저 슬랙 자체 서버에 우리가 만들 서드파티 앱의 URL을 등록해야 한다. 그래야 데스크탑 앱에서 특정 이벤트가 발생하면 내가 생성한 서버로 요청을 보낼 수 있기 때문이다. 그리고, 우리가 만들 서드파티 앱을 위한 서버는 Slack 자체 서버에서 검증된 요청인지를 판단하기 위해 토큰을 생성해 등록해 두어야 한다.</p>
<p>데스크탑 앱에서 서드파티 앱으로 인한 이벤트가 발생하면, 슬랙 자체 서버를 거쳐 나의 서드파티 앱 서버로 이어 요청이 발생하게 되고, 나의 서버에서 token을 검증한 다음, 특정 결과를 슬랙 자체 서버로, 슬랙 자체 서버에서는 데스트탑 앱으로 다시 결과를 돌려주며 데스트탑 앱의 특정 행동을 하게끔 하는 것이다.</p>
<p>그렇다면 서드파티 앱을 만들기 위해 우리는 Slack 자체 서버에 웹훅을 위한 URL을 등록하고, 원하는 결과를 돌려주는 서버를 제작해서 배포하면 된다. 따라서, Slack의 서드파티 앱을 만드는 과정은 데스크탑 앱에 설치된 서드파티 앱에서 특정 이벤트가 발생하면 처리할 서버 및 serverless를 만드는 과정이다.</p>
<p>참고로 Slack Desktop 앱은 <a href="https://slack.engineering/building-hybrid-applications-with-electron/" target="_blank" rel="nofollow">Electron</a>으로 만들어져있고, 크로미움 엔진으로 구동되기 때문에 개발자 도구를 켤 수 있다. 맥에서 Slack의 개발자 도구를 켜기 위해서는 아래와 같은 명령어를 터미널에 입력해 주면 된다. (<a href="https://www.reddit.com/r/Slack/comments/955dro/how_do_i_open_the_chromium_developer_tools_in_the/" target="_blank" rel="nofollow">출처</a>)</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">SLACK_DEVELOPER_MENU</span><span class="token operator">=</span>true
<span class="token function">open</span> <span class="token parameter variable">-a</span> /Applications/Slack.app</code></pre></div>
<p><code class="language-text">Command</code> + <code class="language-text">Option</code> + <code class="language-text">I</code> 를 눌러 다음과 같이 개발자 도구를 둘러보자.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACRElEQVR42lWSS2sTYRSGR7Qt1CI1TXNPZiaTZDJJmrRJmtKqK93ozoW4KVjSWhX/QVVoNQtBEAQpSP0F1lvB/xHdiuBKRdvcm3YSGx7PKBT84OU7s3m+55w5Sso4h5nMokVjZLIz5PKz6PEkRsIinkyhGQmCEZ2IHsMbCDM6Osb4uAv3pJfh4REURTnO0JB8X7x0mbBqEAip+CVqNC6AKIGwRiSa+FdL/GEdQx5aXFzkxtIyK6t3WL19l5WVW5SXVymXb7K0VEbRjBjJVAZVDHSpFxZmKRZnME1doPpfkAN0eYMUSwv0e7+xe0eSPj2pj44GDAYDnFOtVlEcUNKaEsOIGEbI53PkpjNEDQemHQMnBJifnafR6tLu2jQ7No32AZ39Q2rNNp0Dm89fvqJ4fSEMI4UvEBJgiJhlyQwtIppGyBmFAJ223QIsCHC33mGv6UD26fX7/Py1y7fvP9jdq1H9+AnF4wtgTWWZmPSgRSzmihcwLVOAjpn+n2GhNE+90abbPaBWb9BstdiTu1ZvIp2zvf0axYiZMrsEHr8PLZRnrnCFuFiq8TRBTX6QWIa0GG5/mNL8eRrNFnUBdLuH2HYPuz+gYw/oywzf7nxACYZVXG6vRAw1QyxKmKkcyXSOmJkmKu07K6TKo2lZq0qlwtbLLZ5tPuXB+j3W1u6zvlHh+eYLXm2/QQl4TNkpP2ddbjy+IKnMNNlcAUuAUbFX9TiaJJ6eYlxTuXb1Oo8rTzgzOcaJEYVTp0/K/mbYePiIdzvv+QP4XG5CuNBduwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="slack-devtools"
        title=""
        src="/static/d333815ccfde6e9edc3af4db52130137/f97d7/slack-devtools.png"
        srcset="/static/d333815ccfde6e9edc3af4db52130137/0eb09/slack-devtools.png 500w,
/static/d333815ccfde6e9edc3af4db52130137/1263b/slack-devtools.png 1000w,
/static/d333815ccfde6e9edc3af4db52130137/f97d7/slack-devtools.png 2000w,
/static/d333815ccfde6e9edc3af4db52130137/49142/slack-devtools.png 3000w,
/static/d333815ccfde6e9edc3af4db52130137/1ce76/slack-devtools.png 4000w,
/static/d333815ccfde6e9edc3af4db52130137/df017/slack-devtools.png 4110w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<br/>
<h2 id="Slack-서드파티-앱-생성-및-세팅" style="position:relative;">Slack 서드파티 앱 생성 및 세팅<a href="#Slack-%EC%84%9C%EB%93%9C%ED%8C%8C%ED%8B%B0-%EC%95%B1-%EC%83%9D%EC%84%B1-%EB%B0%8F-%EC%84%B8%ED%8C%85" aria-label="Slack 서드파티 앱 생성 및 세팅 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>먼저 테스트 할 워크스페이스를 생성해 두는 것이 좋다. 나 같은 경우는 블로그 CI/CD 파이프라인 중에 빌드가 완료되면 알림을 받을 워크스페이스가 미리 생성되어 있었으므로 이곳을 활용할 것이다.</p>
<h3 id="앱-생성" style="position:relative;">앱 생성<a href="#%EC%95%B1-%EC%83%9D%EC%84%B1" aria-label="앱 생성 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><a href="https://api.slack.com/apps" target="_blank" rel="nofollow">Slack API 앱 생성 페이지</a>로 들어가자. Create New App 버튼을 클릭하면 아래와 같은 모달이 뜨는데, ‘From scratch’ 를 선택해주자.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1444px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 119.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAABYlAAAWJQFJUiTwAAAD6ElEQVR42oVUWU8bZxT1v6nUn0BFkGgRSdWkxHidsT32LDbwC3gmfQGxPPEKEhKvSBEYfkUIS1JKy+Z9wcZgbHC8cHrvtceUqCQjHd9v5vt85txz7x1HIBiEoqpQFEUQiURgGMY3oRMs00LI8xaDvwxgaOQFBn7+Ce43L+FQiWzc6YTb7cbY2BjC4TAsy4Jpms/CIMSsKDSvE0OjLzD8ahiDo0Nwj70iwoiJiBklIg0akYU0DUFSzS8KBAICXtvgPXlGCIeCsMIRmMQR0y1MRqNw+MM6NN2Ax6/C7VPg8qnwKgF4PF6xwCb1+Xzdl6iBvj0Mv6LCz8+CIeik3KEQoUl+cKoaqQuFSKlGSkMhST0WiyFKb+b4HHifYXYJDfHEVsJEjH7aaqC/Z6fLkWFnwGKeEOqG2U/ha88Yfr+/u0fkqtK79yv953YhGT1Cgw745bCiPvrDvtmqu3aEnkALaX3VNmkvZQtBPkR/iui69KINPmR79D1Iytw2KrXMD8MD+HFkEEbUwtTUFCYnJwUTExPfhV0YIdQipMjQ4VS8+NX5O7WLR1L1er0S2advgc/YHcFT5LDbxSDiP969w9LSEhYWFgTz8/OYm5t7FrOzs1hcXMT09LR4KIQyTlRllpxIJpDP5ZHNZpFOp1GtVsHXw8MD/u9qt9sSd3Z2RC1zOFiqXcGLiwsUCgUkk0kkEgmUy2U0Gg3c3d3h/v5eUK/X++tarSaE8XhcUmcvHcw6Pj5OcAkRqzv89AlHx8cS9/b3sX9wgIPDQ3zc25P1h91dWu+jWCqh03nA5uamfFz6hK9f/0bFcCOVSuHq8hL5TAYFIs6kkhKz9Jxjjmwo5nJyn02n6FxaFG5vb/9HIf28HB2Bk1Sm/jpCPZNE5eIMjWIe7UpZ0LwqoU1oXV320F3f57NAq4H41tYjYSwWxds3Lni8fpztfkAqmcLx2RmSpKhCRSlf3xCucV29pftb3JBv1VoddfK1zbVqfsH2+/fwUVGEkIuiU8vwPKc+H6CaPMdV4hyl039QoVg8+Rvl81M0SwV8ucz3YgGtcpHUl4BGDXHy0OfrEconXY/IPKeosh16433tFo16DXe3Ve6ZLjodQruPh1YTLao0X1uUMhdFZlkU0vyaRHhycoJTSnf/4BB7VMU/j46Qy+dRova5qlRwQxZckwU3vf5s9frwaVGoyvw595JkJuTey1EluR9L1BYZqjhH7kXuQbsPm82mRL42NjbgcrkePYzoJnimeTrkza2WTEeH0uRpYNhr3vt6UrixefaFkEfPskxJe3l5GWtra1hZWcHq6qpEG/Y9Rxt8v76+jpmZmf4H4l9xABHHvMeyIgAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="create-new-app"
        title=""
        src="/static/6cd4858a30bc280feb529539869353b2/18d28/create-new-app.png"
        srcset="/static/6cd4858a30bc280feb529539869353b2/0eb09/create-new-app.png 500w,
/static/6cd4858a30bc280feb529539869353b2/1263b/create-new-app.png 1000w,
/static/6cd4858a30bc280feb529539869353b2/18d28/create-new-app.png 1444w"
        sizes="(max-width: 1444px) 100vw, 1444px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>App 이름을 설정해 주고, 어느 워크스페이스에서 사용할 것인지 설정해 주도록 하자.</p>
<p>아래로 주욱 내려보면 ‘Display Information’ 란이 있다. 이 곳에서 App 이름을 다시 설정할 수 있으며 description 및 App Icon을 설정해 줄 수 있다.</p>
<h3 id="권한-및-범위-설정" style="position:relative;">권한 및 범위 설정<a href="#%EA%B6%8C%ED%95%9C-%EB%B0%8F-%EB%B2%94%EC%9C%84-%EC%84%A4%EC%A0%95" aria-label="권한 및 범위 설정 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>좌측 패널의 ‘OAuth &#x26; Permissions’ 를 클릭하면 앱의 권한과 범위(Scope)를 설정해 줄 수 있다. 권한은 OAuth Token을 생성하고 이를 서드파티 앱 서버에 등록함으로써 매번 요청 때마다 권한이 있는 요청인지를 판별하기 위해 생성하는 것이다.</p>
<p>그리고 범위(Scope)란, 내 서드파티 앱이 Slack에서 어떤 어떤 기능을 사용할 것인지를 설정하는 것이다. 가령 <code class="language-text">chat:write</code> 라는 범위는 슬랙 앱이 채팅 메시지를 보낼 수 있다는 권한을 부여하는 것이고, <code class="language-text">channels:read</code> 와 같은 범위는 채널의 멤버를 조회하는 등의 권한을 부여하는 것이다.</p>
<p>상세한 내용은 <a href="https://api.slack.com/scopes" target="_blank" rel="nofollow">Permission scopes</a>에서 확인할 수 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1462px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 102%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACrUlEQVR42qVU6XLaMBjk/V+teYF0QgIECMaWbfmWZHu7K2Mg7Z9Oy8wiW8d69zu0cc4hhIB5niOmafpniGujh+SS4OXHC15fX/E/P+89NlLX9z2uyRXGGOR5jiRJ4phlGdI0jc9a03uWpTC2RdEMMHzXvJzdCcdxRMZD27c37HZ7fLy/w5YlIPtcu4NO5juW8MxPcyH4B6GtKpzOZ5y+vvB5OiHNDMrSoiCx1oqi5IHxLy3zb6gsqjSBqy3AL81DH9HkBja9Yuo77naAG5bxGdy3zFOhkjJys93vsd+dcd6f0TNeaEhM8uJ4wOXtJ9KPLdLdO7L9R4TRyHdz2GGuSrgyh09OCHWFjW8bgJMK66S4PFlomayctk1RIIxTnNOeUfG9IVpVDC3DQqcb37VwstYHDD4sybjV5DAM6LoOXdvSWR9HxWmt2RWBhGN1Iwwk7EyGa+3QubCouGWxJYG1lgkqUcXkFPEj628tl4EfcYVZLEdC1RsJk6KFqfv7l1dCoWmaSCyIWKPU6xcoYGTM/Wp5LAs4hkgKh6fy0METy6iua6i81FqyrGYQVJsPhfktKZEwRxcm+Ej2iI0Oy6IOi2wlFL7dATGDNRWWD8vnskfVuW+xkbrtdovD4RDbbo2nlKsdFZLF8i0ptSxzcrIFpE0Ke9oe1U7Kng93e+tHVvX3Z+3V87PCmr38ZQdcmJQzMfgljmsidAFYtqJU6V2joPV7UpiQ8EhKDjfOcFI0Tn/EULeRxgg+a369A+e10NcsR4XXDEfrcaHKsvOLHaKmgoJxy3k5aCxZixnVdiR9jnXnPFvWsHSUZS7O6QU+TxHMFT5LMLJIZ8ZV/QxuWns7oqli/2o9gu5mKgPPqI2XC5ZKLp+fSE5HJMdjXMDIRPx+sxBxjjfSN2iO+3V9/QJtpBKTOoi11gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="scope"
        title=""
        src="/static/2a3cd42a535fa086fcc0f362eb03ea88/4ab23/scope.png"
        srcset="/static/2a3cd42a535fa086fcc0f362eb03ea88/0eb09/scope.png 500w,
/static/2a3cd42a535fa086fcc0f362eb03ea88/1263b/scope.png 1000w,
/static/2a3cd42a535fa086fcc0f362eb03ea88/4ab23/scope.png 1462w"
        sizes="(max-width: 1462px) 100vw, 1462px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>위와 같은 scope을 설정해 주었다.</p>
<h3 id="Slack-Bot-Token-및-Signing-Secret" style="position:relative;">Slack Bot Token 및 Signing Secret<a href="#Slack-Bot-Token-%EB%B0%8F-Signing-Secret" aria-label="Slack Bot Token 및 Signing Secret permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>Slcak Bot Token을 얻기 위해서는 먼저 데스트탑 앱에 우리 서드파티 앱을 설치해야 한다. 스크롤을 조금 올리면 ‘OAuth Tokens for Your Workspace’  란에 ‘Install to Workspace’ 버튼을 눌러준다.</p>
<p>![Install to Workspace](../img/tools/create-a-slack-random-drawer-app-to-deploy-with-cloudflare/Install to Workspace.png)</p>
<p>그러면, 아래 사진과 같이 scope에서 설정한 권한을 묻는 페이지가 나타나고, 허용을 눌러주면 데스트탑 앱에 서드파티 앱이 설치된다. 그리고 다시 웹 페이지로 돌아와 보면 ‘Bot User OAuth Token’이 생성된 것을 볼 수 있다. 이 녀석을 잘 가지고 있자.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1318px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 44.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABTklEQVR42p1Sy07DMBD0/1+5FIFA/AUHULkicapEW1UhzqO0ieOkeTZN8xi8C6kQEqLC0mh27d2x17uiLEvsdjvkeY4kSVBVFYqiYJ84TVNkWcZ+Xdf4awnf9zGbzeC5HhaLBVzHhSMdWJYFKSVWqxWWyyXm81cE2y0n9X2PYRhOImSPvqCbtdYIwxBxHCOKIra3JjkIAraVihAnKZROEKrPc8qhWKqOmKphwcwIRnRoEFCgESWBQCneUyZYxwl0UUNle1RNy6+hV3Yjuo59FtQqhC9tvLsufEfCs9+wLwuqC317xDDi2Bhu0BvumsMJw7fyiYXz8oz7yQUeby/xcDNhkD29u/qB6xOevjA1cdq2sD8cIG2bGyhK6qT5B4LWEXLT0cYEUEfPwbFp0LYtTwexIMP1PP7o9XqNzWYDGqX/LkGq1CESJpw7b78JfgA2t6gImBJywQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="OAuth-Tokens-for-Your-Workspace"
        title=""
        src="/static/96a2da7c580ae8d60327dd540f7103da/90694/OAuth-Tokens-for-Your-Workspace.png"
        srcset="/static/96a2da7c580ae8d60327dd540f7103da/0eb09/OAuth-Tokens-for-Your-Workspace.png 500w,
/static/96a2da7c580ae8d60327dd540f7103da/1263b/OAuth-Tokens-for-Your-Workspace.png 1000w,
/static/96a2da7c580ae8d60327dd540f7103da/90694/OAuth-Tokens-for-Your-Workspace.png 1318w"
        sizes="(max-width: 1318px) 100vw, 1318px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>그리고 Signing Secret은, 우리가 제작할 서드파티 앱의 서버에 검증 값으로 넣어주어야 할 비밀 키값이다. 좌측 패널의 ‘Basic Information’ 을 클릭하고 App Credentials 란에 보면 Signing Secret 값이 있다. show 버튼을 클릭하면 안에 내용이 보이기 때문에 잘 가지고 있자.</p>
<p>총 2개의 key를 얻게 되었다.</p>
<br/>
<h2 id="서드파티-앱을-위한-서버-환경-설정" style="position:relative;">서드파티 앱을 위한 서버 환경 설정<a href="#%EC%84%9C%EB%93%9C%ED%8C%8C%ED%8B%B0-%EC%95%B1%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%84%9C%EB%B2%84-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95" aria-label="서드파티 앱을 위한 서버 환경 설정 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>서드파티 앱이 설치되었으므로, 서드파티 앱에서 생성하는 이벤트를 처리할 서버를 생성해야 한다. Slack에서는 서드파티 앱을 위한 3가지의 언어 프레임워크를 지원한다. Java, Python, JavaScript다. 우리는 JavaScript를 사용할 것이기 때문에, <a href="https://github.com/SlackAPI/bolt-js" target="_blank" rel="nofollow">Bolt-js</a> 라는 프레임워크를 사용해 서버를 생성할 것이다.</p>
<h3 id="Bolt-js" style="position:relative;">Bolt-js<a href="#Bolt-js" aria-label="Bolt js permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>소스 코드는 <a href="https://github.com/pozafly/its-you/tree/only-bolt" target="_blank" rel="nofollow">only-bolt Branch</a>에 있다.</p>
<p>Bolt-js는 Slack의 서드파티 앱에서 발생한 이벤트를 감지해 데이터를 가공 후 다시 Slack 데스크탑 앱으로 결과를 내려주는 역할을 하는 서버를 만드는 프레임워크다. Slack에서 서드파티 앱 개발을 위해 자체적으로 만든 프레임워크다.</p>
<blockquote>
<p>단, 추후 배포할 cloudflare는 Bolt-js와는 호환성이 좋지 않기 때문에 다른 프레임워크를 사용할 것이다. cloudflare 말고 AWS-Lambda 및 Heroku에 배포할 생각이라면, Bolt-js를 사용해도 좋다.</p>
</blockquote>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">$ <span class="token function">npm</span> i @slack/bolt</code></pre></div>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">$ <span class="token function">npm</span> i <span class="token parameter variable">-D</span> dotenv ts-node-dev typescript</code></pre></div>
<p><code class="language-text">dotenv</code>는 위에서 얻은 2개의 key를 노출하지 않고 세팅하기 위해 설치했으며, <code class="language-text">ts-node-dev</code> 는 타입스크립트로 작성된 코드를 실행하기 위한 런타임 환경을 위해 설치했다.</p>
<blockquote>
<p>※ <code class="language-text">ts-node-dev</code></p>
<p><a href="https://github.com/wclr/ts-node-dev" target="_blank" rel="nofollow">ts-node-dev</a>는 내부적으로 <a href="https://github.com/fgnass/node-dev" target="_blank" rel="nofollow">node-dev</a>를 사용하고 있는데, node-dev는 <a href="https://www.npmjs.com/package/nodemon" target="_blank" rel="nofollow">Nodemon</a>과 같이 코드가 수정되면 Node.js 서버를 재시작 하지 않아도 즉시 다시 시작하게 해주는 라이브러리다. 그리고 <a href="https://github.com/TypeStrong/ts-node" target="_blank" rel="nofollow">ts-node</a>는 Node.js 용 타입스크립트 REPL(실행기)이다. 이 둘을 섞어 사용한다. TypeScript를 JavaScript로 변환 과정 없이 코드를 수정하면 즉시 서버를 재시작 시켜주는 라이브러리이다.</p>
</blockquote>
<p>시크릿 키 설정을 위해 프로젝트 root에 <code class="language-text">.env</code> 파일을 생성한다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># .evn
SLACK_BOT_TOKEN=...
SLACK_SIGNING_SECRET=...</code></pre></div>
<p>이전에 알아두었던 SLACK_BOT_TOKEN, SLACK_SIGNING_SECRET을 입력한다. 그리고 dotenv 라이브러리를 아래와 같이 사용한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// src/utils/env.ts</span>
<span class="token keyword">const</span> dotenv <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'dotenv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dotenv<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token string">'./.env'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>그리고 프로젝트 root에 src/app.ts 파일을 만든다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// src/app.ts</span>
<span class="token keyword">import</span> <span class="token string">'./utils/env'</span><span class="token punctuation">;</span>  <span class="token comment">// dotenv import 구문</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> App <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@slack/bolt'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  signingSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SLACK_SIGNING_SECRET</span><span class="token punctuation">,</span>
  token<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SLACK_BOT_TOKEN</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'⚡️ Bolt app is running!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>서드파티 앱을 위한 Node.js 서버가 하나 만들어졌다.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token comment">// package.json</span>
<span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"ts-node-dev --respawn --transpile-only src/app.ts"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>다음과 같이 scripts를 설정해 주고 <code class="language-text">npm run dev</code> 명령어로 서버를 띄울 수 있다.</p>
<p>브라우저에 <code class="language-text">localhost:3000</code> 으로 접속해보면 아무것도 뜨지 않지만, 터미널 로그에는 GET 요청이 찍힌 것을 확인할 수 있다.</p>
<h3 id="Ngrok-설정" style="position:relative;">Ngrok 설정<a href="#Ngrok-%EC%84%A4%EC%A0%95" aria-label="Ngrok 설정 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>이제 슬랙 자체 서버에 웹훅 URL을 등록할 차례이다. 하지만, Slack에서의 통신은 HTTPS만 가능하도록 설정이 되어있다. localhost는 HTTP이므로 임시 HTTPS 통로가 필요한 상황이다. Slack API에서도 공식적으로 <a href="https://slack.dev/node-slack-sdk/tutorials/local-development" target="_blank" rel="nofollow">Ngrok을 사용해 개발을 권장</a>하고 있다.</p>
<blockquote>
<p>※ Ngrok</p>
<p>프록시 서버다. localhost에 띄워진 서버를 외부에 HTTPS로 접근할 수 있게 도와준다. 네트워크 터널링으로, Ngrok 자체 서버에서 localhost로 이어주는 프로그램이다.</p>
</blockquote>
<p>Ngrok에 회원가입을 하고 <code class="language-text">Setup &amp; Installation</code> 에 적힌 대로 따라해 보자. brew로 install 할 것을 권장한다. 터미널 명령어로 즉시 터널링을 해도 되지만, Ngrok에서는 ID 당 하나의 고정 URL을 제공한다.</p>
<p>왼쪽 탭의 ‘Domains’에 들어가서 Create Domain 버튼을 클릭한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABjklEQVR42n2SzU7rMBCF8wrlJ02TOD927MRxmraU0hRQEQsWiB0/L4DE+r7OXdx3PXc8rUorIRafRh7bx2dOEvSzAcPmEaZeYBwpxIkh9BEGydE6YQyf/Ymg7Qb0i3t0/QDXrWDdAG0HmHbDVTdrmGZA3d4e+rW7Q5xahGO5F6oOBHHWIclnmMQG0aQiNELauAzlr3yLKYRhQb2Ma3BxIXB+nuCMGJ3FGI0miCKJPHfI8pZwTF50TFY4RlBvHJUILwXKZgt7/QrVPpJDn1Fak0MNkVnOTKoZjXkDXa+IGyi9RFFOUVJfVQvuVWaJmKZKRY2yWkLVG4hijiBJm8Pr/pKvki5VZsVC1q0x7++wvX/Dw/YD14snVNT3gt65yBxSMsQfLlY7wePRRNaSwzm5WJOjORIhMW1WeP/8i/evf3h++QOt6UFyn9PoqbB7Gv4L9oLuRLAoexbzwt5Jpa+gyhZlbpFTLLwve57mVNAg8LlJRfnI7qTu6CizKeEfoEikj8URLZ9TdGa39mYsO/wPD+wAtYFxVR4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Ngrok"
        title=""
        src="/static/bf99613d43db87e971f69d7b704e7d7c/f97d7/Ngrok.png"
        srcset="/static/bf99613d43db87e971f69d7b704e7d7c/0eb09/Ngrok.png 500w,
/static/bf99613d43db87e971f69d7b704e7d7c/1263b/Ngrok.png 1000w,
/static/bf99613d43db87e971f69d7b704e7d7c/f97d7/Ngrok.png 2000w,
/static/bf99613d43db87e971f69d7b704e7d7c/35d52/Ngrok.png 2214w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>그러면 고정 URL을 하나 지급해 주는데, 아래의 명령어와 같이 터미널에 입력한다. 끝에 <code class="language-text">80</code> 포트를 <code class="language-text">3000</code> 포트로 변경하면 된다.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">$ ngrok http <span class="token operator">--</span>domain<span class="token operator">=</span>perfect<span class="token operator">-</span>noticeably<span class="token operator">-</span>escargot<span class="token punctuation">.</span>ngrok<span class="token operator">-</span>free<span class="token punctuation">.</span>app <span class="token number">3000</span></code></pre></div>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1706px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.800000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABWElEQVR42kWQ607DMAyFuzRp7smarS2dNBAgBgM0thYkBOz9H+vgVNX245MdWzm2T3H+/sLT6YTnlxEPTwd8nH5wGv9wJA6UH4ffKb/Uhz8M45lyIuefZ+z2I3YvmQFF297BCQsvHbxycNLCCgMtNGxlYCi6imozUiiwUqAsOSEo59DaIIQI7wOKtE4IqyVcDNAViUgD5zxiWiLagOjihNeOeiRYKXAurggS53wewFHcPz7COAvGy6nJWAkXArpNj7CsYb2HthaKtlhQj80fGZ+FpnilOByO6LobSKkmwcWCoW87PNOgZrVCihFNSjBSwmm6QGXUhJFqfpMtNNAbg2K7vUXfb6ComE8oGMd99Bj6Bh+ZmzWOfYvXVcR7UxMJb+sa+xSwi5ZixJ56ufZK9hXZTGsdhKgmwXyOMRaaBhgz+0lb1nVCSrQxbds0Laqquvg2ke1gJf4B/DOoxA6lYRoAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Ngrok-terminal"
        title=""
        src="/static/80043ab3458a5a8723c94b4b473a497a/af7a3/Ngrok-terminal.png"
        srcset="/static/80043ab3458a5a8723c94b4b473a497a/0eb09/Ngrok-terminal.png 500w,
/static/80043ab3458a5a8723c94b4b473a497a/1263b/Ngrok-terminal.png 1000w,
/static/80043ab3458a5a8723c94b4b473a497a/af7a3/Ngrok-terminal.png 1706w"
        sizes="(max-width: 1706px) 100vw, 1706px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>터미널에서 포워딩 하고 있는 정보를 알려주고 있는데 이를 복사해두자. 이제 <code class="language-text">https://perfect-noticeably-escargot.ngrok-free.app</code> URL로 들어오는 요청은 모두 현재 localhost:3000으로 요청이 들어올 것이다.</p>
<p>Slack API로 돌아와서 웹훅 URL을 입력해 줄 것이다. 우리가 만들 서드파티 앱은 Slack 입력 창에 <code class="language-text">/random</code> 등의 명령어를 쳐 동작시킬 것이기 때문에 이를 등록해주어야 한다. ‘Slack Commands’ 란에 들어와 ‘Create New Command’ 를 클릭해주자.</p>
<p>Request URL에는 <code class="language-text">https://perfect-noticeably-escargot.ngrok-free.app/slack/events</code> 와 같이 아까 저장한 URL 주소와 뒤에 <code class="language-text">/slack/events</code> 를 붙여주도록 하자.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1152px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 137.60000000000002%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAABYlAAAWJQFJUiTwAAACfElEQVR42o2ViY7iQAxE+f//20FiB8IdCEfCEe7gnedV9XaiBG1LhZs+3LbLdnrWMm63m83nc8dsOrM0TW2xWAQsl0t7vV5tV633fr9bFQ6HQ+v3+y4Hg4ElSeLy69eXjYYjV8jdJnpVVdUW+A8+jTZFuucW8trz+ay9yubj8bDr9epgDu73u4PzAv/Zc5dRspgvbDwe22azqVlyuVwsXaa2Wq38oqyIweOn08mOx+NfhXKh6XpsuayXjMEa1ilMbmFRFHY+n22327n5MTmHwyFYwBkka5rjBSAsQeFsNvN0IE3Y1CjL0tdW6crdzrLM55zdZBuX+/3eynPpDwSXu1iM2W5jNg6N0q9HDJJR4qQgyTUF+FAc7Pv3tyXjxPI893AQhhhimLnnIT9x0Dmg1+KUeFUvq95VjUBkTFBQyCWCyiuxe6wTR4DVkEOsRBLgMWWCu8wrkEJpEXgpZHCROibwk8nEzzkxP+eoZ0jhURWBV8qnEsMalCl1kKQYUlYrtoGULpYZXZURJzWIG4yzjAtgvV67i7jFHEyn07DHOq5ibdMAFYQnNgdRRC1vt1uX+T4PBOAeCa/qEHmxQvVHZ1ldRV3E06SjgXYleXCZi7vtzoq8cAKwDimXmetC83Jb3D1tcBPgJgpBts68WcDqp7JrWuks46q6SJy0gIdYJ25qtk0Q39Bg0cwil8gpLAI+/wkDXQUy4jRpQ02hLPxERBsp8VA+BoWUkcqM/sYDxBHLVSFYHfdLeVNeyn+1rLRhA2VcIF5IdWTFiXxkT5Wibs1aUKhWr68ZpHAobmlt8VKuxv9rLCuOfOWQzb7XrOfmes1CNcquxvk/0FfvDzdwhoMSwE+BAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="create-new-command"
        title=""
        src="/static/738ea85217540cc532fc40d4e998c56c/d2d74/create-new-command.png"
        srcset="/static/738ea85217540cc532fc40d4e998c56c/0eb09/create-new-command.png 500w,
/static/738ea85217540cc532fc40d4e998c56c/1263b/create-new-command.png 1000w,
/static/738ea85217540cc532fc40d4e998c56c/d2d74/create-new-command.png 1152w"
        sizes="(max-width: 1152px) 100vw, 1152px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>그리고 반드시 하단 우측에 ‘Save’ 버튼을 눌러 등록해 주는 것을 잊지 말자.</p>
<p>이제 Slack 데스크톱 앱에서 <code class="language-text">/random</code> 을 입력하고 enter를 치면 Ngrok을 켜둔 터미널에 log가 잘 찍히는지 확인한다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1810px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 44.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABh0lEQVR42n2R6U7DMBCEnaa5bcdx0iQFylHRqrQU6A3ifv+HGnZNC0ggfnxax5udscfi8WGLyWKNyXSD8dUSy80L7lZPWKyfsVg9Y719Jd6w2tfN7h3b+3esNq+uXt88YHq9w2y+c2vRtifIwhQqVtCJQp5pWktIQqX8nSOXjIGmXppmXyQJVwlrKyilcTEcQ5jSwtgCUiqkQeLEdZ7DEHmqYUisINgkCWMEQfgnnvDQtMcQw9EIcZqg4/vodgN4Xge9pkavrqE0nSjLHN0gQKfjw/e7v+A5QYJV1ULM57do6xZRFLsGDw0Gpzg7O0dRWJRlRaeXrh/Hyb7Gn3W/x1ePwgi2bCCapk8ZWHdsFmRHzoPFrC3JtefgNYtzXtxjE/5Pa4rHFFQ19UnQlj3kuUFADj4Jsii7Mhw8D/Ag/3MYzjJJxp8RHfA8yrChDFtyr+lhJF0j2OdxgE8dkhHz8wEOeyE9EhNFiTPoHw0gZlWBS6MwLQ2aNKbH+Rb9HvwfzpMF2/4JPgBUXdUbFHIN3QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Ngrok-terminal-log"
        title=""
        src="/static/b03dc634d0b00d1f81f5167c44e2c971/418a5/Ngrok-terminal-log.png"
        srcset="/static/b03dc634d0b00d1f81f5167c44e2c971/0eb09/Ngrok-terminal-log.png 500w,
/static/b03dc634d0b00d1f81f5167c44e2c971/1263b/Ngrok-terminal-log.png 1000w,
/static/b03dc634d0b00d1f81f5167c44e2c971/418a5/Ngrok-terminal-log.png 1810w"
        sizes="(max-width: 1810px) 100vw, 1810px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>하지만, 데스크톱 앱에는 error가 찍히는데 잘 동작한 것이니 걱정하지 말자.</p>
<br/>
<h2 id="서드파티-앱-개발" style="position:relative;">서드파티 앱 개발<a href="#%EC%84%9C%EB%93%9C%ED%8C%8C%ED%8B%B0-%EC%95%B1-%EA%B0%9C%EB%B0%9C" aria-label="서드파티 앱 개발 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>먼저 서드파티 앱의 동작을 기획해 보았다.</p>
<h3 id="모달" style="position:relative;">모달<a href="#%EB%AA%A8%EB%8B%AC" aria-label="모달 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><img src="/956cf34a8d98119a5364c74ecd31ebdf/modal.gif" alt="modal"></p>
<ul>
<li><code class="language-text">/random</code> 이라고 입력하면 모달이 뜬다.</li>
<li>모달에는 아래의 요소가 존재한다.
<ul>
<li>멤버 선택 select</li>
<li>‘전체 선택’ 버튼</li>
<li>인원수 input (defualt 1)</li>
<li>제출 버튼</li>
</ul>
</li>
<li>제출 버튼을 클릭하면 현재 채널에 축하 메시지와 함께 추첨 인원 명이 나타난다.</li>
</ul>
<h4 id="이벤트-등록" style="position:relative;">이벤트 등록<a href="#%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%93%B1%EB%A1%9D" aria-label="이벤트 등록 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<p>가장 처음 기획했던 것은, Slack에서 모달이 나타나 추첨하고자 하는 인원을 넣고 제출 버튼을 누르면 랜덤으로 input에 적힌 인원수만큼 골라 메시지로 표현해 주는 것이다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// src/app.ts</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/**/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">app<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'/random'</span><span class="token punctuation">,</span> commands<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'⚡️ Bolt app is running!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>app.command 함수의 첫 번째 인자로 문자열을 받을 수 있는데, 데스트탑 앱에서 슬래시를 포함한 문자열을 입력하고 보내면 <code class="language-text">commands</code> 라는 콜백 함수를 실행시킬 수 있다. 마치 <code class="language-text">addEventListener</code> 와 비슷하다고 생각하면 된다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commands</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  body<span class="token punctuation">,</span>
  ack<span class="token punctuation">,</span>
  client<span class="token punctuation">,</span>
  logger<span class="token punctuation">,</span>
  payload<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> SlackCommandMiddlewareArgs <span class="token operator">&amp;</span> AllMiddlewareArgs<span class="token operator">&lt;</span>StringIndexed<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 데스트탑 앱에서 요소(모달)를 연다.</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>views<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      trigger_id<span class="token operator">:</span> body<span class="token punctuation">.</span>trigger_id<span class="token punctuation">,</span>
      view<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'modal'</span><span class="token punctuation">,</span>
        callback_id<span class="token operator">:</span> <span class="token string">'random'</span><span class="token punctuation">,</span> <span class="token comment">// app.view() 의 첫 번째 인자로 들어가는 id</span>
        blocks<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">/* 모달 요소들 정의 */</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Bolt-js에서 인자로 넘겨주는 <code class="language-text">client</code> 에는 데스트탑의 다양한 정보를 얻을 수 있거나, 데스크탑 앱을 원하는 방식대로 실행시킬 수 있는 함수들이 들어가 있다.</p>
<p><code class="language-text">client.views.open</code> 함수는 데스크탑 앱에서 요소를 여는 역할을 하고 있는데, <code class="language-text">blocks</code> 로 들어가는 배열은 슬랙에서 정의한 요소가 들어가게 된다. <a href="https://app.slack.com/block-kit-builder/T051WUXT25S#%7B%22blocks%22:%5B%7B%22type%22:%22section%22,%22text%22:%7B%22type%22:%22mrkdwn%22,%22text%22:%22Hello,%20Assistant%20to%20the%20Regional%20Manager%20Dwight!%20*Michael%20Scott*%20wants%20to%20know%20where%20you&#x27;d%20like%20to%20take%20the%20Paper%20Company%20investors%20to%20dinner%20tonight.%5Cn%5Cn%20*Please%20select%20a%20restaurant:*%22%7D%7D,%7B%22type%22:%22divider%22%7D,%7B%22type%22:%22section%22,%22text%22:%7B%22type%22:%22mrkdwn%22,%22text%22:%22*Farmhouse%20Thai%20Cuisine*%5Cn:star::star::star::star:%201528%20reviews%5Cn%20They%20do%20have%20some%20vegan%20options,%20like%20the%20roti%20and%20curry,%20plus%20they%20have%20a%20ton%20of%20salad%20stuff%20and%20noodles%20can%20be%20ordered%20without%20meat!!%20They%20have%20something%20for%20everyone%20here%22%7D,%22accessory%22:%7B%22type%22:%22image%22,%22image_url%22:%22https://s3-media3.fl.yelpcdn.com/bphoto/c7ed05m9lC2EmA3Aruue7A/o.jpg%22,%22alt_text%22:%22alt%20text%20for%20image%22%7D%7D,%7B%22type%22:%22section%22,%22text%22:%7B%22type%22:%22mrkdwn%22,%22text%22:%22*Kin%20Khao*%5Cn:star::star::star::star:%201638%20reviews%5Cn%20The%20sticky%20rice%20also%20goes%20wonderfully%20with%20the%20caramelized%20pork%20belly,%20which%20is%20absolutely%20melt-in-your-mouth%20and%20so%20soft.%22%7D,%22accessory%22:%7B%22type%22:%22image%22,%22image_url%22:%22https://s3-media2.fl.yelpcdn.com/bphoto/korel-1YjNtFtJlMTaC26A/o.jpg%22,%22alt_text%22:%22alt%20text%20for%20image%22%7D%7D,%7B%22type%22:%22section%22,%22text%22:%7B%22type%22:%22mrkdwn%22,%22text%22:%22*Ler%20Ros*%5Cn:star::star::star::star:%202082%20reviews%5Cn%20I%20would%20really%20recommend%20the%20%20Yum%20Koh%20Moo%20Yang%20-%20Spicy%20lime%20dressing%20and%20roasted%20quick%20marinated%20pork%20shoulder,%20basil%20leaves,%20chili%20&#x26;%20rice%20powder.%22%7D,%22accessory%22:%7B%22type%22:%22image%22,%22image_url%22:%22https://s3-media2.fl.yelpcdn.com/bphoto/DawwNigKJ2ckPeDeDM7jAg/o.jpg%22,%22alt_text%22:%22alt%20text%20for%20image%22%7D%7D,%7B%22type%22:%22divider%22%7D,%7B%22type%22:%22actions%22,%22elements%22:%5B%7B%22type%22:%22button%22,%22text%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Farmhouse%22,%22emoji%22:true%7D,%22value%22:%22click_me_123%22%7D,%7B%22type%22:%22button%22,%22text%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Kin%20Khao%22,%22emoji%22:true%7D,%22value%22:%22click_me_123%22,%22url%22:%22https://google.com%22%7D,%7B%22type%22:%22button%22,%22text%22:%7B%22type%22:%22plain_text%22,%22text%22:%22Ler%20Ros%22,%22emoji%22:true%7D,%22value%22:%22click_me_123%22,%22url%22:%22https://google.com%22%7D%5D%7D%5D%7D" target="_blank" rel="nofollow">Block Kit Builder</a> 에서 직접 형태를 제작해 볼 수 있다.</p>
<p>여기서 <code class="language-text">callback_id</code> 가 중요하다. 모달에서 ‘제출’ 버튼을 클릭하면 <code class="language-text">app.command()</code> 함수와 마찬가지로 <code class="language-text">app.view()</code> 의 첫 번째 인자의 id와 일치해야 view()의 두 번째 인자인 콜백 함수가 실행된다.</p>
<p><code class="language-text">view</code> 객체는 후에 모달이 다시 렌더링 될 때 비슷한 객체가 사용되기 때문에 이 객체를 비슷한 틀로 생성해 주는 <code class="language-text">generateBlocks</code> 함수로 빼내어 만들어주는 게 좋다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// src/utils/generateBlocks.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@slack/bolt'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">generateBlocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'modal'</span><span class="token punctuation">,</span>
		<span class="token comment">// ...</span>
    blocks<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">/* */</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h4 id="전체-선택-버튼-만들기" style="position:relative;">전체 선택 버튼 만들기<a href="#%EC%A0%84%EC%B2%B4-%EC%84%A0%ED%83%9D-%EB%B2%84%ED%8A%BC-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-label="전체 선택 버튼 만들기 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<p>전체 선택 버튼을 클릭하면 select에 모든 멤버 리스트가 자동으로 들어가야 한다. 그렇게 하기 위해서는 멤버 리스트가 필요하다. <code class="language-text">client.conversations.members()</code> 함수를 사용해서 들고 올 수 있는데, 이 함수는 이전에 설정 한 Slack API의 scope 중 <code class="language-text">[channels:read]</code> 를 사용한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// 명령어를 받아 모달을 여는 콜백함수</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commands</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 현재 채널의 멤버 목록을 가져온다.</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> members <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>conversations<span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      channel<span class="token operator">:</span> body<span class="token punctuation">.</span>channel_id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
		<span class="token comment">// ...</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>members를 console.log()로 찍어보자. 각 멤버의 고윳값이 들어있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 964px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 11.200000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhUlEQVR42k3DSQ6CMABAUW4CtBCrNNAwyCAFRJAEg8PC+x/ly9KXPEdpw7w+KduB7rbQ9hO1HbHXO8v64nzpkUrjJwV+WuIlOUEU44VHXKFw5d9A4TTDzOP9Ja8tSVahp4r8M6LGArNZTNUQVily6whWi9wfygyhI8RoEMO+N/h1THiK+QFWX0A7NNE/9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="member-list"
        title=""
        src="/static/1a5624f55fab8e4f294a8c0949402973/ed282/member-list.png"
        srcset="/static/1a5624f55fab8e4f294a8c0949402973/0eb09/member-list.png 500w,
/static/1a5624f55fab8e4f294a8c0949402973/ed282/member-list.png 964w"
        sizes="(max-width: 964px) 100vw, 964px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p><code class="language-text">multi_users_select</code> 은 Block에서 멤버들을 선택할 수 있도록 해준다. multi_users_select 요소의 <code class="language-text">initial_users</code> 프로퍼티 값으로 <code class="language-text">members</code> 값을 넣어주면 다음 렌더링 때 적용된다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts">blocks<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
    <span class="token comment">// NOTE: view.update를 사용할 경우, 변경하고 싶은 element의 block_id가 변경되어야 value 등의 내용이 달라짐.</span>
    <span class="token comment">// https://stackoverflow.com/questions/72788906/slack-block-kit-plain-text-input-element-update-text-value</span>
    block_id<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">member_input_block_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMilliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    element<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'multi_users_select'</span><span class="token punctuation">,</span>
      placeholder<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'plain_text'</span><span class="token punctuation">,</span>
        text<span class="token operator">:</span> <span class="token string">'Select users'</span><span class="token punctuation">,</span>
        emoji<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      action_id<span class="token operator">:</span> <span class="token string">'multi_users_select-action'</span><span class="token punctuation">,</span>
<span class="gatsby-highlight-code-line">      initial_users<span class="token operator">:</span> isInitModal <span class="token operator">&amp;&amp;</span> members<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> members <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre></div>
<p><code class="language-text">block_id</code> 값이 이전 렌더링과 다음 렌더링 시 다르다면 새롭게 그려준다. 마치 react의 <code class="language-text">key</code> props와 비슷하다. 만약 다음 렌더링 때 변경되지 않았다면 변경된 initial_users 값이 적용되지 않는다. 따라서, 처음 렌더링 된 모달이라면 <code class="language-text">[]</code> 값을, 아니라면 members 값을 넣어주었다.</p>
<p>이제 <code class="language-text">client.views.update()</code> 함수를 이용해 렌더링을 일으킬 수 있도록 해야 한다. 버튼을 하나 만들어보자.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts">blocks<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token comment">// ...</span>
  <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'section'</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'plain_text'</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token string">'모든 인원을 선택합니다.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    accessory<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
      text<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">'plain_text'</span><span class="token punctuation">,</span>
        text<span class="token operator">:</span> <span class="token string">'전체 선택'</span><span class="token punctuation">,</span>
        emoji<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token string">'click_me'</span><span class="token punctuation">,</span>
      action_id<span class="token operator">:</span> <span class="token string">'insert_all_users'</span><span class="token punctuation">,</span> <span class="token comment">// app.action() 첫 번째 인자로 들어가는 id</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre></div>
<p>버튼을 하나 만들었고, <code class="language-text">action_id</code> 를 <code class="language-text">insert_all_users</code> 로 주었다. 이는 <code class="language-text">app.action()</code> 콜백 함수를 실행시킨다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// src/app.ts</span>

<span class="token comment">// ...</span>
app<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'/random'</span><span class="token punctuation">,</span> commands<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">app<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'insert_all_users'</span><span class="token punctuation">,</span> insertAllUsers<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token comment">// ...</span></code></pre></div>
<p>이제 <code class="language-text">insertAllUsers</code> 함수를 만들 것이다. 하지만, insertAllUsers 함수에서는 members를 넣을 수 없다. <code class="language-text">app.action()</code> 의 콜백 함수의 body에는 channel 정보가 있지만, channel.id 에는 ID 정보가 들어오지 않기 때문이다.</p>
<p><code class="language-text">app.action()</code> 이벤트가 발생할 때는 channel 정보를 얻을 수 없을 수 없다. 이 과정은 마치 HTTP의 stateless와 비슷하다. Slack API에서는 이런 경우를 대비해 <code class="language-text">private_metadata</code> 필드를 사용할 수 있다.</p>
<p>맨 처음 모달을 열 때, channel 정보로 members 목록을 직렬화하여 blocks의 <code class="language-text">private_metadata</code> 로 Slack 자체 서버로 보낸 뒤, <code class="language-text">app.action()</code> 함수에서 <code class="language-text">body</code> 필드에 담겨있는 members 정보를 역직렬화 하여 사용하도록 했다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// src/handlers/insertAllUsers.ts</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">insertAllUsers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  ack<span class="token punctuation">,</span>
  client<span class="token punctuation">,</span>
  body<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> SlackActionMiddlewareArgs<span class="token operator">&lt;</span>BlockAction<span class="token operator">></span> <span class="token operator">&amp;</span> AllMiddlewareArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token comment">// 역직렬화 하여 members 정보를 얻는다.</span></span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> members<span class="token punctuation">,</span> channelId <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>
    body<span class="token punctuation">.</span>view<span class="token operator">?.</span>private_metadata <span class="token operator">||</span> <span class="token string">'{}'</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> client<span class="token punctuation">.</span>views<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      view_id<span class="token operator">:</span> body<span class="token operator">?.</span>view<span class="token operator">?.</span>id<span class="token punctuation">,</span>
      hash<span class="token operator">:</span> body<span class="token operator">?.</span>view<span class="token operator">?.</span>hash<span class="token punctuation">,</span>  <span class="token comment">// hash 값이 다르면 view를 새로 그려준다.</span>
      view<span class="token operator">:</span> <span class="token function">generateBlocks</span><span class="token punctuation">(</span><span class="token punctuation">{</span> members<span class="token punctuation">,</span> channelId<span class="token punctuation">,</span> isInitModal<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 모달 element가 담긴 blocks를 리턴함.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">client.views.update()</code> 함수는 기존 모달을 업데이트하라는 명령이다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// src/utils/generateBlocks.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@slack/bolt'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  channelId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  members<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  isInitModal<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">generateBlocks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  channelId<span class="token punctuation">,</span>
  members <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  isInitModal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> privateMetadata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> members<span class="token punctuation">,</span> channelId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token string">'modal'</span><span class="token punctuation">,</span>
		<span class="token comment">// ...</span>
    blocks<span class="token operator">:</span> <span class="token punctuation">[</span>
    	<span class="token comment">// ...</span>
    	<span class="token punctuation">{</span>
    		<span class="token comment">// ...</span>
        element<span class="token operator">:</span> <span class="token punctuation">{</span>
          type<span class="token operator">:</span> <span class="token string">'multi_users_select'</span><span class="token punctuation">,</span>
          <span class="token comment">// ...</span>
<span class="gatsby-highlight-code-line">          initial_users<span class="token operator">:</span> isInitModal <span class="token operator">&amp;&amp;</span> members<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> members <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>이제 ‘전체 선택’ 버튼을 클릭하면, 모달을 열 때 받아두었던 members의 정보로 현재 채널에 들어와있는 멤버 목록을 select에 적용시킬 수 있게 되었다.</p>
<h4 id="제출-기능-만들기" style="position:relative;">제출 기능 만들기<a href="#%EC%A0%9C%EC%B6%9C-%EA%B8%B0%EB%8A%A5-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-label="제출 기능 만들기 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h4>
<p>제출 버튼을 클릭하면 <code class="language-text">app.view()</code> 함수의 콜백이 실행된다.</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// src/app.ts</span>

<span class="token comment">// ...</span>
app<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'/random'</span><span class="token punctuation">,</span> commands<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'insert_all_users'</span><span class="token punctuation">,</span> insertAllUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">app<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">view</span><span class="token generic class-name"><span class="token operator">&lt;</span>ViewSubmitAction<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'random'</span><span class="token punctuation">,</span> responseModal<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token comment">// ...</span></code></pre></div>
<p>띄워졌던 모달의 <code class="language-text">callback_id</code> 는 <code class="language-text">random</code> 이었기 때문에 식별자는 <code class="language-text">'random'</code> 이다. responseModal 함수를 보자.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>
  AllMiddlewareArgs<span class="token punctuation">,</span>
  SlackViewAction<span class="token punctuation">,</span>
  SlackViewMiddlewareArgs<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@slack/bolt'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> getResponseMessage <span class="token keyword">from</span> <span class="token string">'../utils/getResponseResult'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">responseModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  ack<span class="token punctuation">,</span>
  view<span class="token punctuation">,</span>
  client<span class="token punctuation">,</span>
  logger<span class="token punctuation">,</span>
  body<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> SlackViewMiddlewareArgs<span class="token operator">&lt;</span>SlackViewAction<span class="token operator">></span> <span class="token operator">&amp;</span> AllMiddlewareArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> channelId <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span>view<span class="token operator">?.</span>private_metadata <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> states <span class="token operator">=</span> view<span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">;</span>
    <span class="token comment">// 몇 명을 뽑을지 number input에 들어있던 값을 가져온다.</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>states<span class="token punctuation">[</span><span class="token string">'number_input'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'number_input-action'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 선택된 멤버를 가져온다.ㅏ</span>
    <span class="token keyword">let</span> members<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>states<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'member_input_block'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        members <span class="token operator">=</span> states<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'multi_users_select-action'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>selected_users<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> count <span class="token operator">></span> members<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        response_action<span class="token operator">:</span> <span class="token string">'errors'</span><span class="token punctuation">,</span>
        errors<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 에러가 났을 경우, number_input의 error 메시지를 표현한다.</span>
          <span class="token punctuation">[</span><span class="token string">'number_input'</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">'숫자의 범위가 맞지 않습니다.'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">await</span> <span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">getResponseMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      author<span class="token operator">:</span> body<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      members<span class="token punctuation">,</span>
      count<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      channel<span class="token operator">:</span> channelId<span class="token punctuation">,</span>
      text<span class="token operator">:</span> message<span class="token punctuation">,</span>
      mrkdwn<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>몇 명을 뽑을지 결정하는 <code class="language-text">count</code>, 뽑을 대상 목록이 들어있는 <code class="language-text">members</code> 를 변수에 넣고, <code class="language-text">getResponseMessage()</code> 로 보내 평문 메시지로 만든다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> getRandomUsers <span class="token keyword">from</span> <span class="token string">'./getRandomUsers'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  author<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  members<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">getResponseMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  author <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>
  members <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> selectedUsers <span class="token operator">=</span> <span class="token function">getRandomUsers</span><span class="token punctuation">(</span>members<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mentionedUser <span class="token operator">=</span> selectedUsers
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">>• </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">등 : &lt;@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> authorUser <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>author<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">🥳 *당첨! 축하드립니다.* 🎉- by </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>authorUser<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mentionedUser<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>함수는 이렇게 되어있다. 마크다운 구문을 사용할 수 있기 때문에 마크 다운이 포함되어 있으며, <code class="language-text">&lt;@${name}></code> 과 같은 형태는 아래 이미지와 같이 맨션 된 유저가 나타내게 만든다. (<a href="https://api.slack.com/reference/surfaces/formatting#mentioning-users" target="_blank" rel="nofollow">Mentioning users</a>)</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 924px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 81.19999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC7UlEQVR42nWTPZPbVBiF1aZgMoHsypYtWVffsmTZkr+/1l7vbpJNspDAbCahI0WK9MkwAz8gHRTQUNAw/CSGAv4HQ/XwXu1MZsk6xRld6V6d+77nnNcYThY8/Pwp/eGEQ8uh7QaEcU4Y9YiSPn6UEcRX8KPuXui9jhfRsBWGIws3SGpoMv289+AxT559xZfPL7l/fsEXTy852p4wni6ZzFY3MJuvyYqKpib0wrR+0VCybrseUTBm4Dyi7zyU9QgVxaggfX+x68c3oAuzHA/j0HK523QwWzZWO+Cu+oyzWz/zwvmDr+0/Obn1I7fbtzGbSs50aGi03RtodXwpxseYzUes52Oq2YbxZE1YKk6NX/n9p3/57Yd/ODF+YbIbst2dM19uKFZLTMet27sOXV3d8vm9DetFxXevplxcPKGY9Tj65B1vg7944//N9s47Gn4Dx42x3ZCWVPEh2f8ID6wOtgo4WgzJiyFhmtO0Aqw7FdanglYo7tt1AjR0e/rnfagJTTngqJDVekraG9TGuGGM3xUjEu16jKfjoWMj0OJr0o9WaLYVXuDz/cuK3ekpvXJMkOQMhjNxfki3V1LIN50Cve740XuCvRVehTkk6s1rIiXVNW1XHHVqHLauUhDK3nR5zGC8xBJHW9dgS4eaUFduuJKvNC94eTlnvlrRq6Y4flfa7gky4jTFDyMi0bYsc/oDPRXeTVIZCi2HEaYFZTXk9YsJu7P7rDdbZhNxelVSDQeMxyMh6RN3hbBQVH1FN9PTldZ615pL2PVTay2jF4rYOUm5xU8K8jxmO7UETXpZh0M7pK0iuT2mpbo1HP/a1HwAo2F7KN/n229KNsdbaXvHfLFhtTljtNjy4HjFZjaim2fsZk3Olk2K3MZsS6t7jDFMEV0FEY9OF1SjKVk5xT86J5lvZUYjskziIvsdLyCNbdLEwfX0+Km9ATfqORRBVTKoRW37CY1shCltmU0bHXx9qT53YHkctDzMj5Bpwv8AfELc60s+ktgAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="name"
        title=""
        src="/static/9cb35947f59091e7c953e2c0f27aec95/8643c/name.png"
        srcset="/static/9cb35947f59091e7c953e2c0f27aec95/0eb09/name.png 500w,
/static/9cb35947f59091e7c953e2c0f27aec95/8643c/name.png 924w"
        sizes="(max-width: 924px) 100vw, 924px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>그리고 위의 <code class="language-text">client.chat.postMessage()</code> 함수로 getResponseMessage 함수를 통해 만들어진 string을 넘겨주면 슬랙에 뽑힌 사람이 표시되게 된다. <code class="language-text">getRandomUsers</code> 는 간단하게 <code class="language-text">Math.random()</code> 함수로 제작했다. 자세한 것은 <a href="https://github.com/pozafly/its-you/blob/only-bolt/src/utils/getRandomUsers.ts" target="_blank" rel="nofollow">repository</a>에 있다.</p>
<br/>
<h3 id="command-line으로-처리하기" style="position:relative;">command line으로 처리하기<a href="#command-line%EC%9C%BC%EB%A1%9C-%EC%B2%98%EB%A6%AC%ED%95%98%EA%B8%B0" aria-label="command line으로 처리하기 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>모달을 띄우는 과정이 번거롭다면 오직 cli를 이용해 처리하게 만들고 싶었다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">/random @product 2</code></pre></div>
<p>와 같은 명령어를 치면, product로 묶인 그룹에서 2명을 뽑으라는 명령어를 만들고 싶었다. 모달을 띄워야 하는 번거로운 과정 없이 그룹 안에서 뽑을 수 있는 기능이다.</p>
<p><img src="/08e0519b2125958da8e1df17adbe8be2/cli.gif" alt="cli"></p>
<p>이렇게 <code class="language-text">@</code> 로 시작하는 그룹을 생성하기 위해서는 슬랙 유료 버전(Slack Pro)을 사용해야 한다. 슬랙에서 어떤 워크스페이스에 상관없이 맨 처음은 무료로 한 달간 Slack Pro를 사용할 수 있도록 해주기 때문에 무료로 Slack Pro로 변경시키고 그룹 기능을 얻었다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 69.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACJklEQVR42p2UbW/TMBSFM6ASEgUGfUkcx3He4ySt0zbN1A6h0a7TvkxMwP//LYdrt2hiiDHx4VHero+Pj6/jXOpblI1GGGWIkgJxWqLrN/h6/w13d/c43Nxit78hDrjaXePqy96y2X5CICL4XECEEYSMkBcKTq9+QNUaSV7C4yE8P4ArUoi6xyhqMGQZ3vLcch4qnIsjH8IK47ixNVx1iPUWYdXBkVmCsp5BLzqkRYW8VBjRwGG+gdvu4C33EOsbsOU1XooFXhBnQQvH13DY/MQMjttgIOh9WjRwWYCpx+GSO0YMWYL35RZJf4CnP+NdsbG8jjvLgESNyJk/P8KPwgNBkyjKLy1rhEkOP4xp2RJuEGMqC7BqjTeSZp3U5GD24Mi4ewzTeGUctt0F5VdBL3vanBZRpsBJmFHgJqtRVGOSmKyqB+SffKSYplTneIFETIKNXlmnfpjAEzG4TCnXFXJVU6410lwhycq/Yr4Xygj6gh7I4apHNV8iICEviKxg03aQqbKTcJk9jWk70nGmtCGSes+ImasRMzAiKWpLSP35L0Sc25U6HuNYVA0uLzZYzTRysh6fhEyBmfWX8FOY2kyZ9nE5urrBdtlhTYKlKSgbyrOxRc/FbKYZ44zcKWRWQekOeTW31l2zZNqY/xJUWY+JLzFiAmPKc+z69ggaYVP0XEz+pkucrvh+PL+uB9fz6dRw+lGk9odR1HNC/0b5mOYE3atZi5/DQ4xJxb5GmwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="mapping-group"
        title=""
        src="/static/3d6daec986bfb43b149562292a9b843c/f97d7/mapping-group.png"
        srcset="/static/3d6daec986bfb43b149562292a9b843c/0eb09/mapping-group.png 500w,
/static/3d6daec986bfb43b149562292a9b843c/1263b/mapping-group.png 1000w,
/static/3d6daec986bfb43b149562292a9b843c/f97d7/mapping-group.png 2000w,
/static/3d6daec986bfb43b149562292a9b843c/a3ebb/mapping-group.png 2454w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>이미지와 같이 더보기 > 사람 > 사용자 그룹 > 사용자 그룹 새로 만들기에 들어가면 그룹을 만들 수 있다. 나는 <code class="language-text">product</code> 그룹을 생성했다.</p>
<p>이제  <code class="language-text">commands</code> 함수를 수정해야 한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">commands</span><span class="token punctuation">(</span><span class="token comment">/**/</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>rawGroupText<span class="token punctuation">,</span> count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> payload<span class="token punctuation">.</span>text<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// NOTE: rawGroupText: '&lt;!subteam^S06MDLGF4RY|@product>',</span>
  <span class="token keyword">const</span> groupId <span class="token operator">=</span> rawGroupText<span class="token operator">?.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;=subteam\^)(.*?)(?=\|)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gm</span></span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>groupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 모달 open</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">openModal</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 즉시 결과 return</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> users <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>usergroups<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        usergroup<span class="token operator">:</span> groupId<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>users <span class="token operator">||</span> users<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'no users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>payload에는 command line의 정보가 들어 있기 때문에 이를 가공하여 groupId를 뽑아내고 groupId가 없다면 기존과 같이 모달을 연다. 만약 groupId가 있다면 즉시 결과를 return 하도록 변경했다.</p>
<p>그룹 text는 <code class="language-text">&lt;!subteam^S06MDLGF4RY|@product></code> 이런 형태로 나온다. 따라서 적절한 정규식을 이용해 groupId를 가려내고, groupId가 존재하지 않으면 모달을 띄워주고 그렇지 않은 경우 즉시 결과를 return 하도록 했다.</p>
<br/>
<h2 id="배포" style="position:relative;">배포<a href="#%EB%B0%B0%ED%8F%AC" aria-label="배포 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>개발이 완료되었기 때문에 Bolt-js로 만들어진 서버를 배포해야 했다. 왜냐하면 이 기능을 사용하기 위해 매번 Ngrok를 키고 localhost의 서버를 가동해야 하기 때문이다. Slack API 특성상 항상 서버가 이벤트를 받을 준비를 하고 있지 않아도 요청이 들어왔을 경우에만 함수를 실행시키는 serverless function 서비스에 물리기 괜찮아 보였다. 요청 수가 그렇게 많지 않기 때문이다.</p>
<p>Bolt-js에서는 AWS Lambda를 띄우기 위해 <code class="language-text">AwsLambdaReceiver</code> 를 제공하고 있다(<a href="https://slack.dev/bolt-js/deployments/aws-lambda" target="_blank" rel="nofollow">링크</a>). 하지만, AWS Lambda를 띄우기 위해서 free tier 계정을 생성하고 요금을 조금이라도 지불해야 했기 때문에 무료 serverless 서비스를 찾아야 했다. 이전에 토이 프로젝트를 만들었을 때도 결국 1년이 지난 후에는 내릴 수밖에 없었던 것을 생각하면 무료 serverless 서비스를 이용하고 싶었다.</p>
<br/>
<h3 id="Cloudflare" style="position:relative;">Cloudflare<a href="#Cloudflare" aria-label="Cloudflare permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><a href="https://www.cloudflare.com/ko-kr/" target="_blank" rel="nofollow">Cloudflare</a>에는 <a href="https://workers.cloudflare.com/" target="_blank" rel="nofollow">Workers</a>라는 serverless 서비스가 있다. 무료로 제공하고, 구성 방법이 무척이나 간단하다. 내가 느꼈을 때 가장 좋았던 특징은 0ms 콜드 스타트 지원이다. V8 엔진 기반 런타임을 가지고 있어서 VM 위에 함수 여러 개를 띄워두는 형식이 아니라, 하나의 런타임이 여러 함수를 실행할 수 있다고 한다. V8 엔진 기반이라 JavaScript 또는 TypeScript를 무척 잘 지원하지만 타 언어는 완벽한 지원을 하지는 않는다는 점이다. 우리의 서버는 Node.js로 만들어졌기 때문에 문제없이 사용할 수 있다. (<a href="https://x.com/hyunbinseo97/status/1764523963231977694?s=20" target="_blank" rel="nofollow">물론 이런 이야기도 있다.</a>)</p>
<p>다만, 문제점이 하나 있었다. Bolt-js는 애초에 serverless 환경을 염두에 두고 만들어진 프레임워크가 아니라는 점이다. AWS Lambda는 이제는 무척 보편화된 서비스이기 때문에 Bolt-js에서 연결할 수 있는 리시버를 만들어두었다지만, Cloudflare 버전은 없었다.</p>
<p>Workers의 생김새를 보자.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span>
    request<span class="token operator">:</span> Request<span class="token punctuation">,</span>
    env<span class="token operator">:</span> Env<span class="token punctuation">,</span>
    ctx<span class="token operator">:</span> ExecutionContext
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>기존에 Bolt-js로 만든 서버의 형태와 너무 다르다. 요청에 따라 Response 인스턴스를 내보내는 구조이다.</p>
<p>결국 AWS Lambda를 띄워야 하나 고민 중에 <a href="https://dev.to/seratch/running-slack-app-on-cloudflare-workers-3hhn" target="_blank" rel="nofollow">Running Slack App on Cloudflare Workers</a> 글을 보게 되었다. 저자는 Slack의 Relations 팀에 속해 있으며 Relations팀에서 Bolt-js를 개발했다고 한다. 따라서 스펙과 세부 구현 내용을 알 것이라 생각했기 때문에 저자가 만든 라이브러리를 사용하면 Cloudflare에 배포가 가능할 것 같았다.</p>
<p><a href="https://github.com/seratch/slack-cloudflare-workers" target="_blank" rel="nofollow">slack-cloudflare-workers</a> 라는 라이브러리이다.</p>
<br/>
<h3 id="Cloudflare-개발-환경-설정" style="position:relative;">Cloudflare 개발 환경 설정<a href="#Cloudflare-%EA%B0%9C%EB%B0%9C-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95" aria-label="Cloudflare 개발 환경 설정 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p><a href="https://developers.cloudflare.com/workers/wrangler/" target="_blank" rel="nofollow">wrangler</a>는 Cloudflare 제품을 개발하기 위한 CLI다. Cloudflare Workers에 올라갈 소스를 관리하고 배포하기 위해서 필요하다. npm으로 전역에 설치할 수도 있지만, 우리는 헤비 하지 않게 개발 모드 및 배포에만 사용할 것이므로 local devDependency로만 설치하도록 하자. 그리고 slack-cloudflare-workers 라이브러리도 설치하자.</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">$ <span class="token function">npm</span> i <span class="token parameter variable">-D</span> wrangler@latest slack-cloudflare-workers</code></pre></div>
<p>package.json에 wrangler cli 명령어를 적어둔다.</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token comment">// package.json</span>
<span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"wrangler dev src/app.ts"</span><span class="token punctuation">,</span>
  <span class="token property">"deployment"</span><span class="token operator">:</span> <span class="token string">"wrangler deploy src/app.ts"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>프로젝트 루트에 <code class="language-text">.dev.vars</code> 파일을 생성하고 Slack App에 필요한 환경 변수를 넣어준다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">SLACK_BOT_TOKEN=...
SLACK_SIGNING_SECRET=...</code></pre></div>
<p>그리고 아래 명령어를 통해 cli에 환경 변수를 저장할 수 있도록 해주자.</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">$ wrangler secret put SLACK_SIGNING_SECRET
$ wrangler secret put SLACK_BOT_TOKEN</code></pre></div>
<p>app.ts에 가장 기본이 되는 소스를 넣고 실행시킬 것이다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">Env</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span>
    request<span class="token operator">:</span> Request<span class="token punctuation">,</span>
    env<span class="token operator">:</span> Env<span class="token punctuation">,</span>
    ctx<span class="token operator">:</span> ExecutionContext
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>dev 스크립트를 실행시키면 localhost:8787로 실행이 되는 것을 볼 수 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1664px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.8%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKklEQVR42o2S/U6DMBTFeQ/nJmMDbKEUSqEtELepyeL7v8/x3prFTDHxj18O56bc3o8meThjXwds5YitGLCTjtQiFQalbJBLhUJqVE2NrCixSXM87nNsswK7Q/mLxPgAMwRU2kD3IxozROrOEkOkai0kUbXfvqj0atJkPr2id1PEEAeh8JQL7At5R1ZWd3BstUIfApz3mJcFsukgdA9J3H5iTekCruYnqwndckFjA7pxgbYeZpypZUcjsJHGjH+2t5rwfP3Ay/sVrNPlDcbPMGFBXms8ZEdsmPQYF/EfEnXyqAMt4xSgFg/hqLJAw18cROghvEVZtSjrFs+qi3DF7G+xm2dNumFCTduLShs0bkbLIyDPrTf9F4q+W3oNPBb2fEb3PsbYc1yZEZ8s7PMl87PLjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="start-dev-script"
        title=""
        src="/static/58494d10234f65df10821247c088cd71/7bd25/start-dev-script.png"
        srcset="/static/58494d10234f65df10821247c088cd71/0eb09/start-dev-script.png 500w,
/static/58494d10234f65df10821247c088cd71/1263b/start-dev-script.png 1000w,
/static/58494d10234f65df10821247c088cd71/7bd25/start-dev-script.png 1664w"
        sizes="(max-width: 1664px) 100vw, 1664px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>그러면 이 녀석을 Ngrok에서 터널링 해주었던 것처럼 터널링 해주어야 한다. cloudflare에서 제공하는 <code class="language-text">cloudflared</code> 패키지를 사용해도 되지만, 우리는 이전에 Ngrok에서 고정 URL을 받았기 때문에 굳이 cloudflared를 사용하지 않아도 상관없다. 설치하고 싶다면 <code class="language-text">brew install cloudflare/cloudflare/cloudflared</code> 로 설치하고 <a href="https://developers.cloudflare.com/1.1.1.1/encryption/dns-over-https/dns-over-https-client/#cloudflared" target="_blank" rel="nofollow">공식 문서</a>를 참조하여 터널링 해주면 된다. Ngrok port를 8787로 수정하여 터널링 해주자.</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">$ ngrok http <span class="token parameter variable">--domain</span><span class="token operator">=</span>perfect-noticeably-escargot.ngrok-free.app <span class="token number">8787</span></code></pre></div>
<br/>
<h3 id="Cloudflare-workers로-마이그레이션" style="position:relative;">Cloudflare workers로 마이그레이션<a href="#Cloudflare-workers%EB%A1%9C-%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98" aria-label="Cloudflare workers로 마이그레이션 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>app.ts 소스를 아래와 같이 수정한다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> commands <span class="token keyword">from</span> <span class="token string">'./handlers/commands'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> responseModal <span class="token keyword">from</span> <span class="token string">'./handlers/responseModal'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> insertAllUsers <span class="token keyword">from</span> <span class="token string">'./handlers/insertAllUsers'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  SlackApp<span class="token punctuation">,</span>
  SlackEdgeAppEnv<span class="token punctuation">,</span>
  ExecutionContext<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'slack-cloudflare-workers'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">fetch</span><span class="token punctuation">(</span>
    request<span class="token operator">:</span> Request<span class="token punctuation">,</span>
    env<span class="token operator">:</span> SlackEdgeAppEnv<span class="token punctuation">,</span>
    ctx<span class="token operator">:</span> ExecutionContext
  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Response<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SlackApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span> env <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">'/random'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> commands<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token string">'insert_all_users'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> insertAllUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token string">'random'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> responseModal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>slack-cloudflare-workers 에서 원하는 형태로 변경시켰다. <code class="language-text">app.command()</code>, <code class="language-text">app.action</code> 등은 기존 Bolt-js에서 입력한 것과 거의 유사한 모습이지만 두 번째 매개변수로 <code class="language-text">async () => {}</code> 익명 함수를 넘겨주었다.</p>
<p>Slack API는 웹훅 URL로 이벤트 요청을 보냈을 때 3초 이내에 답변이 와야만 한다. 따라서 Bolt-js에서 <code class="language-text">await ack()</code> 함수를 매 콜백 함수마다 실행했었다. slack-cloudflare-workers에서는 두 번째 매개변수로 3초 이내에 답변이 가지 않을 만한 상황이라면 ‘임시 메시지’를 보낼 수 있다. 3초 안에 답변을 줄 수 있고, 임시 메시지가 필요하지 않다면 나와 같이 비어있는 익명 함수를 적어줘도 무방하다.</p>
<p>그리고 뒤에 오는 함수는 기존과 동일하지만 인자로 받는 값은 다르다. 살짝 비교해 보자.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// Bolt-js의 responseModal 함수</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">responseModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  ack<span class="token punctuation">,</span>
  view<span class="token punctuation">,</span>
  client<span class="token punctuation">,</span>
  logger<span class="token punctuation">,</span>
  body<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> SlackViewMiddlewareArgs<span class="token operator">&lt;</span>SlackViewAction<span class="token operator">></span> <span class="token operator">&amp;</span> AllMiddlewareArgs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">ack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> channelId <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span>view<span class="token operator">?.</span>private_metadata <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> states <span class="token operator">=</span> view<span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">;</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>states<span class="token punctuation">[</span><span class="token string">'number_input'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'number_input-action'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// slack-cloudflare-workers의 responseModal 함수</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">responseModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  context<span class="token punctuation">,</span>
  payload<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token operator">:</span> SlackRequest<span class="token operator">&lt;</span>SlackEdgeAppEnv<span class="token punctuation">,</span> ViewClosed <span class="token operator">|</span> ViewSubmission<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> client <span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> view<span class="token punctuation">,</span> user <span class="token punctuation">}</span> <span class="token operator">=</span> payload<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> channelId <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>view<span class="token operator">?.</span>private_metadata <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> states <span class="token operator">=</span> view<span class="token punctuation">[</span><span class="token string">'state'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">;</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>states<span class="token punctuation">[</span><span class="token string">'number_input'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'number_input-action'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Bolt-js는 인자의 객체 형태와 slack-cloudflare-workers의 인자 객체 형태가 다르다. 하지만, context 내부에 <code class="language-text">client</code> 및 다른 값들이 모두 들어있는 것을 볼 수 있다. 이 규칙에 맞게 기존 소스를 마이그레이션 해주면 된다.</p>
<br/>
<h3 id="Cloudflare-Workers에-배포" style="position:relative;">Cloudflare Workers에 배포<a href="#Cloudflare-Workers%EC%97%90-%EB%B0%B0%ED%8F%AC" aria-label="Cloudflare Workers에 배포 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h3>
<p>Cloudflare에 가입하고 이메일 인증을 마치면 대시보드에 들어온다. 그리고 터미널에 wrangler로 로그인하기 위해 아래 명령어를 입력한다.</p>
<div class="gatsby-highlight" data-language="sh"><pre class="language-sh"><code class="language-sh">$ wrangler login</code></pre></div>
<p>그러면 브라우저로 연결되고, 아래와 같은 이미지가 뜨게 되는데 Allow를 눌러주자.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1060px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 237%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAvCAYAAADjNOpjAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEFUlEQVR42pWXS3LTQBCGuQNX4hwsOAR77sCaBbdgxcaBQFFxmQSISOz4FdvxI37EjiW/Gn0T/8rYihSjqq6ekab/+fsxLemF5VybzcZWy6UtN2bR948WfvtgG8u/XuQ9XMZgrXbbKpWyNU+PrHp2bIsozAdcrVaGrJ0sTXMJoG4M27U9jGG9FWe7Xjth7BguFpGF0cLCxdqiWK9WjwaJxGt0XyDoxWJh8/nc6a3LG7ubzmzca9is+cO6nZYFwV+rVqt2dXVl5XLZ6WazaZeXl+7+xcWFnZ+fO91qtWw8Htvd3d0WcLO26Xxpk+CzhZ/eWrsaWLH0036dnVmxWLRCoeB0EAR2cnJipVLJbQIYG93c3NhkMrHpdPqYlGnMcDIa2rTfiRd0rV6vW6PRcIZIrVZzcwBgCBvcvL+/d0AwTAApDeISEYs4foyJB6L4+WPFbrmXGDRYDhCBdjVmAJt2XCowgs319bWTSqXi4ggr1Siii40SQHZ4cH1qnU7Hut2u9Xo9Fx/maN3r9/vJnE1xnQuMFGAYho4FIBjClCyKsTIpNtKZDGezWcICYTwYDNwYrWewY1M2Hw6HCSCyAwh94gUj3y1YIniwnwhAchnCBDDFCg0Y4GJ+e3vrNOzQil+KIRkky2JJZpnjGrVJHQJO9rnHhlEUJWApQB6ykELlvuqRhRrvNIytXa7LCjiuM0bDloQw1z1cxRN0ZtngMklQ7TEGDNYqHVznEMAIj9RlnmQIoF8uKhPixgaAIjwjMYRmNBrt9MTUSdlPCgaUC2wkagwIYcpMCoYAUA7sDhO1JgylWcepATw3KSyCodoUDGFLL2TOM9oZY+LpN4vMpGAEC8YwQeQiGpYI7LQmkyEGuIkBbAFGK1a4L9cJSabLmmBAyeAmLqkX+ueb+Oroyd1MhtBnZwyUGJ1f5mrz+801NykEWj2R4FODxFUdxy92NddchriHoQoaUcP12R3EUK8AtX+dELUxnXO1toObw1Nd2p+rUbD+WZfV+9AYKqYI8fO7trr1s82BjMJmn6G6EOWl0uG532RTgCRFbHRCdGJU6DoxlBUitilADFTAaL9FwYox7JmrDz7rMgb+afBfTOqDJETHLve9DAsSop6I1kuKuQodQL9kMgFxA3dwTfHSl5WaA/f2wVKACO6q/gBljOvKqNwlq2SbZ5kfS3rhwEYsxJQxDNXyNSfTmd82AgSExYCqBmGiJpp3pQAx8ssEJn6p6D5jnW/W+19kSR0iBJ0MsoDkuDecdCz+16zegvqyzczyIZefCL+NpVwGlI93/pQqnXs7Dib2pzk7eKMdQC7iUzj6YrVKYG/eB/by9Vd79e70gcn/AupLirKAYWsQ2u/GzOq9OX7tdOksSd7Lfoayvu4PFf5T/gHzACe/r1XGVQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="wrangler-login"
        title=""
        src="/static/2af6a6523eb2a5794d69b3162dae3318/ea60f/wrangler-login.png"
        srcset="/static/2af6a6523eb2a5794d69b3162dae3318/0eb09/wrangler-login.png 500w,
/static/2af6a6523eb2a5794d69b3162dae3318/1263b/wrangler-login.png 1000w,
/static/2af6a6523eb2a5794d69b3162dae3318/ea60f/wrangler-login.png 1060w"
        sizes="(max-width: 1060px) 100vw, 1060px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>이제 wrangler.toml 파일을 생성해 주어야 한다. toml 파일은, Workers에서 동작할 서버의 정보를 담는 파일이다.</p>
<div class="gatsby-highlight" data-language="toml"><pre class="language-toml"><code class="language-toml"><span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"its-you"</span>
<span class="token key property">main</span> <span class="token punctuation">=</span> <span class="token string">"src/app.ts"</span>
<span class="token key property">compatibility_date</span> <span class="token punctuation">=</span> <span class="token string">"2024-03-04"</span>

<span class="token punctuation">[</span><span class="token table class-name">vars</span><span class="token punctuation">]</span>
<span class="token key property">SLACK_BOT_TOKEN</span> <span class="token punctuation">=</span> <span class="token string">"..."</span>
<span class="token key property">SLACK_SIGNING_SECRET</span> <span class="token punctuation">=</span> <span class="token string">"..."</span></code></pre></div>
<p>vars에는 Workers 내부에 코드를 참조할 수 있는 환경 변수다. 배포할 때마다 Workers의 함수는 변경되고, 빌드 시 생성될 환경 변수가 날아가므로 명시해 주면 문제없이 동작한다. Cloudflare 대시보드로 돌아가 보면 Workers가 하나 띄워져 있는 것을 볼 수 있다. Workers를 클릭하고, 상단의 Triggers 탭으로 가면 이렇게 Workers의 공식 URL을 받을 수 있다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1212px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 109.60000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAADOElEQVR42nVU2ZLbRgzkH+fD8pgvyKsfUhXHZa8rK8k6KEq8h5yDwznawIjiSrs2iqghh8Mm0A0gA9k0TSjLCpfLBVVVoWkajOPIrxBjhLUWwzBAKgUxSkz8TO/btoX3Ho+W3QGvBJbneXIG5sMMdgfshYAWPYbDDio/QJK3VYnZuQTEwOyZmgLk5DGqCdrMeG8MqLVGRVG74gRxzrF5+Y7xeIC9FugpUjfPlGGZssuUDRiNQ9WOaIRco2JnCyGkP/NTGAXGSw1xIUqKEl5J+BDXM7xm1lEEFGE/KChtP0TIh9j4nJk9ptnCUkR3f29ZMzqUvU2A12bAtR5QtgNxQ5wQmFtIb8cZh9MV2+0G+/0e280G5/MZM4GyBsyzMQaZppQH7TBITW6IEw1lbpH6JZUknNFoice+7yFIIBaN77uuWyujKApk0xyTKE0vKUqd1jug8wwY1tSZ17ByzHvxA+dZPZAglLIYFZrBoBYGzvkHQL+WxaI7XfTDaHj3ib/r9YpMKJ/46UaD4bKDrk+Ia8m8iRIWpZ0jvkgYbSPmSRCmWQGZgsxYTyo78DoPVAqySR/GuKTIqS7Phuj5+7vHpz3wz8Hj5ShRt/0tajKuxczMdJCE6UhlIafflk1IikfkjcWp9cj7iKobYZRYG2DSEtnsQioRPVmSf34i+R7hE4eRai9qTh7RUyOEt1r840/cVFakMpeMIB7dour7CJ+HAO0loLjyzfbXZ9x6metQUP1pijDEtyPhIUJeky8tFpaWe3T+UTYaD6FmGk16rbl7edwnyK8tftjhz7PBRDRjwLmZULQTjpVO66AjOsXKhvWwNhMkTZd71L+yLO8CtuWMz7seLyeFf3cC36gcWgVcep5Et4+lnrE/5tjttmn48kjj3mXn+7unsqGzMO0JtvjynIJ/Gw5GU1n1XQLrqX+55jrqZ+7pmnq5ruvUz5nQ1CmDTRODGH/qy8fhYGia7GmoNk0NM3FkHJFanAYKuZTyJko32qRwfMezf+hlS9GV/7+i2R/QUertIUfHTvf98QR9KWiU2dv4kgTKE5tBf9cpbhA4v/zAj697vP63w4b9yw6v5DntWxoMLMpPYPauR1q12yYAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="workers-personal-url"
        title=""
        src="/static/56a2404052e762299827dee498590c43/468b3/workers-personal-url.png"
        srcset="/static/56a2404052e762299827dee498590c43/0eb09/workers-personal-url.png 500w,
/static/56a2404052e762299827dee498590c43/1263b/workers-personal-url.png 1000w,
/static/56a2404052e762299827dee498590c43/468b3/workers-personal-url.png 1212w"
        sizes="(max-width: 1212px) 100vw, 1212px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>이제 Slack API 공식 페이지로 돌아가서 <code class="language-text">Interactivity &amp; Shortcuts</code>, <code class="language-text">Slash Commands</code> 에 설정해 두었던 웹훅 URL을 변경하자. 물론 <code class="language-text">/slack/events</code> 를 뒤에 붙이는 것을 잊지 말자.</p>
<p>이제 모든 요청은, 터널링 하고 있는 local로 들어오는 것이 아니라 Cloudflare의 Workers로 요청이 들어올 것이고 serverless 함수가 실행되어 웹훅을 Slack에 돌려줄 것이다.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 2000px; "
    >
      <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 62.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABn0lEQVR42o1TSW7bQBDk23PJKd8JcshHfNNFsCzSXGbfK90tDUHTDuABSrOoWVPd1TPM84wYE1LKhPRflFLQWttRa4X2GcZlKBsxq4BIHMP9fseyLHDOwnsvsLR2zsFaC2OMIMaI8+jkShvMy4pAMUNgZaWiNNAfGuu6kaIqCjq6uj4qLd9tw2Qa3g0Q6WM+K/QzLMsmi5AaKXLYtg2abtREzgoZrDbnvBMqD/z6C/z4Dfz8A7y8AasDbCDCcZpJakKmWzg1VnMcpRa8vt0QQ9zTFNJF0aUOTc7wnIlQkSKpBaXGSjjF4+D9OE17DTuhI+UhhE81JVNGSa/Xix2tre5OdoLjvs/ntRCO4/hIlVIrucBHD12c5HEO/gqfCC+XCyZKSdKglGOKUMV9i+xLQu5DBtdIXKUeZIXlG4TsRDsT3m43XK9X6r9VbnPJw9VIfdkezn0AKWI8P86NSlTTY99N4ZfR3ZSgkhFIaXYB2XqU55ydx7bO0Gojh43EWKthtHrEEhqZOYirh9fA4HU/O858OddYOoJeV6MHUU8x/wAP9frp/3b0uwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="worker-status"
        title=""
        src="/static/2b3f81dbf826c9bf17b2272dc63fdbab/f97d7/worker-status.png"
        srcset="/static/2b3f81dbf826c9bf17b2272dc63fdbab/0eb09/worker-status.png 500w,
/static/2b3f81dbf826c9bf17b2272dc63fdbab/1263b/worker-status.png 1000w,
/static/2b3f81dbf826c9bf17b2272dc63fdbab/f97d7/worker-status.png 2000w,
/static/2b3f81dbf826c9bf17b2272dc63fdbab/b02f5/worker-status.png 2236w"
        sizes="(max-width: 2000px) 100vw, 2000px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
    </span></p>
<p>대시보드에서 얼마나 요청을 받았는지, 현재 상태는 어떤지 체크할 수 있는 기능을 제공하고 있다. 그리고 실시간 로그도 볼 수 있다. 만약 Slack App에 기능을 자주 추가하거나 수정해야 한다면, GitHub Actions와 연동해 자동으로 Workers에 배포될 수 있도록 CI/CD 환경을 구성해 봐도 좋을 것 같다.</p>
<br/>
<h2 id="마치며" style="position:relative;">마치며<a href="#%EB%A7%88%EC%B9%98%EB%A9%B0" aria-label="마치며 permalink" class="auto-link after"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>회사에서 Slack을 메신저로 사용한다면, Slack App을 직접 만들어 사용해 봐도 좋을 것 같다. 업무를 하려면 매일 들어가야 하는 곳이기 때문에 접근성이 매우 좋기 때문이다. 다만, Slack App을 만드는 과정은 그렇게 평탄한 과정은 아니다.</p>
<p>생각보다 내가 원하는 기능이 없을 때도 있고 공식 문서가 친절한 듯 친절하지 않기 때문이다. 맨 처음 기획했던 것이 있었는데, 모달 UI에서 지원을 하지 않아 개발 도중 방향을 틀기도 했다.</p>
<p>아주 복잡한 처리가 아니라면 재미로 한 번 만들어봄직하다고 생각한다. 그리고, 랜덤 뽑기 뿐 아니라 프로덕트 빌드가 완료되면 웹훅을 연동해 메시지를 보낸다든지, 버튼을 클릭하면 GitHub Actions 상에 빌드 된 결과물을 즉시 배포할 수 있는 버튼을 만든다든지 생산성 도구로 활용하면 더 빛을 발할 것 같다.</p>
<p>그리고 이번에 Cloudflare의 Workers를 한 번 활용해 봐서 재미있었다. 실제 Node.js 환경은 아니라서 <code class="language-text">fs</code> 와 같은 Node.js API를 사용하지는 못하지만, 정말 가벼운 작업을 돌릴 수 있다는 점이 매력적이었다.</p>
<p>사실 아직 구현하고 싶은 모든 기능을 구현하지는 않았다. 메시지만 내뱉는게 정적인 것 같아 추후에 다른 이펙트를 넣어 극적인 효과를 내는 봇으로 추가 기능 개발을 하고 싶다.</p>
<p>덧, <code class="language-text">/random @product 2</code> 대신 cli option을 추가해 <code class="language-text">/random @product -c 2 -d @pozafly</code> 와 같은 명확한 옵션을 주어야만 동작하는 기능으로 변경시켰다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">-c [number] : 뽑을 인원
-d [@id] : 제외시킬 사람 이름</code></pre></div>
<br/>
<br/>
<blockquote>
<p>참고</p>
<ul>
<li><a href="https://wormwlrm.github.io/2022/05/07/Bamboo-Forest-Slack-App.html" target="_blank" rel="nofollow">임금님 귀는 당나귀 귀! 대나무숲 슬랙 앱 만들기</a></li>
<li><a href="https://sddev.tistory.com/9" target="_blank" rel="nofollow">웹훅이란?</a></li>
<li><a href="https://dev.to/seratch/running-slack-app-on-cloudflare-workers-3hhn" target="_blank" rel="nofollow">Running Slack App on Cloudflare Workers</a></li>
<li><a href="https://ryanking13.github.io/2020/07/26/introducing-cf-workers-2.html" target="_blank" rel="nofollow">Cloudflare Workers로 서버리스 앱 개발하기</a></li>
</ul>
</blockquote></div></section></article><style data-emotion="css lhozv1">.css-lhozv1{position:relative;box-sizing:border-box;width:100%;max-width:760px;margin-right:auto;margin-left:auto;}</style><div class="css-lhozv1"><div></div></div></div></main><style data-emotion="css dcfhc9">.css-dcfhc9{position:relative;padding:0 5vw;}</style><style data-emotion="css 1exn8a1">.css-1exn8a1{background:#0a0b0c;position:relative;padding:0 5vw;}.css-1exn8a1 .post-card{padding-bottom:0;border-bottom:none;}.css-1exn8a1 .post-card:after{display:none;}.css-1exn8a1 .post-card-primary-tag{color:#fff;opacity:0.6;}.css-1exn8a1 .post-card-title{color:#fff;word-break:keep-all;opacity:0.8;-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-1exn8a1 .post-card:hover .post-card-image{opacity:1;}.css-1exn8a1 .post-card-excerpt{color:rgb(255 255 255 / 0.6);}.css-1exn8a1 .static-avatar{border-color:#000;}.css-1exn8a1 .post-card-byline-content{color:rgb(255 255 255 / 0.6);}.css-1exn8a1 .post-card-byline-content a{color:rgb(255 255 255 / 0.8);}.css-1exn8a1 .author-avatar{border-color:#0a0b0c;}.css-1exn8a1 .author-profile-image{background:#0a0b0c;}@media (max-width: 650px){.css-1exn8a1 .post-card{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;margin:25px;padding:25px 0 0;}}</style><aside class="read-next css-1exn8a1 e7ky4j51"><div class="css-8aaawc"><style data-emotion="css 2ud111">.css-2ud111{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:0 -25px;padding:60px 0 0;}</style><div class="read-next-feed css-2ud111 e7ky4j50"><style data-emotion="css 1qcf3bt">.css-1qcf3bt{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:0 1 326px;-ms-flex:0 1 326px;flex:0 1 326px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:0 25px 50px;padding:25px;background:linear-gradient(
    #1a1c20,
    #0a0b0c
  );border-radius:3px;}.css-1qcf3bt a{-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;}.css-1qcf3bt a:hover{-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 1170px){.css-1qcf3bt{-webkit-flex:1 1 261px;-ms-flex:1 1 261px;flex:1 1 261px;margin-bottom:5vw;}}@media (max-width: 650px){.css-1qcf3bt{display:none;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;margin:0 25px;padding:0;background:none;}}</style><article class="read-next-card css-1qcf3bt ez817vd4"><header class="read-next-card-header"><style data-emotion="css 18chcim">.css-18chcim{margin:0;font-size:1.3rem;font-weight:300;line-height:1em;color:rgb(255 255 255 / 0.6);letter-spacing:0.4px;}.css-18chcim span,.css-18chcim a{font-size:inherit;}.css-18chcim a{font-weight:500;color:#fff;-webkit-text-decoration:none;text-decoration:none;opacity:0.8;}.css-18chcim a:hover{opacity:1;}</style><h3 class="css-18chcim ez817vd3"><span>More in</span> <a href="/tags/tool/">Tool</a></h3></header><style data-emotion="css 1vix6iq">.css-1vix6iq{font-size:1.3rem;}.css-1vix6iq ul{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:0;padding:0;list-style:none;}.css-1vix6iq li{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;margin:0;padding:20px 0;border-bottom:rgb(255 255 255 / 0.1);}.css-1vix6iq li:last-of-type{padding-bottom:5px;border:none;}.css-1vix6iq h4{margin:0;font-size:1.3rem;font-weight:600;line-height:1.6em;}.css-1vix6iq li a{display:block;font-size:inherit;color:#fff;opacity:0.8;}.css-1vix6iq li a:hover{opacity:1;}</style><div class="read-next-card-content css-1vix6iq ez817vd2"><ul><li><h4><a href="/tools/alfred-korean-english-converter/">한영타변환기 Alfred Workflow 개발기</a></h4><style data-emotion="css 1qhf9t">.css-1qhf9t{margin-top:2px;font-size:1.2rem;font-weight:400;line-height:1.4em;}.css-1qhf9t p{margin:0;font-size:inherit;color:rgb(255 255 255 / 0.6);}.css-1qhf9t p time{font-size:inherit;}</style><div class="read-next-card-meta css-1qhf9t ez817vd1"><p><time dateTime="2023-06-10">2023-06-10</time> -<!-- --> <!-- -->8 min read</p></div></li><li><h4><a href="/node/node-version-manager/">노드 버전 매니저 툴 비교기(nvm &amp; fnm &amp; Volta)</a></h4><div class="read-next-card-meta css-1qhf9t ez817vd1"><p><time dateTime="2023-03-28">2023-03-28</time> -<!-- --> <!-- -->9 min read</p></div></li><li><h4><a href="/node/setting-npm-differently-for-each-project/">nvm을 사용해 프로젝트별로 Node.js 버전 다르게 사용하기</a></h4><div class="read-next-card-meta css-1qhf9t ez817vd1"><p><time dateTime="2022-04-10">2022-04-10</time> -<!-- --> <!-- -->5 min read</p></div></li></ul></div><style data-emotion="css ok4czd">.css-ok4czd{position:relative;margin:40px 0 5px;}.css-ok4czd a{padding:7px 12px 8px 14px;font-size:1.3rem;color:rgb(255 255 255 / 0.6);border:1px solid rgb(255 255 255 / 0.6);border-radius:999px;-webkit-transition:all 0.35s ease-in-out;transition:all 0.35s ease-in-out;}.css-ok4czd a:hover{color:#fecd35;-webkit-text-decoration:none;text-decoration:none;border-color:#fecd35;}</style><footer class="read-next-card-footer css-ok4czd ez817vd0"><a href="/tags/tool/">See all 4 posts<!-- --> →</a></footer></article><style data-emotion="css 49lcs7">.css-49lcs7{position:relative;overflow:hidden;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 301px;-ms-flex:1 1 301px;flex:1 1 301px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:220px;margin:0 20px 60px;-webkit-background-size:cover;background-size:cover;}.css-49lcs7 img{-webkit-transform:scale(1)!important;-moz-transform:scale(1)!important;-ms-transform:scale(1)!important;transform:scale(1)!important;-webkit-transition:opacity 0.3s ease-out 0s,-webkit-transform 0.5s ease 0s!important;transition:opacity 0.3s ease-out 0s,transform 0.5s ease 0s!important;}.css-49lcs7:hover .post-card-image:after{opacity:var(--post-card-after-opacity);}.css-49lcs7:hover img[data-main-image]{-webkit-transform:scale(1.03)!important;-moz-transform:scale(1.03)!important;-ms-transform:scale(1.03)!important;transform:scale(1.03)!important;}.css-49lcs7.is-next .post-card-image{background:#191b1f;border:1px solid hsl(230 6% 23%);}.css-49lcs7.is-next .post-card-primary-tag a{color:#90a2aa;}.css-49lcs7.is-next .post-card-excerpt{color:#768086;}.css-49lcs7.is-next .post-card-byline-content{color:#90a2aa;}</style><article class="post-card   is-next css-49lcs7"><style data-emotion="css uih3rl">.css-uih3rl{position:relative;overflow:hidden;display:block;border-radius:12px;}</style><a class="post-card-image-link css-uih3rl" href="/environment/why-do-you-use-import-meta-in-vite/"><style data-emotion="css pg199o">.css-pg199o{overflow:hidden;width:auto;height:200px;background-color:var(--background-color);-webkit-background-size:cover;background-size:cover;border:1px solid var(--image-border-color);border-radius:12px;}.css-pg199o:after{content:'';position:absolute;top:0;left:0;display:block;width:100%;height:100%;opacity:var(--post-card-opacity);background-color:var(--post-card-background);-webkit-transition:all 0.3s ease 0s;transition:all 0.3s ease 0s;}.css-pg199o img{border-radius:12px;}</style><div class="post-card-image css-pg199o ezywgfd6"><div data-gatsby-image-wrapper="" style="height:100%" class="gatsby-image-wrapper"><div aria-hidden="true" style="padding-top:56.25%"></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAALABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAgDBAUJ/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwAC/9oADAMBAAIQAxAAAAHioxyxxrq2a5D/AP/EAB0QAAICAQUAAAAAAAAAAAAAAAEDAgQFBgcREzP/2gAIAQEAAQUCQEi3uDhNDYSqFiYHsGT6K8eU/wD/xAAcEQADAQACAwAAAAAAAAAAAAABAgMRAAQTMVL/2gAIAQMBAT8Bk80TshpeR7SnOTljkCtko1ET0XdA0ifhzukLnP/EAB4RAAICAQUBAAAAAAAAAAAAAAIDAQQTABESFCJx/9oACAECAQE/ASFZYiKXC2u42KxtgUtFtZ9ZqriZAuwscoWK3pZV7SFtiZjkBbfNf//EACcQAAIBAwMDAwUAAAAAAAAAAAECAwQREhMhMQAFIhRBUQYWoaKx/9oACAEBAAY/AoUqI55aX1MRqY6cRrO1PpDW0YirRCXDMxS+Sl+V36+lftWt7nXVdd22mre41NXUpJHoSM6085Kx40ss5DCOmjAiSKNiweRlxyKHfI3EExy823yi8G+LgDj4A6EO+nqq2HtfQ5/Y/wA46zyJaD06RX3xTInG3BW7HYggdIbsC1ycXdBcsfZSB+ONuB1//8QAGhABAQEAAwEAAAAAAAAAAAAAAREhADFRQf/aAAgBAQABPyEB0QioD06aBvPMkyJr1vEDS1wS+uUffxbVsQFC1s+uJEII0j0vT4HHpEHKJG1IkuGBCBJRfBFZ/wAzABAD/9oADAMBAAIAAwAAABDQ7//EABcRAQADAAAAAAAAAAAAAAAAAAEQESH/2gAIAQMBAT8QD+YHPqFkohgRf//EABsRAAIBBQAAAAAAAAAAAAAAAAERIQAxYdHw/9oACAECAQE/ELOkBMVBFxj+qTRUkZeNcgv/xAAXEAEBAQEAAAAAAAAAAAAAAAABEQAh/9oACAEBAAE/EK8yc0UjoSrqANjQlcA6Uhirylvrj0pCCC29EhbINgwIAAA4ICG6ohgTTj05g49wjVX34qCAT4b/2Q==" alt=""/><picture><source type="image/webp" data-srcset="/static/3e003894f92a9a0261250e0307b1c3bf/a66aa/main.webp 750w,/static/3e003894f92a9a0261250e0307b1c3bf/65dd5/main.webp 1080w,/static/3e003894f92a9a0261250e0307b1c3bf/4fad6/main.webp 1366w,/static/3e003894f92a9a0261250e0307b1c3bf/c512e/main.webp 1920w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" data-src="/static/3e003894f92a9a0261250e0307b1c3bf/a764f/main.jpg" data-srcset="/static/3e003894f92a9a0261250e0307b1c3bf/37bba/main.jpg 750w,/static/3e003894f92a9a0261250e0307b1c3bf/61c72/main.jpg 1080w,/static/3e003894f92a9a0261250e0307b1c3bf/d61e8/main.jpg 1366w,/static/3e003894f92a9a0261250e0307b1c3bf/a764f/main.jpg 1920w" alt="Vite에서 import.meta는 왜 사용하는 걸까? (feat. HMR) cover image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/3e003894f92a9a0261250e0307b1c3bf/a66aa/main.webp 750w,/static/3e003894f92a9a0261250e0307b1c3bf/65dd5/main.webp 1080w,/static/3e003894f92a9a0261250e0307b1c3bf/4fad6/main.webp 1366w,/static/3e003894f92a9a0261250e0307b1c3bf/c512e/main.webp 1920w" sizes="100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="100vw" decoding="async" loading="lazy" src="/static/3e003894f92a9a0261250e0307b1c3bf/a764f/main.jpg" srcSet="/static/3e003894f92a9a0261250e0307b1c3bf/37bba/main.jpg 750w,/static/3e003894f92a9a0261250e0307b1c3bf/61c72/main.jpg 1080w,/static/3e003894f92a9a0261250e0307b1c3bf/d61e8/main.jpg 1366w,/static/3e003894f92a9a0261250e0307b1c3bf/a764f/main.jpg 1920w" alt="Vite에서 import.meta는 왜 사용하는 걸까? (feat. HMR) cover image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></div></a><style data-emotion="css z5atxi">.css-z5atxi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="post-card-content css-z5atxi ezywgfd5"><style data-emotion="css vm6g88">.css-vm6g88{margin:15px 0 0.2em;font-size:1.2rem;font-weight:500;color:#90a2aa;letter-spacing:0.2px;}.css-vm6g88 a{font-size:1.2rem;}</style><div class="post-card-primary-tag css-vm6g88 ezywgfd4"><a href="/tags/bundler/">Bundler</a>,  <a href="/tags/vite/">Vite</a>,  <a href="/tags/environment/">Environment</a></div><style data-emotion="css 1fjrpmt">.css-1fjrpmt{position:relative;display:block;color:#15171A;}.css-1fjrpmt:hover{-webkit-text-decoration:none;text-decoration:none;}</style><a class="post-card-content-link css-1fjrpmt" href="/environment/why-do-you-use-import-meta-in-vite/"><header><style data-emotion="css 18yvs8h">.css-18yvs8h{margin:0 0 0.4em;line-height:1.15em;color:var(--post-card-title);word-break:keep-all;}</style><h2 class="post-card-title css-18yvs8h ezywgfd3">Vite에서 import.meta는 왜 사용하는 걸까? (feat. HMR)</h2></header><style data-emotion="css 1t868fc">.css-1t868fc{font-size:1.6rem;color:var(--post-card-description);}.css-1t868fc p{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;width:100%;margin-bottom:0.4em;font-size:1.4rem;text-overflow:ellipsis;-webkit-line-clamp:2;}</style><section class="post-card-excerpt css-1t868fc ezywgfd2"><p>Vite의 철학에 기반한 방식, import.meta에 대한 이야기</p></section></a><style data-emotion="css 143c7df">.css-143c7df{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;padding:0;}</style><footer class="post-card-meta css-143c7df ezywgfd1"><style data-emotion="css 137vq87">.css-137vq87{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 50%;-ms-flex:1 1 50%;flex:1 1 50%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-weight:400;line-height:1.4em;color:#90a2aa;letter-spacing:0.2px;}.css-137vq87 time{font-size:1.3rem;}.css-137vq87 span{margin:0;font-size:1.3rem;}.css-137vq87 a{font-weight:600;color:var(--post-card-by-line);}</style><div class="post-card-byline-content css-137vq87 ezywgfd0"><span class="post-card-byline-date"><time dateTime="2024-02-04">2024-02-04</time> <span class="bull">•</span> <span>15 min read</span></span></div></footer></div></article></div></div></aside><style data-emotion="css d4eprp">.css-d4eprp{position:relative;padding:0 5vw;position:relative;padding-top:20px;padding-bottom:22px;color:#fff;background:#000;}</style><footer class="css-d4eprp"><style data-emotion="css 98e3yl">.css-98e3yl{width:100%;max-width:1040px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;font-size:1.3rem;color:rgb(255 255 255 / 0.7);}.css-98e3yl a{color:rgb(255 255 255 / 0.7);}.css-98e3yl a:hover{color:rgb(255 255 255 / 1);-webkit-text-decoration:none;text-decoration:none;}@media (max-width: 650px){.css-98e3yl{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="css-98e3yl"><section class="copyright">© <!-- -->2024<!-- --> <span>|  </span><a href="https://www.gatsbyjs.com/" target="_blank" rel="nofollow noreferrer">Pozafly&#x27;s Blog<!-- --> <!-- -->is based on Gatsby</a></section><style data-emotion="css 13qgqyf">.css-13qgqyf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-13qgqyf a{position:relative;margin-left:20px;font-size:1.3rem;}.css-13qgqyf a:before{content:'';position:absolute;top:11px;left:-11px;display:block;width:2px;height:2px;background:#fff;border-radius:100%;}.css-13qgqyf a:first-of-type:before{display:none;}@media (max-width: 650px){.css-13qgqyf a:first-of-type{margin-left:0;}}</style><nav class="css-13qgqyf e69t7dt0"><a href="/">Latest Posts</a><a href="https://github.com/pozafly" target="_blank" rel="noopener noreferrer">Github</a><a href="/rss.xml">RSS</a></nav></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/tools/create-a-slack-random-drawer-app-to-deploy-with-cloudflare/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-dc4cdb937e32791de7df.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-e5c26c6534c8a9ec0974.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-cbfe9007f8a9ee2b71c4.js\"],\"component---src-pages-tags-tsx\":[\"/component---src-pages-tags-tsx-33065f7d4cc9d2b5fdb9.js\"],\"component---src-templates-index-tsx\":[\"/component---src-templates-index-tsx-d708e5fb7c66855ed7c9.js\"],\"component---src-templates-post-tsx\":[],\"component---src-templates-tags-tsx\":[\"/component---src-templates-tags-tsx-995568dc7627671250b5.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="ce205b4963ae7534a910";</script><script src="/webpack-runtime-b556248653fa1a040ec7.js" async></script><script src="/app-dc4cdb937e32791de7df.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>